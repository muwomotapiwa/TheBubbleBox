<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Bubble Box - Premium Laundry & Cleaning Services</title>
    <script type="module" crossorigin>(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))S(k);new MutationObserver(k=>{for(const P of k)if(P.type==="childList")for(const T of P.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&S(T)}).observe(document,{childList:!0,subtree:!0});function _(k){const P={};return k.integrity&&(P.integrity=k.integrity),k.referrerPolicy&&(P.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?P.credentials="include":k.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function S(k){if(k.ep)return;k.ep=!0;const P=_(k);fetch(k.href,P)}})();function Ov(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var Cx={exports:{}},ig={};var P_;function Lv(){if(P_)return ig;P_=1;var m=Symbol.for("react.transitional.element"),h=Symbol.for("react.fragment");function _(S,k,P){var T=null;if(P!==void 0&&(T=""+P),k.key!==void 0&&(T=""+k.key),"key"in k){P={};for(var c in k)c!=="key"&&(P[c]=k[c])}else P=k;return k=P.ref,{$$typeof:m,type:S,key:T,ref:k!==void 0?k:null,props:P}}return ig.Fragment=h,ig.jsx=_,ig.jsxs=_,ig}var D_;function Bv(){return D_||(D_=1,Cx.exports=Lv()),Cx.exports}var n=Bv(),Ax={exports:{}},Ds={};var R_;function Fv(){if(R_)return Ds;R_=1;var m=Symbol.for("react.transitional.element"),h=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),P=Symbol.for("react.consumer"),T=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),F=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),se=Symbol.for("react.activity"),ue=Symbol.iterator;function ae(le){return le===null||typeof le!="object"?null:(le=ue&&le[ue]||le["@@iterator"],typeof le=="function"?le:null)}var Q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y=Object.assign,G={};function pe(le,Le,nt){this.props=le,this.context=Le,this.refs=G,this.updater=nt||Q}pe.prototype.isReactComponent={},pe.prototype.setState=function(le,Le){if(typeof le!="object"&&typeof le!="function"&&le!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,le,Le,"setState")},pe.prototype.forceUpdate=function(le){this.updater.enqueueForceUpdate(this,le,"forceUpdate")};function _e(){}_e.prototype=pe.prototype;function Ne(le,Le,nt){this.props=le,this.context=Le,this.refs=G,this.updater=nt||Q}var Oe=Ne.prototype=new _e;Oe.constructor=Ne,Y(Oe,pe.prototype),Oe.isPureReactComponent=!0;var Be=Array.isArray;function xt(){}var $e={H:null,A:null,T:null,S:null},de=Object.prototype.hasOwnProperty;function Ae(le,Le,nt){var lt=nt.ref;return{$$typeof:m,type:le,key:Le,ref:lt!==void 0?lt:null,props:nt}}function Ye(le,Le){return Ae(le.type,Le,le.props)}function _t(le){return typeof le=="object"&&le!==null&&le.$$typeof===m}function Et(le){var Le={"=":"=0",":":"=2"};return"$"+le.replace(/[=:]/g,function(nt){return Le[nt]})}var zt=/\/+/g;function ht(le,Le){return typeof le=="object"&&le!==null&&le.key!=null?Et(""+le.key):Le.toString(36)}function Qe(le){switch(le.status){case"fulfilled":return le.value;case"rejected":throw le.reason;default:switch(typeof le.status=="string"?le.then(xt,xt):(le.status="pending",le.then(function(Le){le.status==="pending"&&(le.status="fulfilled",le.value=Le)},function(Le){le.status==="pending"&&(le.status="rejected",le.reason=Le)})),le.status){case"fulfilled":return le.value;case"rejected":throw le.reason}}throw le}function Ce(le,Le,nt,lt,Ot){var Mt=typeof le;(Mt==="undefined"||Mt==="boolean")&&(le=null);var mt=!1;if(le===null)mt=!0;else switch(Mt){case"bigint":case"string":case"number":mt=!0;break;case"object":switch(le.$$typeof){case m:case h:mt=!0;break;case re:return mt=le._init,Ce(mt(le._payload),Le,nt,lt,Ot)}}if(mt)return Ot=Ot(le),mt=lt===""?"."+ht(le,0):lt,Be(Ot)?(nt="",mt!=null&&(nt=mt.replace(zt,"$&/")+"/"),Ce(Ot,Le,nt,"",function(js){return js})):Ot!=null&&(_t(Ot)&&(Ot=Ye(Ot,nt+(Ot.key==null||le&&le.key===Ot.key?"":(""+Ot.key).replace(zt,"$&/")+"/")+mt)),Le.push(Ot)),1;mt=0;var Dt=lt===""?".":lt+":";if(Be(le))for(var ys=0;ys<le.length;ys++)lt=le[ys],Mt=Dt+ht(lt,ys),mt+=Ce(lt,Le,nt,Mt,Ot);else if(ys=ae(le),typeof ys=="function")for(le=ys.call(le),ys=0;!(lt=le.next()).done;)lt=lt.value,Mt=Dt+ht(lt,ys++),mt+=Ce(lt,Le,nt,Mt,Ot);else if(Mt==="object"){if(typeof le.then=="function")return Ce(Qe(le),Le,nt,lt,Ot);throw Le=String(le),Error("Objects are not valid as a React child (found: "+(Le==="[object Object]"?"object with keys {"+Object.keys(le).join(", ")+"}":Le)+"). If you meant to render a collection of children, use an array instead.")}return mt}function We(le,Le,nt){if(le==null)return le;var lt=[],Ot=0;return Ce(le,lt,"","",function(Mt){return Le.call(nt,Mt,Ot++)}),lt}function dt(le){if(le._status===-1){var Le=le._result;Le=Le(),Le.then(function(nt){(le._status===0||le._status===-1)&&(le._status=1,le._result=nt)},function(nt){(le._status===0||le._status===-1)&&(le._status=2,le._result=nt)}),le._status===-1&&(le._status=0,le._result=Le)}if(le._status===1)return le._result.default;throw le._result}var Ze=typeof reportError=="function"?reportError:function(le){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Le=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof le=="object"&&le!==null&&typeof le.message=="string"?String(le.message):String(le),error:le});if(!window.dispatchEvent(Le))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",le);return}console.error(le)},Pe={map:We,forEach:function(le,Le,nt){We(le,function(){Le.apply(this,arguments)},nt)},count:function(le){var Le=0;return We(le,function(){Le++}),Le},toArray:function(le){return We(le,function(Le){return Le})||[]},only:function(le){if(!_t(le))throw Error("React.Children.only expected to receive a single React element child.");return le}};return Ds.Activity=se,Ds.Children=Pe,Ds.Component=pe,Ds.Fragment=_,Ds.Profiler=k,Ds.PureComponent=Ne,Ds.StrictMode=S,Ds.Suspense=O,Ds.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$e,Ds.__COMPILER_RUNTIME={__proto__:null,c:function(le){return $e.H.useMemoCache(le)}},Ds.cache=function(le){return function(){return le.apply(null,arguments)}},Ds.cacheSignal=function(){return null},Ds.cloneElement=function(le,Le,nt){if(le==null)throw Error("The argument must be a React element, but you passed "+le+".");var lt=Y({},le.props),Ot=le.key;if(Le!=null)for(Mt in Le.key!==void 0&&(Ot=""+Le.key),Le)!de.call(Le,Mt)||Mt==="key"||Mt==="__self"||Mt==="__source"||Mt==="ref"&&Le.ref===void 0||(lt[Mt]=Le[Mt]);var Mt=arguments.length-2;if(Mt===1)lt.children=nt;else if(1<Mt){for(var mt=Array(Mt),Dt=0;Dt<Mt;Dt++)mt[Dt]=arguments[Dt+2];lt.children=mt}return Ae(le.type,Ot,lt)},Ds.createContext=function(le){return le={$$typeof:T,_currentValue:le,_currentValue2:le,_threadCount:0,Provider:null,Consumer:null},le.Provider=le,le.Consumer={$$typeof:P,_context:le},le},Ds.createElement=function(le,Le,nt){var lt,Ot={},Mt=null;if(Le!=null)for(lt in Le.key!==void 0&&(Mt=""+Le.key),Le)de.call(Le,lt)&&lt!=="key"&&lt!=="__self"&&lt!=="__source"&&(Ot[lt]=Le[lt]);var mt=arguments.length-2;if(mt===1)Ot.children=nt;else if(1<mt){for(var Dt=Array(mt),ys=0;ys<mt;ys++)Dt[ys]=arguments[ys+2];Ot.children=Dt}if(le&&le.defaultProps)for(lt in mt=le.defaultProps,mt)Ot[lt]===void 0&&(Ot[lt]=mt[lt]);return Ae(le,Mt,Ot)},Ds.createRef=function(){return{current:null}},Ds.forwardRef=function(le){return{$$typeof:c,render:le}},Ds.isValidElement=_t,Ds.lazy=function(le){return{$$typeof:re,_payload:{_status:-1,_result:le},_init:dt}},Ds.memo=function(le,Le){return{$$typeof:F,type:le,compare:Le===void 0?null:Le}},Ds.startTransition=function(le){var Le=$e.T,nt={};$e.T=nt;try{var lt=le(),Ot=$e.S;Ot!==null&&Ot(nt,lt),typeof lt=="object"&&lt!==null&&typeof lt.then=="function"&&lt.then(xt,Ze)}catch(Mt){Ze(Mt)}finally{Le!==null&&nt.types!==null&&(Le.types=nt.types),$e.T=Le}},Ds.unstable_useCacheRefresh=function(){return $e.H.useCacheRefresh()},Ds.use=function(le){return $e.H.use(le)},Ds.useActionState=function(le,Le,nt){return $e.H.useActionState(le,Le,nt)},Ds.useCallback=function(le,Le){return $e.H.useCallback(le,Le)},Ds.useContext=function(le){return $e.H.useContext(le)},Ds.useDebugValue=function(){},Ds.useDeferredValue=function(le,Le){return $e.H.useDeferredValue(le,Le)},Ds.useEffect=function(le,Le){return $e.H.useEffect(le,Le)},Ds.useEffectEvent=function(le){return $e.H.useEffectEvent(le)},Ds.useId=function(){return $e.H.useId()},Ds.useImperativeHandle=function(le,Le,nt){return $e.H.useImperativeHandle(le,Le,nt)},Ds.useInsertionEffect=function(le,Le){return $e.H.useInsertionEffect(le,Le)},Ds.useLayoutEffect=function(le,Le){return $e.H.useLayoutEffect(le,Le)},Ds.useMemo=function(le,Le){return $e.H.useMemo(le,Le)},Ds.useOptimistic=function(le,Le){return $e.H.useOptimistic(le,Le)},Ds.useReducer=function(le,Le,nt){return $e.H.useReducer(le,Le,nt)},Ds.useRef=function(le){return $e.H.useRef(le)},Ds.useState=function(le){return $e.H.useState(le)},Ds.useSyncExternalStore=function(le,Le,nt){return $e.H.useSyncExternalStore(le,Le,nt)},Ds.useTransition=function(){return $e.H.useTransition()},Ds.version="19.2.3",Ds}var I_;function l_(){return I_||(I_=1,Ax.exports=Fv()),Ax.exports}var ee=l_(),kx={exports:{}},ag={},Mx={exports:{}},Px={};var z_;function Uv(){return z_||(z_=1,(function(m){function h(Ce,We){var dt=Ce.length;Ce.push(We);e:for(;0<dt;){var Ze=dt-1>>>1,Pe=Ce[Ze];if(0<k(Pe,We))Ce[Ze]=We,Ce[dt]=Pe,dt=Ze;else break e}}function _(Ce){return Ce.length===0?null:Ce[0]}function S(Ce){if(Ce.length===0)return null;var We=Ce[0],dt=Ce.pop();if(dt!==We){Ce[0]=dt;e:for(var Ze=0,Pe=Ce.length,le=Pe>>>1;Ze<le;){var Le=2*(Ze+1)-1,nt=Ce[Le],lt=Le+1,Ot=Ce[lt];if(0>k(nt,dt))lt<Pe&&0>k(Ot,nt)?(Ce[Ze]=Ot,Ce[lt]=dt,Ze=lt):(Ce[Ze]=nt,Ce[Le]=dt,Ze=Le);else if(lt<Pe&&0>k(Ot,dt))Ce[Ze]=Ot,Ce[lt]=dt,Ze=lt;else break e}}return We}function k(Ce,We){var dt=Ce.sortIndex-We.sortIndex;return dt!==0?dt:Ce.id-We.id}if(m.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var P=performance;m.unstable_now=function(){return P.now()}}else{var T=Date,c=T.now();m.unstable_now=function(){return T.now()-c}}var O=[],F=[],re=1,se=null,ue=3,ae=!1,Q=!1,Y=!1,G=!1,pe=typeof setTimeout=="function"?setTimeout:null,_e=typeof clearTimeout=="function"?clearTimeout:null,Ne=typeof setImmediate<"u"?setImmediate:null;function Oe(Ce){for(var We=_(F);We!==null;){if(We.callback===null)S(F);else if(We.startTime<=Ce)S(F),We.sortIndex=We.expirationTime,h(O,We);else break;We=_(F)}}function Be(Ce){if(Y=!1,Oe(Ce),!Q)if(_(O)!==null)Q=!0,xt||(xt=!0,Et());else{var We=_(F);We!==null&&Qe(Be,We.startTime-Ce)}}var xt=!1,$e=-1,de=5,Ae=-1;function Ye(){return G?!0:!(m.unstable_now()-Ae<de)}function _t(){if(G=!1,xt){var Ce=m.unstable_now();Ae=Ce;var We=!0;try{e:{Q=!1,Y&&(Y=!1,_e($e),$e=-1),ae=!0;var dt=ue;try{t:{for(Oe(Ce),se=_(O);se!==null&&!(se.expirationTime>Ce&&Ye());){var Ze=se.callback;if(typeof Ze=="function"){se.callback=null,ue=se.priorityLevel;var Pe=Ze(se.expirationTime<=Ce);if(Ce=m.unstable_now(),typeof Pe=="function"){se.callback=Pe,Oe(Ce),We=!0;break t}se===_(O)&&S(O),Oe(Ce)}else S(O);se=_(O)}if(se!==null)We=!0;else{var le=_(F);le!==null&&Qe(Be,le.startTime-Ce),We=!1}}break e}finally{se=null,ue=dt,ae=!1}We=void 0}}finally{We?Et():xt=!1}}}var Et;if(typeof Ne=="function")Et=function(){Ne(_t)};else if(typeof MessageChannel<"u"){var zt=new MessageChannel,ht=zt.port2;zt.port1.onmessage=_t,Et=function(){ht.postMessage(null)}}else Et=function(){pe(_t,0)};function Qe(Ce,We){$e=pe(function(){Ce(m.unstable_now())},We)}m.unstable_IdlePriority=5,m.unstable_ImmediatePriority=1,m.unstable_LowPriority=4,m.unstable_NormalPriority=3,m.unstable_Profiling=null,m.unstable_UserBlockingPriority=2,m.unstable_cancelCallback=function(Ce){Ce.callback=null},m.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):de=0<Ce?Math.floor(1e3/Ce):5},m.unstable_getCurrentPriorityLevel=function(){return ue},m.unstable_next=function(Ce){switch(ue){case 1:case 2:case 3:var We=3;break;default:We=ue}var dt=ue;ue=We;try{return Ce()}finally{ue=dt}},m.unstable_requestPaint=function(){G=!0},m.unstable_runWithPriority=function(Ce,We){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var dt=ue;ue=Ce;try{return We()}finally{ue=dt}},m.unstable_scheduleCallback=function(Ce,We,dt){var Ze=m.unstable_now();switch(typeof dt=="object"&&dt!==null?(dt=dt.delay,dt=typeof dt=="number"&&0<dt?Ze+dt:Ze):dt=Ze,Ce){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=dt+Pe,Ce={id:re++,callback:We,priorityLevel:Ce,startTime:dt,expirationTime:Pe,sortIndex:-1},dt>Ze?(Ce.sortIndex=dt,h(F,Ce),_(O)===null&&Ce===_(F)&&(Y?(_e($e),$e=-1):Y=!0,Qe(Be,dt-Ze))):(Ce.sortIndex=Pe,h(O,Ce),Q||ae||(Q=!0,xt||(xt=!0,Et()))),Ce},m.unstable_shouldYield=Ye,m.unstable_wrapCallback=function(Ce){var We=ue;return function(){var dt=ue;ue=We;try{return Ce.apply(this,arguments)}finally{ue=dt}}}})(Px)),Px}var O_;function $v(){return O_||(O_=1,Mx.exports=Uv()),Mx.exports}var Dx={exports:{}},pn={};var L_;function Vv(){if(L_)return pn;L_=1;var m=l_();function h(O){var F="https://react.dev/errors/"+O;if(1<arguments.length){F+="?args[]="+encodeURIComponent(arguments[1]);for(var re=2;re<arguments.length;re++)F+="&args[]="+encodeURIComponent(arguments[re])}return"Minified React error #"+O+"; visit "+F+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function _(){}var S={d:{f:_,r:function(){throw Error(h(522))},D:_,C:_,L:_,m:_,X:_,S:_,M:_},p:0,findDOMNode:null},k=Symbol.for("react.portal");function P(O,F,re){var se=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:k,key:se==null?null:""+se,children:O,containerInfo:F,implementation:re}}var T=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(O,F){if(O==="font")return"";if(typeof F=="string")return F==="use-credentials"?F:""}return pn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,pn.createPortal=function(O,F){var re=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!F||F.nodeType!==1&&F.nodeType!==9&&F.nodeType!==11)throw Error(h(299));return P(O,F,null,re)},pn.flushSync=function(O){var F=T.T,re=S.p;try{if(T.T=null,S.p=2,O)return O()}finally{T.T=F,S.p=re,S.d.f()}},pn.preconnect=function(O,F){typeof O=="string"&&(F?(F=F.crossOrigin,F=typeof F=="string"?F==="use-credentials"?F:"":void 0):F=null,S.d.C(O,F))},pn.prefetchDNS=function(O){typeof O=="string"&&S.d.D(O)},pn.preinit=function(O,F){if(typeof O=="string"&&F&&typeof F.as=="string"){var re=F.as,se=c(re,F.crossOrigin),ue=typeof F.integrity=="string"?F.integrity:void 0,ae=typeof F.fetchPriority=="string"?F.fetchPriority:void 0;re==="style"?S.d.S(O,typeof F.precedence=="string"?F.precedence:void 0,{crossOrigin:se,integrity:ue,fetchPriority:ae}):re==="script"&&S.d.X(O,{crossOrigin:se,integrity:ue,fetchPriority:ae,nonce:typeof F.nonce=="string"?F.nonce:void 0})}},pn.preinitModule=function(O,F){if(typeof O=="string")if(typeof F=="object"&&F!==null){if(F.as==null||F.as==="script"){var re=c(F.as,F.crossOrigin);S.d.M(O,{crossOrigin:re,integrity:typeof F.integrity=="string"?F.integrity:void 0,nonce:typeof F.nonce=="string"?F.nonce:void 0})}}else F==null&&S.d.M(O)},pn.preload=function(O,F){if(typeof O=="string"&&typeof F=="object"&&F!==null&&typeof F.as=="string"){var re=F.as,se=c(re,F.crossOrigin);S.d.L(O,re,{crossOrigin:se,integrity:typeof F.integrity=="string"?F.integrity:void 0,nonce:typeof F.nonce=="string"?F.nonce:void 0,type:typeof F.type=="string"?F.type:void 0,fetchPriority:typeof F.fetchPriority=="string"?F.fetchPriority:void 0,referrerPolicy:typeof F.referrerPolicy=="string"?F.referrerPolicy:void 0,imageSrcSet:typeof F.imageSrcSet=="string"?F.imageSrcSet:void 0,imageSizes:typeof F.imageSizes=="string"?F.imageSizes:void 0,media:typeof F.media=="string"?F.media:void 0})}},pn.preloadModule=function(O,F){if(typeof O=="string")if(F){var re=c(F.as,F.crossOrigin);S.d.m(O,{as:typeof F.as=="string"&&F.as!=="script"?F.as:void 0,crossOrigin:re,integrity:typeof F.integrity=="string"?F.integrity:void 0})}else S.d.m(O)},pn.requestFormReset=function(O){S.d.r(O)},pn.unstable_batchedUpdates=function(O,F){return O(F)},pn.useFormState=function(O,F,re){return T.H.useFormState(O,F,re)},pn.useFormStatus=function(){return T.H.useHostTransitionStatus()},pn.version="19.2.3",pn}var B_;function qv(){if(B_)return Dx.exports;B_=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(h){console.error(h)}}return m(),Dx.exports=Vv(),Dx.exports}var F_;function Gv(){if(F_)return ag;F_=1;var m=$v(),h=l_(),_=qv();function S(i){var o="https://react.dev/errors/"+i;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)o+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function k(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function P(i){var o=i,f=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&4098)!==0&&(f=o.return),i=o.return;while(i)}return o.tag===3?f:null}function T(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function c(i){if(i.tag===31){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function O(i){if(P(i)!==i)throw Error(S(188))}function F(i){var o=i.alternate;if(!o){if(o=P(i),o===null)throw Error(S(188));return o!==i?null:i}for(var f=i,v=o;;){var C=f.return;if(C===null)break;var D=C.alternate;if(D===null){if(v=C.return,v!==null){f=v;continue}break}if(C.child===D.child){for(D=C.child;D;){if(D===f)return O(C),i;if(D===v)return O(C),o;D=D.sibling}throw Error(S(188))}if(f.return!==v.return)f=C,v=D;else{for(var Z=!1,ce=C.child;ce;){if(ce===f){Z=!0,f=C,v=D;break}if(ce===v){Z=!0,v=C,f=D;break}ce=ce.sibling}if(!Z){for(ce=D.child;ce;){if(ce===f){Z=!0,f=D,v=C;break}if(ce===v){Z=!0,v=D,f=C;break}ce=ce.sibling}if(!Z)throw Error(S(189))}}if(f.alternate!==v)throw Error(S(190))}if(f.tag!==3)throw Error(S(188));return f.stateNode.current===f?i:o}function re(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i;for(i=i.child;i!==null;){if(o=re(i),o!==null)return o;i=i.sibling}return null}var se=Object.assign,ue=Symbol.for("react.element"),ae=Symbol.for("react.transitional.element"),Q=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),pe=Symbol.for("react.profiler"),_e=Symbol.for("react.consumer"),Ne=Symbol.for("react.context"),Oe=Symbol.for("react.forward_ref"),Be=Symbol.for("react.suspense"),xt=Symbol.for("react.suspense_list"),$e=Symbol.for("react.memo"),de=Symbol.for("react.lazy"),Ae=Symbol.for("react.activity"),Ye=Symbol.for("react.memo_cache_sentinel"),_t=Symbol.iterator;function Et(i){return i===null||typeof i!="object"?null:(i=_t&&i[_t]||i["@@iterator"],typeof i=="function"?i:null)}var zt=Symbol.for("react.client.reference");function ht(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===zt?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Y:return"Fragment";case pe:return"Profiler";case G:return"StrictMode";case Be:return"Suspense";case xt:return"SuspenseList";case Ae:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case Q:return"Portal";case Ne:return i.displayName||"Context";case _e:return(i._context.displayName||"Context")+".Consumer";case Oe:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case $e:return o=i.displayName||null,o!==null?o:ht(i.type)||"Memo";case de:o=i._payload,i=i._init;try{return ht(i(o))}catch{}}return null}var Qe=Array.isArray,Ce=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We=_.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,dt={pending:!1,data:null,method:null,action:null},Ze=[],Pe=-1;function le(i){return{current:i}}function Le(i){0>Pe||(i.current=Ze[Pe],Ze[Pe]=null,Pe--)}function nt(i,o){Pe++,Ze[Pe]=i.current,i.current=o}var lt=le(null),Ot=le(null),Mt=le(null),mt=le(null);function Dt(i,o){switch(nt(Mt,o),nt(Ot,i),nt(lt,null),o.nodeType){case 9:case 11:i=(i=o.documentElement)&&(i=i.namespaceURI)?Dc(i):0;break;default:if(i=o.tagName,o=o.namespaceURI)o=Dc(o),i=Fm(o,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Le(lt),nt(lt,i)}function ys(){Le(lt),Le(Ot),Le(Mt)}function js(i){i.memoizedState!==null&&nt(mt,i);var o=lt.current,f=Fm(o,i.type);o!==f&&(nt(Ot,i),nt(lt,f))}function ks(i){Ot.current===i&&(Le(lt),Le(Ot)),mt.current===i&&(Le(mt),Kh._currentValue=dt)}var Es,Rr;function us(i){if(Es===void 0)try{throw Error()}catch(f){var o=f.stack.trim().match(/\n( *(at )?)/);Es=o&&o[1]||"",Rr=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Es+i+Rr}var xs=!1;function Is(i,o){if(!i||xs)return"";xs=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var v={DetermineComponentFrameRoot:function(){try{if(o){var At=function(){throw Error()};if(Object.defineProperty(At.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(At,[])}catch(ft){var ct=ft}Reflect.construct(i,[],At)}else{try{At.call()}catch(ft){ct=ft}i.call(At.prototype)}}else{try{throw Error()}catch(ft){ct=ft}(At=i())&&typeof At.catch=="function"&&At.catch(function(){})}}catch(ft){if(ft&&ct&&typeof ft.stack=="string")return[ft.stack,ct.stack]}return[null,null]}};v.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var C=Object.getOwnPropertyDescriptor(v.DetermineComponentFrameRoot,"name");C&&C.configurable&&Object.defineProperty(v.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=v.DetermineComponentFrameRoot(),Z=D[0],ce=D[1];if(Z&&ce){var ze=Z.split(`
`),at=ce.split(`
`);for(C=v=0;v<ze.length&&!ze[v].includes("DetermineComponentFrameRoot");)v++;for(;C<at.length&&!at[C].includes("DetermineComponentFrameRoot");)C++;if(v===ze.length||C===at.length)for(v=ze.length-1,C=at.length-1;1<=v&&0<=C&&ze[v]!==at[C];)C--;for(;1<=v&&0<=C;v--,C--)if(ze[v]!==at[C]){if(v!==1||C!==1)do if(v--,C--,0>C||ze[v]!==at[C]){var bt=`
`+ze[v].replace(" at new "," at ");return i.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",i.displayName)),bt}while(1<=v&&0<=C);break}}}finally{xs=!1,Error.prepareStackTrace=f}return(f=i?i.displayName||i.name:"")?us(f):""}function Os(i,o){switch(i.tag){case 26:case 27:case 5:return us(i.type);case 16:return us("Lazy");case 13:return i.child!==o&&o!==null?us("Suspense Fallback"):us("Suspense");case 19:return us("SuspenseList");case 0:case 15:return Is(i.type,!1);case 11:return Is(i.type.render,!1);case 1:return Is(i.type,!0);case 31:return us("Activity");default:return""}}function ar(i){try{var o="",f=null;do o+=Os(i,f),f=i,i=i.return;while(i);return o}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}var vi=Object.prototype.hasOwnProperty,wt=m.unstable_scheduleCallback,qs=m.unstable_cancelCallback,yr=m.unstable_shouldYield,Ha=m.unstable_requestPaint,Ms=m.unstable_now,oi=m.unstable_getCurrentPriorityLevel,Fr=m.unstable_ImmediatePriority,Oi=m.unstable_UserBlockingPriority,Gi=m.unstable_NormalPriority,Fs=m.unstable_LowPriority,Ls=m.unstable_IdlePriority,Fe=m.log,H=m.unstable_setDisableYieldValue,K=null,U=null;function he(i){if(typeof Fe=="function"&&H(i),U&&typeof U.setStrictMode=="function")try{U.setStrictMode(K,i)}catch{}}var ve=Math.clz32?Math.clz32:Ue,Ve=Math.log,He=Math.LN2;function Ue(i){return i>>>=0,i===0?32:31-(Ve(i)/He|0)|0}var Re=256,ot=262144,rt=4194304;function Te(i){var o=i&42;if(o!==0)return o;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Vt(i,o,f){var v=i.pendingLanes;if(v===0)return 0;var C=0,D=i.suspendedLanes,Z=i.pingedLanes;i=i.warmLanes;var ce=v&134217727;return ce!==0?(v=ce&~D,v!==0?C=Te(v):(Z&=ce,Z!==0?C=Te(Z):f||(f=ce&~i,f!==0&&(C=Te(f))))):(ce=v&~D,ce!==0?C=Te(ce):Z!==0?C=Te(Z):f||(f=v&~i,f!==0&&(C=Te(f)))),C===0?0:o!==0&&o!==C&&(o&D)===0&&(D=C&-C,f=o&-o,D>=f||D===32&&(f&4194048)!==0)?o:C}function as(i,o){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&o)===0}function Kt(i,o){switch(i){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ss(){var i=rt;return rt<<=1,(rt&62914560)===0&&(rt=4194304),i}function Qt(i){for(var o=[],f=0;31>f;f++)o.push(i);return o}function ls(i,o){i.pendingLanes|=o,o!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function xr(i,o,f,v,C,D){var Z=i.pendingLanes;i.pendingLanes=f,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=f,i.entangledLanes&=f,i.errorRecoveryDisabledLanes&=f,i.shellSuspendCounter=0;var ce=i.entanglements,ze=i.expirationTimes,at=i.hiddenUpdates;for(f=Z&~f;0<f;){var bt=31-ve(f),At=1<<bt;ce[bt]=0,ze[bt]=-1;var ct=at[bt];if(ct!==null)for(at[bt]=null,bt=0;bt<ct.length;bt++){var ft=ct[bt];ft!==null&&(ft.lane&=-536870913)}f&=~At}v!==0&&Sr(i,v,0),D!==0&&C===0&&i.tag!==0&&(i.suspendedLanes|=D&~(Z&~o))}function Sr(i,o,f){i.pendingLanes|=o,i.suspendedLanes&=~o;var v=31-ve(o);i.entangledLanes|=o,i.entanglements[v]=i.entanglements[v]|1073741824|f&261930}function Gs(i,o){var f=i.entangledLanes|=o;for(i=i.entanglements;f;){var v=31-ve(f),C=1<<v;C&o|i[v]&o&&(i[v]|=o),f&=~C}}function vr(i,o){var f=o&-o;return f=(f&42)!==0?1:Rs(f),(f&(i.suspendedLanes|o))!==0?0:f}function Rs(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Nt(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Ps(){var i=We.p;return i!==0?i:(i=window.event,i===void 0?32:Sy(i.type))}function Ks(i,o){var f=We.p;try{return We.p=i,o()}finally{We.p=f}}var li=Math.random().toString(36).slice(2),Hs="__reactFiber$"+li,Ct="__reactProps$"+li,is="__reactContainer$"+li,es="__reactEvents$"+li,ra="__reactListeners$"+li,rc="__reactHandles$"+li,va="__reactResources$"+li,ds="__reactMarker$"+li;function no(i){delete i[Hs],delete i[Ct],delete i[es],delete i[ra],delete i[rc]}function ba(i){var o=i[Hs];if(o)return o;for(var f=i.parentNode;f;){if(o=f[is]||f[Hs]){if(f=o.alternate,o.child!==null||f!==null&&f.child!==null)for(i=Sp(i);i!==null;){if(f=i[Hs])return f;i=Sp(i)}return o}i=f,f=i.parentNode}return null}function Za(i){if(i=i[Hs]||i[is]){var o=i.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return i}return null}function hi(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i.stateNode;throw Error(S(33))}function xe(i){var o=i[va];return o||(o=i[va]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Pt(i){i[ds]=!0}var Ft=new Set,Gt={};function Ht(i,o){Js(i,o),Js(i+"Capture",o)}function Js(i,o){for(Gt[i]=o,i=0;i<o.length;i++)Ft.add(o[i])}var fi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ia={},ei={};function Er(i){return vi.call(ei,i)?!0:vi.call(ia,i)?!1:fi.test(i)?ei[i]=!0:(ia[i]=!0,!1)}function mn(i,o,f){if(Er(o))if(f===null)i.removeAttribute(o);else{switch(typeof f){case"undefined":case"function":case"symbol":i.removeAttribute(o);return;case"boolean":var v=o.toLowerCase().slice(0,5);if(v!=="data-"&&v!=="aria-"){i.removeAttribute(o);return}}i.setAttribute(o,""+f)}}function Rn(i,o,f){if(f===null)i.removeAttribute(o);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttribute(o,""+f)}}function Wa(i,o,f,v){if(v===null)i.removeAttribute(f);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(f);return}i.setAttributeNS(o,f,""+v)}}function Zs(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Kd(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function xf(i,o,f){var v=Object.getOwnPropertyDescriptor(i.constructor.prototype,o);if(!i.hasOwnProperty(o)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var C=v.get,D=v.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return C.call(this)},set:function(Z){f=""+Z,D.call(this,Z)}}),Object.defineProperty(i,o,{enumerable:v.enumerable}),{getValue:function(){return f},setValue:function(Z){f=""+Z},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function cl(i){if(!i._valueTracker){var o=Kd(i)?"checked":"value";i._valueTracker=xf(i,o,""+i[o])}}function Jd(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var f=o.getValue(),v="";return i&&(v=Kd(i)?i.checked?"true":"false":i.value),i=v,i!==f?(o.setValue(i),!0):!1}function Gc(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var _f=/[\n"\\]/g;function Hi(i){return i.replace(_f,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Hc(i,o,f,v,C,D,Z,ce){i.name="",Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?i.type=Z:i.removeAttribute("type"),o!=null?Z==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+Zs(o)):i.value!==""+Zs(o)&&(i.value=""+Zs(o)):Z!=="submit"&&Z!=="reset"||i.removeAttribute("value"),o!=null?Zc(i,Z,Zs(o)):f!=null?Zc(i,Z,Zs(f)):v!=null&&i.removeAttribute("value"),C==null&&D!=null&&(i.defaultChecked=!!D),C!=null&&(i.checked=C&&typeof C!="function"&&typeof C!="symbol"),ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?i.name=""+Zs(ce):i.removeAttribute("name")}function Xu(i,o,f,v,C,D,Z,ce){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(i.type=D),o!=null||f!=null){if(!(D!=="submit"&&D!=="reset"||o!=null)){cl(i);return}f=f!=null?""+Zs(f):"",o=o!=null?""+Zs(o):f,ce||o===i.value||(i.value=o),i.defaultValue=o}v=v??C,v=typeof v!="function"&&typeof v!="symbol"&&!!v,i.checked=ce?i.checked:!!v,i.defaultChecked=!!v,Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"&&(i.name=Z),cl(i)}function Zc(i,o,f){o==="number"&&Gc(i.ownerDocument)===i||i.defaultValue===""+f||(i.defaultValue=""+f)}function Mo(i,o,f,v){if(i=i.options,o){o={};for(var C=0;C<f.length;C++)o["$"+f[C]]=!0;for(f=0;f<i.length;f++)C=o.hasOwnProperty("$"+i[f].value),i[f].selected!==C&&(i[f].selected=C),C&&v&&(i[f].defaultSelected=!0)}else{for(f=""+Zs(f),o=null,C=0;C<i.length;C++){if(i[C].value===f){i[C].selected=!0,v&&(i[C].defaultSelected=!0);return}o!==null||i[C].disabled||(o=i[C])}o!==null&&(o.selected=!0)}}function vf(i,o,f){if(o!=null&&(o=""+Zs(o),o!==i.value&&(i.value=o),f==null)){i.defaultValue!==o&&(i.defaultValue=o);return}i.defaultValue=f!=null?""+Zs(f):""}function ic(i,o,f,v){if(o==null){if(v!=null){if(f!=null)throw Error(S(92));if(Qe(v)){if(1<v.length)throw Error(S(93));v=v[0]}f=v}f==null&&(f=""),o=f}f=Zs(o),i.defaultValue=f,v=i.textContent,v===f&&v!==""&&v!==null&&(i.value=v),cl(i)}function oo(i,o){if(o){var f=i.firstChild;if(f&&f===i.lastChild&&f.nodeType===3){f.nodeValue=o;return}}i.textContent=o}var bf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ul(i,o,f){var v=o.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?v?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="":v?i.setProperty(o,f):typeof f!="number"||f===0||bf.has(o)?o==="float"?i.cssFloat=f:i[o]=(""+f).trim():i[o]=f+"px"}function Ku(i,o,f){if(o!=null&&typeof o!="object")throw Error(S(62));if(i=i.style,f!=null){for(var v in f)!f.hasOwnProperty(v)||o!=null&&o.hasOwnProperty(v)||(v.indexOf("--")===0?i.setProperty(v,""):v==="float"?i.cssFloat="":i[v]="");for(var C in o)v=o[C],o.hasOwnProperty(C)&&f[C]!==v&&ul(i,C,v)}else for(var D in o)o.hasOwnProperty(D)&&ul(i,D,o[D])}function dl(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Po=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ac=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function _s(i){return ac.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function gn(){}var Qd=null;function Wc(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var pi=null,ti=null;function Cr(i){var o=Za(i);if(o&&(i=o.stateNode)){var f=i[Ct]||null;e:switch(i=o.stateNode,o.type){case"input":if(Hc(i,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),o=f.name,f.type==="radio"&&o!=null){for(f=i;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Hi(""+o)+'"][type="radio"]'),o=0;o<f.length;o++){var v=f[o];if(v!==i&&v.form===i.form){var C=v[Ct]||null;if(!C)throw Error(S(90));Hc(v,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name)}}for(o=0;o<f.length;o++)v=f[o],v.form===i.form&&Jd(v)}break e;case"textarea":vf(i,f.value,f.defaultValue);break e;case"select":o=f.value,o!=null&&Mo(i,!!f.multiple,o,!1)}}}var ns=!1;function ur(i,o,f){if(ns)return i(o,f);ns=!0;try{var v=i(o);return v}finally{if(ns=!1,(pi!==null||ti!==null)&&(Ih(),pi&&(o=pi,i=ti,ti=pi=null,Cr(o),i)))for(o=0;o<i.length;o++)Cr(i[o])}}function Ya(i,o){var f=i.stateNode;if(f===null)return null;var v=f[Ct]||null;if(v===null)return null;f=v[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(i=i.type,v=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!v;break e;default:i=!1}if(i)return null;if(f&&typeof f!="function")throw Error(S(231,o,typeof f));return f}var Ur=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zi=!1;if(Ur)try{var mi={};Object.defineProperty(mi,"passive",{get:function(){Zi=!0}}),window.addEventListener("test",mi,mi),window.removeEventListener("test",mi,mi)}catch{Zi=!1}var wa=null,In=null,Ar=null;function Do(){if(Ar)return Ar;var i,o=In,f=o.length,v,C="value"in wa?wa.value:wa.textContent,D=C.length;for(i=0;i<f&&o[i]===C[i];i++);var Z=f-i;for(v=1;v<=Z&&o[f-v]===C[D-v];v++);return Ar=C.slice(i,1<v?1-v:void 0)}function Sa(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function hl(){return!0}function Wi(){return!1}function ci(i){function o(f,v,C,D,Z){this._reactName=f,this._targetInst=C,this.type=v,this.nativeEvent=D,this.target=Z,this.currentTarget=null;for(var ce in i)i.hasOwnProperty(ce)&&(f=i[ce],this[ce]=f?f(D):D[ce]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?hl:Wi,this.isPropagationStopped=Wi,this}return se(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=hl)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=hl)},persist:function(){},isPersistent:hl}),o}var Yi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yc=ci(Yi),fl=se({},Yi,{view:0,detail:0}),pl=ci(fl),nr,Ro,As,ms=se({},fl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jc,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==As&&(As&&i.type==="mousemove"?(nr=i.screenX-As.screenX,Ro=i.screenY-As.screenY):Ro=nr=0,As=i),nr)},movementY:function(i){return"movementY"in i?i.movementY:Ro}}),ml=ci(ms),Bs=se({},ms,{dataTransfer:0}),Xc=ci(Bs),Xa=se({},fl,{relatedTarget:0}),Io=ci(Xa),zo=se({},Yi,{animationName:0,elapsedTime:0,pseudoElement:0}),wf=ci(zo),Kc=se({},Yi,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),eh=ci(Kc),im=se({},Yi,{data:0}),th=ci(im),Xi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gl(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=kr[i])?!!o[i]:!1}function Jc(){return gl}var Qc=se({},fl,{key:function(i){if(i.key){var o=Xi[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=Sa(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?zn[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jc,charCode:function(i){return i.type==="keypress"?Sa(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Sa(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),$r=ci(Qc),Sf=se({},ms,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ju=ci(Sf),jf=se({},fl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jc}),am=ci(jf),nc=se({},Yi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qu=ci(nc),oc=se({},ms,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),sh=ci(oc),eu=se({},Yi,{newState:0,oldState:0}),lc=ci(eu),cc=[9,13,27,32],Wr=Ur&&"CompositionEvent"in window,uc=null;Ur&&"documentMode"in document&&(uc=document.documentMode);var dc=Ur&&"TextEvent"in window&&!uc,hc=Ur&&(!Wr||uc&&8<uc&&11>=uc),Oo=" ",Tf=!1;function tu(i,o){switch(i){case"keyup":return cc.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nf(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var yn=!1;function ed(i,o){switch(i){case"compositionend":return Nf(o);case"keypress":return o.which!==32?null:(Tf=!0,Oo);case"textInput":return i=o.data,i===Oo&&Tf?null:i;default:return null}}function Ef(i,o){if(yn)return i==="compositionend"||!Wr&&tu(i,o)?(i=Do(),Ar=In=wa=null,yn=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return hc&&o.locale!=="ko"?null:o.data;default:return null}}var Cf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function td(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!Cf[i.type]:o==="textarea"}function sd(i,o,f,v){pi?ti?ti.push(v):ti=[v]:pi=v,o=Bh(o,"onChange"),0<o.length&&(f=new Yc("onChange","change",null,f,v),i.push({event:f,listeners:o}))}var yl=null,fc=null;function Af(i){ly(i,0)}function su(i){var o=hi(i);if(Jd(o))return i}function Lo(i,o){if(i==="change")return o}var rh=!1;if(Ur){var ru;if(Ur){var Bo="oninput"in document;if(!Bo){var ih=document.createElement("div");ih.setAttribute("oninput","return;"),Bo=typeof ih.oninput=="function"}ru=Bo}else ru=!1;rh=ru&&(!document.documentMode||9<document.documentMode)}function iu(){yl&&(yl.detachEvent("onpropertychange",kf),fc=yl=null)}function kf(i){if(i.propertyName==="value"&&su(fc)){var o=[];sd(o,fc,i,Wc(i)),ur(Af,o)}}function nm(i,o,f){i==="focusin"?(iu(),yl=o,fc=f,yl.attachEvent("onpropertychange",kf)):i==="focusout"&&iu()}function Mf(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return su(fc)}function au(i,o){if(i==="click")return su(o)}function Pf(i,o){if(i==="input"||i==="change")return su(o)}function ah(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var aa=typeof Object.is=="function"?Object.is:ah;function Fo(i,o){if(aa(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var f=Object.keys(i),v=Object.keys(o);if(f.length!==v.length)return!1;for(v=0;v<f.length;v++){var C=f[v];if(!vi.call(o,C)||!aa(i[C],o[C]))return!1}return!0}function Ka(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function nu(i,o){var f=Ka(i);i=0;for(var v;f;){if(f.nodeType===3){if(v=i+f.textContent.length,i<=o&&v>=o)return{node:f,offset:o-i};i=v}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=Ka(f)}}function rd(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?rd(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function id(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var o=Gc(i.document);o instanceof i.HTMLIFrameElement;){try{var f=typeof o.contentWindow.location.href=="string"}catch{f=!1}if(f)i=o.contentWindow;else break;o=Gc(i.document)}return o}function ou(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var ad=Ur&&"documentMode"in document&&11>=document.documentMode,Ja=null,lu=null,cu=null,nd=!1;function Df(i,o,f){var v=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;nd||Ja==null||Ja!==Gc(v)||(v=Ja,"selectionStart"in v&&ou(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),cu&&Fo(cu,v)||(cu=v,v=Bh(lu,"onSelect"),0<v.length&&(o=new Yc("onSelect","select",null,o,f),i.push({event:o,listeners:v}),o.target=Ja)))}function xl(i,o){var f={};return f[i.toLowerCase()]=o.toLowerCase(),f["Webkit"+i]="webkit"+o,f["Moz"+i]="moz"+o,f}var _l={animationend:xl("Animation","AnimationEnd"),animationiteration:xl("Animation","AnimationIteration"),animationstart:xl("Animation","AnimationStart"),transitionrun:xl("Transition","TransitionRun"),transitionstart:xl("Transition","TransitionStart"),transitioncancel:xl("Transition","TransitionCancel"),transitionend:xl("Transition","TransitionEnd")},nh={},Ws={};Ur&&(Ws=document.createElement("div").style,"AnimationEvent"in window||(delete _l.animationend.animation,delete _l.animationiteration.animation,delete _l.animationstart.animation),"TransitionEvent"in window||delete _l.transitionend.transition);function On(i){if(nh[i])return nh[i];if(!_l[i])return i;var o=_l[i],f;for(f in o)if(o.hasOwnProperty(f)&&f in Ws)return nh[i]=o[f];return i}var uu=On("animationend"),du=On("animationiteration"),od=On("animationstart"),vl=On("transitionrun"),hu=On("transitionstart"),pc=On("transitioncancel"),ja=On("transitionend"),oh=new Map,ld="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ld.push("scrollEnd");function Ta(i,o){oh.set(i,o),Ht(o,[i])}var Ln=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Ki=[],lo=0,bl=0;function wl(){for(var i=lo,o=bl=lo=0;o<i;){var f=Ki[o];Ki[o++]=null;var v=Ki[o];Ki[o++]=null;var C=Ki[o];Ki[o++]=null;var D=Ki[o];if(Ki[o++]=null,v!==null&&C!==null){var Z=v.pending;Z===null?C.next=C:(C.next=Z.next,Z.next=C),v.pending=C}D!==0&&lh(f,C,D)}}function fu(i,o,f,v){Ki[lo++]=i,Ki[lo++]=o,Ki[lo++]=f,Ki[lo++]=v,bl|=v,i.lanes|=v,i=i.alternate,i!==null&&(i.lanes|=v)}function Uo(i,o,f,v){return fu(i,o,f,v),mc(i)}function Qa(i,o){return fu(i,null,null,o),mc(i)}function lh(i,o,f){i.lanes|=f;var v=i.alternate;v!==null&&(v.lanes|=f);for(var C=!1,D=i.return;D!==null;)D.childLanes|=f,v=D.alternate,v!==null&&(v.childLanes|=f),D.tag===22&&(i=D.stateNode,i===null||i._visibility&1||(C=!0)),i=D,D=D.return;return i.tag===3?(D=i.stateNode,C&&o!==null&&(C=31-ve(f),i=D.hiddenUpdates,v=i[C],v===null?i[C]=[o]:v.push(o),o.lane=f|536870912),D):null}function mc(i){if(50<Rh)throw Rh=0,jm=null,Error(S(185));for(var o=i.return;o!==null;)i=o,o=i.return;return i.tag===3?i.stateNode:null}var gs={};function cd(i,o,f,v){this.tag=i,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Na(i,o,f,v){return new cd(i,o,f,v)}function ud(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Ea(i,o){var f=i.alternate;return f===null?(f=Na(i.tag,o,i.key,i.mode),f.elementType=i.elementType,f.type=i.type,f.stateNode=i.stateNode,f.alternate=i,i.alternate=f):(f.pendingProps=o,f.type=i.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=i.flags&65011712,f.childLanes=i.childLanes,f.lanes=i.lanes,f.child=i.child,f.memoizedProps=i.memoizedProps,f.memoizedState=i.memoizedState,f.updateQueue=i.updateQueue,o=i.dependencies,f.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},f.sibling=i.sibling,f.index=i.index,f.ref=i.ref,f.refCleanup=i.refCleanup,f}function Rf(i,o){i.flags&=65011714;var f=i.alternate;return f===null?(i.childLanes=0,i.lanes=o,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=f.childLanes,i.lanes=f.lanes,i.child=f.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=f.memoizedProps,i.memoizedState=f.memoizedState,i.updateQueue=f.updateQueue,i.type=f.type,o=f.dependencies,i.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),i}function dd(i,o,f,v,C,D){var Z=0;if(v=i,typeof i=="function")ud(i)&&(Z=1);else if(typeof i=="string")Z=Ap(i,f,lt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Ae:return i=Na(31,f,o,C),i.elementType=Ae,i.lanes=D,i;case Y:return $o(f.children,C,D,o);case G:Z=8,C|=24;break;case pe:return i=Na(12,f,o,C|2),i.elementType=pe,i.lanes=D,i;case Be:return i=Na(13,f,o,C),i.elementType=Be,i.lanes=D,i;case xt:return i=Na(19,f,o,C),i.elementType=xt,i.lanes=D,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Ne:Z=10;break e;case _e:Z=9;break e;case Oe:Z=11;break e;case $e:Z=14;break e;case de:Z=16,v=null;break e}Z=29,f=Error(S(130,i===null?"null":typeof i,"")),v=null}return o=Na(Z,f,o,C),o.elementType=i,o.type=v,o.lanes=D,o}function $o(i,o,f,v){return i=Na(7,i,v,o),i.lanes=f,i}function ch(i,o,f){return i=Na(6,i,null,o),i.lanes=f,i}function hd(i){var o=Na(18,null,null,0);return o.stateNode=i,o}function Vo(i,o,f){return o=Na(4,i.children!==null?i.children:[],i.key,o),o.lanes=f,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}var gc=new WeakMap;function Ji(i,o){if(typeof i=="object"&&i!==null){var f=gc.get(i);return f!==void 0?f:(o={value:i,source:o,stack:ar(o)},gc.set(i,o),o)}return{value:i,source:o,stack:ar(o)}}var qo=[],Go=0,Sl=null,Ho=0,gi=[],bi=0,Bn=null,Fn=1,na="";function co(i,o){qo[Go++]=Ho,qo[Go++]=Sl,Sl=i,Ho=o}function uh(i,o,f){gi[bi++]=Fn,gi[bi++]=na,gi[bi++]=Bn,Bn=i;var v=Fn;i=na;var C=32-ve(v)-1;v&=~(1<<C),f+=1;var D=32-ve(o)+C;if(30<D){var Z=C-C%5;D=(v&(1<<Z)-1).toString(32),v>>=Z,C-=Z,Fn=1<<32-ve(o)+C|f<<C|v,na=D+i}else Fn=1<<D|f<<C|v,na=i}function jl(i){i.return!==null&&(co(i,1),uh(i,1,0))}function yc(i){for(;i===Sl;)Sl=qo[--Go],qo[Go]=null,Ho=qo[--Go],qo[Go]=null;for(;i===Bn;)Bn=gi[--bi],gi[bi]=null,na=gi[--bi],gi[bi]=null,Fn=gi[--bi],gi[bi]=null}function dh(i,o){gi[bi++]=Fn,gi[bi++]=na,gi[bi++]=Bn,Fn=o.id,na=o.overflow,Bn=i}var wi=null,dr=null,zs=!1,uo=null,Ca=!1,Ir=Error(S(519));function oa(i){var o=Error(S(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ho(Ji(o,i)),Ir}function la(i){var o=i.stateNode,f=i.type,v=i.memoizedProps;switch(o[Hs]=i,o[Ct]=v,f){case"dialog":Vs("cancel",o),Vs("close",o);break;case"iframe":case"object":case"embed":Vs("load",o);break;case"video":case"audio":for(f=0;f<Pc.length;f++)Vs(Pc[f],o);break;case"source":Vs("error",o);break;case"img":case"image":case"link":Vs("error",o),Vs("load",o);break;case"details":Vs("toggle",o);break;case"input":Vs("invalid",o),Xu(o,v.value,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name,!0);break;case"select":Vs("invalid",o);break;case"textarea":Vs("invalid",o),ic(o,v.value,v.defaultValue,v.children)}f=v.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||o.textContent===""+f||v.suppressHydrationWarning===!0||Lm(o.textContent,f)?(v.popover!=null&&(Vs("beforetoggle",o),Vs("toggle",o)),v.onScroll!=null&&Vs("scroll",o),v.onScrollEnd!=null&&Vs("scrollend",o),v.onClick!=null&&(o.onclick=gn),o=!0):o=!1,o||oa(i,!0)}function pu(i){for(wi=i.return;wi;)switch(wi.tag){case 5:case 31:case 13:Ca=!1;return;case 27:case 3:Ca=!0;return;default:wi=wi.return}}function Un(i){if(i!==wi)return!1;if(!zs)return pu(i),zs=!0,!1;var o=i.tag,f;if((f=o!==3&&o!==27)&&((f=o===5)&&(f=i.type,f=!(f!=="form"&&f!=="button")||vp(i.type,i.memoizedProps)),f=!f),f&&dr&&oa(i),pu(i),o===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(S(317));dr=Ui(i)}else if(o===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(S(317));dr=Ui(i)}else o===27?(o=dr,Ic(i.type)?(i=Oa,Oa=null,dr=i):dr=o):dr=wi?An(i.stateNode.nextSibling):null;return!0}function $n(){dr=wi=null,zs=!1}function Vn(){var i=uo;return i!==null&&(un===null?un=i:un.push.apply(un,i),uo=null),i}function ho(i){uo===null?uo=[i]:uo.push(i)}var fo=le(null),en=null,qn=null;function po(i,o,f){nt(fo,o._currentValue),o._currentValue=f}function Gn(i){i._currentValue=fo.current,Le(fo)}function fd(i,o,f){for(;i!==null;){var v=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,v!==null&&(v.childLanes|=o)):v!==null&&(v.childLanes&o)!==o&&(v.childLanes|=o),i===f)break;i=i.return}}function pd(i,o,f,v){var C=i.child;for(C!==null&&(C.return=i);C!==null;){var D=C.dependencies;if(D!==null){var Z=C.child;D=D.firstContext;e:for(;D!==null;){var ce=D;D=C;for(var ze=0;ze<o.length;ze++)if(ce.context===o[ze]){D.lanes|=f,ce=D.alternate,ce!==null&&(ce.lanes|=f),fd(D.return,f,i),v||(Z=null);break e}D=ce.next}}else if(C.tag===18){if(Z=C.return,Z===null)throw Error(S(341));Z.lanes|=f,D=Z.alternate,D!==null&&(D.lanes|=f),fd(Z,f,i),Z=null}else Z=C.child;if(Z!==null)Z.return=C;else for(Z=C;Z!==null;){if(Z===i){Z=null;break}if(C=Z.sibling,C!==null){C.return=Z.return,Z=C;break}Z=Z.return}C=Z}}function Aa(i,o,f,v){i=null;for(var C=o,D=!1;C!==null;){if(!D){if((C.flags&524288)!==0)D=!0;else if((C.flags&262144)!==0)break}if(C.tag===10){var Z=C.alternate;if(Z===null)throw Error(S(387));if(Z=Z.memoizedProps,Z!==null){var ce=C.type;aa(C.pendingProps.value,Z.value)||(i!==null?i.push(ce):i=[ce])}}else if(C===mt.current){if(Z=C.alternate,Z===null)throw Error(S(387));Z.memoizedState.memoizedState!==C.memoizedState.memoizedState&&(i!==null?i.push(Kh):i=[Kh])}C=C.return}i!==null&&pd(o,i,f,v),o.flags|=262144}function xc(i){for(i=i.firstContext;i!==null;){if(!aa(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function mo(i){en=i,qn=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function si(i){return md(en,i)}function mu(i,o){return en===null&&mo(i),md(i,o)}function md(i,o){var f=o._currentValue;if(o={context:o,memoizedValue:f,next:null},qn===null){if(i===null)throw Error(S(308));qn=o,i.dependencies={lanes:0,firstContext:o},i.flags|=524288}else qn=qn.next=o;return f}var hh=typeof AbortController<"u"?AbortController:function(){var i=[],o=this.signal={aborted:!1,addEventListener:function(f,v){i.push(v)}};this.abort=function(){o.aborted=!0,i.forEach(function(f){return f()})}},If=m.unstable_scheduleCallback,fh=m.unstable_NormalPriority,Yr={$$typeof:Ne,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Hn(){return{controller:new hh,data:new Map,refCount:0}}function _c(i){i.refCount--,i.refCount===0&&If(fh,function(){i.controller.abort()})}var Li=null,ka=0,Tl=0,Bi=null;function om(i,o){if(Li===null){var f=Li=[];ka=0,Tl=Dm(),Bi={status:"pending",value:void 0,then:function(v){f.push(v)}}}return ka++,o.then(vc,vc),o}function vc(){if(--ka===0&&Li!==null){Bi!==null&&(Bi.status="fulfilled");var i=Li;Li=null,Tl=0,Bi=null;for(var o=0;o<i.length;o++)(0,i[o])()}}function gu(i,o){var f=[],v={status:"pending",value:null,reason:null,then:function(C){f.push(C)}};return i.then(function(){v.status="fulfilled",v.value=o;for(var C=0;C<f.length;C++)(0,f[C])(o)},function(C){for(v.status="rejected",v.reason=C,C=0;C<f.length;C++)(0,f[C])(void 0)}),v}var yi=Ce.S;Ce.S=function(i,o){Gg=Ms(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&om(i,o),yi!==null&&yi(i,o)};var xn=le(null);function gd(){var i=xn.current;return i!==null?i:Dr.pooledCache}function yd(i,o){o===null?nt(xn,xn.current):nt(xn,o.pool)}function zf(){var i=gd();return i===null?null:{parent:Yr._currentValue,pool:i}}var _n=Error(S(460)),Zo=Error(S(474)),ca=Error(S(542)),Ut={then:function(){}};function yu(i){return i=i.status,i==="fulfilled"||i==="rejected"}function xd(i,o,f){switch(f=i[f],f===void 0?i.push(o):f!==o&&(o.then(gn,gn),o=f),o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,_d(i),i;default:if(typeof o.status=="string")o.then(gn,gn);else{if(i=Dr,i!==null&&100<i.shellSuspendCounter)throw Error(S(482));i=o,i.status="pending",i.then(function(v){if(o.status==="pending"){var C=o;C.status="fulfilled",C.value=v}},function(v){if(o.status==="pending"){var C=o;C.status="rejected",C.reason=v}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,_d(i),i}throw vn=o,_n}}function tn(i){try{var o=i._init;return o(i._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(vn=f,_n):f}}var vn=null;function bc(){if(vn===null)throw Error(S(459));var i=vn;return vn=null,i}function _d(i){if(i===_n||i===ca)throw Error(S(483))}var Zn=null,Nl=0;function xu(i){var o=Nl;return Nl+=1,Zn===null&&(Zn=[]),xd(Zn,i,o)}function Wn(i,o){o=o.props.ref,i.ref=o!==void 0?o:null}function vd(i,o){throw o.$$typeof===ue?Error(S(525)):(i=Object.prototype.toString.call(o),Error(S(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i)))}function _u(i){function o(Xe,Ge){if(i){var it=Xe.deletions;it===null?(Xe.deletions=[Ge],Xe.flags|=16):it.push(Ge)}}function f(Xe,Ge){if(!i)return null;for(;Ge!==null;)o(Xe,Ge),Ge=Ge.sibling;return null}function v(Xe){for(var Ge=new Map;Xe!==null;)Xe.key!==null?Ge.set(Xe.key,Xe):Ge.set(Xe.index,Xe),Xe=Xe.sibling;return Ge}function C(Xe,Ge){return Xe=Ea(Xe,Ge),Xe.index=0,Xe.sibling=null,Xe}function D(Xe,Ge,it){return Xe.index=it,i?(it=Xe.alternate,it!==null?(it=it.index,it<Ge?(Xe.flags|=67108866,Ge):it):(Xe.flags|=67108866,Ge)):(Xe.flags|=1048576,Ge)}function Z(Xe){return i&&Xe.alternate===null&&(Xe.flags|=67108866),Xe}function ce(Xe,Ge,it,jt){return Ge===null||Ge.tag!==6?(Ge=ch(it,Xe.mode,jt),Ge.return=Xe,Ge):(Ge=C(Ge,it),Ge.return=Xe,Ge)}function ze(Xe,Ge,it,jt){var cs=it.type;return cs===Y?bt(Xe,Ge,it.props.children,jt,it.key):Ge!==null&&(Ge.elementType===cs||typeof cs=="object"&&cs!==null&&cs.$$typeof===de&&tn(cs)===Ge.type)?(Ge=C(Ge,it.props),Wn(Ge,it),Ge.return=Xe,Ge):(Ge=dd(it.type,it.key,it.props,null,Xe.mode,jt),Wn(Ge,it),Ge.return=Xe,Ge)}function at(Xe,Ge,it,jt){return Ge===null||Ge.tag!==4||Ge.stateNode.containerInfo!==it.containerInfo||Ge.stateNode.implementation!==it.implementation?(Ge=Vo(it,Xe.mode,jt),Ge.return=Xe,Ge):(Ge=C(Ge,it.children||[]),Ge.return=Xe,Ge)}function bt(Xe,Ge,it,jt,cs){return Ge===null||Ge.tag!==7?(Ge=$o(it,Xe.mode,jt,cs),Ge.return=Xe,Ge):(Ge=C(Ge,it),Ge.return=Xe,Ge)}function At(Xe,Ge,it){if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return Ge=ch(""+Ge,Xe.mode,it),Ge.return=Xe,Ge;if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case ae:return it=dd(Ge.type,Ge.key,Ge.props,null,Xe.mode,it),Wn(it,Ge),it.return=Xe,it;case Q:return Ge=Vo(Ge,Xe.mode,it),Ge.return=Xe,Ge;case de:return Ge=tn(Ge),At(Xe,Ge,it)}if(Qe(Ge)||Et(Ge))return Ge=$o(Ge,Xe.mode,it,null),Ge.return=Xe,Ge;if(typeof Ge.then=="function")return At(Xe,xu(Ge),it);if(Ge.$$typeof===Ne)return At(Xe,mu(Xe,Ge),it);vd(Xe,Ge)}return null}function ct(Xe,Ge,it,jt){var cs=Ge!==null?Ge.key:null;if(typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint")return cs!==null?null:ce(Xe,Ge,""+it,jt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case ae:return it.key===cs?ze(Xe,Ge,it,jt):null;case Q:return it.key===cs?at(Xe,Ge,it,jt):null;case de:return it=tn(it),ct(Xe,Ge,it,jt)}if(Qe(it)||Et(it))return cs!==null?null:bt(Xe,Ge,it,jt,null);if(typeof it.then=="function")return ct(Xe,Ge,xu(it),jt);if(it.$$typeof===Ne)return ct(Xe,Ge,mu(Xe,it),jt);vd(Xe,it)}return null}function ft(Xe,Ge,it,jt,cs){if(typeof jt=="string"&&jt!==""||typeof jt=="number"||typeof jt=="bigint")return Xe=Xe.get(it)||null,ce(Ge,Xe,""+jt,cs);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case ae:return Xe=Xe.get(jt.key===null?it:jt.key)||null,ze(Ge,Xe,jt,cs);case Q:return Xe=Xe.get(jt.key===null?it:jt.key)||null,at(Ge,Xe,jt,cs);case de:return jt=tn(jt),ft(Xe,Ge,it,jt,cs)}if(Qe(jt)||Et(jt))return Xe=Xe.get(it)||null,bt(Ge,Xe,jt,cs,null);if(typeof jt.then=="function")return ft(Xe,Ge,it,xu(jt),cs);if(jt.$$typeof===Ne)return ft(Xe,Ge,it,mu(Ge,jt),cs);vd(Ge,jt)}return null}function Jt(Xe,Ge,it,jt){for(var cs=null,cr=null,rs=Ge,ws=Ge=0,hs=null;rs!==null&&ws<it.length;ws++){rs.index>ws?(hs=rs,rs=null):hs=rs.sibling;var tr=ct(Xe,rs,it[ws],jt);if(tr===null){rs===null&&(rs=hs);break}i&&rs&&tr.alternate===null&&o(Xe,rs),Ge=D(tr,Ge,ws),cr===null?cs=tr:cr.sibling=tr,cr=tr,rs=hs}if(ws===it.length)return f(Xe,rs),zs&&co(Xe,ws),cs;if(rs===null){for(;ws<it.length;ws++)rs=At(Xe,it[ws],jt),rs!==null&&(Ge=D(rs,Ge,ws),cr===null?cs=rs:cr.sibling=rs,cr=rs);return zs&&co(Xe,ws),cs}for(rs=v(rs);ws<it.length;ws++)hs=ft(rs,Xe,ws,it[ws],jt),hs!==null&&(i&&hs.alternate!==null&&rs.delete(hs.key===null?ws:hs.key),Ge=D(hs,Ge,ws),cr===null?cs=hs:cr.sibling=hs,cr=hs);return i&&rs.forEach(function(Yl){return o(Xe,Yl)}),zs&&co(Xe,ws),cs}function ps(Xe,Ge,it,jt){if(it==null)throw Error(S(151));for(var cs=null,cr=null,rs=Ge,ws=Ge=0,hs=null,tr=it.next();rs!==null&&!tr.done;ws++,tr=it.next()){rs.index>ws?(hs=rs,rs=null):hs=rs.sibling;var Yl=ct(Xe,rs,tr.value,jt);if(Yl===null){rs===null&&(rs=hs);break}i&&rs&&Yl.alternate===null&&o(Xe,rs),Ge=D(Yl,Ge,ws),cr===null?cs=Yl:cr.sibling=Yl,cr=Yl,rs=hs}if(tr.done)return f(Xe,rs),zs&&co(Xe,ws),cs;if(rs===null){for(;!tr.done;ws++,tr=it.next())tr=At(Xe,tr.value,jt),tr!==null&&(Ge=D(tr,Ge,ws),cr===null?cs=tr:cr.sibling=tr,cr=tr);return zs&&co(Xe,ws),cs}for(rs=v(rs);!tr.done;ws++,tr=it.next())tr=ft(rs,Xe,ws,tr.value,jt),tr!==null&&(i&&tr.alternate!==null&&rs.delete(tr.key===null?ws:tr.key),Ge=D(tr,Ge,ws),cr===null?cs=tr:cr.sibling=tr,cr=tr);return i&&rs.forEach(function(ky){return o(Xe,ky)}),zs&&co(Xe,ws),cs}function gr(Xe,Ge,it,jt){if(typeof it=="object"&&it!==null&&it.type===Y&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case ae:e:{for(var cs=it.key;Ge!==null;){if(Ge.key===cs){if(cs=it.type,cs===Y){if(Ge.tag===7){f(Xe,Ge.sibling),jt=C(Ge,it.props.children),jt.return=Xe,Xe=jt;break e}}else if(Ge.elementType===cs||typeof cs=="object"&&cs!==null&&cs.$$typeof===de&&tn(cs)===Ge.type){f(Xe,Ge.sibling),jt=C(Ge,it.props),Wn(jt,it),jt.return=Xe,Xe=jt;break e}f(Xe,Ge);break}else o(Xe,Ge);Ge=Ge.sibling}it.type===Y?(jt=$o(it.props.children,Xe.mode,jt,it.key),jt.return=Xe,Xe=jt):(jt=dd(it.type,it.key,it.props,null,Xe.mode,jt),Wn(jt,it),jt.return=Xe,Xe=jt)}return Z(Xe);case Q:e:{for(cs=it.key;Ge!==null;){if(Ge.key===cs)if(Ge.tag===4&&Ge.stateNode.containerInfo===it.containerInfo&&Ge.stateNode.implementation===it.implementation){f(Xe,Ge.sibling),jt=C(Ge,it.children||[]),jt.return=Xe,Xe=jt;break e}else{f(Xe,Ge);break}else o(Xe,Ge);Ge=Ge.sibling}jt=Vo(it,Xe.mode,jt),jt.return=Xe,Xe=jt}return Z(Xe);case de:return it=tn(it),gr(Xe,Ge,it,jt)}if(Qe(it))return Jt(Xe,Ge,it,jt);if(Et(it)){if(cs=Et(it),typeof cs!="function")throw Error(S(150));return it=cs.call(it),ps(Xe,Ge,it,jt)}if(typeof it.then=="function")return gr(Xe,Ge,xu(it),jt);if(it.$$typeof===Ne)return gr(Xe,Ge,mu(Xe,it),jt);vd(Xe,it)}return typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint"?(it=""+it,Ge!==null&&Ge.tag===6?(f(Xe,Ge.sibling),jt=C(Ge,it),jt.return=Xe,Xe=jt):(f(Xe,Ge),jt=ch(it,Xe.mode,jt),jt.return=Xe,Xe=jt),Z(Xe)):f(Xe,Ge)}return function(Xe,Ge,it,jt){try{Nl=0;var cs=gr(Xe,Ge,it,jt);return Zn=null,cs}catch(rs){if(rs===_n||rs===ca)throw rs;var cr=Na(29,rs,null,Xe.mode);return cr.lanes=jt,cr.return=Xe,cr}finally{}}}var Yn=_u(!0),ph=_u(!1),Xn=!1;function bd(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vu(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Kn(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function go(i,o,f){var v=i.updateQueue;if(v===null)return null;if(v=v.shared,(pr&2)!==0){var C=v.pending;return C===null?o.next=o:(o.next=C.next,C.next=o),v.pending=o,o=mc(i),lh(i,null,f),o}return fu(i,v,o,f),mc(i)}function sn(i,o,f){if(o=o.updateQueue,o!==null&&(o=o.shared,(f&4194048)!==0)){var v=o.lanes;v&=i.pendingLanes,f|=v,o.lanes=f,Gs(i,f)}}function sr(i,o){var f=i.updateQueue,v=i.alternate;if(v!==null&&(v=v.updateQueue,f===v)){var C=null,D=null;if(f=f.firstBaseUpdate,f!==null){do{var Z={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};D===null?C=D=Z:D=D.next=Z,f=f.next}while(f!==null);D===null?C=D=o:D=D.next=o}else C=D=o;f={baseState:v.baseState,firstBaseUpdate:C,lastBaseUpdate:D,shared:v.shared,callbacks:v.callbacks},i.updateQueue=f;return}i=f.lastBaseUpdate,i===null?f.firstBaseUpdate=o:i.next=o,f.lastBaseUpdate=o}var mh=!1;function yo(){if(mh){var i=Bi;if(i!==null)throw i}}function Wo(i,o,f,v){mh=!1;var C=i.updateQueue;Xn=!1;var D=C.firstBaseUpdate,Z=C.lastBaseUpdate,ce=C.shared.pending;if(ce!==null){C.shared.pending=null;var ze=ce,at=ze.next;ze.next=null,Z===null?D=at:Z.next=at,Z=ze;var bt=i.alternate;bt!==null&&(bt=bt.updateQueue,ce=bt.lastBaseUpdate,ce!==Z&&(ce===null?bt.firstBaseUpdate=at:ce.next=at,bt.lastBaseUpdate=ze))}if(D!==null){var At=C.baseState;Z=0,bt=at=ze=null,ce=D;do{var ct=ce.lane&-536870913,ft=ct!==ce.lane;if(ft?($s&ct)===ct:(v&ct)===ct){ct!==0&&ct===Tl&&(mh=!0),bt!==null&&(bt=bt.next={lane:0,tag:ce.tag,payload:ce.payload,callback:null,next:null});e:{var Jt=i,ps=ce;ct=o;var gr=f;switch(ps.tag){case 1:if(Jt=ps.payload,typeof Jt=="function"){At=Jt.call(gr,At,ct);break e}At=Jt;break e;case 3:Jt.flags=Jt.flags&-65537|128;case 0:if(Jt=ps.payload,ct=typeof Jt=="function"?Jt.call(gr,At,ct):Jt,ct==null)break e;At=se({},At,ct);break e;case 2:Xn=!0}}ct=ce.callback,ct!==null&&(i.flags|=64,ft&&(i.flags|=8192),ft=C.callbacks,ft===null?C.callbacks=[ct]:ft.push(ct))}else ft={lane:ct,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null},bt===null?(at=bt=ft,ze=At):bt=bt.next=ft,Z|=ct;if(ce=ce.next,ce===null){if(ce=C.shared.pending,ce===null)break;ft=ce,ce=ft.next,ft.next=null,C.lastBaseUpdate=ft,C.shared.pending=null}}while(!0);bt===null&&(ze=At),C.baseState=ze,C.firstBaseUpdate=at,C.lastBaseUpdate=bt,D===null&&(C.shared.lanes=0),Fl|=Z,i.lanes=Z,i.memoizedState=At}}function bu(i,o){if(typeof i!="function")throw Error(S(191,i));i.call(o)}function wd(i,o){var f=i.callbacks;if(f!==null)for(i.callbacks=null,i=0;i<f.length;i++)bu(f[i],o)}var El=le(null),wu=le(0);function gh(i,o){i=Bl,nt(wu,i),nt(El,o),Bl=i|o.baseLanes}function Ma(){nt(wu,Bl),nt(El,El.current)}function Cl(){Bl=wu.current,Le(El),Le(wu)}var $t=le(null),Wt=null;function rn(i){var o=i.alternate;nt(Vr,Vr.current&1),nt($t,i),Wt===null&&(o===null||El.current!==null||o.memoizedState!==null)&&(Wt=i)}function wc(i){nt(Vr,Vr.current),nt($t,i),Wt===null&&(Wt=i)}function Su(i){i.tag===22?(nt(Vr,Vr.current),nt($t,i),Wt===null&&(Wt=i)):Xr()}function Xr(){nt(Vr,Vr.current),nt($t,$t.current)}function zr(i){Le($t),Wt===i&&(Wt=null),Le(Vr)}var Vr=le(0);function ju(i){for(var o=i;o!==null;){if(o.tag===13){var f=o.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||fa(f)||Lr(f)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var xo=0,Cs=null,Qs=null,Ts=null,Mr=!1,an=!1,bn=!1,Al=0,kl=0,_o=null,yh=0;function jr(){throw Error(S(321))}function wn(i,o){if(o===null)return!1;for(var f=0;f<o.length&&f<i.length;f++)if(!aa(i[f],o[f]))return!1;return!0}function Sc(i,o,f,v,C,D){return xo=D,Cs=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Ce.H=i===null||i.memoizedState===null?fr:ri,bn=!1,D=f(v,C),bn=!1,an&&(D=Tu(o,f,v,C)),jc(i),D}function jc(i){Ce.H=rr;var o=Qs!==null&&Qs.next!==null;if(xo=0,Ts=Qs=Cs=null,Mr=!1,kl=0,_o=null,o)throw Error(S(300));i===null||Ti||(i=i.dependencies,i!==null&&xc(i)&&(Ti=!0))}function Tu(i,o,f,v){Cs=i;var C=0;do{if(an&&(_o=null),kl=0,an=!1,25<=C)throw Error(S(301));if(C+=1,Ts=Qs=null,i.updateQueue!=null){var D=i.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}Ce.H=ui,D=o(f,v)}while(an);return D}function Nu(){var i=Ce.H,o=i.useState()[0];return o=typeof o.then=="function"?Ml(o):o,i=i.useState()[0],(Qs!==null?Qs.memoizedState:null)!==i&&(Cs.flags|=1024),o}function Eu(){var i=Al!==0;return Al=0,i}function Yo(i,o,f){o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~f}function vo(i){if(Mr){for(i=i.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Mr=!1}xo=0,Ts=Qs=Cs=null,an=!1,kl=Al=0,_o=null}function Di(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ts===null?Cs.memoizedState=Ts=i:Ts=Ts.next=i,Ts}function Pr(){if(Qs===null){var i=Cs.alternate;i=i!==null?i.memoizedState:null}else i=Qs.next;var o=Ts===null?Cs.memoizedState:Ts.next;if(o!==null)Ts=o,Qs=i;else{if(i===null)throw Cs.alternate===null?Error(S(467)):Error(S(310));Qs=i,i={memoizedState:Qs.memoizedState,baseState:Qs.baseState,baseQueue:Qs.baseQueue,queue:Qs.queue,next:null},Ts===null?Cs.memoizedState=Ts=i:Ts=Ts.next=i}return Ts}function Jn(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ml(i){var o=kl;return kl+=1,_o===null&&(_o=[]),i=xd(_o,i,o),o=Cs,(Ts===null?o.memoizedState:Ts.next)===null&&(o=o.alternate,Ce.H=o===null||o.memoizedState===null?fr:ri),i}function Pl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Ml(i);if(i.$$typeof===Ne)return si(i)}throw Error(S(438,String(i)))}function Tc(i){var o=null,f=Cs.updateQueue;if(f!==null&&(o=f.memoCache),o==null){var v=Cs.alternate;v!==null&&(v=v.updateQueue,v!==null&&(v=v.memoCache,v!=null&&(o={data:v.data.map(function(C){return C.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),f===null&&(f=Jn(),Cs.updateQueue=f),f.memoCache=o,f=o.data[o.index],f===void 0)for(f=o.data[o.index]=Array(i),v=0;v<i;v++)f[v]=Ye;return o.index++,f}function Sn(i,o){return typeof o=="function"?o(i):o}function x(i){var o=Pr();return t(o,Qs,i)}function t(i,o,f){var v=i.queue;if(v===null)throw Error(S(311));v.lastRenderedReducer=f;var C=i.baseQueue,D=v.pending;if(D!==null){if(C!==null){var Z=C.next;C.next=D.next,D.next=Z}o.baseQueue=C=D,v.pending=null}if(D=i.baseState,C===null)i.memoizedState=D;else{o=C.next;var ce=Z=null,ze=null,at=o,bt=!1;do{var At=at.lane&-536870913;if(At!==at.lane?($s&At)===At:(xo&At)===At){var ct=at.revertLane;if(ct===0)ze!==null&&(ze=ze.next={lane:0,revertLane:0,gesture:null,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null}),At===Tl&&(bt=!0);else if((xo&ct)===ct){at=at.next,ct===Tl&&(bt=!0);continue}else At={lane:0,revertLane:at.revertLane,gesture:null,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null},ze===null?(ce=ze=At,Z=D):ze=ze.next=At,Cs.lanes|=ct,Fl|=ct;At=at.action,bn&&f(D,At),D=at.hasEagerState?at.eagerState:f(D,At)}else ct={lane:At,revertLane:at.revertLane,gesture:at.gesture,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null},ze===null?(ce=ze=ct,Z=D):ze=ze.next=ct,Cs.lanes|=At,Fl|=At;at=at.next}while(at!==null&&at!==o);if(ze===null?Z=D:ze.next=ce,!aa(D,i.memoizedState)&&(Ti=!0,bt&&(f=Bi,f!==null)))throw f;i.memoizedState=D,i.baseState=Z,i.baseQueue=ze,v.lastRenderedState=D}return C===null&&(v.lanes=0),[i.memoizedState,v.dispatch]}function a(i){var o=Pr(),f=o.queue;if(f===null)throw Error(S(311));f.lastRenderedReducer=i;var v=f.dispatch,C=f.pending,D=o.memoizedState;if(C!==null){f.pending=null;var Z=C=C.next;do D=i(D,Z.action),Z=Z.next;while(Z!==C);aa(D,o.memoizedState)||(Ti=!0),o.memoizedState=D,o.baseQueue===null&&(o.baseState=D),f.lastRenderedState=D}return[D,v]}function u(i,o,f){var v=Cs,C=Pr(),D=zs;if(D){if(f===void 0)throw Error(S(407));f=f()}else f=o();var Z=!aa((Qs||C).memoizedState,f);if(Z&&(C.memoizedState=f,Ti=!0),C=C.queue,tt(j.bind(null,v,C,i),[i]),C.getSnapshot!==o||Z||Ts!==null&&Ts.memoizedState.tag&1){if(v.flags|=2048,je(9,{destroy:void 0},b.bind(null,v,C,f,o),null),Dr===null)throw Error(S(349));D||(xo&127)!==0||p(v,o,f)}return f}function p(i,o,f){i.flags|=16384,i={getSnapshot:o,value:f},o=Cs.updateQueue,o===null?(o=Jn(),Cs.updateQueue=o,o.stores=[i]):(f=o.stores,f===null?o.stores=[i]:f.push(i))}function b(i,o,f,v){o.value=f,o.getSnapshot=v,E(o)&&M(i)}function j(i,o,f){return f(function(){E(o)&&M(i)})}function E(i){var o=i.getSnapshot;i=i.value;try{var f=o();return!aa(i,f)}catch{return!0}}function M(i){var o=Qa(i,2);o!==null&&hn(o,i,2)}function z(i){var o=Di();if(typeof i=="function"){var f=i;if(i=f(),bn){he(!0);try{f()}finally{he(!1)}}}return o.memoizedState=o.baseState=i,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sn,lastRenderedState:i},o}function L(i,o,f,v){return i.baseState=f,t(i,Qs,typeof v=="function"?v:Sn)}function q(i,o,f,v,C){if(Pa(i))throw Error(S(485));if(i=o.action,i!==null){var D={payload:C,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Z){D.listeners.push(Z)}};Ce.T!==null?f(!0):D.isTransition=!1,v(D),f=o.pending,f===null?(D.next=o.pending=D,V(o,D)):(D.next=f.next,o.pending=f.next=D)}}function V(i,o){var f=o.action,v=o.payload,C=i.state;if(o.isTransition){var D=Ce.T,Z={};Ce.T=Z;try{var ce=f(C,v),ze=Ce.S;ze!==null&&ze(Z,ce),J(i,o,ce)}catch(at){fe(i,o,at)}finally{D!==null&&Z.types!==null&&(D.types=Z.types),Ce.T=D}}else try{D=f(C,v),J(i,o,D)}catch(at){fe(i,o,at)}}function J(i,o,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(v){ie(i,o,v)},function(v){return fe(i,o,v)}):ie(i,o,f)}function ie(i,o,f){o.status="fulfilled",o.value=f,ye(o),i.state=f,o=i.pending,o!==null&&(f=o.next,f===o?i.pending=null:(f=f.next,o.next=f,V(i,f)))}function fe(i,o,f){var v=i.pending;if(i.pending=null,v!==null){v=v.next;do o.status="rejected",o.reason=f,ye(o),o=o.next;while(o!==v)}i.action=null}function ye(i){i=i.listeners;for(var o=0;o<i.length;o++)(0,i[o])()}function ge(i,o){return o}function Se(i,o){if(zs){var f=Dr.formState;if(f!==null){e:{var v=Cs;if(zs){if(dr){t:{for(var C=dr,D=Ca;C.nodeType!==8;){if(!D){C=null;break t}if(C=An(C.nextSibling),C===null){C=null;break t}}D=C.data,C=D==="F!"||D==="F"?C:null}if(C){dr=An(C.nextSibling),v=C.data==="F!";break e}}oa(v)}v=!1}v&&(o=f[0])}}return f=Di(),f.memoizedState=f.baseState=o,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ge,lastRenderedState:o},f.queue=v,f=Nc.bind(null,Cs,v),v.dispatch=f,v=z(!1),D=da.bind(null,Cs,!1,v.queue),v=Di(),C={state:o,dispatch:null,action:i,pending:null},v.queue=C,f=q.bind(null,Cs,C,D,f),C.dispatch=f,v.memoizedState=i,[o,f,!1]}function Me(i){var o=Pr();return we(o,Qs,i)}function we(i,o,f){if(o=t(i,o,ge)[0],i=x(Sn)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var v=Ml(o)}catch(Z){throw Z===_n?ca:Z}else v=o;o=Pr();var C=o.queue,D=C.dispatch;return f!==o.memoizedState&&(Cs.flags|=2048,je(9,{destroy:void 0},ke.bind(null,C,f),null)),[v,D,i]}function ke(i,o){i.action=o}function De(i){var o=Pr(),f=Qs;if(f!==null)return we(o,f,i);Pr(),o=o.memoizedState,f=Pr();var v=f.queue.dispatch;return f.memoizedState=i,[o,v,!1]}function je(i,o,f,v){return i={tag:i,create:f,deps:v,inst:o,next:null},o=Cs.updateQueue,o===null&&(o=Jn(),Cs.updateQueue=o),f=o.lastEffect,f===null?o.lastEffect=i.next=i:(v=f.next,f.next=i,i.next=v,o.lastEffect=i),i}function qe(){return Pr().memoizedState}function st(i,o,f,v){var C=Di();Cs.flags|=i,C.memoizedState=je(1|o,{destroy:void 0},f,v===void 0?null:v)}function Ke(i,o,f,v){var C=Pr();v=v===void 0?null:v;var D=C.memoizedState.inst;Qs!==null&&v!==null&&wn(v,Qs.memoizedState.deps)?C.memoizedState=je(o,D,f,v):(Cs.flags|=i,C.memoizedState=je(1|o,D,f,v))}function et(i,o){st(8390656,8,i,o)}function tt(i,o){Ke(2048,8,i,o)}function Rt(i){Cs.flags|=4;var o=Cs.updateQueue;if(o===null)o=Jn(),Cs.updateQueue=o,o.events=[i];else{var f=o.events;f===null?o.events=[i]:f.push(i)}}function It(i){var o=Pr().memoizedState;return Rt({ref:o,nextImpl:i}),function(){if((pr&2)!==0)throw Error(S(440));return o.impl.apply(void 0,arguments)}}function St(i,o){return Ke(4,2,i,o)}function Bt(i,o){return Ke(4,4,i,o)}function fs(i,o){if(typeof o=="function"){i=i();var f=o(i);return function(){typeof f=="function"?f():o(null)}}if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function er(i,o,f){f=f!=null?f.concat([i]):null,Ke(4,4,fs.bind(null,o,i),f)}function _r(){}function hr(i,o){var f=Pr();o=o===void 0?null:o;var v=f.memoizedState;return o!==null&&wn(o,v[1])?v[0]:(f.memoizedState=[i,o],i)}function Tr(i,o){var f=Pr();o=o===void 0?null:o;var v=f.memoizedState;if(o!==null&&wn(o,v[1]))return v[0];if(v=i(),bn){he(!0);try{i()}finally{he(!1)}}return f.memoizedState=[v,o],v}function or(i,o,f){return f===void 0||(xo&1073741824)!==0&&($s&261930)===0?i.memoizedState=o:(i.memoizedState=f,i=Zg(),Cs.lanes|=i,Fl|=i,f)}function Or(i,o,f,v){return aa(f,o)?f:El.current!==null?(i=or(i,f,v),aa(i,o)||(Ti=!0),i):(xo&42)===0||(xo&1073741824)!==0&&($s&261930)===0?(Ti=!0,i.memoizedState=f):(i=Zg(),Cs.lanes|=i,Fl|=i,o)}function Nr(i,o,f,v,C){var D=We.p;We.p=D!==0&&8>D?D:8;var Z=Ce.T,ce={};Ce.T=ce,da(i,!1,o,f);try{var ze=C(),at=Ce.S;if(at!==null&&at(ce,ze),ze!==null&&typeof ze=="object"&&typeof ze.then=="function"){var bt=gu(ze,v);Tn(i,o,bt,dn(i))}else Tn(i,o,v,dn(i))}catch(At){Tn(i,o,{then:function(){},status:"rejected",reason:At},dn())}finally{We.p=D,Z!==null&&ce.types!==null&&(Z.types=ce.types),Ce.T=Z}}function Si(){}function qr(i,o,f,v){if(i.tag!==5)throw Error(S(476));var C=Gr(i).queue;Nr(i,C,o,dt,f===null?Si:function(){return ji(i),f(v)})}function Gr(i){var o=i.memoizedState;if(o!==null)return o;o={memoizedState:dt,baseState:dt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sn,lastRenderedState:dt},next:null};var f={};return o.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sn,lastRenderedState:f},next:null},i.memoizedState=o,i=i.alternate,i!==null&&(i.memoizedState=o),o}function ji(i){var o=Gr(i);o.next===null&&(o=i.alternate.memoizedState),Tn(i,o.next.queue,{},dn())}function Qn(){return si(Kh)}function eo(){return Pr().memoizedState}function jn(){return Pr().memoizedState}function ua(i){for(var o=i.return;o!==null;){switch(o.tag){case 24:case 3:var f=dn();i=Kn(f);var v=go(o,i,f);v!==null&&(hn(v,o,f),sn(v,o,f)),o={cache:Hn()},i.payload=o;return}o=o.return}}function Dl(i,o,f){var v=dn();f={lane:v,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Pa(i)?nn(o,f):(f=Uo(i,o,f,v),f!==null&&(hn(f,i,v),on(f,o,v)))}function Nc(i,o,f){var v=dn();Tn(i,o,f,v)}function Tn(i,o,f,v){var C={lane:v,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(Pa(i))nn(o,C);else{var D=i.alternate;if(i.lanes===0&&(D===null||D.lanes===0)&&(D=o.lastRenderedReducer,D!==null))try{var Z=o.lastRenderedState,ce=D(Z,f);if(C.hasEagerState=!0,C.eagerState=ce,aa(ce,Z))return fu(i,o,C,0),Dr===null&&wl(),!1}catch{}finally{}if(f=Uo(i,o,C,v),f!==null)return hn(f,i,v),on(f,o,v),!0}return!1}function da(i,o,f,v){if(v={lane:2,revertLane:Dm(),gesture:null,action:v,hasEagerState:!1,eagerState:null,next:null},Pa(i)){if(o)throw Error(S(479))}else o=Uo(i,f,v,2),o!==null&&hn(o,i,2)}function Pa(i){var o=i.alternate;return i===Cs||o!==null&&o===Cs}function nn(i,o){an=Mr=!0;var f=i.pending;f===null?o.next=o:(o.next=f.next,f.next=o),i.pending=o}function on(i,o,f){if((f&4194048)!==0){var v=o.lanes;v&=i.pendingLanes,f|=v,o.lanes=f,Gs(i,f)}}var rr={readContext:si,use:Pl,useCallback:jr,useContext:jr,useEffect:jr,useImperativeHandle:jr,useLayoutEffect:jr,useInsertionEffect:jr,useMemo:jr,useReducer:jr,useRef:jr,useState:jr,useDebugValue:jr,useDeferredValue:jr,useTransition:jr,useSyncExternalStore:jr,useId:jr,useHostTransitionStatus:jr,useFormState:jr,useActionState:jr,useOptimistic:jr,useMemoCache:jr,useCacheRefresh:jr};rr.useEffectEvent=jr;var fr={readContext:si,use:Pl,useCallback:function(i,o){return Di().memoizedState=[i,o===void 0?null:o],i},useContext:si,useEffect:et,useImperativeHandle:function(i,o,f){f=f!=null?f.concat([i]):null,st(4194308,4,fs.bind(null,o,i),f)},useLayoutEffect:function(i,o){return st(4194308,4,i,o)},useInsertionEffect:function(i,o){st(4,2,i,o)},useMemo:function(i,o){var f=Di();o=o===void 0?null:o;var v=i();if(bn){he(!0);try{i()}finally{he(!1)}}return f.memoizedState=[v,o],v},useReducer:function(i,o,f){var v=Di();if(f!==void 0){var C=f(o);if(bn){he(!0);try{f(o)}finally{he(!1)}}}else C=o;return v.memoizedState=v.baseState=C,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:C},v.queue=i,i=i.dispatch=Dl.bind(null,Cs,i),[v.memoizedState,i]},useRef:function(i){var o=Di();return i={current:i},o.memoizedState=i},useState:function(i){i=z(i);var o=i.queue,f=Nc.bind(null,Cs,o);return o.dispatch=f,[i.memoizedState,f]},useDebugValue:_r,useDeferredValue:function(i,o){var f=Di();return or(f,i,o)},useTransition:function(){var i=z(!1);return i=Nr.bind(null,Cs,i.queue,!0,!1),Di().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,o,f){var v=Cs,C=Di();if(zs){if(f===void 0)throw Error(S(407));f=f()}else{if(f=o(),Dr===null)throw Error(S(349));($s&127)!==0||p(v,o,f)}C.memoizedState=f;var D={value:f,getSnapshot:o};return C.queue=D,et(j.bind(null,v,D,i),[i]),v.flags|=2048,je(9,{destroy:void 0},b.bind(null,v,D,f,o),null),f},useId:function(){var i=Di(),o=Dr.identifierPrefix;if(zs){var f=na,v=Fn;f=(v&~(1<<32-ve(v)-1)).toString(32)+f,o="_"+o+"R_"+f,f=Al++,0<f&&(o+="H"+f.toString(32)),o+="_"}else f=yh++,o="_"+o+"r_"+f.toString(32)+"_";return i.memoizedState=o},useHostTransitionStatus:Qn,useFormState:Se,useActionState:Se,useOptimistic:function(i){var o=Di();o.memoizedState=o.baseState=i;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=f,o=da.bind(null,Cs,!0,f),f.dispatch=o,[i,o]},useMemoCache:Tc,useCacheRefresh:function(){return Di().memoizedState=ua.bind(null,Cs)},useEffectEvent:function(i){var o=Di(),f={impl:i};return o.memoizedState=f,function(){if((pr&2)!==0)throw Error(S(440));return f.impl.apply(void 0,arguments)}}},ri={readContext:si,use:Pl,useCallback:hr,useContext:si,useEffect:tt,useImperativeHandle:er,useInsertionEffect:St,useLayoutEffect:Bt,useMemo:Tr,useReducer:x,useRef:qe,useState:function(){return x(Sn)},useDebugValue:_r,useDeferredValue:function(i,o){var f=Pr();return Or(f,Qs.memoizedState,i,o)},useTransition:function(){var i=x(Sn)[0],o=Pr().memoizedState;return[typeof i=="boolean"?i:Ml(i),o]},useSyncExternalStore:u,useId:eo,useHostTransitionStatus:Qn,useFormState:Me,useActionState:Me,useOptimistic:function(i,o){var f=Pr();return L(f,Qs,i,o)},useMemoCache:Tc,useCacheRefresh:jn};ri.useEffectEvent=It;var ui={readContext:si,use:Pl,useCallback:hr,useContext:si,useEffect:tt,useImperativeHandle:er,useInsertionEffect:St,useLayoutEffect:Bt,useMemo:Tr,useReducer:a,useRef:qe,useState:function(){return a(Sn)},useDebugValue:_r,useDeferredValue:function(i,o){var f=Pr();return Qs===null?or(f,i,o):Or(f,Qs.memoizedState,i,o)},useTransition:function(){var i=a(Sn)[0],o=Pr().memoizedState;return[typeof i=="boolean"?i:Ml(i),o]},useSyncExternalStore:u,useId:eo,useHostTransitionStatus:Qn,useFormState:De,useActionState:De,useOptimistic:function(i,o){var f=Pr();return Qs!==null?L(f,Qs,i,o):(f.baseState=i,[i,f.queue.dispatch])},useMemoCache:Tc,useCacheRefresh:jn};ui.useEffectEvent=It;function Sd(i,o,f,v){o=i.memoizedState,f=f(v,o),f=f==null?o:se({},o,f),i.memoizedState=f,i.lanes===0&&(i.updateQueue.baseState=f)}var jd={enqueueSetState:function(i,o,f){i=i._reactInternals;var v=dn(),C=Kn(v);C.payload=o,f!=null&&(C.callback=f),o=go(i,C,v),o!==null&&(hn(o,i,v),sn(o,i,v))},enqueueReplaceState:function(i,o,f){i=i._reactInternals;var v=dn(),C=Kn(v);C.tag=1,C.payload=o,f!=null&&(C.callback=f),o=go(i,C,v),o!==null&&(hn(o,i,v),sn(o,i,v))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var f=dn(),v=Kn(f);v.tag=2,o!=null&&(v.callback=o),o=go(i,v,f),o!==null&&(hn(o,i,f),sn(o,i,f))}};function Xo(i,o,f,v,C,D,Z){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(v,D,Z):o.prototype&&o.prototype.isPureReactComponent?!Fo(f,v)||!Fo(C,D):!0}function Of(i,o,f,v){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(f,v),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(f,v),o.state!==i&&jd.enqueueReplaceState(o,o.state,null)}function Ko(i,o){var f=o;if("ref"in o){f={};for(var v in o)v!=="ref"&&(f[v]=o[v])}if(i=i.defaultProps){f===o&&(f=se({},f));for(var C in i)f[C]===void 0&&(f[C]=i[C])}return f}function Td(i){Ln(i)}function bo(i){console.error(i)}function wo(i){Ln(i)}function Nn(i,o){try{var f=i.onUncaughtError;f(o.value,{componentStack:o.stack})}catch(v){setTimeout(function(){throw v})}}function Nd(i,o,f){try{var v=i.onCaughtError;v(f.value,{componentStack:f.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(C){setTimeout(function(){throw C})}}function Cu(i,o,f){return f=Kn(f),f.tag=3,f.payload={element:null},f.callback=function(){Nn(i,o)},f}function Au(i){return i=Kn(i),i.tag=3,i}function ku(i,o,f,v){var C=f.type.getDerivedStateFromError;if(typeof C=="function"){var D=v.value;i.payload=function(){return C(D)},i.callback=function(){Nd(o,f,v)}}var Z=f.stateNode;Z!==null&&typeof Z.componentDidCatch=="function"&&(i.callback=function(){Nd(o,f,v),typeof C!="function"&&(Ul===null?Ul=new Set([this]):Ul.add(this));var ce=v.stack;this.componentDidCatch(v.value,{componentStack:ce!==null?ce:""})})}function Lf(i,o,f,v,C){if(f.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){if(o=f.alternate,o!==null&&Aa(o,f,C,!0),f=$t.current,f!==null){switch(f.tag){case 31:case 13:return Wt===null?zh():f.alternate===null&&ii===0&&(ii=3),f.flags&=-257,f.flags|=65536,f.lanes=C,v===Ut?f.flags|=16384:(o=f.updateQueue,o===null?f.updateQueue=new Set([v]):o.add(v),cp(i,v,C)),!1;case 22:return f.flags|=65536,v===Ut?f.flags|=16384:(o=f.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([v])},f.updateQueue=o):(f=o.retryQueue,f===null?o.retryQueue=new Set([v]):f.add(v)),cp(i,v,C)),!1}throw Error(S(435,f.tag))}return cp(i,v,C),zh(),!1}if(zs)return o=$t.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=C,v!==Ir&&(i=Error(S(422),{cause:v}),ho(Ji(i,f)))):(v!==Ir&&(o=Error(S(423),{cause:v}),ho(Ji(o,f))),i=i.current.alternate,i.flags|=65536,C&=-C,i.lanes|=C,v=Ji(v,f),C=Cu(i.stateNode,v,C),sr(i,C),ii!==4&&(ii=2)),!1;var D=Error(S(520),{cause:v});if(D=Ji(D,f),Ph===null?Ph=[D]:Ph.push(D),ii!==4&&(ii=2),o===null)return!0;v=Ji(v,f),f=o;do{switch(f.tag){case 3:return f.flags|=65536,i=C&-C,f.lanes|=i,i=Cu(f.stateNode,v,i),sr(f,i),!1;case 1:if(o=f.type,D=f.stateNode,(f.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(Ul===null||!Ul.has(D))))return f.flags|=65536,C&=-C,f.lanes|=C,C=Au(C),ku(C,i,f,v),sr(f,C),!1}f=f.return}while(f!==null);return!1}var Bf=Error(S(461)),Ti=!1;function Ri(i,o,f,v){o.child=i===null?ph(o,null,f,v):Yn(o,i.child,f,v)}function kg(i,o,f,v,C){f=f.render;var D=o.ref;if("ref"in v){var Z={};for(var ce in v)ce!=="ref"&&(Z[ce]=v[ce])}else Z=v;return mo(o),v=Sc(i,o,f,Z,D,C),ce=Eu(),i!==null&&!Ti?(Yo(i,o,C),Qo(i,o,C)):(zs&&ce&&jl(o),o.flags|=1,Ri(i,o,v,C),o.child)}function Ff(i,o,f,v,C){if(i===null){var D=f.type;return typeof D=="function"&&!ud(D)&&D.defaultProps===void 0&&f.compare===null?(o.tag=15,o.type=D,lm(i,o,D,v,C)):(i=dd(f.type,null,v,o,o.mode,C),i.ref=o.ref,i.return=o,o.child=i)}if(D=i.child,!vh(i,C)){var Z=D.memoizedProps;if(f=f.compare,f=f!==null?f:Fo,f(Z,v)&&i.ref===o.ref)return Qo(i,o,C)}return o.flags|=1,i=Ea(D,v),i.ref=o.ref,i.return=o,o.child=i}function lm(i,o,f,v,C){if(i!==null){var D=i.memoizedProps;if(Fo(D,v)&&i.ref===o.ref)if(Ti=!1,o.pendingProps=v=D,vh(i,C))(i.flags&131072)!==0&&(Ti=!0);else return o.lanes=i.lanes,Qo(i,o,C)}return um(i,o,f,v,C)}function cm(i,o,f,v){var C=v.children,D=i!==null?i.memoizedState:null;if(i===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),v.mode==="hidden"){if((o.flags&128)!==0){if(D=D!==null?D.baseLanes|f:f,i!==null){for(v=o.child=i.child,C=0;v!==null;)C=C|v.lanes|v.childLanes,v=v.sibling;v=C&~D}else v=0,o.child=null;return Mg(i,o,D,f,v)}if((f&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},i!==null&&yd(o,D!==null?D.cachePool:null),D!==null?gh(o,D):Ma(),Su(o);else return v=o.lanes=536870912,Mg(i,o,D!==null?D.baseLanes|f:f,f,v)}else D!==null?(yd(o,D.cachePool),gh(o,D),Xr(),o.memoizedState=null):(i!==null&&yd(o,null),Ma(),Xr());return Ri(i,o,C,f),o.child}function Jo(i,o){return i!==null&&i.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Mg(i,o,f,v,C){var D=gd();return D=D===null?null:{parent:Yr._currentValue,pool:D},o.memoizedState={baseLanes:f,cachePool:D},i!==null&&yd(o,null),Ma(),Su(o),i!==null&&Aa(i,o,v,!0),o.childLanes=C,null}function Rl(i,o){return o=Gf({mode:o.mode,children:o.children},i.mode),o.ref=i.ref,i.child=o,o.return=i,o}function xh(i,o,f){return Yn(o,i.child,null,f),i=Rl(o,o.pendingProps),i.flags|=2,zr(o),o.memoizedState=null,i}function Uf(i,o,f){var v=o.pendingProps,C=(o.flags&128)!==0;if(o.flags&=-129,i===null){if(zs){if(v.mode==="hidden")return i=Rl(o,v),o.lanes=536870912,Jo(null,i);if(wc(o),(i=dr)?(i=zc(i,Ca),i=i!==null&&i.data==="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:Bn!==null?{id:Fn,overflow:na}:null,retryLane:536870912,hydrationErrors:null},f=hd(i),f.return=o,o.child=f,wi=o,dr=null)):i=null,i===null)throw oa(o);return o.lanes=536870912,null}return Rl(o,v)}var D=i.memoizedState;if(D!==null){var Z=D.dehydrated;if(wc(o),C)if(o.flags&256)o.flags&=-257,o=xh(i,o,f);else if(o.memoizedState!==null)o.child=i.child,o.flags|=128,o=null;else throw Error(S(558));else if(Ti||Aa(i,o,f,!1),C=(f&i.childLanes)!==0,Ti||C){if(v=Dr,v!==null&&(Z=vr(v,f),Z!==0&&Z!==D.retryLane))throw D.retryLane=Z,Qa(i,Z),hn(v,i,Z),Bf;zh(),o=xh(i,o,f)}else i=D.treeContext,dr=An(Z.nextSibling),wi=o,zs=!0,uo=null,Ca=!1,i!==null&&dh(o,i),o=Rl(o,v),o.flags|=4096;return o}return i=Ea(i.child,{mode:v.mode,children:v.children}),i.ref=o.ref,o.child=i,i.return=o,i}function $f(i,o){var f=o.ref;if(f===null)i!==null&&i.ref!==null&&(o.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(S(284));(i===null||i.ref!==f)&&(o.flags|=4194816)}}function um(i,o,f,v,C){return mo(o),f=Sc(i,o,f,v,void 0,C),v=Eu(),i!==null&&!Ti?(Yo(i,o,C),Qo(i,o,C)):(zs&&v&&jl(o),o.flags|=1,Ri(i,o,f,C),o.child)}function Pg(i,o,f,v,C,D){return mo(o),o.updateQueue=null,f=Tu(o,v,f,C),jc(i),v=Eu(),i!==null&&!Ti?(Yo(i,o,D),Qo(i,o,D)):(zs&&v&&jl(o),o.flags|=1,Ri(i,o,f,D),o.child)}function Dg(i,o,f,v,C){if(mo(o),o.stateNode===null){var D=gs,Z=f.contextType;typeof Z=="object"&&Z!==null&&(D=si(Z)),D=new f(v,D),o.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=jd,o.stateNode=D,D._reactInternals=o,D=o.stateNode,D.props=v,D.state=o.memoizedState,D.refs={},bd(o),Z=f.contextType,D.context=typeof Z=="object"&&Z!==null?si(Z):gs,D.state=o.memoizedState,Z=f.getDerivedStateFromProps,typeof Z=="function"&&(Sd(o,f,Z,v),D.state=o.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(Z=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),Z!==D.state&&jd.enqueueReplaceState(D,D.state,null),Wo(o,v,D,C),yo(),D.state=o.memoizedState),typeof D.componentDidMount=="function"&&(o.flags|=4194308),v=!0}else if(i===null){D=o.stateNode;var ce=o.memoizedProps,ze=Ko(f,ce);D.props=ze;var at=D.context,bt=f.contextType;Z=gs,typeof bt=="object"&&bt!==null&&(Z=si(bt));var At=f.getDerivedStateFromProps;bt=typeof At=="function"||typeof D.getSnapshotBeforeUpdate=="function",ce=o.pendingProps!==ce,bt||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(ce||at!==Z)&&Of(o,D,v,Z),Xn=!1;var ct=o.memoizedState;D.state=ct,Wo(o,v,D,C),yo(),at=o.memoizedState,ce||ct!==at||Xn?(typeof At=="function"&&(Sd(o,f,At,v),at=o.memoizedState),(ze=Xn||Xo(o,f,ze,v,ct,at,Z))?(bt||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(o.flags|=4194308)):(typeof D.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=v,o.memoizedState=at),D.props=v,D.state=at,D.context=Z,v=ze):(typeof D.componentDidMount=="function"&&(o.flags|=4194308),v=!1)}else{D=o.stateNode,vu(i,o),Z=o.memoizedProps,bt=Ko(f,Z),D.props=bt,At=o.pendingProps,ct=D.context,at=f.contextType,ze=gs,typeof at=="object"&&at!==null&&(ze=si(at)),ce=f.getDerivedStateFromProps,(at=typeof ce=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(Z!==At||ct!==ze)&&Of(o,D,v,ze),Xn=!1,ct=o.memoizedState,D.state=ct,Wo(o,v,D,C),yo();var ft=o.memoizedState;Z!==At||ct!==ft||Xn||i!==null&&i.dependencies!==null&&xc(i.dependencies)?(typeof ce=="function"&&(Sd(o,f,ce,v),ft=o.memoizedState),(bt=Xn||Xo(o,f,bt,v,ct,ft,ze)||i!==null&&i.dependencies!==null&&xc(i.dependencies))?(at||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(v,ft,ze),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(v,ft,ze)),typeof D.componentDidUpdate=="function"&&(o.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof D.componentDidUpdate!="function"||Z===i.memoizedProps&&ct===i.memoizedState||(o.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||Z===i.memoizedProps&&ct===i.memoizedState||(o.flags|=1024),o.memoizedProps=v,o.memoizedState=ft),D.props=v,D.state=ft,D.context=ze,v=bt):(typeof D.componentDidUpdate!="function"||Z===i.memoizedProps&&ct===i.memoizedState||(o.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||Z===i.memoizedProps&&ct===i.memoizedState||(o.flags|=1024),v=!1)}return D=v,$f(i,o),v=(o.flags&128)!==0,D||v?(D=o.stateNode,f=v&&typeof f.getDerivedStateFromError!="function"?null:D.render(),o.flags|=1,i!==null&&v?(o.child=Yn(o,i.child,null,C),o.child=Yn(o,null,f,C)):Ri(i,o,f,C),o.memoizedState=D.state,i=o.child):i=Qo(i,o,C),i}function Rg(i,o,f,v){return $n(),o.flags|=256,Ri(i,o,f,v),o.child}var Vf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _h(i){return{baseLanes:i,cachePool:zf()}}function qf(i,o,f){return i=i!==null?i.childLanes&~f:0,o&&(i|=Qi),i}function dm(i,o,f){var v=o.pendingProps,C=!1,D=(o.flags&128)!==0,Z;if((Z=D)||(Z=i!==null&&i.memoizedState===null?!1:(Vr.current&2)!==0),Z&&(C=!0,o.flags&=-129),Z=(o.flags&32)!==0,o.flags&=-33,i===null){if(zs){if(C?rn(o):Xr(),(i=dr)?(i=zc(i,Ca),i=i!==null&&i.data!=="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:Bn!==null?{id:Fn,overflow:na}:null,retryLane:536870912,hydrationErrors:null},f=hd(i),f.return=o,o.child=f,wi=o,dr=null)):i=null,i===null)throw oa(o);return Lr(i)?o.lanes=32:o.lanes=536870912,null}var ce=v.children;return v=v.fallback,C?(Xr(),C=o.mode,ce=Gf({mode:"hidden",children:ce},C),v=$o(v,C,f,null),ce.return=o,v.return=o,ce.sibling=v,o.child=ce,v=o.child,v.memoizedState=_h(f),v.childLanes=qf(i,Z,f),o.memoizedState=Vf,Jo(null,v)):(rn(o),hm(o,ce))}var ze=i.memoizedState;if(ze!==null&&(ce=ze.dehydrated,ce!==null)){if(D)o.flags&256?(rn(o),o.flags&=-257,o=Hf(i,o,f)):o.memoizedState!==null?(Xr(),o.child=i.child,o.flags|=128,o=null):(Xr(),ce=v.fallback,C=o.mode,v=Gf({mode:"visible",children:v.children},C),ce=$o(ce,C,f,null),ce.flags|=2,v.return=o,ce.return=o,v.sibling=ce,o.child=v,Yn(o,i.child,null,f),v=o.child,v.memoizedState=_h(f),v.childLanes=qf(i,Z,f),o.memoizedState=Vf,o=Jo(null,v));else if(rn(o),Lr(ce)){if(Z=ce.nextSibling&&ce.nextSibling.dataset,Z)var at=Z.dgst;Z=at,v=Error(S(419)),v.stack="",v.digest=Z,ho({value:v,source:null,stack:null}),o=Hf(i,o,f)}else if(Ti||Aa(i,o,f,!1),Z=(f&i.childLanes)!==0,Ti||Z){if(Z=Dr,Z!==null&&(v=vr(Z,f),v!==0&&v!==ze.retryLane))throw ze.retryLane=v,Qa(i,v),hn(Z,i,v),Bf;fa(ce)||zh(),o=Hf(i,o,f)}else fa(ce)?(o.flags|=192,o.child=i.child,o=null):(i=ze.treeContext,dr=An(ce.nextSibling),wi=o,zs=!0,uo=null,Ca=!1,i!==null&&dh(o,i),o=hm(o,v.children),o.flags|=4096);return o}return C?(Xr(),ce=v.fallback,C=o.mode,ze=i.child,at=ze.sibling,v=Ea(ze,{mode:"hidden",children:v.children}),v.subtreeFlags=ze.subtreeFlags&65011712,at!==null?ce=Ea(at,ce):(ce=$o(ce,C,f,null),ce.flags|=2),ce.return=o,v.return=o,v.sibling=ce,o.child=v,Jo(null,v),v=o.child,ce=i.child.memoizedState,ce===null?ce=_h(f):(C=ce.cachePool,C!==null?(ze=Yr._currentValue,C=C.parent!==ze?{parent:ze,pool:ze}:C):C=zf(),ce={baseLanes:ce.baseLanes|f,cachePool:C}),v.memoizedState=ce,v.childLanes=qf(i,Z,f),o.memoizedState=Vf,Jo(i.child,v)):(rn(o),f=i.child,i=f.sibling,f=Ea(f,{mode:"visible",children:v.children}),f.return=o,f.sibling=null,i!==null&&(Z=o.deletions,Z===null?(o.deletions=[i],o.flags|=16):Z.push(i)),o.child=f,o.memoizedState=null,f)}function hm(i,o){return o=Gf({mode:"visible",children:o},i.mode),o.return=i,i.child=o}function Gf(i,o){return i=Na(22,i,null,o),i.lanes=0,i}function Hf(i,o,f){return Yn(o,i.child,null,f),i=hm(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function fm(i,o,f){i.lanes|=o;var v=i.alternate;v!==null&&(v.lanes|=o),fd(i.return,o,f)}function pm(i,o,f,v,C,D){var Z=i.memoizedState;Z===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:v,tail:f,tailMode:C,treeForkCount:D}:(Z.isBackwards=o,Z.rendering=null,Z.renderingStartTime=0,Z.last=v,Z.tail=f,Z.tailMode=C,Z.treeForkCount=D)}function Zf(i,o,f){var v=o.pendingProps,C=v.revealOrder,D=v.tail;v=v.children;var Z=Vr.current,ce=(Z&2)!==0;if(ce?(Z=Z&1|2,o.flags|=128):Z&=1,nt(Vr,Z),Ri(i,o,v,f),v=zs?Ho:0,!ce&&i!==null&&(i.flags&128)!==0)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&fm(i,f,o);else if(i.tag===19)fm(i,f,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(C){case"forwards":for(f=o.child,C=null;f!==null;)i=f.alternate,i!==null&&ju(i)===null&&(C=f),f=f.sibling;f=C,f===null?(C=o.child,o.child=null):(C=f.sibling,f.sibling=null),pm(o,!1,C,f,D,v);break;case"backwards":case"unstable_legacy-backwards":for(f=null,C=o.child,o.child=null;C!==null;){if(i=C.alternate,i!==null&&ju(i)===null){o.child=C;break}i=C.sibling,C.sibling=f,f=C,C=i}pm(o,!0,f,null,D,v);break;case"together":pm(o,!1,null,null,void 0,v);break;default:o.memoizedState=null}return o.child}function Qo(i,o,f){if(i!==null&&(o.dependencies=i.dependencies),Fl|=o.lanes,(f&o.childLanes)===0)if(i!==null){if(Aa(i,o,f,!1),(f&o.childLanes)===0)return null}else return null;if(i!==null&&o.child!==i.child)throw Error(S(153));if(o.child!==null){for(i=o.child,f=Ea(i,i.pendingProps),o.child=f,f.return=o;i.sibling!==null;)i=i.sibling,f=f.sibling=Ea(i,i.pendingProps),f.return=o;f.sibling=null}return o.child}function vh(i,o){return(i.lanes&o)!==0?!0:(i=i.dependencies,!!(i!==null&&xc(i)))}function bh(i,o,f){switch(o.tag){case 3:Dt(o,o.stateNode.containerInfo),po(o,Yr,i.memoizedState.cache),$n();break;case 27:case 5:js(o);break;case 4:Dt(o,o.stateNode.containerInfo);break;case 10:po(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,wc(o),null;break;case 13:var v=o.memoizedState;if(v!==null)return v.dehydrated!==null?(rn(o),o.flags|=128,null):(f&o.child.childLanes)!==0?dm(i,o,f):(rn(o),i=Qo(i,o,f),i!==null?i.sibling:null);rn(o);break;case 19:var C=(i.flags&128)!==0;if(v=(f&o.childLanes)!==0,v||(Aa(i,o,f,!1),v=(f&o.childLanes)!==0),C){if(v)return Zf(i,o,f);o.flags|=128}if(C=o.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),nt(Vr,Vr.current),v)break;return null;case 22:return o.lanes=0,cm(i,o,f,o.pendingProps);case 24:po(o,Yr,i.memoizedState.cache)}return Qo(i,o,f)}function ha(i,o,f){if(i!==null)if(i.memoizedProps!==o.pendingProps)Ti=!0;else{if(!vh(i,f)&&(o.flags&128)===0)return Ti=!1,bh(i,o,f);Ti=(i.flags&131072)!==0}else Ti=!1,zs&&(o.flags&1048576)!==0&&uh(o,Ho,o.index);switch(o.lanes=0,o.tag){case 16:e:{var v=o.pendingProps;if(i=tn(o.elementType),o.type=i,typeof i=="function")ud(i)?(v=Ko(i,v),o.tag=1,o=Dg(null,o,i,v,f)):(o.tag=0,o=um(null,o,i,v,f));else{if(i!=null){var C=i.$$typeof;if(C===Oe){o.tag=11,o=kg(null,o,i,v,f);break e}else if(C===$e){o.tag=14,o=Ff(null,o,i,v,f);break e}}throw o=ht(i)||i,Error(S(306,o,""))}}return o;case 0:return um(i,o,o.type,o.pendingProps,f);case 1:return v=o.type,C=Ko(v,o.pendingProps),Dg(i,o,v,C,f);case 3:e:{if(Dt(o,o.stateNode.containerInfo),i===null)throw Error(S(387));v=o.pendingProps;var D=o.memoizedState;C=D.element,vu(i,o),Wo(o,v,null,f);var Z=o.memoizedState;if(v=Z.cache,po(o,Yr,v),v!==D.cache&&pd(o,[Yr],f,!0),yo(),v=Z.element,D.isDehydrated)if(D={element:v,isDehydrated:!1,cache:Z.cache},o.updateQueue.baseState=D,o.memoizedState=D,o.flags&256){o=Rg(i,o,v,f);break e}else if(v!==C){C=Ji(Error(S(424)),o),ho(C),o=Rg(i,o,v,f);break e}else{switch(i=o.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(dr=An(i.firstChild),wi=o,zs=!0,uo=null,Ca=!0,f=ph(o,null,v,f),o.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if($n(),v===C){o=Qo(i,o,f);break e}Ri(i,o,v,f)}o=o.child}return o;case 26:return $f(i,o),i===null?(f=Hm(o.type,null,o.pendingProps,null))?o.memoizedState=f:zs||(f=o.type,i=o.pendingProps,v=$h(Mt.current).createElement(f),v[Hs]=o,v[Ct]=i,zi(v,f,i),Pt(v),o.stateNode=v):o.memoizedState=Hm(o.type,i.memoizedProps,o.pendingProps,i.memoizedState),null;case 27:return js(o),i===null&&zs&&(v=o.stateNode=py(o.type,o.pendingProps,Mt.current),wi=o,Ca=!0,C=dr,Ic(o.type)?(Oa=C,dr=An(v.firstChild)):dr=C),Ri(i,o,o.pendingProps.children,f),$f(i,o),i===null&&(o.flags|=4194304),o.child;case 5:return i===null&&zs&&((C=v=dr)&&(v=Fi(v,o.type,o.pendingProps,Ca),v!==null?(o.stateNode=v,wi=o,dr=An(v.firstChild),Ca=!1,C=!0):C=!1),C||oa(o)),js(o),C=o.type,D=o.pendingProps,Z=i!==null?i.memoizedProps:null,v=D.children,vp(C,D)?v=null:Z!==null&&vp(C,Z)&&(o.flags|=32),o.memoizedState!==null&&(C=Sc(i,o,Nu,null,null,f),Kh._currentValue=C),$f(i,o),Ri(i,o,v,f),o.child;case 6:return i===null&&zs&&((i=f=dr)&&(f=No(f,o.pendingProps,Ca),f!==null?(o.stateNode=f,wi=o,dr=null,i=!0):i=!1),i||oa(o)),null;case 13:return dm(i,o,f);case 4:return Dt(o,o.stateNode.containerInfo),v=o.pendingProps,i===null?o.child=Yn(o,null,v,f):Ri(i,o,v,f),o.child;case 11:return kg(i,o,o.type,o.pendingProps,f);case 7:return Ri(i,o,o.pendingProps,f),o.child;case 8:return Ri(i,o,o.pendingProps.children,f),o.child;case 12:return Ri(i,o,o.pendingProps.children,f),o.child;case 10:return v=o.pendingProps,po(o,o.type,v.value),Ri(i,o,v.children,f),o.child;case 9:return C=o.type._context,v=o.pendingProps.children,mo(o),C=si(C),v=v(C),o.flags|=1,Ri(i,o,v,f),o.child;case 14:return Ff(i,o,o.type,o.pendingProps,f);case 15:return lm(i,o,o.type,o.pendingProps,f);case 19:return Zf(i,o,f);case 31:return Uf(i,o,f);case 22:return cm(i,o,f,o.pendingProps);case 24:return mo(o),v=si(Yr),i===null?(C=gd(),C===null&&(C=Dr,D=Hn(),C.pooledCache=D,D.refCount++,D!==null&&(C.pooledCacheLanes|=f),C=D),o.memoizedState={parent:v,cache:C},bd(o),po(o,Yr,C)):((i.lanes&f)!==0&&(vu(i,o),Wo(o,null,null,f),yo()),C=i.memoizedState,D=o.memoizedState,C.parent!==v?(C={parent:v,cache:v},o.memoizedState=C,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=C),po(o,Yr,v)):(v=D.cache,po(o,Yr,v),v!==C.cache&&pd(o,[Yr],f,!0))),Ri(i,o,o.pendingProps.children,f),o.child;case 29:throw o.pendingProps}throw Error(S(156,o.tag))}function el(i){i.flags|=4}function wh(i,o,f,v,C){if((o=(i.mode&32)!==0)&&(o=!1),o){if(i.flags|=16777216,(C&335544128)===C)if(i.stateNode.complete)i.flags|=8192;else if(Nm())i.flags|=8192;else throw vn=Ut,Zo}else i.flags&=-16777217}function Ig(i,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!kp(o))if(Nm())i.flags|=8192;else throw vn=Ut,Zo}function Sh(i,o){o!==null&&(i.flags|=4),i.flags&16384&&(o=i.tag!==22?ss():536870912,i.lanes|=o,Iu|=o)}function jh(i,o){if(!zs)switch(i.tailMode){case"hidden":o=i.tail;for(var f=null;o!==null;)o.alternate!==null&&(f=o),o=o.sibling;f===null?i.tail=null:f.sibling=null;break;case"collapsed":f=i.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:v.sibling=null}}function Hr(i){var o=i.alternate!==null&&i.alternate.child===i.child,f=0,v=0;if(o)for(var C=i.child;C!==null;)f|=C.lanes|C.childLanes,v|=C.subtreeFlags&65011712,v|=C.flags&65011712,C.return=i,C=C.sibling;else for(C=i.child;C!==null;)f|=C.lanes|C.childLanes,v|=C.subtreeFlags,v|=C.flags,C.return=i,C=C.sibling;return i.subtreeFlags|=v,i.childLanes=f,o}function zg(i,o,f){var v=o.pendingProps;switch(yc(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hr(o),null;case 1:return Hr(o),null;case 3:return f=o.stateNode,v=null,i!==null&&(v=i.memoizedState.cache),o.memoizedState.cache!==v&&(o.flags|=2048),Gn(Yr),ys(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(i===null||i.child===null)&&(Un(o)?el(o):i===null||i.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Vn())),Hr(o),null;case 26:var C=o.type,D=o.memoizedState;return i===null?(el(o),D!==null?(Hr(o),Ig(o,D)):(Hr(o),wh(o,C,null,v,f))):D?D!==i.memoizedState?(el(o),Hr(o),Ig(o,D)):(Hr(o),o.flags&=-16777217):(i=i.memoizedProps,i!==v&&el(o),Hr(o),wh(o,C,i,v,f)),null;case 27:if(ks(o),f=Mt.current,C=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==v&&el(o);else{if(!v){if(o.stateNode===null)throw Error(S(166));return Hr(o),null}i=lt.current,Un(o)?la(o):(i=py(C,v,f),o.stateNode=i,el(o))}return Hr(o),null;case 5:if(ks(o),C=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==v&&el(o);else{if(!v){if(o.stateNode===null)throw Error(S(166));return Hr(o),null}if(D=lt.current,Un(o))la(o);else{var Z=$h(Mt.current);switch(D){case 1:D=Z.createElementNS("http://www.w3.org/2000/svg",C);break;case 2:D=Z.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;default:switch(C){case"svg":D=Z.createElementNS("http://www.w3.org/2000/svg",C);break;case"math":D=Z.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;case"script":D=Z.createElement("div"),D.innerHTML="<script><\/script>",D=D.removeChild(D.firstChild);break;case"select":D=typeof v.is=="string"?Z.createElement("select",{is:v.is}):Z.createElement("select"),v.multiple?D.multiple=!0:v.size&&(D.size=v.size);break;default:D=typeof v.is=="string"?Z.createElement(C,{is:v.is}):Z.createElement(C)}}D[Hs]=o,D[Ct]=v;e:for(Z=o.child;Z!==null;){if(Z.tag===5||Z.tag===6)D.appendChild(Z.stateNode);else if(Z.tag!==4&&Z.tag!==27&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===o)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===o)break e;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}o.stateNode=D;e:switch(zi(D,C,v),C){case"button":case"input":case"select":case"textarea":v=!!v.autoFocus;break e;case"img":v=!0;break e;default:v=!1}v&&el(o)}}return Hr(o),wh(o,o.type,i===null?null:i.memoizedProps,o.pendingProps,f),null;case 6:if(i&&o.stateNode!=null)i.memoizedProps!==v&&el(o);else{if(typeof v!="string"&&o.stateNode===null)throw Error(S(166));if(i=Mt.current,Un(o)){if(i=o.stateNode,f=o.memoizedProps,v=null,C=wi,C!==null)switch(C.tag){case 27:case 5:v=C.memoizedProps}i[Hs]=o,i=!!(i.nodeValue===f||v!==null&&v.suppressHydrationWarning===!0||Lm(i.nodeValue,f)),i||oa(o,!0)}else i=$h(i).createTextNode(v),i[Hs]=o,o.stateNode=i}return Hr(o),null;case 31:if(f=o.memoizedState,i===null||i.memoizedState!==null){if(v=Un(o),f!==null){if(i===null){if(!v)throw Error(S(318));if(i=o.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(S(557));i[Hs]=o}else $n(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Hr(o),i=!1}else f=Vn(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=f),i=!0;if(!i)return o.flags&256?(zr(o),o):(zr(o),null);if((o.flags&128)!==0)throw Error(S(558))}return Hr(o),null;case 13:if(v=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(C=Un(o),v!==null&&v.dehydrated!==null){if(i===null){if(!C)throw Error(S(318));if(C=o.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(S(317));C[Hs]=o}else $n(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Hr(o),C=!1}else C=Vn(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=C),C=!0;if(!C)return o.flags&256?(zr(o),o):(zr(o),null)}return zr(o),(o.flags&128)!==0?(o.lanes=f,o):(f=v!==null,i=i!==null&&i.memoizedState!==null,f&&(v=o.child,C=null,v.alternate!==null&&v.alternate.memoizedState!==null&&v.alternate.memoizedState.cachePool!==null&&(C=v.alternate.memoizedState.cachePool.pool),D=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(D=v.memoizedState.cachePool.pool),D!==C&&(v.flags|=2048)),f!==i&&f&&(o.child.flags|=8192),Sh(o,o.updateQueue),Hr(o),null);case 4:return ys(),i===null&&zm(o.stateNode.containerInfo),Hr(o),null;case 10:return Gn(o.type),Hr(o),null;case 19:if(Le(Vr),v=o.memoizedState,v===null)return Hr(o),null;if(C=(o.flags&128)!==0,D=v.rendering,D===null)if(C)jh(v,!1);else{if(ii!==0||i!==null&&(i.flags&128)!==0)for(i=o.child;i!==null;){if(D=ju(i),D!==null){for(o.flags|=128,jh(v,!1),i=D.updateQueue,o.updateQueue=i,Sh(o,i),o.subtreeFlags=0,i=f,f=o.child;f!==null;)Rf(f,i),f=f.sibling;return nt(Vr,Vr.current&1|2),zs&&co(o,v.treeForkCount),o.child}i=i.sibling}v.tail!==null&&Ms()>Dh&&(o.flags|=128,C=!0,jh(v,!1),o.lanes=4194304)}else{if(!C)if(i=ju(D),i!==null){if(o.flags|=128,C=!0,i=i.updateQueue,o.updateQueue=i,Sh(o,i),jh(v,!0),v.tail===null&&v.tailMode==="hidden"&&!D.alternate&&!zs)return Hr(o),null}else 2*Ms()-v.renderingStartTime>Dh&&f!==536870912&&(o.flags|=128,C=!0,jh(v,!1),o.lanes=4194304);v.isBackwards?(D.sibling=o.child,o.child=D):(i=v.last,i!==null?i.sibling=D:o.child=D,v.last=D)}return v.tail!==null?(i=v.tail,v.rendering=i,v.tail=i.sibling,v.renderingStartTime=Ms(),i.sibling=null,f=Vr.current,nt(Vr,C?f&1|2:f&1),zs&&co(o,v.treeForkCount),i):(Hr(o),null);case 22:case 23:return zr(o),Cl(),v=o.memoizedState!==null,i!==null?i.memoizedState!==null!==v&&(o.flags|=8192):v&&(o.flags|=8192),v?(f&536870912)!==0&&(o.flags&128)===0&&(Hr(o),o.subtreeFlags&6&&(o.flags|=8192)):Hr(o),f=o.updateQueue,f!==null&&Sh(o,f.retryQueue),f=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(f=i.memoizedState.cachePool.pool),v=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(v=o.memoizedState.cachePool.pool),v!==f&&(o.flags|=2048),i!==null&&Le(xn),null;case 24:return f=null,i!==null&&(f=i.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Gn(Yr),Hr(o),null;case 25:return null;case 30:return null}throw Error(S(156,o.tag))}function ux(i,o){switch(yc(o),o.tag){case 1:return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Gn(Yr),ys(),i=o.flags,(i&65536)!==0&&(i&128)===0?(o.flags=i&-65537|128,o):null;case 26:case 27:case 5:return ks(o),null;case 31:if(o.memoizedState!==null){if(zr(o),o.alternate===null)throw Error(S(340));$n()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 13:if(zr(o),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(S(340));$n()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return Le(Vr),null;case 4:return ys(),null;case 10:return Gn(o.type),null;case 22:case 23:return zr(o),Cl(),i!==null&&Le(xn),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 24:return Gn(Yr),null;case 25:return null;default:return null}}function Wf(i,o){switch(yc(o),o.tag){case 3:Gn(Yr),ys();break;case 26:case 27:case 5:ks(o);break;case 4:ys();break;case 31:o.memoizedState!==null&&zr(o);break;case 13:zr(o);break;case 19:Le(Vr);break;case 10:Gn(o.type);break;case 22:case 23:zr(o),Cl(),i!==null&&Le(xn);break;case 24:Gn(Yr)}}function Ed(i,o){try{var f=o.updateQueue,v=f!==null?f.lastEffect:null;if(v!==null){var C=v.next;f=C;do{if((f.tag&i)===i){v=void 0;var D=f.create,Z=f.inst;v=D(),Z.destroy=v}f=f.next}while(f!==C)}}catch(ce){mr(o,o.return,ce)}}function Il(i,o,f){try{var v=o.updateQueue,C=v!==null?v.lastEffect:null;if(C!==null){var D=C.next;v=D;do{if((v.tag&i)===i){var Z=v.inst,ce=Z.destroy;if(ce!==void 0){Z.destroy=void 0,C=o;var ze=f,at=ce;try{at()}catch(bt){mr(C,ze,bt)}}}v=v.next}while(v!==D)}}catch(bt){mr(o,o.return,bt)}}function Og(i){var o=i.updateQueue;if(o!==null){var f=i.stateNode;try{wd(o,f)}catch(v){mr(i,i.return,v)}}}function Lg(i,o,f){f.props=Ko(i.type,i.memoizedProps),f.state=i.memoizedState;try{f.componentWillUnmount()}catch(v){mr(i,o,v)}}function Th(i,o){try{var f=i.ref;if(f!==null){switch(i.tag){case 26:case 27:case 5:var v=i.stateNode;break;case 30:v=i.stateNode;break;default:v=i.stateNode}typeof f=="function"?i.refCleanup=f(v):f.current=v}}catch(C){mr(i,o,C)}}function En(i,o){var f=i.ref,v=i.refCleanup;if(f!==null)if(typeof v=="function")try{v()}catch(C){mr(i,o,C)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(C){mr(i,o,C)}else f.current=null}function Yf(i){var o=i.type,f=i.memoizedProps,v=i.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":f.autoFocus&&v.focus();break e;case"img":f.src?v.src=f.src:f.srcSet&&(v.srcset=f.srcSet)}}catch(C){mr(i,i.return,C)}}function Xf(i,o,f){try{var v=i.stateNode;hy(v,i.type,f,o),v[Ct]=o}catch(C){mr(i,i.return,C)}}function Ec(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Ic(i.type)||i.tag===4}function Mu(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Ec(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Ic(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function mm(i,o,f){var v=i.tag;if(v===5||v===6)i=i.stateNode,o?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(i,o):(o=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,o.appendChild(i),f=f._reactRootContainer,f!=null||o.onclick!==null||(o.onclick=gn));else if(v!==4&&(v===27&&Ic(i.type)&&(f=i.stateNode,o=null),i=i.child,i!==null))for(mm(i,o,f),i=i.sibling;i!==null;)mm(i,o,f),i=i.sibling}function Kf(i,o,f){var v=i.tag;if(v===5||v===6)i=i.stateNode,o?f.insertBefore(i,o):f.appendChild(i);else if(v!==4&&(v===27&&Ic(i.type)&&(f=i.stateNode),i=i.child,i!==null))for(Kf(i,o,f),i=i.sibling;i!==null;)Kf(i,o,f),i=i.sibling}function Bg(i){var o=i.stateNode,f=i.memoizedProps;try{for(var v=i.type,C=o.attributes;C.length;)o.removeAttributeNode(C[0]);zi(o,v,f),o[Hs]=i,o[Ct]=f}catch(D){mr(i,i.return,D)}}var zl=!1,Ni=!1,gm=!1,Fg=typeof WeakSet=="function"?WeakSet:Set,Ei=null;function dx(i,o){if(i=i.containerInfo,Uh=Lc,i=id(i),ou(i)){if("selectionStart"in i)var f={start:i.selectionStart,end:i.selectionEnd};else e:{f=(f=i.ownerDocument)&&f.defaultView||window;var v=f.getSelection&&f.getSelection();if(v&&v.rangeCount!==0){f=v.anchorNode;var C=v.anchorOffset,D=v.focusNode;v=v.focusOffset;try{f.nodeType,D.nodeType}catch{f=null;break e}var Z=0,ce=-1,ze=-1,at=0,bt=0,At=i,ct=null;t:for(;;){for(var ft;At!==f||C!==0&&At.nodeType!==3||(ce=Z+C),At!==D||v!==0&&At.nodeType!==3||(ze=Z+v),At.nodeType===3&&(Z+=At.nodeValue.length),(ft=At.firstChild)!==null;)ct=At,At=ft;for(;;){if(At===i)break t;if(ct===f&&++at===C&&(ce=Z),ct===D&&++bt===v&&(ze=Z),(ft=At.nextSibling)!==null)break;At=ct,ct=At.parentNode}At=ft}f=ce===-1||ze===-1?null:{start:ce,end:ze}}else f=null}f=f||{start:0,end:0}}else f=null;for(Bm={focusedElem:i,selectionRange:f},Lc=!1,Ei=o;Ei!==null;)if(o=Ei,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,Ei=i;else for(;Ei!==null;){switch(o=Ei,D=o.alternate,i=o.flags,o.tag){case 0:if((i&4)!==0&&(i=o.updateQueue,i=i!==null?i.events:null,i!==null))for(f=0;f<i.length;f++)C=i[f],C.ref.impl=C.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&D!==null){i=void 0,f=o,C=D.memoizedProps,D=D.memoizedState,v=f.stateNode;try{var Jt=Ko(f.type,C);i=v.getSnapshotBeforeUpdate(Jt,D),v.__reactInternalSnapshotBeforeUpdate=i}catch(ps){mr(f,f.return,ps)}}break;case 3:if((i&1024)!==0){if(i=o.stateNode.containerInfo,f=i.nodeType,f===9)rl(i);else if(f===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":rl(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(S(163))}if(i=o.sibling,i!==null){i.return=o.return,Ei=i;break}Ei=o.return}}function ym(i,o,f){var v=f.flags;switch(f.tag){case 0:case 11:case 15:cn(i,f),v&4&&Ed(5,f);break;case 1:if(cn(i,f),v&4)if(i=f.stateNode,o===null)try{i.componentDidMount()}catch(Z){mr(f,f.return,Z)}else{var C=Ko(f.type,o.memoizedProps);o=o.memoizedState;try{i.componentDidUpdate(C,o,i.__reactInternalSnapshotBeforeUpdate)}catch(Z){mr(f,f.return,Z)}}v&64&&Og(f),v&512&&Th(f,f.return);break;case 3:if(cn(i,f),v&64&&(i=f.updateQueue,i!==null)){if(o=null,f.child!==null)switch(f.child.tag){case 27:case 5:o=f.child.stateNode;break;case 1:o=f.child.stateNode}try{wd(i,o)}catch(Z){mr(f,f.return,Z)}}break;case 27:o===null&&v&4&&Bg(f);case 26:case 5:cn(i,f),o===null&&v&4&&Yf(f),v&512&&Th(f,f.return);break;case 12:cn(i,f);break;case 31:cn(i,f),v&4&&Nh(i,f);break;case 13:cn(i,f),v&4&&Eh(i,f),v&64&&(i=f.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(f=Cm.bind(null,f),Ai(i,f))));break;case 22:if(v=f.memoizedState!==null||zl,!v){o=o!==null&&o.memoizedState!==null||Ni,C=zl;var D=Ni;zl=v,(Ni=o)&&!D?Ol(i,f,(f.subtreeFlags&8772)!==0):cn(i,f),zl=C,Ni=D}break;case 30:break;default:cn(i,f)}}function Cd(i){var o=i.alternate;o!==null&&(i.alternate=null,Cd(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&no(o)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Kr=null,Ys=!1;function ln(i,o,f){for(f=f.child;f!==null;)xm(i,o,f),f=f.sibling}function xm(i,o,f){if(U&&typeof U.onCommitFiberUnmount=="function")try{U.onCommitFiberUnmount(K,f)}catch{}switch(f.tag){case 26:Ni||En(f,o),ln(i,o,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Ni||En(f,o);var v=Kr,C=Ys;Ic(f.type)&&(Kr=f.stateNode,Ys=!1),ln(i,o,f),Vh(f.stateNode),Kr=v,Ys=C;break;case 5:Ni||En(f,o);case 6:if(v=Kr,C=Ys,Kr=null,ln(i,o,f),Kr=v,Ys=C,Kr!==null)if(Ys)try{(Kr.nodeType===9?Kr.body:Kr.nodeName==="HTML"?Kr.ownerDocument.body:Kr).removeChild(f.stateNode)}catch(D){mr(f,o,D)}else try{Kr.removeChild(f.stateNode)}catch(D){mr(f,o,D)}break;case 18:Kr!==null&&(Ys?(i=Kr,fy(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,f.stateNode),qd(i)):fy(Kr,f.stateNode));break;case 4:v=Kr,C=Ys,Kr=f.stateNode.containerInfo,Ys=!0,ln(i,o,f),Kr=v,Ys=C;break;case 0:case 11:case 14:case 15:Il(2,f,o),Ni||Il(4,f,o),ln(i,o,f);break;case 1:Ni||(En(f,o),v=f.stateNode,typeof v.componentWillUnmount=="function"&&Lg(f,o,v)),ln(i,o,f);break;case 21:ln(i,o,f);break;case 22:Ni=(v=Ni)||f.memoizedState!==null,ln(i,o,f),Ni=v;break;default:ln(i,o,f)}}function Nh(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{qd(i)}catch(f){mr(o,o.return,f)}}}function Eh(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{qd(i)}catch(f){mr(o,o.return,f)}}function Ch(i){switch(i.tag){case 31:case 13:case 19:var o=i.stateNode;return o===null&&(o=i.stateNode=new Fg),o;case 22:return i=i.stateNode,o=i._retryCache,o===null&&(o=i._retryCache=new Fg),o;default:throw Error(S(435,i.tag))}}function Ah(i,o){var f=Ch(i);o.forEach(function(v){if(!f.has(v)){f.add(v);var C=px.bind(null,i,v);v.then(C,C)}})}function Da(i,o){var f=o.deletions;if(f!==null)for(var v=0;v<f.length;v++){var C=f[v],D=i,Z=o,ce=Z;e:for(;ce!==null;){switch(ce.tag){case 27:if(Ic(ce.type)){Kr=ce.stateNode,Ys=!1;break e}break;case 5:Kr=ce.stateNode,Ys=!1;break e;case 3:case 4:Kr=ce.stateNode.containerInfo,Ys=!0;break e}ce=ce.return}if(Kr===null)throw Error(S(160));xm(D,Z,C),Kr=null,Ys=!1,D=C.alternate,D!==null&&(D.return=null),C.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Jf(o,i),o=o.sibling}var Ra=null;function Jf(i,o){var f=i.alternate,v=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Da(o,i),Ii(i),v&4&&(Il(3,i,i.return),Ed(3,i),Il(5,i,i.return));break;case 1:Da(o,i),Ii(i),v&512&&(Ni||f===null||En(f,f.return)),v&64&&zl&&(i=i.updateQueue,i!==null&&(v=i.callbacks,v!==null&&(f=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=f===null?v:f.concat(v))));break;case 26:var C=Ra;if(Da(o,i),Ii(i),v&512&&(Ni||f===null||En(f,f.return)),v&4){var D=f!==null?f.memoizedState:null;if(v=i.memoizedState,f===null)if(v===null)if(i.stateNode===null){e:{v=i.type,f=i.memoizedProps,C=C.ownerDocument||C;t:switch(v){case"title":D=C.getElementsByTagName("title")[0],(!D||D[ds]||D[Hs]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=C.createElement(v),C.head.insertBefore(D,C.querySelector("head > title"))),zi(D,v,f),D[Hs]=i,Pt(D),v=D;break e;case"link":var Z=Gh("link","href",C).get(v+(f.href||""));if(Z){for(var ce=0;ce<Z.length;ce++)if(D=Z[ce],D.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&D.getAttribute("rel")===(f.rel==null?null:f.rel)&&D.getAttribute("title")===(f.title==null?null:f.title)&&D.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){Z.splice(ce,1);break t}}D=C.createElement(v),zi(D,v,f),C.head.appendChild(D);break;case"meta":if(Z=Gh("meta","content",C).get(v+(f.content||""))){for(ce=0;ce<Z.length;ce++)if(D=Z[ce],D.getAttribute("content")===(f.content==null?null:""+f.content)&&D.getAttribute("name")===(f.name==null?null:f.name)&&D.getAttribute("property")===(f.property==null?null:f.property)&&D.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&D.getAttribute("charset")===(f.charSet==null?null:f.charSet)){Z.splice(ce,1);break t}}D=C.createElement(v),zi(D,v,f),C.head.appendChild(D);break;default:throw Error(S(468,v))}D[Hs]=i,Pt(D),v=D}i.stateNode=v}else Hh(C,i.type,i.stateNode);else i.stateNode=Fu(C,v,i.memoizedProps);else D!==v?(D===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):D.count--,v===null?Hh(C,i.type,i.stateNode):Fu(C,v,i.memoizedProps)):v===null&&i.stateNode!==null&&Xf(i,i.memoizedProps,f.memoizedProps)}break;case 27:Da(o,i),Ii(i),v&512&&(Ni||f===null||En(f,f.return)),f!==null&&v&4&&Xf(i,i.memoizedProps,f.memoizedProps);break;case 5:if(Da(o,i),Ii(i),v&512&&(Ni||f===null||En(f,f.return)),i.flags&32){C=i.stateNode;try{oo(C,"")}catch(Jt){mr(i,i.return,Jt)}}v&4&&i.stateNode!=null&&(C=i.memoizedProps,Xf(i,C,f!==null?f.memoizedProps:C)),v&1024&&(gm=!0);break;case 6:if(Da(o,i),Ii(i),v&4){if(i.stateNode===null)throw Error(S(162));v=i.memoizedProps,f=i.stateNode;try{f.nodeValue=v}catch(Jt){mr(i,i.return,Jt)}}break;case 3:if(qh=null,C=Ra,Ra=ql(o.containerInfo),Da(o,i),Ra=C,Ii(i),v&4&&f!==null&&f.memoizedState.isDehydrated)try{qd(o.containerInfo)}catch(Jt){mr(i,i.return,Jt)}gm&&(gm=!1,kh(i));break;case 4:v=Ra,Ra=ql(i.stateNode.containerInfo),Da(o,i),Ii(i),Ra=v;break;case 12:Da(o,i),Ii(i);break;case 31:Da(o,i),Ii(i),v&4&&(v=i.updateQueue,v!==null&&(i.updateQueue=null,Ah(i,v)));break;case 13:Da(o,i),Ii(i),i.child.flags&8192&&i.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(tp=Ms()),v&4&&(v=i.updateQueue,v!==null&&(i.updateQueue=null,Ah(i,v)));break;case 22:C=i.memoizedState!==null;var ze=f!==null&&f.memoizedState!==null,at=zl,bt=Ni;if(zl=at||C,Ni=bt||ze,Da(o,i),Ni=bt,zl=at,Ii(i),v&8192)e:for(o=i.stateNode,o._visibility=C?o._visibility&-2:o._visibility|1,C&&(f===null||ze||zl||Ni||So(i)),f=null,o=i;;){if(o.tag===5||o.tag===26){if(f===null){ze=f=o;try{if(D=ze.stateNode,C)Z=D.style,typeof Z.setProperty=="function"?Z.setProperty("display","none","important"):Z.display="none";else{ce=ze.stateNode;var At=ze.memoizedProps.style,ct=At!=null&&At.hasOwnProperty("display")?At.display:null;ce.style.display=ct==null||typeof ct=="boolean"?"":(""+ct).trim()}}catch(Jt){mr(ze,ze.return,Jt)}}}else if(o.tag===6){if(f===null){ze=o;try{ze.stateNode.nodeValue=C?"":ze.memoizedProps}catch(Jt){mr(ze,ze.return,Jt)}}}else if(o.tag===18){if(f===null){ze=o;try{var ft=ze.stateNode;C?ir(ft,!0):ir(ze.stateNode,!1)}catch(Jt){mr(ze,ze.return,Jt)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===i)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break e;for(;o.sibling===null;){if(o.return===null||o.return===i)break e;f===o&&(f=null),o=o.return}f===o&&(f=null),o.sibling.return=o.return,o=o.sibling}v&4&&(v=i.updateQueue,v!==null&&(f=v.retryQueue,f!==null&&(v.retryQueue=null,Ah(i,f))));break;case 19:Da(o,i),Ii(i),v&4&&(v=i.updateQueue,v!==null&&(i.updateQueue=null,Ah(i,v)));break;case 30:break;case 21:break;default:Da(o,i),Ii(i)}}function Ii(i){var o=i.flags;if(o&2){try{for(var f,v=i.return;v!==null;){if(Ec(v)){f=v;break}v=v.return}if(f==null)throw Error(S(160));switch(f.tag){case 27:var C=f.stateNode,D=Mu(i);Kf(i,D,C);break;case 5:var Z=f.stateNode;f.flags&32&&(oo(Z,""),f.flags&=-33);var ce=Mu(i);Kf(i,ce,Z);break;case 3:case 4:var ze=f.stateNode.containerInfo,at=Mu(i);mm(i,at,ze);break;default:throw Error(S(161))}}catch(bt){mr(i,i.return,bt)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function kh(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var o=i;kh(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),i=i.sibling}}function cn(i,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)ym(i,o.alternate,o),o=o.sibling}function So(i){for(i=i.child;i!==null;){var o=i;switch(o.tag){case 0:case 11:case 14:case 15:Il(4,o,o.return),So(o);break;case 1:En(o,o.return);var f=o.stateNode;typeof f.componentWillUnmount=="function"&&Lg(o,o.return,f),So(o);break;case 27:Vh(o.stateNode);case 26:case 5:En(o,o.return),So(o);break;case 22:o.memoizedState===null&&So(o);break;case 30:So(o);break;default:So(o)}i=i.sibling}}function Ol(i,o,f){for(f=f&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var v=o.alternate,C=i,D=o,Z=D.flags;switch(D.tag){case 0:case 11:case 15:Ol(C,D,f),Ed(4,D);break;case 1:if(Ol(C,D,f),v=D,C=v.stateNode,typeof C.componentDidMount=="function")try{C.componentDidMount()}catch(at){mr(v,v.return,at)}if(v=D,C=v.updateQueue,C!==null){var ce=v.stateNode;try{var ze=C.shared.hiddenCallbacks;if(ze!==null)for(C.shared.hiddenCallbacks=null,C=0;C<ze.length;C++)bu(ze[C],ce)}catch(at){mr(v,v.return,at)}}f&&Z&64&&Og(D),Th(D,D.return);break;case 27:Bg(D);case 26:case 5:Ol(C,D,f),f&&v===null&&Z&4&&Yf(D),Th(D,D.return);break;case 12:Ol(C,D,f);break;case 31:Ol(C,D,f),f&&Z&4&&Nh(C,D);break;case 13:Ol(C,D,f),f&&Z&4&&Eh(C,D);break;case 22:D.memoizedState===null&&Ol(C,D,f),Th(D,D.return);break;case 30:break;default:Ol(C,D,f)}o=o.sibling}}function Qf(i,o){var f=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(f=i.memoizedState.cachePool.pool),i=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(i=o.memoizedState.cachePool.pool),i!==f&&(i!=null&&i.refCount++,f!=null&&_c(f))}function Ll(i,o){i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&_c(i))}function jo(i,o,f,v){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)_m(i,o,f,v),o=o.sibling}function _m(i,o,f,v){var C=o.flags;switch(o.tag){case 0:case 11:case 15:jo(i,o,f,v),C&2048&&Ed(9,o);break;case 1:jo(i,o,f,v);break;case 3:jo(i,o,f,v),C&2048&&(i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&_c(i)));break;case 12:if(C&2048){jo(i,o,f,v),i=o.stateNode;try{var D=o.memoizedProps,Z=D.id,ce=D.onPostCommit;typeof ce=="function"&&ce(Z,o.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ze){mr(o,o.return,ze)}}else jo(i,o,f,v);break;case 31:jo(i,o,f,v);break;case 13:jo(i,o,f,v);break;case 23:break;case 22:D=o.stateNode,Z=o.alternate,o.memoizedState!==null?D._visibility&2?jo(i,o,f,v):Pu(i,o):D._visibility&2?jo(i,o,f,v):(D._visibility|=2,tl(i,o,f,v,(o.subtreeFlags&10256)!==0||!1)),C&2048&&Qf(Z,o);break;case 24:jo(i,o,f,v),C&2048&&Ll(o.alternate,o);break;default:jo(i,o,f,v)}}function tl(i,o,f,v,C){for(C=C&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var D=i,Z=o,ce=f,ze=v,at=Z.flags;switch(Z.tag){case 0:case 11:case 15:tl(D,Z,ce,ze,C),Ed(8,Z);break;case 23:break;case 22:var bt=Z.stateNode;Z.memoizedState!==null?bt._visibility&2?tl(D,Z,ce,ze,C):Pu(D,Z):(bt._visibility|=2,tl(D,Z,ce,ze,C)),C&&at&2048&&Qf(Z.alternate,Z);break;case 24:tl(D,Z,ce,ze,C),C&&at&2048&&Ll(Z.alternate,Z);break;default:tl(D,Z,ce,ze,C)}o=o.sibling}}function Pu(i,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var f=i,v=o,C=v.flags;switch(v.tag){case 22:Pu(f,v),C&2048&&Qf(v.alternate,v);break;case 24:Pu(f,v),C&2048&&Ll(v.alternate,v);break;default:Pu(f,v)}o=o.sibling}}var Ad=8192;function Du(i,o,f){if(i.subtreeFlags&Ad)for(i=i.child;i!==null;)Ug(i,o,f),i=i.sibling}function Ug(i,o,f){switch(i.tag){case 26:Du(i,o,f),i.flags&Ad&&i.memoizedState!==null&&Ym(f,Ra,i.memoizedState,i.memoizedProps);break;case 5:Du(i,o,f);break;case 3:case 4:var v=Ra;Ra=ql(i.stateNode.containerInfo),Du(i,o,f),Ra=v;break;case 22:i.memoizedState===null&&(v=i.alternate,v!==null&&v.memoizedState!==null?(v=Ad,Ad=16777216,Du(i,o,f),Ad=v):Du(i,o,f));break;default:Du(i,o,f)}}function $g(i){var o=i.alternate;if(o!==null&&(i=o.child,i!==null)){o.child=null;do o=i.sibling,i.sibling=null,i=o;while(i!==null)}}function Mh(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var f=0;f<o.length;f++){var v=o[f];Ei=v,kd(v,i)}$g(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Vg(i),i=i.sibling}function Vg(i){switch(i.tag){case 0:case 11:case 15:Mh(i),i.flags&2048&&Il(9,i,i.return);break;case 3:Mh(i);break;case 12:Mh(i);break;case 22:var o=i.stateNode;i.memoizedState!==null&&o._visibility&2&&(i.return===null||i.return.tag!==13)?(o._visibility&=-3,ep(i)):Mh(i);break;default:Mh(i)}}function ep(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var f=0;f<o.length;f++){var v=o[f];Ei=v,kd(v,i)}$g(i)}for(i=i.child;i!==null;){switch(o=i,o.tag){case 0:case 11:case 15:Il(8,o,o.return),ep(o);break;case 22:f=o.stateNode,f._visibility&2&&(f._visibility&=-3,ep(o));break;default:ep(o)}i=i.sibling}}function kd(i,o){for(;Ei!==null;){var f=Ei;switch(f.tag){case 0:case 11:case 15:Il(8,f,o);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var v=f.memoizedState.cachePool.pool;v!=null&&v.refCount++}break;case 24:_c(f.memoizedState.cache)}if(v=f.child,v!==null)v.return=f,Ei=v;else e:for(f=i;Ei!==null;){v=Ei;var C=v.sibling,D=v.return;if(Cd(v),v===f){Ei=null;break e}if(C!==null){C.return=D,Ei=C;break e}Ei=D}}}var hx={getCacheForType:function(i){var o=si(Yr),f=o.data.get(i);return f===void 0&&(f=i(),o.data.set(i,f)),f},cacheSignal:function(){return si(Yr).controller.signal}},qg=typeof WeakMap=="function"?WeakMap:Map,pr=0,Dr=null,Us=null,$s=0,br=0,Ia=null,to=!1,Cc=!1,vm=!1,Bl=0,ii=0,Fl=0,Ru=0,bm=0,Qi=0,Iu=0,Ph=null,un=null,wm=!1,tp=0,Gg=0,Dh=1/0,Md=null,Ul=null,Ci=0,$l=null,Pd=null,so=0,Sm=0,sp=null,Hg=null,Rh=0,jm=null;function dn(){return(pr&2)!==0&&$s!==0?$s&-$s:Ce.T!==null?Dm():Ps()}function Zg(){if(Qi===0)if(($s&536870912)===0||zs){var i=ot;ot<<=1,(ot&3932160)===0&&(ot=262144),Qi=i}else Qi=536870912;return i=$t.current,i!==null&&(i.flags|=32),Qi}function hn(i,o,f){(i===Dr&&(br===2||br===9)||i.cancelPendingCommit!==null)&&(Rd(i,0),Ac(i,$s,Qi,!1)),ls(i,f),((pr&2)===0||i!==Dr)&&(i===Dr&&((pr&2)===0&&(Ru|=f),ii===4&&Ac(i,$s,Qi,!1)),To(i))}function xi(i,o,f){if((pr&6)!==0)throw Error(S(327));var v=!f&&(o&127)===0&&(o&i.expiredLanes)===0||as(i,o),C=v?Id(i,o):ap(i,o,!0),D=v;do{if(C===0){Cc&&!v&&Ac(i,o,0,!1);break}else{if(f=i.current.alternate,D&&!fx(f)){C=ap(i,o,!1),D=!1;continue}if(C===2){if(D=o,i.errorRecoveryDisabledLanes&D)var Z=0;else Z=i.pendingLanes&-536870913,Z=Z!==0?Z:Z&536870912?536870912:0;if(Z!==0){o=Z;e:{var ce=i;C=Ph;var ze=ce.current.memoizedState.isDehydrated;if(ze&&(Rd(ce,Z).flags|=256),Z=ap(ce,Z,!1),Z!==2){if(vm&&!ze){ce.errorRecoveryDisabledLanes|=D,Ru|=D,C=4;break e}D=un,un=C,D!==null&&(un===null?un=D:un.push.apply(un,D))}C=Z}if(D=!1,C!==2)continue}}if(C===1){Rd(i,0),Ac(i,o,0,!0);break}e:{switch(v=i,D=C,D){case 0:case 1:throw Error(S(345));case 4:if((o&4194048)!==o)break;case 6:Ac(v,o,Qi,!to);break e;case 2:un=null;break;case 3:case 5:break;default:throw Error(S(329))}if((o&62914560)===o&&(C=tp+300-Ms(),10<C)){if(Ac(v,o,Qi,!to),Vt(v,0,!0)!==0)break e;so=o,v.timeoutHandle=wp(Dd.bind(null,v,f,un,Md,wm,o,Qi,Ru,Iu,to,D,"Throttled",-0,0),C);break e}Dd(v,f,un,Md,wm,o,Qi,Ru,Iu,to,D,null,-0,0)}}break}while(!0);To(i)}function Dd(i,o,f,v,C,D,Z,ce,ze,at,bt,At,ct,ft){if(i.timeoutHandle=-1,At=o.subtreeFlags,At&8192||(At&16785408)===16785408){At={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:gn},Ug(o,D,At);var Jt=(D&62914560)===D?tp-Ms():(D&4194048)===D?Gg-Ms():0;if(Jt=yy(At,Jt),Jt!==null){so=D,i.cancelPendingCommit=Jt(Jg.bind(null,i,o,D,f,v,C,Z,ce,ze,bt,At,null,ct,ft)),Ac(i,D,Z,!at);return}}Jg(i,o,D,f,v,C,Z,ce,ze)}function fx(i){for(var o=i;;){var f=o.tag;if((f===0||f===11||f===15)&&o.flags&16384&&(f=o.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var v=0;v<f.length;v++){var C=f[v],D=C.getSnapshot;C=C.value;try{if(!aa(D(),C))return!1}catch{return!1}}if(f=o.child,o.subtreeFlags&16384&&f!==null)f.return=o,o=f;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ac(i,o,f,v){o&=~bm,o&=~Ru,i.suspendedLanes|=o,i.pingedLanes&=~o,v&&(i.warmLanes|=o),v=i.expirationTimes;for(var C=o;0<C;){var D=31-ve(C),Z=1<<D;v[D]=-1,C&=~Z}f!==0&&Sr(i,f,o)}function Ih(){return(pr&6)===0?(Cn(0),!1):!0}function rp(){if(Us!==null){if(br===0)var i=Us.return;else i=Us,qn=en=null,vo(i),Zn=null,Nl=0,i=Us;for(;i!==null;)Wf(i.alternate,i),i=i.return;Us=null}}function Rd(i,o){var f=i.timeoutHandle;f!==-1&&(i.timeoutHandle=-1,Um(f)),f=i.cancelPendingCommit,f!==null&&(i.cancelPendingCommit=null,f()),so=0,rp(),Dr=i,Us=f=Ea(i.current,null),$s=o,br=0,Ia=null,to=!1,Cc=as(i,o),vm=!1,Iu=Qi=bm=Ru=Fl=ii=0,un=Ph=null,wm=!1,(o&8)!==0&&(o|=o&32);var v=i.entangledLanes;if(v!==0)for(i=i.entanglements,v&=o;0<v;){var C=31-ve(v),D=1<<C;o|=i[C],v&=~D}return Bl=o,wl(),f}function Tm(i,o){Cs=null,Ce.H=rr,o===_n||o===ca?(o=bc(),br=3):o===Zo?(o=bc(),br=4):br=o===Bf?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Ia=o,Us===null&&(ii=1,Nn(i,Ji(o,i.current)))}function Nm(){var i=$t.current;return i===null?!0:($s&4194048)===$s?Wt===null:($s&62914560)===$s||($s&536870912)!==0?i===Wt:!1}function zu(){var i=Ce.H;return Ce.H=rr,i===null?rr:i}function ip(){var i=Ce.A;return Ce.A=hx,i}function zh(){ii=4,to||($s&4194048)!==$s&&$t.current!==null||(Cc=!0),(Fl&134217727)===0&&(Ru&134217727)===0||Dr===null||Ac(Dr,$s,Qi,!1)}function ap(i,o,f){var v=pr;pr|=2;var C=zu(),D=ip();(Dr!==i||$s!==o)&&(Md=null,Rd(i,o)),o=!1;var Z=ii;e:do try{if(br!==0&&Us!==null){var ce=Us,ze=Ia;switch(br){case 8:rp(),Z=6;break e;case 3:case 2:case 9:case 6:$t.current===null&&(o=!0);var at=br;if(br=0,Ia=null,zd(i,ce,ze,at),f&&Cc){Z=0;break e}break;default:at=br,br=0,Ia=null,zd(i,ce,ze,at)}}np(),Z=ii;break}catch(bt){Tm(i,bt)}while(!0);return o&&i.shellSuspendCounter++,qn=en=null,pr=v,Ce.H=C,Ce.A=D,Us===null&&(Dr=null,$s=0,wl()),Z}function np(){for(;Us!==null;)Yg(Us)}function Id(i,o){var f=pr;pr|=2;var v=zu(),C=ip();Dr!==i||$s!==o?(Md=null,Dh=Ms()+500,Rd(i,o)):Cc=as(i,o);e:do try{if(br!==0&&Us!==null){o=Us;var D=Ia;t:switch(br){case 1:br=0,Ia=null,zd(i,o,D,1);break;case 2:case 9:if(yu(D)){br=0,Ia=null,Xg(o);break}o=function(){br!==2&&br!==9||Dr!==i||(br=7),To(i)},D.then(o,o);break e;case 3:br=7;break e;case 4:br=5;break e;case 7:yu(D)?(br=0,Ia=null,Xg(o)):(br=0,Ia=null,zd(i,o,D,7));break;case 5:var Z=null;switch(Us.tag){case 26:Z=Us.memoizedState;case 5:case 27:var ce=Us;if(Z?kp(Z):ce.stateNode.complete){br=0,Ia=null;var ze=ce.sibling;if(ze!==null)Us=ze;else{var at=ce.return;at!==null?(Us=at,op(at)):Us=null}break t}}br=0,Ia=null,zd(i,o,D,5);break;case 6:br=0,Ia=null,zd(i,o,D,6);break;case 8:rp(),ii=6;break e;default:throw Error(S(462))}}Wg();break}catch(bt){Tm(i,bt)}while(!0);return qn=en=null,Ce.H=v,Ce.A=C,pr=f,Us!==null?0:(Dr=null,$s=0,wl(),ii)}function Wg(){for(;Us!==null&&!yr();)Yg(Us)}function Yg(i){var o=ha(i.alternate,i,Bl);i.memoizedProps=i.pendingProps,o===null?op(i):Us=o}function Xg(i){var o=i,f=o.alternate;switch(o.tag){case 15:case 0:o=Pg(f,o,o.pendingProps,o.type,void 0,$s);break;case 11:o=Pg(f,o,o.pendingProps,o.type.render,o.ref,$s);break;case 5:vo(o);default:Wf(f,o),o=Us=Rf(o,Bl),o=ha(f,o,Bl)}i.memoizedProps=i.pendingProps,o===null?op(i):Us=o}function zd(i,o,f,v){qn=en=null,vo(o),Zn=null,Nl=0;var C=o.return;try{if(Lf(i,C,o,f,$s)){ii=1,Nn(i,Ji(f,i.current)),Us=null;return}}catch(D){if(C!==null)throw Us=C,D;ii=1,Nn(i,Ji(f,i.current)),Us=null;return}o.flags&32768?(zs||v===1?i=!0:Cc||($s&536870912)!==0?i=!1:(to=i=!0,(v===2||v===9||v===3||v===6)&&(v=$t.current,v!==null&&v.tag===13&&(v.flags|=16384))),Kg(o,i)):op(o)}function op(i){var o=i;do{if((o.flags&32768)!==0){Kg(o,to);return}i=o.return;var f=zg(o.alternate,o,Bl);if(f!==null){Us=f;return}if(o=o.sibling,o!==null){Us=o;return}Us=o=i}while(o!==null);ii===0&&(ii=5)}function Kg(i,o){do{var f=ux(i.alternate,i);if(f!==null){f.flags&=32767,Us=f;return}if(f=i.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!o&&(i=i.sibling,i!==null)){Us=i;return}Us=i=f}while(i!==null);ii=6,Us=null}function Jg(i,o,f,v,C,D,Z,ce,ze){i.cancelPendingCommit=null;do lp();while(Ci!==0);if((pr&6)!==0)throw Error(S(327));if(o!==null){if(o===i.current)throw Error(S(177));if(D=o.lanes|o.childLanes,D|=bl,xr(i,f,D,Z,ce,ze),i===Dr&&(Us=Dr=null,$s=0),Pd=o,$l=i,so=f,Sm=D,sp=C,Hg=v,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,iy(Gi,function(){return ry(),null})):(i.callbackNode=null,i.callbackPriority=0),v=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||v){v=Ce.T,Ce.T=null,C=We.p,We.p=2,Z=pr,pr|=4;try{dx(i,o,f)}finally{pr=Z,We.p=C,Ce.T=v}}Ci=1,Qg(),ey(),ty()}}function Qg(){if(Ci===1){Ci=0;var i=$l,o=Pd,f=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||f){f=Ce.T,Ce.T=null;var v=We.p;We.p=2;var C=pr;pr|=4;try{Jf(o,i);var D=Bm,Z=id(i.containerInfo),ce=D.focusedElem,ze=D.selectionRange;if(Z!==ce&&ce&&ce.ownerDocument&&rd(ce.ownerDocument.documentElement,ce)){if(ze!==null&&ou(ce)){var at=ze.start,bt=ze.end;if(bt===void 0&&(bt=at),"selectionStart"in ce)ce.selectionStart=at,ce.selectionEnd=Math.min(bt,ce.value.length);else{var At=ce.ownerDocument||document,ct=At&&At.defaultView||window;if(ct.getSelection){var ft=ct.getSelection(),Jt=ce.textContent.length,ps=Math.min(ze.start,Jt),gr=ze.end===void 0?ps:Math.min(ze.end,Jt);!ft.extend&&ps>gr&&(Z=gr,gr=ps,ps=Z);var Xe=nu(ce,ps),Ge=nu(ce,gr);if(Xe&&Ge&&(ft.rangeCount!==1||ft.anchorNode!==Xe.node||ft.anchorOffset!==Xe.offset||ft.focusNode!==Ge.node||ft.focusOffset!==Ge.offset)){var it=At.createRange();it.setStart(Xe.node,Xe.offset),ft.removeAllRanges(),ps>gr?(ft.addRange(it),ft.extend(Ge.node,Ge.offset)):(it.setEnd(Ge.node,Ge.offset),ft.addRange(it))}}}}for(At=[],ft=ce;ft=ft.parentNode;)ft.nodeType===1&&At.push({element:ft,left:ft.scrollLeft,top:ft.scrollTop});for(typeof ce.focus=="function"&&ce.focus(),ce=0;ce<At.length;ce++){var jt=At[ce];jt.element.scrollLeft=jt.left,jt.element.scrollTop=jt.top}}Lc=!!Uh,Bm=Uh=null}finally{pr=C,We.p=v,Ce.T=f}}i.current=o,Ci=2}}function ey(){if(Ci===2){Ci=0;var i=$l,o=Pd,f=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||f){f=Ce.T,Ce.T=null;var v=We.p;We.p=2;var C=pr;pr|=4;try{ym(i,o.alternate,o)}finally{pr=C,We.p=v,Ce.T=f}}Ci=3}}function ty(){if(Ci===4||Ci===3){Ci=0,Ha();var i=$l,o=Pd,f=so,v=Hg;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Ci=5:(Ci=0,Pd=$l=null,sy(i,i.pendingLanes));var C=i.pendingLanes;if(C===0&&(Ul=null),Nt(f),o=o.stateNode,U&&typeof U.onCommitFiberRoot=="function")try{U.onCommitFiberRoot(K,o,void 0,(o.current.flags&128)===128)}catch{}if(v!==null){o=Ce.T,C=We.p,We.p=2,Ce.T=null;try{for(var D=i.onRecoverableError,Z=0;Z<v.length;Z++){var ce=v[Z];D(ce.value,{componentStack:ce.stack})}}finally{Ce.T=o,We.p=C}}(so&3)!==0&&lp(),To(i),C=i.pendingLanes,(f&261930)!==0&&(C&42)!==0?i===jm?Rh++:(Rh=0,jm=i):Rh=0,Cn(0)}}function sy(i,o){(i.pooledCacheLanes&=o)===0&&(o=i.pooledCache,o!=null&&(i.pooledCache=null,_c(o)))}function lp(){return Qg(),ey(),ty(),ry()}function ry(){if(Ci!==5)return!1;var i=$l,o=Sm;Sm=0;var f=Nt(so),v=Ce.T,C=We.p;try{We.p=32>f?32:f,Ce.T=null,f=sp,sp=null;var D=$l,Z=so;if(Ci=0,Pd=$l=null,so=0,(pr&6)!==0)throw Error(S(331));var ce=pr;if(pr|=4,Vg(D.current),_m(D,D.current,Z,f),pr=ce,Cn(0,!1),U&&typeof U.onPostCommitFiberRoot=="function")try{U.onPostCommitFiberRoot(K,D)}catch{}return!0}finally{We.p=C,Ce.T=v,sy(i,o)}}function Em(i,o,f){o=Ji(f,o),o=Cu(i.stateNode,o,2),i=go(i,o,2),i!==null&&(ls(i,2),To(i))}function mr(i,o,f){if(i.tag===3)Em(i,i,f);else for(;o!==null;){if(o.tag===3){Em(o,i,f);break}else if(o.tag===1){var v=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(Ul===null||!Ul.has(v))){i=Ji(f,i),f=Au(2),v=go(o,f,2),v!==null&&(ku(f,v,o,i),ls(v,2),To(v));break}}o=o.return}}function cp(i,o,f){var v=i.pingCache;if(v===null){v=i.pingCache=new qg;var C=new Set;v.set(o,C)}else C=v.get(o),C===void 0&&(C=new Set,v.set(o,C));C.has(f)||(vm=!0,C.add(f),i=kc.bind(null,i,o,f),o.then(i,i))}function kc(i,o,f){var v=i.pingCache;v!==null&&v.delete(o),i.pingedLanes|=i.suspendedLanes&f,i.warmLanes&=~f,Dr===i&&($s&f)===f&&(ii===4||ii===3&&($s&62914560)===$s&&300>Ms()-tp?(pr&2)===0&&Rd(i,0):bm|=f,Iu===$s&&(Iu=0)),To(i)}function Oh(i,o){o===0&&(o=ss()),i=Qa(i,o),i!==null&&(ls(i,o),To(i))}function Cm(i){var o=i.memoizedState,f=0;o!==null&&(f=o.retryLane),Oh(i,f)}function px(i,o){var f=0;switch(i.tag){case 31:case 13:var v=i.stateNode,C=i.memoizedState;C!==null&&(f=C.retryLane);break;case 19:v=i.stateNode;break;case 22:v=i.stateNode._retryCache;break;default:throw Error(S(314))}v!==null&&v.delete(o),Oh(i,f)}function iy(i,o){return wt(i,o)}var up=null,Od=null,Am=!1,dp=!1,km=!1,Vl=0;function To(i){i!==Od&&i.next===null&&(Od===null?up=Od=i:Od=Od.next=i),dp=!0,Am||(Am=!0,Pm())}function Cn(i,o){if(!km&&dp){km=!0;do for(var f=!1,v=up;v!==null;){if(i!==0){var C=v.pendingLanes;if(C===0)var D=0;else{var Z=v.suspendedLanes,ce=v.pingedLanes;D=(1<<31-ve(42|i)+1)-1,D&=C&~(Z&~ce),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(f=!0,Lh(v,D))}else D=$s,D=Vt(v,v===Dr?D:0,v.cancelPendingCommit!==null||v.timeoutHandle!==-1),(D&3)===0||as(v,D)||(f=!0,Lh(v,D));v=v.next}while(f);km=!1}}function Mc(){Mm()}function Mm(){dp=Am=!1;var i=0;Vl!==0&&bp()&&(i=Vl);for(var o=Ms(),f=null,v=up;v!==null;){var C=v.next,D=hp(v,o);D===0?(v.next=null,f===null?up=C:f.next=C,C===null&&(Od=f)):(f=v,(i!==0||(D&3)!==0)&&(dp=!0)),v=C}Ci!==0&&Ci!==5||Cn(i),Vl!==0&&(Vl=0)}function hp(i,o){for(var f=i.suspendedLanes,v=i.pingedLanes,C=i.expirationTimes,D=i.pendingLanes&-62914561;0<D;){var Z=31-ve(D),ce=1<<Z,ze=C[Z];ze===-1?((ce&f)===0||(ce&v)!==0)&&(C[Z]=Kt(ce,o)):ze<=o&&(i.expiredLanes|=ce),D&=~ce}if(o=Dr,f=$s,f=Vt(i,i===o?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),v=i.callbackNode,f===0||i===o&&(br===2||br===9)||i.cancelPendingCommit!==null)return v!==null&&v!==null&&qs(v),i.callbackNode=null,i.callbackPriority=0;if((f&3)===0||as(i,f)){if(o=f&-f,o===i.callbackPriority)return o;switch(v!==null&&qs(v),Nt(f)){case 2:case 8:f=Oi;break;case 32:f=Gi;break;case 268435456:f=Ls;break;default:f=Gi}return v=ay.bind(null,i),f=wt(f,v),i.callbackPriority=o,i.callbackNode=f,o}return v!==null&&v!==null&&qs(v),i.callbackPriority=2,i.callbackNode=null,2}function ay(i,o){if(Ci!==0&&Ci!==5)return i.callbackNode=null,i.callbackPriority=0,null;var f=i.callbackNode;if(lp()&&i.callbackNode!==f)return null;var v=$s;return v=Vt(i,i===Dr?v:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),v===0?null:(xi(i,v,o),hp(i,Ms()),i.callbackNode!=null&&i.callbackNode===f?ay.bind(null,i):null)}function Lh(i,o){if(lp())return null;xi(i,o,!0)}function Pm(){Vm(function(){(pr&6)!==0?wt(Fr,Mc):Mm()})}function Dm(){if(Vl===0){var i=Tl;i===0&&(i=Re,Re<<=1,(Re&261888)===0&&(Re=256)),Vl=i}return Vl}function fp(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:_s(""+i)}function pp(i,o){var f=o.ownerDocument.createElement("input");return f.name=o.name,f.value=o.value,i.id&&f.setAttribute("form",i.id),o.parentNode.insertBefore(f,o),i=new FormData(i),f.parentNode.removeChild(f),i}function Ld(i,o,f,v,C){if(o==="submit"&&f&&f.stateNode===C){var D=fp((C[Ct]||null).action),Z=v.submitter;Z&&(o=(o=Z[Ct]||null)?fp(o.formAction):Z.getAttribute("formAction"),o!==null&&(D=o,Z=null));var ce=new Yc("action","action",null,v,C);i.push({event:ce,listeners:[{instance:null,listener:function(){if(v.defaultPrevented){if(Vl!==0){var ze=Z?pp(C,Z):new FormData(C);qr(f,{pending:!0,data:ze,method:C.method,action:D},null,ze)}}else typeof D=="function"&&(ce.preventDefault(),ze=Z?pp(C,Z):new FormData(C),qr(f,{pending:!0,data:ze,method:C.method,action:D},D,ze))},currentTarget:C}]})}}for(var mp=0;mp<ld.length;mp++){var gp=ld[mp],Rm=gp.toLowerCase(),ny=gp[0].toUpperCase()+gp.slice(1);Ta(Rm,"on"+ny)}Ta(uu,"onAnimationEnd"),Ta(du,"onAnimationIteration"),Ta(od,"onAnimationStart"),Ta("dblclick","onDoubleClick"),Ta("focusin","onFocus"),Ta("focusout","onBlur"),Ta(vl,"onTransitionRun"),Ta(hu,"onTransitionStart"),Ta(pc,"onTransitionCancel"),Ta(ja,"onTransitionEnd"),Js("onMouseEnter",["mouseout","mouseover"]),Js("onMouseLeave",["mouseout","mouseover"]),Js("onPointerEnter",["pointerout","pointerover"]),Js("onPointerLeave",["pointerout","pointerover"]),Ht("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ht("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ht("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ht("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ht("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ht("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pc));function ly(i,o){o=(o&4)!==0;for(var f=0;f<i.length;f++){var v=i[f],C=v.event;v=v.listeners;e:{var D=void 0;if(o)for(var Z=v.length-1;0<=Z;Z--){var ce=v[Z],ze=ce.instance,at=ce.currentTarget;if(ce=ce.listener,ze!==D&&C.isPropagationStopped())break e;D=ce,C.currentTarget=at;try{D(C)}catch(bt){Ln(bt)}C.currentTarget=null,D=ze}else for(Z=0;Z<v.length;Z++){if(ce=v[Z],ze=ce.instance,at=ce.currentTarget,ce=ce.listener,ze!==D&&C.isPropagationStopped())break e;D=ce,C.currentTarget=at;try{D(C)}catch(bt){Ln(bt)}C.currentTarget=null,D=ze}}}}function Vs(i,o){var f=o[es];f===void 0&&(f=o[es]=new Set);var v=i+"__bubble";f.has(v)||(xp(o,i,2,!1),f.add(v))}function Im(i,o,f){var v=0;o&&(v|=4),xp(f,i,v,o)}var yp="_reactListening"+Math.random().toString(36).slice(2);function zm(i){if(!i[yp]){i[yp]=!0,Ft.forEach(function(f){f!=="selectionchange"&&(oy.has(f)||Im(f,!1,i),Im(f,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[yp]||(o[yp]=!0,Im("selectionchange",!1,o))}}function xp(i,o,f,v){switch(Sy(o)){case 2:var C=mx;break;case 8:C=Qm;break;default:C=Jh}f=C.bind(null,o,f,i),C=void 0,!Zi||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(C=!0),v?C!==void 0?i.addEventListener(o,f,{capture:!0,passive:C}):i.addEventListener(o,f,!0):C!==void 0?i.addEventListener(o,f,{passive:C}):i.addEventListener(o,f,!1)}function sl(i,o,f,v,C){var D=v;if((o&1)===0&&(o&2)===0&&v!==null)e:for(;;){if(v===null)return;var Z=v.tag;if(Z===3||Z===4){var ce=v.stateNode.containerInfo;if(ce===C)break;if(Z===4)for(Z=v.return;Z!==null;){var ze=Z.tag;if((ze===3||ze===4)&&Z.stateNode.containerInfo===C)return;Z=Z.return}for(;ce!==null;){if(Z=ba(ce),Z===null)return;if(ze=Z.tag,ze===5||ze===6||ze===26||ze===27){v=D=Z;continue e}ce=ce.parentNode}}v=v.return}ur(function(){var at=D,bt=Wc(f),At=[];e:{var ct=oh.get(i);if(ct!==void 0){var ft=Yc,Jt=i;switch(i){case"keypress":if(Sa(f)===0)break e;case"keydown":case"keyup":ft=$r;break;case"focusin":Jt="focus",ft=Io;break;case"focusout":Jt="blur",ft=Io;break;case"beforeblur":case"afterblur":ft=Io;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ft=ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ft=Xc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ft=am;break;case uu:case du:case od:ft=wf;break;case ja:ft=Qu;break;case"scroll":case"scrollend":ft=pl;break;case"wheel":ft=sh;break;case"copy":case"cut":case"paste":ft=eh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ft=Ju;break;case"toggle":case"beforetoggle":ft=lc}var ps=(o&4)!==0,gr=!ps&&(i==="scroll"||i==="scrollend"),Xe=ps?ct!==null?ct+"Capture":null:ct;ps=[];for(var Ge=at,it;Ge!==null;){var jt=Ge;if(it=jt.stateNode,jt=jt.tag,jt!==5&&jt!==26&&jt!==27||it===null||Xe===null||(jt=Ya(Ge,Xe),jt!=null&&ps.push(Bd(Ge,jt,it))),gr)break;Ge=Ge.return}0<ps.length&&(ct=new ft(ct,Jt,null,f,bt),At.push({event:ct,listeners:ps}))}}if((o&7)===0){e:{if(ct=i==="mouseover"||i==="pointerover",ft=i==="mouseout"||i==="pointerout",ct&&f!==Qd&&(Jt=f.relatedTarget||f.fromElement)&&(ba(Jt)||Jt[is]))break e;if((ft||ct)&&(ct=bt.window===bt?bt:(ct=bt.ownerDocument)?ct.defaultView||ct.parentWindow:window,ft?(Jt=f.relatedTarget||f.toElement,ft=at,Jt=Jt?ba(Jt):null,Jt!==null&&(gr=P(Jt),ps=Jt.tag,Jt!==gr||ps!==5&&ps!==27&&ps!==6)&&(Jt=null)):(ft=null,Jt=at),ft!==Jt)){if(ps=ml,jt="onMouseLeave",Xe="onMouseEnter",Ge="mouse",(i==="pointerout"||i==="pointerover")&&(ps=Ju,jt="onPointerLeave",Xe="onPointerEnter",Ge="pointer"),gr=ft==null?ct:hi(ft),it=Jt==null?ct:hi(Jt),ct=new ps(jt,Ge+"leave",ft,f,bt),ct.target=gr,ct.relatedTarget=it,jt=null,ba(bt)===at&&(ps=new ps(Xe,Ge+"enter",Jt,f,bt),ps.target=it,ps.relatedTarget=gr,jt=ps),gr=jt,ft&&Jt)t:{for(ps=cy,Xe=ft,Ge=Jt,it=0,jt=Xe;jt;jt=ps(jt))it++;jt=0;for(var cs=Ge;cs;cs=ps(cs))jt++;for(;0<it-jt;)Xe=ps(Xe),it--;for(;0<jt-it;)Ge=ps(Ge),jt--;for(;it--;){if(Xe===Ge||Ge!==null&&Xe===Ge.alternate){ps=Xe;break t}Xe=ps(Xe),Ge=ps(Ge)}ps=null}else ps=null;ft!==null&&Om(At,ct,ft,ps,!1),Jt!==null&&gr!==null&&Om(At,gr,Jt,ps,!0)}}e:{if(ct=at?hi(at):window,ft=ct.nodeName&&ct.nodeName.toLowerCase(),ft==="select"||ft==="input"&&ct.type==="file")var cr=Lo;else if(td(ct))if(rh)cr=Pf;else{cr=Mf;var rs=nm}else ft=ct.nodeName,!ft||ft.toLowerCase()!=="input"||ct.type!=="checkbox"&&ct.type!=="radio"?at&&dl(at.elementType)&&(cr=Lo):cr=au;if(cr&&(cr=cr(i,at))){sd(At,cr,f,bt);break e}rs&&rs(i,ct,at),i==="focusout"&&at&&ct.type==="number"&&at.memoizedProps.value!=null&&Zc(ct,"number",ct.value)}switch(rs=at?hi(at):window,i){case"focusin":(td(rs)||rs.contentEditable==="true")&&(Ja=rs,lu=at,cu=null);break;case"focusout":cu=lu=Ja=null;break;case"mousedown":nd=!0;break;case"contextmenu":case"mouseup":case"dragend":nd=!1,Df(At,f,bt);break;case"selectionchange":if(ad)break;case"keydown":case"keyup":Df(At,f,bt)}var ws;if(Wr)e:{switch(i){case"compositionstart":var hs="onCompositionStart";break e;case"compositionend":hs="onCompositionEnd";break e;case"compositionupdate":hs="onCompositionUpdate";break e}hs=void 0}else yn?tu(i,f)&&(hs="onCompositionEnd"):i==="keydown"&&f.keyCode===229&&(hs="onCompositionStart");hs&&(hc&&f.locale!=="ko"&&(yn||hs!=="onCompositionStart"?hs==="onCompositionEnd"&&yn&&(ws=Do()):(wa=bt,In="value"in wa?wa.value:wa.textContent,yn=!0)),rs=Bh(at,hs),0<rs.length&&(hs=new th(hs,i,null,f,bt),At.push({event:hs,listeners:rs}),ws?hs.data=ws:(ws=Nf(f),ws!==null&&(hs.data=ws)))),(ws=dc?ed(i,f):Ef(i,f))&&(hs=Bh(at,"onBeforeInput"),0<hs.length&&(rs=new th("onBeforeInput","beforeinput",null,f,bt),At.push({event:rs,listeners:hs}),rs.data=ws)),Ld(At,i,at,f,bt)}ly(At,o)})}function Bd(i,o,f){return{instance:i,listener:o,currentTarget:f}}function Bh(i,o){for(var f=o+"Capture",v=[];i!==null;){var C=i,D=C.stateNode;if(C=C.tag,C!==5&&C!==26&&C!==27||D===null||(C=Ya(i,f),C!=null&&v.unshift(Bd(i,C,D)),C=Ya(i,o),C!=null&&v.push(Bd(i,C,D))),i.tag===3)return v;i=i.return}return[]}function cy(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Om(i,o,f,v,C){for(var D=o._reactName,Z=[];f!==null&&f!==v;){var ce=f,ze=ce.alternate,at=ce.stateNode;if(ce=ce.tag,ze!==null&&ze===v)break;ce!==5&&ce!==26&&ce!==27||at===null||(ze=at,C?(at=Ya(f,D),at!=null&&Z.unshift(Bd(f,at,ze))):C||(at=Ya(f,D),at!=null&&Z.push(Bd(f,at,ze)))),f=f.return}Z.length!==0&&i.push({event:o,listeners:Z})}var uy=/\r\n?/g,dy=/\u0000|\uFFFD/g;function Fh(i){return(typeof i=="string"?i:""+i).replace(uy,`
`).replace(dy,"")}function Lm(i,o){return o=Fh(o),Fh(i)===o}function lr(i,o,f,v,C,D){switch(f){case"children":typeof v=="string"?o==="body"||o==="textarea"&&v===""||oo(i,v):(typeof v=="number"||typeof v=="bigint")&&o!=="body"&&oo(i,""+v);break;case"className":Rn(i,"class",v);break;case"tabIndex":Rn(i,"tabindex",v);break;case"dir":case"role":case"viewBox":case"width":case"height":Rn(i,f,v);break;case"style":Ku(i,v,D);break;case"data":if(o!=="object"){Rn(i,"data",v);break}case"src":case"href":if(v===""&&(o!=="a"||f!=="href")){i.removeAttribute(f);break}if(v==null||typeof v=="function"||typeof v=="symbol"||typeof v=="boolean"){i.removeAttribute(f);break}v=_s(""+v),i.setAttribute(f,v);break;case"action":case"formAction":if(typeof v=="function"){i.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(f==="formAction"?(o!=="input"&&lr(i,o,"name",C.name,C,null),lr(i,o,"formEncType",C.formEncType,C,null),lr(i,o,"formMethod",C.formMethod,C,null),lr(i,o,"formTarget",C.formTarget,C,null)):(lr(i,o,"encType",C.encType,C,null),lr(i,o,"method",C.method,C,null),lr(i,o,"target",C.target,C,null)));if(v==null||typeof v=="symbol"||typeof v=="boolean"){i.removeAttribute(f);break}v=_s(""+v),i.setAttribute(f,v);break;case"onClick":v!=null&&(i.onclick=gn);break;case"onScroll":v!=null&&Vs("scroll",i);break;case"onScrollEnd":v!=null&&Vs("scrollend",i);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(S(61));if(f=v.__html,f!=null){if(C.children!=null)throw Error(S(60));i.innerHTML=f}}break;case"multiple":i.multiple=v&&typeof v!="function"&&typeof v!="symbol";break;case"muted":i.muted=v&&typeof v!="function"&&typeof v!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(v==null||typeof v=="function"||typeof v=="boolean"||typeof v=="symbol"){i.removeAttribute("xlink:href");break}f=_s(""+v),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":v!=null&&typeof v!="function"&&typeof v!="symbol"?i.setAttribute(f,""+v):i.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":v&&typeof v!="function"&&typeof v!="symbol"?i.setAttribute(f,""):i.removeAttribute(f);break;case"capture":case"download":v===!0?i.setAttribute(f,""):v!==!1&&v!=null&&typeof v!="function"&&typeof v!="symbol"?i.setAttribute(f,v):i.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":v!=null&&typeof v!="function"&&typeof v!="symbol"&&!isNaN(v)&&1<=v?i.setAttribute(f,v):i.removeAttribute(f);break;case"rowSpan":case"start":v==null||typeof v=="function"||typeof v=="symbol"||isNaN(v)?i.removeAttribute(f):i.setAttribute(f,v);break;case"popover":Vs("beforetoggle",i),Vs("toggle",i),mn(i,"popover",v);break;case"xlinkActuate":Wa(i,"http://www.w3.org/1999/xlink","xlink:actuate",v);break;case"xlinkArcrole":Wa(i,"http://www.w3.org/1999/xlink","xlink:arcrole",v);break;case"xlinkRole":Wa(i,"http://www.w3.org/1999/xlink","xlink:role",v);break;case"xlinkShow":Wa(i,"http://www.w3.org/1999/xlink","xlink:show",v);break;case"xlinkTitle":Wa(i,"http://www.w3.org/1999/xlink","xlink:title",v);break;case"xlinkType":Wa(i,"http://www.w3.org/1999/xlink","xlink:type",v);break;case"xmlBase":Wa(i,"http://www.w3.org/XML/1998/namespace","xml:base",v);break;case"xmlLang":Wa(i,"http://www.w3.org/XML/1998/namespace","xml:lang",v);break;case"xmlSpace":Wa(i,"http://www.w3.org/XML/1998/namespace","xml:space",v);break;case"is":mn(i,"is",v);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Po.get(f)||f,mn(i,f,v))}}function _p(i,o,f,v,C,D){switch(f){case"style":Ku(i,v,D);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(S(61));if(f=v.__html,f!=null){if(C.children!=null)throw Error(S(60));i.innerHTML=f}}break;case"children":typeof v=="string"?oo(i,v):(typeof v=="number"||typeof v=="bigint")&&oo(i,""+v);break;case"onScroll":v!=null&&Vs("scroll",i);break;case"onScrollEnd":v!=null&&Vs("scrollend",i);break;case"onClick":v!=null&&(i.onclick=gn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Gt.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(C=f.endsWith("Capture"),o=f.slice(2,C?f.length-7:void 0),D=i[Ct]||null,D=D!=null?D[f]:null,typeof D=="function"&&i.removeEventListener(o,D,C),typeof v=="function")){typeof D!="function"&&D!==null&&(f in i?i[f]=null:i.hasAttribute(f)&&i.removeAttribute(f)),i.addEventListener(o,v,C);break e}f in i?i[f]=v:v===!0?i.setAttribute(f,""):mn(i,f,v)}}}function zi(i,o,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Vs("error",i),Vs("load",i);var v=!1,C=!1,D;for(D in f)if(f.hasOwnProperty(D)){var Z=f[D];if(Z!=null)switch(D){case"src":v=!0;break;case"srcSet":C=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,o));default:lr(i,o,D,Z,f,null)}}C&&lr(i,o,"srcSet",f.srcSet,f,null),v&&lr(i,o,"src",f.src,f,null);return;case"input":Vs("invalid",i);var ce=D=Z=C=null,ze=null,at=null;for(v in f)if(f.hasOwnProperty(v)){var bt=f[v];if(bt!=null)switch(v){case"name":C=bt;break;case"type":Z=bt;break;case"checked":ze=bt;break;case"defaultChecked":at=bt;break;case"value":D=bt;break;case"defaultValue":ce=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(S(137,o));break;default:lr(i,o,v,bt,f,null)}}Xu(i,D,ce,ze,at,Z,C,!1);return;case"select":Vs("invalid",i),v=Z=D=null;for(C in f)if(f.hasOwnProperty(C)&&(ce=f[C],ce!=null))switch(C){case"value":D=ce;break;case"defaultValue":Z=ce;break;case"multiple":v=ce;default:lr(i,o,C,ce,f,null)}o=D,f=Z,i.multiple=!!v,o!=null?Mo(i,!!v,o,!1):f!=null&&Mo(i,!!v,f,!0);return;case"textarea":Vs("invalid",i),D=C=v=null;for(Z in f)if(f.hasOwnProperty(Z)&&(ce=f[Z],ce!=null))switch(Z){case"value":v=ce;break;case"defaultValue":C=ce;break;case"children":D=ce;break;case"dangerouslySetInnerHTML":if(ce!=null)throw Error(S(91));break;default:lr(i,o,Z,ce,f,null)}ic(i,v,C,D);return;case"option":for(ze in f)if(f.hasOwnProperty(ze)&&(v=f[ze],v!=null))switch(ze){case"selected":i.selected=v&&typeof v!="function"&&typeof v!="symbol";break;default:lr(i,o,ze,v,f,null)}return;case"dialog":Vs("beforetoggle",i),Vs("toggle",i),Vs("cancel",i),Vs("close",i);break;case"iframe":case"object":Vs("load",i);break;case"video":case"audio":for(v=0;v<Pc.length;v++)Vs(Pc[v],i);break;case"image":Vs("error",i),Vs("load",i);break;case"details":Vs("toggle",i);break;case"embed":case"source":case"link":Vs("error",i),Vs("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(at in f)if(f.hasOwnProperty(at)&&(v=f[at],v!=null))switch(at){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,o));default:lr(i,o,at,v,f,null)}return;default:if(dl(o)){for(bt in f)f.hasOwnProperty(bt)&&(v=f[bt],v!==void 0&&_p(i,o,bt,v,f,void 0));return}}for(ce in f)f.hasOwnProperty(ce)&&(v=f[ce],v!=null&&lr(i,o,ce,v,f,null))}function hy(i,o,f,v){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var C=null,D=null,Z=null,ce=null,ze=null,at=null,bt=null;for(ft in f){var At=f[ft];if(f.hasOwnProperty(ft)&&At!=null)switch(ft){case"checked":break;case"value":break;case"defaultValue":ze=At;default:v.hasOwnProperty(ft)||lr(i,o,ft,null,v,At)}}for(var ct in v){var ft=v[ct];if(At=f[ct],v.hasOwnProperty(ct)&&(ft!=null||At!=null))switch(ct){case"type":D=ft;break;case"name":C=ft;break;case"checked":at=ft;break;case"defaultChecked":bt=ft;break;case"value":Z=ft;break;case"defaultValue":ce=ft;break;case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(S(137,o));break;default:ft!==At&&lr(i,o,ct,ft,v,At)}}Hc(i,Z,ce,ze,at,bt,D,C);return;case"select":ft=Z=ce=ct=null;for(D in f)if(ze=f[D],f.hasOwnProperty(D)&&ze!=null)switch(D){case"value":break;case"multiple":ft=ze;default:v.hasOwnProperty(D)||lr(i,o,D,null,v,ze)}for(C in v)if(D=v[C],ze=f[C],v.hasOwnProperty(C)&&(D!=null||ze!=null))switch(C){case"value":ct=D;break;case"defaultValue":ce=D;break;case"multiple":Z=D;default:D!==ze&&lr(i,o,C,D,v,ze)}o=ce,f=Z,v=ft,ct!=null?Mo(i,!!f,ct,!1):!!v!=!!f&&(o!=null?Mo(i,!!f,o,!0):Mo(i,!!f,f?[]:"",!1));return;case"textarea":ft=ct=null;for(ce in f)if(C=f[ce],f.hasOwnProperty(ce)&&C!=null&&!v.hasOwnProperty(ce))switch(ce){case"value":break;case"children":break;default:lr(i,o,ce,null,v,C)}for(Z in v)if(C=v[Z],D=f[Z],v.hasOwnProperty(Z)&&(C!=null||D!=null))switch(Z){case"value":ct=C;break;case"defaultValue":ft=C;break;case"children":break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(S(91));break;default:C!==D&&lr(i,o,Z,C,v,D)}vf(i,ct,ft);return;case"option":for(var Jt in f)if(ct=f[Jt],f.hasOwnProperty(Jt)&&ct!=null&&!v.hasOwnProperty(Jt))switch(Jt){case"selected":i.selected=!1;break;default:lr(i,o,Jt,null,v,ct)}for(ze in v)if(ct=v[ze],ft=f[ze],v.hasOwnProperty(ze)&&ct!==ft&&(ct!=null||ft!=null))switch(ze){case"selected":i.selected=ct&&typeof ct!="function"&&typeof ct!="symbol";break;default:lr(i,o,ze,ct,v,ft)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ps in f)ct=f[ps],f.hasOwnProperty(ps)&&ct!=null&&!v.hasOwnProperty(ps)&&lr(i,o,ps,null,v,ct);for(at in v)if(ct=v[at],ft=f[at],v.hasOwnProperty(at)&&ct!==ft&&(ct!=null||ft!=null))switch(at){case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(S(137,o));break;default:lr(i,o,at,ct,v,ft)}return;default:if(dl(o)){for(var gr in f)ct=f[gr],f.hasOwnProperty(gr)&&ct!==void 0&&!v.hasOwnProperty(gr)&&_p(i,o,gr,void 0,v,ct);for(bt in v)ct=v[bt],ft=f[bt],!v.hasOwnProperty(bt)||ct===ft||ct===void 0&&ft===void 0||_p(i,o,bt,ct,v,ft);return}}for(var Xe in f)ct=f[Xe],f.hasOwnProperty(Xe)&&ct!=null&&!v.hasOwnProperty(Xe)&&lr(i,o,Xe,null,v,ct);for(At in v)ct=v[At],ft=f[At],!v.hasOwnProperty(At)||ct===ft||ct==null&&ft==null||lr(i,o,At,ct,v,ft)}function za(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Fd(){if(typeof performance.getEntriesByType=="function"){for(var i=0,o=0,f=performance.getEntriesByType("resource"),v=0;v<f.length;v++){var C=f[v],D=C.transferSize,Z=C.initiatorType,ce=C.duration;if(D&&ce&&za(Z)){for(Z=0,ce=C.responseEnd,v+=1;v<f.length;v++){var ze=f[v],at=ze.startTime;if(at>ce)break;var bt=ze.transferSize,At=ze.initiatorType;bt&&za(At)&&(ze=ze.responseEnd,Z+=bt*(ze<ce?1:(ce-at)/(ze-at)))}if(--v,o+=8*(D+Z)/(C.duration/1e3),i++,10<i)break}}if(0<i)return o/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Uh=null,Bm=null;function $h(i){return i.nodeType===9?i:i.ownerDocument}function Dc(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Fm(i,o){if(i===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&o==="foreignObject"?0:i}function vp(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Rc=null;function bp(){var i=window.event;return i&&i.type==="popstate"?i===Rc?!1:(Rc=i,!0):(Rc=null,!1)}var wp=typeof setTimeout=="function"?setTimeout:void 0,Um=typeof clearTimeout=="function"?clearTimeout:void 0,$m=typeof Promise=="function"?Promise:void 0,Vm=typeof queueMicrotask=="function"?queueMicrotask:typeof $m<"u"?function(i){return $m.resolve(null).then(i).catch(qm)}:wp;function qm(i){setTimeout(function(){throw i})}function Ic(i){return i==="head"}function fy(i,o){var f=o,v=0;do{var C=f.nextSibling;if(i.removeChild(f),C&&C.nodeType===8)if(f=C.data,f==="/$"||f==="/&"){if(v===0){i.removeChild(C),qd(o);return}v--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")v++;else if(f==="html")Vh(i.ownerDocument.documentElement);else if(f==="head"){f=i.ownerDocument.head,Vh(f);for(var D=f.firstChild;D;){var Z=D.nextSibling,ce=D.nodeName;D[ds]||ce==="SCRIPT"||ce==="STYLE"||ce==="LINK"&&D.rel.toLowerCase()==="stylesheet"||f.removeChild(D),D=Z}}else f==="body"&&Vh(i.ownerDocument.body);f=C}while(f);qd(o)}function ir(i,o){var f=i;i=0;do{var v=f.nextSibling;if(f.nodeType===1?o?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(o?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),v&&v.nodeType===8)if(f=v.data,f==="/$"){if(i===0)break;i--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||i++;f=v}while(f)}function rl(i){var o=i.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var f=o;switch(o=o.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":rl(f),no(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}i.removeChild(f)}}function Fi(i,o,f,v){for(;i.nodeType===1;){var C=f;if(i.nodeName.toLowerCase()!==o.toLowerCase()){if(!v&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(v){if(!i[ds])switch(o){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(D=i.getAttribute("rel"),D==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(D!==C.rel||i.getAttribute("href")!==(C.href==null||C.href===""?null:C.href)||i.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin)||i.getAttribute("title")!==(C.title==null?null:C.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(D=i.getAttribute("src"),(D!==(C.src==null?null:C.src)||i.getAttribute("type")!==(C.type==null?null:C.type)||i.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin))&&D&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(o==="input"&&i.type==="hidden"){var D=C.name==null?null:""+C.name;if(C.type==="hidden"&&i.getAttribute("name")===D)return i}else return i;if(i=An(i.nextSibling),i===null)break}return null}function No(i,o,f){if(o==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!f||(i=An(i.nextSibling),i===null))return null;return i}function zc(i,o){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=An(i.nextSibling),i===null))return null;return i}function fa(i){return i.data==="$?"||i.data==="$~"}function Lr(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function Ai(i,o){var f=i.ownerDocument;if(i.data==="$~")i._reactRetry=o;else if(i.data!=="$?"||f.readyState!=="loading")o();else{var v=function(){o(),f.removeEventListener("DOMContentLoaded",v)};f.addEventListener("DOMContentLoaded",v),i._reactRetry=v}}function An(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return i}var Oa=null;function Ui(i){i=i.nextSibling;for(var o=0;i;){if(i.nodeType===8){var f=i.data;if(f==="/$"||f==="/&"){if(o===0)return An(i.nextSibling);o--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||o++}i=i.nextSibling}return null}function Sp(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var f=i.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(o===0)return i;o--}else f!=="/$"&&f!=="/&"||o++}i=i.previousSibling}return null}function py(i,o,f){switch(o=$h(f),i){case"html":if(i=o.documentElement,!i)throw Error(S(452));return i;case"head":if(i=o.head,!i)throw Error(S(453));return i;case"body":if(i=o.body,!i)throw Error(S(454));return i;default:throw Error(S(451))}}function Vh(i){for(var o=i.attributes;o.length;)i.removeAttributeNode(o[0]);no(i)}var Xs=new Map,La=new Set;function ql(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var il=We.d;We.d={f:my,r:gy,D:pa,C:Eo,L:Tp,m:ma,X:Np,S:Oc,M:Gm};function my(){var i=il.f(),o=Ih();return i||o}function gy(i){var o=Za(i);o!==null&&o.tag===5&&o.type==="form"?ji(o):il.r(i)}var Ou=typeof document>"u"?null:document;function jp(i,o,f){var v=Ou;if(v&&typeof o=="string"&&o){var C=Hi(o);C='link[rel="'+i+'"][href="'+C+'"]',typeof f=="string"&&(C+='[crossorigin="'+f+'"]'),La.has(C)||(La.add(C),i={rel:i,crossOrigin:f,href:o},v.querySelector(C)===null&&(o=v.createElement("link"),zi(o,"link",i),Pt(o),v.head.appendChild(o)))}}function pa(i){il.D(i),jp("dns-prefetch",i,null)}function Eo(i,o){il.C(i,o),jp("preconnect",i,o)}function Tp(i,o,f){il.L(i,o,f);var v=Ou;if(v&&i&&o){var C='link[rel="preload"][as="'+Hi(o)+'"]';o==="image"&&f&&f.imageSrcSet?(C+='[imagesrcset="'+Hi(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(C+='[imagesizes="'+Hi(f.imageSizes)+'"]')):C+='[href="'+Hi(i)+'"]';var D=C;switch(o){case"style":D=Lu(i);break;case"script":D=Bu(i)}Xs.has(D)||(i=se({rel:"preload",href:o==="image"&&f&&f.imageSrcSet?void 0:i,as:o},f),Xs.set(D,i),v.querySelector(C)!==null||o==="style"&&v.querySelector(Ud(D))||o==="script"&&v.querySelector($d(D))||(o=v.createElement("link"),zi(o,"link",i),Pt(o),v.head.appendChild(o)))}}function ma(i,o){il.m(i,o);var f=Ou;if(f&&i){var v=o&&typeof o.as=="string"?o.as:"script",C='link[rel="modulepreload"][as="'+Hi(v)+'"][href="'+Hi(i)+'"]',D=C;switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=Bu(i)}if(!Xs.has(D)&&(i=se({rel:"modulepreload",href:i},o),Xs.set(D,i),f.querySelector(C)===null)){switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector($d(D)))return}v=f.createElement("link"),zi(v,"link",i),Pt(v),f.head.appendChild(v)}}}function Oc(i,o,f){il.S(i,o,f);var v=Ou;if(v&&i){var C=xe(v).hoistableStyles,D=Lu(i);o=o||"default";var Z=C.get(D);if(!Z){var ce={loading:0,preload:null};if(Z=v.querySelector(Ud(D)))ce.loading=5;else{i=se({rel:"stylesheet",href:i,"data-precedence":o},f),(f=Xs.get(D))&&Cp(i,f);var ze=Z=v.createElement("link");Pt(ze),zi(ze,"link",i),ze._p=new Promise(function(at,bt){ze.onload=at,ze.onerror=bt}),ze.addEventListener("load",function(){ce.loading|=1}),ze.addEventListener("error",function(){ce.loading|=2}),ce.loading|=4,Vd(Z,o,v)}Z={type:"stylesheet",instance:Z,count:1,state:ce},C.set(D,Z)}}}function Np(i,o){il.X(i,o);var f=Ou;if(f&&i){var v=xe(f).hoistableScripts,C=Bu(i),D=v.get(C);D||(D=f.querySelector($d(C)),D||(i=se({src:i,async:!0},o),(o=Xs.get(C))&&Wm(i,o),D=f.createElement("script"),Pt(D),zi(D,"link",i),f.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},v.set(C,D))}}function Gm(i,o){il.M(i,o);var f=Ou;if(f&&i){var v=xe(f).hoistableScripts,C=Bu(i),D=v.get(C);D||(D=f.querySelector($d(C)),D||(i=se({src:i,async:!0,type:"module"},o),(o=Xs.get(C))&&Wm(i,o),D=f.createElement("script"),Pt(D),zi(D,"link",i),f.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},v.set(C,D))}}function Hm(i,o,f,v){var C=(C=Mt.current)?ql(C):null;if(!C)throw Error(S(446));switch(i){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(o=Lu(f.href),f=xe(C).hoistableStyles,v=f.get(o),v||(v={type:"style",instance:null,count:0,state:null},f.set(o,v)),v):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){i=Lu(f.href);var D=xe(C).hoistableStyles,Z=D.get(i);if(Z||(C=C.ownerDocument||C,Z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(i,Z),(D=C.querySelector(Ud(i)))&&!D._p&&(Z.instance=D,Z.state.loading=5),Xs.has(i)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},Xs.set(i,f),D||Ep(C,i,f,Z.state))),o&&v===null)throw Error(S(528,""));return Z}if(o&&v!==null)throw Error(S(529,""));return null;case"script":return o=f.async,f=f.src,typeof f=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Bu(f),f=xe(C).hoistableScripts,v=f.get(o),v||(v={type:"script",instance:null,count:0,state:null},f.set(o,v)),v):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,i))}}function Lu(i){return'href="'+Hi(i)+'"'}function Ud(i){return'link[rel="stylesheet"]['+i+"]"}function Zm(i){return se({},i,{"data-precedence":i.precedence,precedence:null})}function Ep(i,o,f,v){i.querySelector('link[rel="preload"][as="style"]['+o+"]")?v.loading=1:(o=i.createElement("link"),v.preload=o,o.addEventListener("load",function(){return v.loading|=1}),o.addEventListener("error",function(){return v.loading|=2}),zi(o,"link",f),Pt(o),i.head.appendChild(o))}function Bu(i){return'[src="'+Hi(i)+'"]'}function $d(i){return"script[async]"+i}function Fu(i,o,f){if(o.count++,o.instance===null)switch(o.type){case"style":var v=i.querySelector('style[data-href~="'+Hi(f.href)+'"]');if(v)return o.instance=v,Pt(v),v;var C=se({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return v=(i.ownerDocument||i).createElement("style"),Pt(v),zi(v,"style",C),Vd(v,f.precedence,i),o.instance=v;case"stylesheet":C=Lu(f.href);var D=i.querySelector(Ud(C));if(D)return o.state.loading|=4,o.instance=D,Pt(D),D;v=Zm(f),(C=Xs.get(C))&&Cp(v,C),D=(i.ownerDocument||i).createElement("link"),Pt(D);var Z=D;return Z._p=new Promise(function(ce,ze){Z.onload=ce,Z.onerror=ze}),zi(D,"link",v),o.state.loading|=4,Vd(D,f.precedence,i),o.instance=D;case"script":return D=Bu(f.src),(C=i.querySelector($d(D)))?(o.instance=C,Pt(C),C):(v=f,(C=Xs.get(D))&&(v=se({},f),Wm(v,C)),i=i.ownerDocument||i,C=i.createElement("script"),Pt(C),zi(C,"link",v),i.head.appendChild(C),o.instance=C);case"void":return null;default:throw Error(S(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(v=o.instance,o.state.loading|=4,Vd(v,f.precedence,i));return o.instance}function Vd(i,o,f){for(var v=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),C=v.length?v[v.length-1]:null,D=C,Z=0;Z<v.length;Z++){var ce=v[Z];if(ce.dataset.precedence===o)D=ce;else if(D!==C)break}D?D.parentNode.insertBefore(i,D.nextSibling):(o=f.nodeType===9?f.head:f,o.insertBefore(i,o.firstChild))}function Cp(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.title==null&&(i.title=o.title)}function Wm(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.integrity==null&&(i.integrity=o.integrity)}var qh=null;function Gh(i,o,f){if(qh===null){var v=new Map,C=qh=new Map;C.set(f,v)}else C=qh,v=C.get(f),v||(v=new Map,C.set(f,v));if(v.has(i))return v;for(v.set(i,null),f=f.getElementsByTagName(i),C=0;C<f.length;C++){var D=f[C];if(!(D[ds]||D[Hs]||i==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var Z=D.getAttribute(o)||"";Z=i+Z;var ce=v.get(Z);ce?ce.push(D):v.set(Z,[D])}}return v}function Hh(i,o,f){i=i.ownerDocument||i,i.head.insertBefore(f,o==="title"?i.querySelector("head > title"):null)}function Ap(i,o,f){if(f===1||o.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return i=o.disabled,typeof o.precedence=="string"&&i==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function kp(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function Ym(i,o,f,v){if(f.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var C=Lu(v.href),D=o.querySelector(Ud(C));if(D){o=D._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(i.count++,i=Wh.bind(i),o.then(i,i)),f.state.loading|=4,f.instance=D,Pt(D);return}D=o.ownerDocument||o,v=Zm(v),(C=Xs.get(C))&&Cp(v,C),D=D.createElement("link"),Pt(D);var Z=D;Z._p=new Promise(function(ce,ze){Z.onload=ce,Z.onerror=ze}),zi(D,"link",v),f.instance=D}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(f,o),(o=f.state.preload)&&(f.state.loading&3)===0&&(i.count++,f=Wh.bind(i),o.addEventListener("load",f),o.addEventListener("error",f))}}var Zh=0;function yy(i,o){return i.stylesheets&&i.count===0&&Xh(i,i.stylesheets),0<i.count||0<i.imgCount?function(f){var v=setTimeout(function(){if(i.stylesheets&&Xh(i,i.stylesheets),i.unsuspend){var D=i.unsuspend;i.unsuspend=null,D()}},6e4+o);0<i.imgBytes&&Zh===0&&(Zh=62500*Fd());var C=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&Xh(i,i.stylesheets),i.unsuspend)){var D=i.unsuspend;i.unsuspend=null,D()}},(i.imgBytes>Zh?50:800)+o);return i.unsuspend=f,function(){i.unsuspend=null,clearTimeout(v),clearTimeout(C)}}:null}function Wh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Xh(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Yh=null;function Xh(i,o){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Yh=new Map,o.forEach(xy,i),Yh=null,Wh.call(i))}function xy(i,o){if(!(o.state.loading&4)){var f=Yh.get(i);if(f)var v=f.get(null);else{f=new Map,Yh.set(i,f);for(var C=i.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<C.length;D++){var Z=C[D];(Z.nodeName==="LINK"||Z.getAttribute("media")!=="not all")&&(f.set(Z.dataset.precedence,Z),v=Z)}v&&f.set(null,v)}C=o.instance,Z=C.getAttribute("data-precedence"),D=f.get(Z)||v,D===v&&f.set(null,C),f.set(Z,C),this.count++,v=Wh.bind(this),C.addEventListener("load",v),C.addEventListener("error",v),D?D.parentNode.insertBefore(C,D.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(C,i.firstChild)),o.state.loading|=4}}var Kh={$$typeof:Ne,Provider:null,Consumer:null,_currentValue:dt,_currentValue2:dt,_threadCount:0};function _y(i,o,f,v,C,D,Z,ce,ze){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qt(0),this.hiddenUpdates=Qt(null),this.identifierPrefix=v,this.onUncaughtError=C,this.onCaughtError=D,this.onRecoverableError=Z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ze,this.incompleteTransitions=new Map}function vy(i,o,f,v,C,D,Z,ce,ze,at,bt,At){return i=new _y(i,o,f,Z,ze,at,bt,At,ce),o=1,D===!0&&(o|=24),D=Na(3,null,null,o),i.current=D,D.stateNode=i,o=Hn(),o.refCount++,i.pooledCache=o,o.refCount++,D.memoizedState={element:v,isDehydrated:f,cache:o},bd(D),i}function by(i){return i?(i=gs,i):gs}function Mp(i,o,f,v,C,D){C=by(C),v.context===null?v.context=C:v.pendingContext=C,v=Kn(o),v.payload={element:f},D=D===void 0?null:D,D!==null&&(v.callback=D),f=go(i,v,o),f!==null&&(hn(f,i,o),sn(f,i,o))}function Xm(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var f=i.retryLane;i.retryLane=f!==0&&f<o?f:o}}function Km(i,o){Xm(i,o),(i=i.alternate)&&Xm(i,o)}function wy(i){if(i.tag===13||i.tag===31){var o=Qa(i,67108864);o!==null&&hn(o,i,67108864),Km(i,67108864)}}function Jm(i){if(i.tag===13||i.tag===31){var o=dn();o=Rs(o);var f=Qa(i,o);f!==null&&hn(f,i,o),Km(i,o)}}var Lc=!0;function mx(i,o,f,v){var C=Ce.T;Ce.T=null;var D=We.p;try{We.p=2,Jh(i,o,f,v)}finally{We.p=D,Ce.T=C}}function Qm(i,o,f,v){var C=Ce.T;Ce.T=null;var D=We.p;try{We.p=8,Jh(i,o,f,v)}finally{We.p=D,Ce.T=C}}function Jh(i,o,f,v){if(Lc){var C=Pp(v);if(C===null)sl(i,o,v,Gl,f),Ty(i,v);else if(gx(C,i,o,f,v))v.stopPropagation();else if(Ty(i,v),o&4&&-1<jy.indexOf(i)){for(;C!==null;){var D=Za(C);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var Z=Te(D.pendingLanes);if(Z!==0){var ce=D;for(ce.pendingLanes|=2,ce.entangledLanes|=2;Z;){var ze=1<<31-ve(Z);ce.entanglements[1]|=ze,Z&=~ze}To(D),(pr&6)===0&&(Dh=Ms()+500,Cn(0))}}break;case 31:case 13:ce=Qa(D,2),ce!==null&&hn(ce,D,2),Ih(),Km(D,2)}if(D=Pp(v),D===null&&sl(i,o,v,Gl,f),D===C)break;C=D}C!==null&&v.stopPropagation()}else sl(i,o,v,null,f)}}function Pp(i){return i=Wc(i),Dp(i)}var Gl=null;function Dp(i){if(Gl=null,i=ba(i),i!==null){var o=P(i);if(o===null)i=null;else{var f=o.tag;if(f===13){if(i=T(o),i!==null)return i;i=null}else if(f===31){if(i=c(o),i!==null)return i;i=null}else if(f===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Gl=i,null}function Sy(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(oi()){case Fr:return 2;case Oi:return 8;case Gi:case Fs:return 32;case Ls:return 268435456;default:return 32}default:return 32}}var Uu=!1,Hl=null,Zl=null,Wl=null,Qh=new Map,ef=new Map,al=[],jy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ty(i,o){switch(i){case"focusin":case"focusout":Hl=null;break;case"dragenter":case"dragleave":Zl=null;break;case"mouseover":case"mouseout":Wl=null;break;case"pointerover":case"pointerout":Qh.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":ef.delete(o.pointerId)}}function tf(i,o,f,v,C,D){return i===null||i.nativeEvent!==D?(i={blockedOn:o,domEventName:f,eventSystemFlags:v,nativeEvent:D,targetContainers:[C]},o!==null&&(o=Za(o),o!==null&&wy(o)),i):(i.eventSystemFlags|=v,o=i.targetContainers,C!==null&&o.indexOf(C)===-1&&o.push(C),i)}function gx(i,o,f,v,C){switch(o){case"focusin":return Hl=tf(Hl,i,o,f,v,C),!0;case"dragenter":return Zl=tf(Zl,i,o,f,v,C),!0;case"mouseover":return Wl=tf(Wl,i,o,f,v,C),!0;case"pointerover":var D=C.pointerId;return Qh.set(D,tf(Qh.get(D)||null,i,o,f,v,C)),!0;case"gotpointercapture":return D=C.pointerId,ef.set(D,tf(ef.get(D)||null,i,o,f,v,C)),!0}return!1}function Ny(i){var o=ba(i.target);if(o!==null){var f=P(o);if(f!==null){if(o=f.tag,o===13){if(o=T(f),o!==null){i.blockedOn=o,Ks(i.priority,function(){Jm(f)});return}}else if(o===31){if(o=c(f),o!==null){i.blockedOn=o,Ks(i.priority,function(){Jm(f)});return}}else if(o===3&&f.stateNode.current.memoizedState.isDehydrated){i.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Rp(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var f=Pp(i.nativeEvent);if(f===null){f=i.nativeEvent;var v=new f.constructor(f.type,f);Qd=v,f.target.dispatchEvent(v),Qd=null}else return o=Za(f),o!==null&&wy(o),i.blockedOn=f,!1;o.shift()}return!0}function eg(i,o,f){Rp(i)&&f.delete(o)}function yx(){Uu=!1,Hl!==null&&Rp(Hl)&&(Hl=null),Zl!==null&&Rp(Zl)&&(Zl=null),Wl!==null&&Rp(Wl)&&(Wl=null),Qh.forEach(eg),ef.forEach(eg)}function Bc(i,o){i.blockedOn===o&&(i.blockedOn=null,Uu||(Uu=!0,m.unstable_scheduleCallback(m.unstable_NormalPriority,yx)))}var Ip=null;function Ey(i){Ip!==i&&(Ip=i,m.unstable_scheduleCallback(m.unstable_NormalPriority,function(){Ip===i&&(Ip=null);for(var o=0;o<i.length;o+=3){var f=i[o],v=i[o+1],C=i[o+2];if(typeof v!="function"){if(Dp(v||f)===null)continue;break}var D=Za(f);D!==null&&(i.splice(o,3),o-=3,qr(D,{pending:!0,data:C,method:f.method,action:v},v,C))}}))}function qd(i){function o(ze){return Bc(ze,i)}Hl!==null&&Bc(Hl,i),Zl!==null&&Bc(Zl,i),Wl!==null&&Bc(Wl,i),Qh.forEach(o),ef.forEach(o);for(var f=0;f<al.length;f++){var v=al[f];v.blockedOn===i&&(v.blockedOn=null)}for(;0<al.length&&(f=al[0],f.blockedOn===null);)Ny(f),f.blockedOn===null&&al.shift();if(f=(i.ownerDocument||i).$$reactFormReplay,f!=null)for(v=0;v<f.length;v+=3){var C=f[v],D=f[v+1],Z=C[Ct]||null;if(typeof D=="function")Z||Ey(f);else if(Z){var ce=null;if(D&&D.hasAttribute("formAction")){if(C=D,Z=D[Ct]||null)ce=Z.formAction;else if(Dp(C)!==null)continue}else ce=Z.action;typeof ce=="function"?f[v+1]=ce:(f.splice(v,3),v-=3),Ey(f)}}}function zp(){function i(D){D.canIntercept&&D.info==="react-transition"&&D.intercept({handler:function(){return new Promise(function(Z){return C=Z})},focusReset:"manual",scroll:"manual"})}function o(){C!==null&&(C(),C=null),v||setTimeout(f,20)}function f(){if(!v&&!navigation.transition){var D=navigation.currentEntry;D&&D.url!=null&&navigation.navigate(D.url,{state:D.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var v=!1,C=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(f,100),function(){v=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),C!==null&&(C(),C=null)}}}function Op(i){this._internalRoot=i}Lp.prototype.render=Op.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(S(409));var f=o.current,v=dn();Mp(f,v,i,o,null,null)},Lp.prototype.unmount=Op.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Mp(i.current,2,null,i,null,null),Ih(),o[is]=null}};function Lp(i){this._internalRoot=i}Lp.prototype.unstable_scheduleHydration=function(i){if(i){var o=Ps();i={blockedOn:null,target:i,priority:o};for(var f=0;f<al.length&&o!==0&&o<al[f].priority;f++);al.splice(f,0,i),f===0&&Ny(i)}};var Cy=h.version;if(Cy!=="19.2.3")throw Error(S(527,Cy,"19.2.3"));We.findDOMNode=function(i){var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(S(188)):(i=Object.keys(i).join(","),Error(S(268,i)));return i=F(o),i=i!==null?re(i):null,i=i===null?null:i.stateNode,i};var Ay={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Ce,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sf.isDisabled&&sf.supportsFiber)try{K=sf.inject(Ay),U=sf}catch{}}return ag.createRoot=function(i,o){if(!k(i))throw Error(S(299));var f=!1,v="",C=Td,D=bo,Z=wo;return o!=null&&(o.unstable_strictMode===!0&&(f=!0),o.identifierPrefix!==void 0&&(v=o.identifierPrefix),o.onUncaughtError!==void 0&&(C=o.onUncaughtError),o.onCaughtError!==void 0&&(D=o.onCaughtError),o.onRecoverableError!==void 0&&(Z=o.onRecoverableError)),o=vy(i,1,!1,null,null,f,v,null,C,D,Z,zp),i[is]=o.current,zm(i),new Op(o)},ag.hydrateRoot=function(i,o,f){if(!k(i))throw Error(S(299));var v=!1,C="",D=Td,Z=bo,ce=wo,ze=null;return f!=null&&(f.unstable_strictMode===!0&&(v=!0),f.identifierPrefix!==void 0&&(C=f.identifierPrefix),f.onUncaughtError!==void 0&&(D=f.onUncaughtError),f.onCaughtError!==void 0&&(Z=f.onCaughtError),f.onRecoverableError!==void 0&&(ce=f.onRecoverableError),f.formState!==void 0&&(ze=f.formState)),o=vy(i,1,!0,o,f??null,v,C,ze,D,Z,ce,zp),o.context=by(null),f=o.current,v=dn(),v=Rs(v),C=Kn(v),C.callback=null,go(f,C,v),f=v,o.current.lanes=f,ls(o,f),To(o),i[is]=o.current,zm(i),new Lp(o)},ag.version="19.2.3",ag}var U_;function Hv(){if(U_)return kx.exports;U_=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(h){console.error(h)}}return m(),kx.exports=Gv(),kx.exports}var Zv=Hv();var $_="popstate";function Wv(m={}){function h(S,k){let{pathname:P,search:T,hash:c}=S.location;return Hx("",{pathname:P,search:T,hash:c},k.state&&k.state.usr||null,k.state&&k.state.key||"default")}function _(S,k){return typeof k=="string"?k:pg(k)}return Xv(h,_,null,m)}function _i(m,h){if(m===!1||m===null||typeof m>"u")throw new Error(h)}function Uc(m,h){if(!m){typeof console<"u"&&console.warn(h);try{throw new Error(h)}catch{}}}function Yv(){return Math.random().toString(36).substring(2,10)}function V_(m,h){return{usr:m.state,key:m.key,idx:h}}function Hx(m,h,_=null,S){return{pathname:typeof m=="string"?m:m.pathname,search:"",hash:"",...typeof h=="string"?Qp(h):h,state:_,key:h&&h.key||S||Yv()}}function pg({pathname:m="/",search:h="",hash:_=""}){return h&&h!=="?"&&(m+=h.charAt(0)==="?"?h:"?"+h),_&&_!=="#"&&(m+=_.charAt(0)==="#"?_:"#"+_),m}function Qp(m){let h={};if(m){let _=m.indexOf("#");_>=0&&(h.hash=m.substring(_),m=m.substring(0,_));let S=m.indexOf("?");S>=0&&(h.search=m.substring(S),m=m.substring(0,S)),m&&(h.pathname=m)}return h}function Xv(m,h,_,S={}){let{window:k=document.defaultView,v5Compat:P=!1}=S,T=k.history,c="POP",O=null,F=re();F==null&&(F=0,T.replaceState({...T.state,idx:F},""));function re(){return(T.state||{idx:null}).idx}function se(){c="POP";let G=re(),pe=G==null?null:G-F;F=G,O&&O({action:c,location:Y.location,delta:pe})}function ue(G,pe){c="PUSH";let _e=Hx(Y.location,G,pe);F=re()+1;let Ne=V_(_e,F),Oe=Y.createHref(_e);try{T.pushState(Ne,"",Oe)}catch(Be){if(Be instanceof DOMException&&Be.name==="DataCloneError")throw Be;k.location.assign(Oe)}P&&O&&O({action:c,location:Y.location,delta:1})}function ae(G,pe){c="REPLACE";let _e=Hx(Y.location,G,pe);F=re();let Ne=V_(_e,F),Oe=Y.createHref(_e);T.replaceState(Ne,"",Oe),P&&O&&O({action:c,location:Y.location,delta:0})}function Q(G){return Kv(G)}let Y={get action(){return c},get location(){return m(k,T)},listen(G){if(O)throw new Error("A history only accepts one active listener");return k.addEventListener($_,se),O=G,()=>{k.removeEventListener($_,se),O=null}},createHref(G){return h(k,G)},createURL:Q,encodeLocation(G){let pe=Q(G);return{pathname:pe.pathname,search:pe.search,hash:pe.hash}},push:ue,replace:ae,go(G){return T.go(G)}};return Y}function Kv(m,h=!1){let _="http://localhost";typeof window<"u"&&(_=window.location.origin!=="null"?window.location.origin:window.location.href),_i(_,"No window.location.(origin|href) available to create URL");let S=typeof m=="string"?m:pg(m);return S=S.replace(/ $/,"%20"),!h&&S.startsWith("//")&&(S=_+S),new URL(S,_)}function C0(m,h,_="/"){return Jv(m,h,_,!1)}function Jv(m,h,_,S){let k=typeof h=="string"?Qp(h):h,P=Wu(k.pathname||"/",_);if(P==null)return null;let T=A0(m);Qv(T);let c=null;for(let O=0;c==null&&O<T.length;++O){let F=ub(P);c=lb(T[O],F,S)}return c}function A0(m,h=[],_=[],S="",k=!1){let P=(T,c,O=k,F)=>{let re={relativePath:F===void 0?T.path||"":F,caseSensitive:T.caseSensitive===!0,childrenIndex:c,route:T};if(re.relativePath.startsWith("/")){if(!re.relativePath.startsWith(S)&&O)return;_i(re.relativePath.startsWith(S),`Absolute route path "${re.relativePath}" nested under path "${S}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),re.relativePath=re.relativePath.slice(S.length)}let se=Hu([S,re.relativePath]),ue=_.concat(re);T.children&&T.children.length>0&&(_i(T.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${se}".`),A0(T.children,h,ue,se,O)),!(T.path==null&&!T.index)&&h.push({path:se,score:nb(se,T.index),routesMeta:ue})};return m.forEach((T,c)=>{if(T.path===""||!T.path?.includes("?"))P(T,c);else for(let O of k0(T.path))P(T,c,!0,O)}),h}function k0(m){let h=m.split("/");if(h.length===0)return[];let[_,...S]=h,k=_.endsWith("?"),P=_.replace(/\?$/,"");if(S.length===0)return k?[P,""]:[P];let T=k0(S.join("/")),c=[];return c.push(...T.map(O=>O===""?P:[P,O].join("/"))),k&&c.push(...T),c.map(O=>m.startsWith("/")&&O===""?"/":O)}function Qv(m){m.sort((h,_)=>h.score!==_.score?_.score-h.score:ob(h.routesMeta.map(S=>S.childrenIndex),_.routesMeta.map(S=>S.childrenIndex)))}var eb=/^:[\w-]+$/,tb=3,sb=2,rb=1,ib=10,ab=-2,q_=m=>m==="*";function nb(m,h){let _=m.split("/"),S=_.length;return _.some(q_)&&(S+=ab),h&&(S+=sb),_.filter(k=>!q_(k)).reduce((k,P)=>k+(eb.test(P)?tb:P===""?rb:ib),S)}function ob(m,h){return m.length===h.length&&m.slice(0,-1).every((S,k)=>S===h[k])?m[m.length-1]-h[h.length-1]:0}function lb(m,h,_=!1){let{routesMeta:S}=m,k={},P="/",T=[];for(let c=0;c<S.length;++c){let O=S[c],F=c===S.length-1,re=P==="/"?h:h.slice(P.length)||"/",se=Hy({path:O.relativePath,caseSensitive:O.caseSensitive,end:F},re),ue=O.route;if(!se&&F&&_&&!S[S.length-1].route.index&&(se=Hy({path:O.relativePath,caseSensitive:O.caseSensitive,end:!1},re)),!se)return null;Object.assign(k,se.params),T.push({params:k,pathname:Hu([P,se.pathname]),pathnameBase:pb(Hu([P,se.pathnameBase])),route:ue}),se.pathnameBase!=="/"&&(P=Hu([P,se.pathnameBase]))}return T}function Hy(m,h){typeof m=="string"&&(m={path:m,caseSensitive:!1,end:!0});let[_,S]=cb(m.path,m.caseSensitive,m.end),k=h.match(_);if(!k)return null;let P=k[0],T=P.replace(/(.)\/+$/,"$1"),c=k.slice(1);return{params:S.reduce((F,{paramName:re,isOptional:se},ue)=>{if(re==="*"){let Q=c[ue]||"";T=P.slice(0,P.length-Q.length).replace(/(.)\/+$/,"$1")}const ae=c[ue];return se&&!ae?F[re]=void 0:F[re]=(ae||"").replace(/%2F/g,"/"),F},{}),pathname:P,pathnameBase:T,pattern:m}}function cb(m,h=!1,_=!0){Uc(m==="*"||!m.endsWith("*")||m.endsWith("/*"),`Route path "${m}" will be treated as if it were "${m.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${m.replace(/\*$/,"/*")}".`);let S=[],k="^"+m.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(T,c,O)=>(S.push({paramName:c,isOptional:O!=null}),O?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return m.endsWith("*")?(S.push({paramName:"*"}),k+=m==="*"||m==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):_?k+="\\/*$":m!==""&&m!=="/"&&(k+="(?:(?=\\/|$))"),[new RegExp(k,h?void 0:"i"),S]}function ub(m){try{return m.split("/").map(h=>decodeURIComponent(h).replace(/\//g,"%2F")).join("/")}catch(h){return Uc(!1,`The URL path "${m}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${h}).`),m}}function Wu(m,h){if(h==="/")return m;if(!m.toLowerCase().startsWith(h.toLowerCase()))return null;let _=h.endsWith("/")?h.length-1:h.length,S=m.charAt(_);return S&&S!=="/"?null:m.slice(_)||"/"}var db=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function hb(m,h="/"){let{pathname:_,search:S="",hash:k=""}=typeof m=="string"?Qp(m):m,P;return _?(_=_.replace(/\/\/+/g,"/"),_.startsWith("/")?P=G_(_.substring(1),"/"):P=G_(_,h)):P=h,{pathname:P,search:mb(S),hash:gb(k)}}function G_(m,h){let _=h.replace(/\/+$/,"").split("/");return m.split("/").forEach(k=>{k===".."?_.length>1&&_.pop():k!=="."&&_.push(k)}),_.length>1?_.join("/"):"/"}function Rx(m,h,_,S){return`Cannot include a '${m}' character in a manually specified \`to.${h}\` field [${JSON.stringify(S)}].  Please separate it out to the \`to.${_}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function fb(m){return m.filter((h,_)=>_===0||h.route.path&&h.route.path.length>0)}function M0(m){let h=fb(m);return h.map((_,S)=>S===h.length-1?_.pathname:_.pathnameBase)}function P0(m,h,_,S=!1){let k;typeof m=="string"?k=Qp(m):(k={...m},_i(!k.pathname||!k.pathname.includes("?"),Rx("?","pathname","search",k)),_i(!k.pathname||!k.pathname.includes("#"),Rx("#","pathname","hash",k)),_i(!k.search||!k.search.includes("#"),Rx("#","search","hash",k)));let P=m===""||k.pathname==="",T=P?"/":k.pathname,c;if(T==null)c=_;else{let se=h.length-1;if(!S&&T.startsWith("..")){let ue=T.split("/");for(;ue[0]==="..";)ue.shift(),se-=1;k.pathname=ue.join("/")}c=se>=0?h[se]:"/"}let O=hb(k,c),F=T&&T!=="/"&&T.endsWith("/"),re=(P||T===".")&&_.endsWith("/");return!O.pathname.endsWith("/")&&(F||re)&&(O.pathname+="/"),O}var Hu=m=>m.join("/").replace(/\/\/+/g,"/"),pb=m=>m.replace(/\/+$/,"").replace(/^\/*/,"/"),mb=m=>!m||m==="?"?"":m.startsWith("?")?m:"?"+m,gb=m=>!m||m==="#"?"":m.startsWith("#")?m:"#"+m,yb=class{constructor(m,h,_,S=!1){this.status=m,this.statusText=h||"",this.internal=S,_ instanceof Error?(this.data=_.toString(),this.error=_):this.data=_}};function xb(m){return m!=null&&typeof m.status=="number"&&typeof m.statusText=="string"&&typeof m.internal=="boolean"&&"data"in m}function _b(m){return m.map(h=>h.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var D0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function R0(m,h){let _=m;if(typeof _!="string"||!db.test(_))return{absoluteURL:void 0,isExternal:!1,to:_};let S=_,k=!1;if(D0)try{let P=new URL(window.location.href),T=_.startsWith("//")?new URL(P.protocol+_):new URL(_),c=Wu(T.pathname,h);T.origin===P.origin&&c!=null?_=c+T.search+T.hash:k=!0}catch{Uc(!1,`<Link to="${_}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:S,isExternal:k,to:_}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var I0=["POST","PUT","PATCH","DELETE"];new Set(I0);var vb=["GET",...I0];new Set(vb);var em=ee.createContext(null);em.displayName="DataRouter";var ex=ee.createContext(null);ex.displayName="DataRouterState";var bb=ee.createContext(!1),z0=ee.createContext({isTransitioning:!1});z0.displayName="ViewTransition";var wb=ee.createContext(new Map);wb.displayName="Fetchers";var Sb=ee.createContext(null);Sb.displayName="Await";var ll=ee.createContext(null);ll.displayName="Navigation";var Sg=ee.createContext(null);Sg.displayName="Location";var qc=ee.createContext({outlet:null,matches:[],isDataRoute:!1});qc.displayName="Route";var c_=ee.createContext(null);c_.displayName="RouteError";var O0="REACT_ROUTER_ERROR",jb="REDIRECT",Tb="ROUTE_ERROR_RESPONSE";function Nb(m){if(m.startsWith(`${O0}:${jb}:{`))try{let h=JSON.parse(m.slice(28));if(typeof h=="object"&&h&&typeof h.status=="number"&&typeof h.statusText=="string"&&typeof h.location=="string"&&typeof h.reloadDocument=="boolean"&&typeof h.replace=="boolean")return h}catch{}}function Eb(m){if(m.startsWith(`${O0}:${Tb}:{`))try{let h=JSON.parse(m.slice(40));if(typeof h=="object"&&h&&typeof h.status=="number"&&typeof h.statusText=="string")return new yb(h.status,h.statusText,h.data)}catch{}}function Cb(m,{relative:h}={}){_i(jg(),"useHref() may be used only in the context of a <Router> component.");let{basename:_,navigator:S}=ee.useContext(ll),{hash:k,pathname:P,search:T}=Tg(m,{relative:h}),c=P;return _!=="/"&&(c=P==="/"?_:Hu([_,P])),S.createHref({pathname:c,search:T,hash:k})}function jg(){return ee.useContext(Sg)!=null}function sc(){return _i(jg(),"useLocation() may be used only in the context of a <Router> component."),ee.useContext(Sg).location}var L0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function B0(m){ee.useContext(ll).static||ee.useLayoutEffect(m)}function yf(){let{isDataRoute:m}=ee.useContext(qc);return m?$b():Ab()}function Ab(){_i(jg(),"useNavigate() may be used only in the context of a <Router> component.");let m=ee.useContext(em),{basename:h,navigator:_}=ee.useContext(ll),{matches:S}=ee.useContext(qc),{pathname:k}=sc(),P=JSON.stringify(M0(S)),T=ee.useRef(!1);return B0(()=>{T.current=!0}),ee.useCallback((O,F={})=>{if(Uc(T.current,L0),!T.current)return;if(typeof O=="number"){_.go(O);return}let re=P0(O,JSON.parse(P),k,F.relative==="path");m==null&&h!=="/"&&(re.pathname=re.pathname==="/"?h:Hu([h,re.pathname])),(F.replace?_.replace:_.push)(re,F.state,F)},[h,_,P,k,m])}ee.createContext(null);function kb(){let{matches:m}=ee.useContext(qc),h=m[m.length-1];return h?h.params:{}}function Tg(m,{relative:h}={}){let{matches:_}=ee.useContext(qc),{pathname:S}=sc(),k=JSON.stringify(M0(_));return ee.useMemo(()=>P0(m,JSON.parse(k),S,h==="path"),[m,k,S,h])}function Mb(m,h){return F0(m,h)}function F0(m,h,_,S,k){_i(jg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:P}=ee.useContext(ll),{matches:T}=ee.useContext(qc),c=T[T.length-1],O=c?c.params:{},F=c?c.pathname:"/",re=c?c.pathnameBase:"/",se=c&&c.route;{let _e=se&&se.path||"";$0(F,!se||_e.endsWith("*")||_e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${F}" (under <Route path="${_e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_e}"> to <Route path="${_e==="/"?"*":`${_e}/*`}">.`)}let ue=sc(),ae;if(h){let _e=typeof h=="string"?Qp(h):h;_i(re==="/"||_e.pathname?.startsWith(re),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${re}" but pathname "${_e.pathname}" was given in the \`location\` prop.`),ae=_e}else ae=ue;let Q=ae.pathname||"/",Y=Q;if(re!=="/"){let _e=re.replace(/^\//,"").split("/");Y="/"+Q.replace(/^\//,"").split("/").slice(_e.length).join("/")}let G=C0(m,{pathname:Y});Uc(se||G!=null,`No routes matched location "${ae.pathname}${ae.search}${ae.hash}" `),Uc(G==null||G[G.length-1].route.element!==void 0||G[G.length-1].route.Component!==void 0||G[G.length-1].route.lazy!==void 0,`Matched leaf route at location "${ae.pathname}${ae.search}${ae.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let pe=zb(G&&G.map(_e=>Object.assign({},_e,{params:Object.assign({},O,_e.params),pathname:Hu([re,P.encodeLocation?P.encodeLocation(_e.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_e.pathname]),pathnameBase:_e.pathnameBase==="/"?re:Hu([re,P.encodeLocation?P.encodeLocation(_e.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_e.pathnameBase])})),T,_,S,k);return h&&pe?ee.createElement(Sg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ae},navigationType:"POP"}},pe):pe}function Pb(){let m=Ub(),h=xb(m)?`${m.status} ${m.statusText}`:m instanceof Error?m.message:JSON.stringify(m),_=m instanceof Error?m.stack:null,S="rgba(200,200,200, 0.5)",k={padding:"0.5rem",backgroundColor:S},P={padding:"2px 4px",backgroundColor:S},T=null;return console.error("Error handled by React Router default ErrorBoundary:",m),T=ee.createElement(ee.Fragment,null,ee.createElement("p",null," Hey developer "),ee.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ee.createElement("code",{style:P},"ErrorBoundary")," or"," ",ee.createElement("code",{style:P},"errorElement")," prop on your route.")),ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},h),_?ee.createElement("pre",{style:k},_):null,T)}var Db=ee.createElement(Pb,null),U0=class extends ee.Component{constructor(m){super(m),this.state={location:m.location,revalidation:m.revalidation,error:m.error}}static getDerivedStateFromError(m){return{error:m}}static getDerivedStateFromProps(m,h){return h.location!==m.location||h.revalidation!=="idle"&&m.revalidation==="idle"?{error:m.error,location:m.location,revalidation:m.revalidation}:{error:m.error!==void 0?m.error:h.error,location:h.location,revalidation:m.revalidation||h.revalidation}}componentDidCatch(m,h){this.props.onError?this.props.onError(m,h):console.error("React Router caught the following error during render",m)}render(){let m=this.state.error;if(this.context&&typeof m=="object"&&m&&"digest"in m&&typeof m.digest=="string"){const _=Eb(m.digest);_&&(m=_)}let h=m!==void 0?ee.createElement(qc.Provider,{value:this.props.routeContext},ee.createElement(c_.Provider,{value:m,children:this.props.component})):this.props.children;return this.context?ee.createElement(Rb,{error:m},h):h}};U0.contextType=bb;var Ix=new WeakMap;function Rb({children:m,error:h}){let{basename:_}=ee.useContext(ll);if(typeof h=="object"&&h&&"digest"in h&&typeof h.digest=="string"){let S=Nb(h.digest);if(S){let k=Ix.get(h);if(k)throw k;let P=R0(S.location,_);if(D0&&!Ix.get(h))if(P.isExternal||S.reloadDocument)window.location.href=P.absoluteURL||P.to;else{const T=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(P.to,{replace:S.replace}));throw Ix.set(h,T),T}return ee.createElement("meta",{httpEquiv:"refresh",content:`0;url=${P.absoluteURL||P.to}`})}}return m}function Ib({routeContext:m,match:h,children:_}){let S=ee.useContext(em);return S&&S.static&&S.staticContext&&(h.route.errorElement||h.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=h.route.id),ee.createElement(qc.Provider,{value:m},_)}function zb(m,h=[],_=null,S=null,k=null){if(m==null){if(!_)return null;if(_.errors)m=_.matches;else if(h.length===0&&!_.initialized&&_.matches.length>0)m=_.matches;else return null}let P=m,T=_?.errors;if(T!=null){let re=P.findIndex(se=>se.route.id&&T?.[se.route.id]!==void 0);_i(re>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(T).join(",")}`),P=P.slice(0,Math.min(P.length,re+1))}let c=!1,O=-1;if(_)for(let re=0;re<P.length;re++){let se=P[re];if((se.route.HydrateFallback||se.route.hydrateFallbackElement)&&(O=re),se.route.id){let{loaderData:ue,errors:ae}=_,Q=se.route.loader&&!ue.hasOwnProperty(se.route.id)&&(!ae||ae[se.route.id]===void 0);if(se.route.lazy||Q){c=!0,O>=0?P=P.slice(0,O+1):P=[P[0]];break}}}let F=_&&S?(re,se)=>{S(re,{location:_.location,params:_.matches?.[0]?.params??{},unstable_pattern:_b(_.matches),errorInfo:se})}:void 0;return P.reduceRight((re,se,ue)=>{let ae,Q=!1,Y=null,G=null;_&&(ae=T&&se.route.id?T[se.route.id]:void 0,Y=se.route.errorElement||Db,c&&(O<0&&ue===0?($0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Q=!0,G=null):O===ue&&(Q=!0,G=se.route.hydrateFallbackElement||null)));let pe=h.concat(P.slice(0,ue+1)),_e=()=>{let Ne;return ae?Ne=Y:Q?Ne=G:se.route.Component?Ne=ee.createElement(se.route.Component,null):se.route.element?Ne=se.route.element:Ne=re,ee.createElement(Ib,{match:se,routeContext:{outlet:re,matches:pe,isDataRoute:_!=null},children:Ne})};return _&&(se.route.ErrorBoundary||se.route.errorElement||ue===0)?ee.createElement(U0,{location:_.location,revalidation:_.revalidation,component:Y,error:ae,children:_e(),routeContext:{outlet:null,matches:pe,isDataRoute:!0},onError:F}):_e()},null)}function u_(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ob(m){let h=ee.useContext(em);return _i(h,u_(m)),h}function Lb(m){let h=ee.useContext(ex);return _i(h,u_(m)),h}function Bb(m){let h=ee.useContext(qc);return _i(h,u_(m)),h}function d_(m){let h=Bb(m),_=h.matches[h.matches.length-1];return _i(_.route.id,`${m} can only be used on routes that contain a unique "id"`),_.route.id}function Fb(){return d_("useRouteId")}function Ub(){let m=ee.useContext(c_),h=Lb("useRouteError"),_=d_("useRouteError");return m!==void 0?m:h.errors?.[_]}function $b(){let{router:m}=Ob("useNavigate"),h=d_("useNavigate"),_=ee.useRef(!1);return B0(()=>{_.current=!0}),ee.useCallback(async(k,P={})=>{Uc(_.current,L0),_.current&&(typeof k=="number"?await m.navigate(k):await m.navigate(k,{fromRouteId:h,...P}))},[m,h])}var H_={};function $0(m,h,_){!h&&!H_[m]&&(H_[m]=!0,Uc(!1,_))}ee.memo(Vb);function Vb({routes:m,future:h,state:_,onError:S}){return F0(m,void 0,_,S,h)}function Br(m){_i(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function qb({basename:m="/",children:h=null,location:_,navigationType:S="POP",navigator:k,static:P=!1,unstable_useTransitions:T}){_i(!jg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=m.replace(/^\/*/,"/"),O=ee.useMemo(()=>({basename:c,navigator:k,static:P,unstable_useTransitions:T,future:{}}),[c,k,P,T]);typeof _=="string"&&(_=Qp(_));let{pathname:F="/",search:re="",hash:se="",state:ue=null,key:ae="default"}=_,Q=ee.useMemo(()=>{let Y=Wu(F,c);return Y==null?null:{location:{pathname:Y,search:re,hash:se,state:ue,key:ae},navigationType:S}},[c,F,re,se,ue,ae,S]);return Uc(Q!=null,`<Router basename="${c}"> is not able to match the URL "${F}${re}${se}" because it does not start with the basename, so the <Router> won't render anything.`),Q==null?null:ee.createElement(ll.Provider,{value:O},ee.createElement(Sg.Provider,{children:h,value:Q}))}function h_({children:m,location:h}){return Mb(Zx(m),h)}function Zx(m,h=[]){let _=[];return ee.Children.forEach(m,(S,k)=>{if(!ee.isValidElement(S))return;let P=[...h,k];if(S.type===ee.Fragment){_.push.apply(_,Zx(S.props.children,P));return}_i(S.type===Br,`[${typeof S.type=="string"?S.type:S.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),_i(!S.props.index||!S.props.children,"An index route cannot have child routes.");let T={id:S.props.id||P.join("-"),caseSensitive:S.props.caseSensitive,element:S.props.element,Component:S.props.Component,index:S.props.index,path:S.props.path,middleware:S.props.middleware,loader:S.props.loader,action:S.props.action,hydrateFallbackElement:S.props.hydrateFallbackElement,HydrateFallback:S.props.HydrateFallback,errorElement:S.props.errorElement,ErrorBoundary:S.props.ErrorBoundary,hasErrorBoundary:S.props.hasErrorBoundary===!0||S.props.ErrorBoundary!=null||S.props.errorElement!=null,shouldRevalidate:S.props.shouldRevalidate,handle:S.props.handle,lazy:S.props.lazy};S.props.children&&(T.children=Zx(S.props.children,P)),_.push(T)}),_}var $y="get",Vy="application/x-www-form-urlencoded";function tx(m){return typeof HTMLElement<"u"&&m instanceof HTMLElement}function Gb(m){return tx(m)&&m.tagName.toLowerCase()==="button"}function Hb(m){return tx(m)&&m.tagName.toLowerCase()==="form"}function Zb(m){return tx(m)&&m.tagName.toLowerCase()==="input"}function Wb(m){return!!(m.metaKey||m.altKey||m.ctrlKey||m.shiftKey)}function Yb(m,h){return m.button===0&&(!h||h==="_self")&&!Wb(m)}var Dy=null;function Xb(){if(Dy===null)try{new FormData(document.createElement("form"),0),Dy=!1}catch{Dy=!0}return Dy}var Kb=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function zx(m){return m!=null&&!Kb.has(m)?(Uc(!1,`"${m}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Vy}"`),null):m}function Jb(m,h){let _,S,k,P,T;if(Hb(m)){let c=m.getAttribute("action");S=c?Wu(c,h):null,_=m.getAttribute("method")||$y,k=zx(m.getAttribute("enctype"))||Vy,P=new FormData(m)}else if(Gb(m)||Zb(m)&&(m.type==="submit"||m.type==="image")){let c=m.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let O=m.getAttribute("formaction")||c.getAttribute("action");if(S=O?Wu(O,h):null,_=m.getAttribute("formmethod")||c.getAttribute("method")||$y,k=zx(m.getAttribute("formenctype"))||zx(c.getAttribute("enctype"))||Vy,P=new FormData(c,m),!Xb()){let{name:F,type:re,value:se}=m;if(re==="image"){let ue=F?`${F}.`:"";P.append(`${ue}x`,"0"),P.append(`${ue}y`,"0")}else F&&P.append(F,se)}}else{if(tx(m))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');_=$y,S=null,k=Vy,T=m}return P&&k==="text/plain"&&(T=P,P=void 0),{action:S,method:_.toLowerCase(),encType:k,formData:P,body:T}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function f_(m,h){if(m===!1||m===null||typeof m>"u")throw new Error(h)}function Qb(m,h,_,S){let k=typeof m=="string"?new URL(m,typeof window>"u"?"server://singlefetch/":window.location.origin):m;return _?k.pathname.endsWith("/")?k.pathname=`${k.pathname}_.${S}`:k.pathname=`${k.pathname}.${S}`:k.pathname==="/"?k.pathname=`_root.${S}`:h&&Wu(k.pathname,h)==="/"?k.pathname=`${h.replace(/\/$/,"")}/_root.${S}`:k.pathname=`${k.pathname.replace(/\/$/,"")}.${S}`,k}async function e1(m,h){if(m.id in h)return h[m.id];try{let _=await import(m.module);return h[m.id]=_,_}catch(_){return console.error(`Error loading route module \`${m.module}\`, reloading page...`),console.error(_),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function t1(m){return m==null?!1:m.href==null?m.rel==="preload"&&typeof m.imageSrcSet=="string"&&typeof m.imageSizes=="string":typeof m.rel=="string"&&typeof m.href=="string"}async function s1(m,h,_){let S=await Promise.all(m.map(async k=>{let P=h.routes[k.route.id];if(P){let T=await e1(P,_);return T.links?T.links():[]}return[]}));return n1(S.flat(1).filter(t1).filter(k=>k.rel==="stylesheet"||k.rel==="preload").map(k=>k.rel==="stylesheet"?{...k,rel:"prefetch",as:"style"}:{...k,rel:"prefetch"}))}function Z_(m,h,_,S,k,P){let T=(O,F)=>_[F]?O.route.id!==_[F].route.id:!0,c=(O,F)=>_[F].pathname!==O.pathname||_[F].route.path?.endsWith("*")&&_[F].params["*"]!==O.params["*"];return P==="assets"?h.filter((O,F)=>T(O,F)||c(O,F)):P==="data"?h.filter((O,F)=>{let re=S.routes[O.route.id];if(!re||!re.hasLoader)return!1;if(T(O,F)||c(O,F))return!0;if(O.route.shouldRevalidate){let se=O.route.shouldRevalidate({currentUrl:new URL(k.pathname+k.search+k.hash,window.origin),currentParams:_[0]?.params||{},nextUrl:new URL(m,window.origin),nextParams:O.params,defaultShouldRevalidate:!0});if(typeof se=="boolean")return se}return!0}):[]}function r1(m,h,{includeHydrateFallback:_}={}){return i1(m.map(S=>{let k=h.routes[S.route.id];if(!k)return[];let P=[k.module];return k.clientActionModule&&(P=P.concat(k.clientActionModule)),k.clientLoaderModule&&(P=P.concat(k.clientLoaderModule)),_&&k.hydrateFallbackModule&&(P=P.concat(k.hydrateFallbackModule)),k.imports&&(P=P.concat(k.imports)),P}).flat(1))}function i1(m){return[...new Set(m)]}function a1(m){let h={},_=Object.keys(m).sort();for(let S of _)h[S]=m[S];return h}function n1(m,h){let _=new Set;return new Set(h),m.reduce((S,k)=>{let P=JSON.stringify(a1(k));return _.has(P)||(_.add(P),S.push({key:P,link:k})),S},[])}function V0(){let m=ee.useContext(em);return f_(m,"You must render this element inside a <DataRouterContext.Provider> element"),m}function o1(){let m=ee.useContext(ex);return f_(m,"You must render this element inside a <DataRouterStateContext.Provider> element"),m}var p_=ee.createContext(void 0);p_.displayName="FrameworkContext";function q0(){let m=ee.useContext(p_);return f_(m,"You must render this element inside a <HydratedRouter> element"),m}function l1(m,h){let _=ee.useContext(p_),[S,k]=ee.useState(!1),[P,T]=ee.useState(!1),{onFocus:c,onBlur:O,onMouseEnter:F,onMouseLeave:re,onTouchStart:se}=h,ue=ee.useRef(null);ee.useEffect(()=>{if(m==="render"&&T(!0),m==="viewport"){let Y=pe=>{pe.forEach(_e=>{T(_e.isIntersecting)})},G=new IntersectionObserver(Y,{threshold:.5});return ue.current&&G.observe(ue.current),()=>{G.disconnect()}}},[m]),ee.useEffect(()=>{if(S){let Y=setTimeout(()=>{T(!0)},100);return()=>{clearTimeout(Y)}}},[S]);let ae=()=>{k(!0)},Q=()=>{k(!1),T(!1)};return _?m!=="intent"?[P,ue,{}]:[P,ue,{onFocus:ng(c,ae),onBlur:ng(O,Q),onMouseEnter:ng(F,ae),onMouseLeave:ng(re,Q),onTouchStart:ng(se,ae)}]:[!1,ue,{}]}function ng(m,h){return _=>{m&&m(_),_.defaultPrevented||h(_)}}function c1({page:m,...h}){let{router:_}=V0(),S=ee.useMemo(()=>C0(_.routes,m,_.basename),[_.routes,m,_.basename]);return S?ee.createElement(d1,{page:m,matches:S,...h}):null}function u1(m){let{manifest:h,routeModules:_}=q0(),[S,k]=ee.useState([]);return ee.useEffect(()=>{let P=!1;return s1(m,h,_).then(T=>{P||k(T)}),()=>{P=!0}},[m,h,_]),S}function d1({page:m,matches:h,..._}){let S=sc(),{future:k,manifest:P,routeModules:T}=q0(),{basename:c}=V0(),{loaderData:O,matches:F}=o1(),re=ee.useMemo(()=>Z_(m,h,F,P,S,"data"),[m,h,F,P,S]),se=ee.useMemo(()=>Z_(m,h,F,P,S,"assets"),[m,h,F,P,S]),ue=ee.useMemo(()=>{if(m===S.pathname+S.search+S.hash)return[];let Y=new Set,G=!1;if(h.forEach(_e=>{let Ne=P.routes[_e.route.id];!Ne||!Ne.hasLoader||(!re.some(Oe=>Oe.route.id===_e.route.id)&&_e.route.id in O&&T[_e.route.id]?.shouldRevalidate||Ne.hasClientLoader?G=!0:Y.add(_e.route.id))}),Y.size===0)return[];let pe=Qb(m,c,k.unstable_trailingSlashAwareDataRequests,"data");return G&&Y.size>0&&pe.searchParams.set("_routes",h.filter(_e=>Y.has(_e.route.id)).map(_e=>_e.route.id).join(",")),[pe.pathname+pe.search]},[c,k.unstable_trailingSlashAwareDataRequests,O,S,P,re,h,m,T]),ae=ee.useMemo(()=>r1(se,P),[se,P]),Q=u1(se);return ee.createElement(ee.Fragment,null,ue.map(Y=>ee.createElement("link",{key:Y,rel:"prefetch",as:"fetch",href:Y,..._})),ae.map(Y=>ee.createElement("link",{key:Y,rel:"modulepreload",href:Y,..._})),Q.map(({key:Y,link:G})=>ee.createElement("link",{key:Y,nonce:_.nonce,...G,crossOrigin:G.crossOrigin??_.crossOrigin})))}function h1(...m){return h=>{m.forEach(_=>{typeof _=="function"?_(h):_!=null&&(_.current=h)})}}var f1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{f1&&(window.__reactRouterVersion="7.13.0")}catch{}function p1({basename:m,children:h,unstable_useTransitions:_,window:S}){let k=ee.useRef();k.current==null&&(k.current=Wv({window:S,v5Compat:!0}));let P=k.current,[T,c]=ee.useState({action:P.action,location:P.location}),O=ee.useCallback(F=>{_===!1?c(F):ee.startTransition(()=>c(F))},[_]);return ee.useLayoutEffect(()=>P.listen(O),[P,O]),ee.createElement(qb,{basename:m,children:h,location:T.location,navigationType:T.action,navigator:P,unstable_useTransitions:_})}var G0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wr=ee.forwardRef(function({onClick:h,discover:_="render",prefetch:S="none",relative:k,reloadDocument:P,replace:T,state:c,target:O,to:F,preventScrollReset:re,viewTransition:se,unstable_defaultShouldRevalidate:ue,...ae},Q){let{basename:Y,unstable_useTransitions:G}=ee.useContext(ll),pe=typeof F=="string"&&G0.test(F),_e=R0(F,Y);F=_e.to;let Ne=Cb(F,{relative:k}),[Oe,Be,xt]=l1(S,ae),$e=x1(F,{replace:T,state:c,target:O,preventScrollReset:re,relative:k,viewTransition:se,unstable_defaultShouldRevalidate:ue,unstable_useTransitions:G});function de(Ye){h&&h(Ye),Ye.defaultPrevented||$e(Ye)}let Ae=ee.createElement("a",{...ae,...xt,href:_e.absoluteURL||Ne,onClick:_e.isExternal||P?h:de,ref:h1(Q,Be),target:O,"data-discover":!pe&&_==="render"?"true":void 0});return Oe&&!pe?ee.createElement(ee.Fragment,null,Ae,ee.createElement(c1,{page:Ne})):Ae});wr.displayName="Link";var m1=ee.forwardRef(function({"aria-current":h="page",caseSensitive:_=!1,className:S="",end:k=!1,style:P,to:T,viewTransition:c,children:O,...F},re){let se=Tg(T,{relative:F.relative}),ue=sc(),ae=ee.useContext(ex),{navigator:Q,basename:Y}=ee.useContext(ll),G=ae!=null&&S1(se)&&c===!0,pe=Q.encodeLocation?Q.encodeLocation(se).pathname:se.pathname,_e=ue.pathname,Ne=ae&&ae.navigation&&ae.navigation.location?ae.navigation.location.pathname:null;_||(_e=_e.toLowerCase(),Ne=Ne?Ne.toLowerCase():null,pe=pe.toLowerCase()),Ne&&Y&&(Ne=Wu(Ne,Y)||Ne);const Oe=pe!=="/"&&pe.endsWith("/")?pe.length-1:pe.length;let Be=_e===pe||!k&&_e.startsWith(pe)&&_e.charAt(Oe)==="/",xt=Ne!=null&&(Ne===pe||!k&&Ne.startsWith(pe)&&Ne.charAt(pe.length)==="/"),$e={isActive:Be,isPending:xt,isTransitioning:G},de=Be?h:void 0,Ae;typeof S=="function"?Ae=S($e):Ae=[S,Be?"active":null,xt?"pending":null,G?"transitioning":null].filter(Boolean).join(" ");let Ye=typeof P=="function"?P($e):P;return ee.createElement(wr,{...F,"aria-current":de,className:Ae,ref:re,style:Ye,to:T,viewTransition:c},typeof O=="function"?O($e):O)});m1.displayName="NavLink";var g1=ee.forwardRef(({discover:m="render",fetcherKey:h,navigate:_,reloadDocument:S,replace:k,state:P,method:T=$y,action:c,onSubmit:O,relative:F,preventScrollReset:re,viewTransition:se,unstable_defaultShouldRevalidate:ue,...ae},Q)=>{let{unstable_useTransitions:Y}=ee.useContext(ll),G=b1(),pe=w1(c,{relative:F}),_e=T.toLowerCase()==="get"?"get":"post",Ne=typeof c=="string"&&G0.test(c),Oe=Be=>{if(O&&O(Be),Be.defaultPrevented)return;Be.preventDefault();let xt=Be.nativeEvent.submitter,$e=xt?.getAttribute("formmethod")||T,de=()=>G(xt||Be.currentTarget,{fetcherKey:h,method:$e,navigate:_,replace:k,state:P,relative:F,preventScrollReset:re,viewTransition:se,unstable_defaultShouldRevalidate:ue});Y&&_!==!1?ee.startTransition(()=>de()):de()};return ee.createElement("form",{ref:Q,method:_e,action:pe,onSubmit:S?O:Oe,...ae,"data-discover":!Ne&&m==="render"?"true":void 0})});g1.displayName="Form";function y1(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function H0(m){let h=ee.useContext(em);return _i(h,y1(m)),h}function x1(m,{target:h,replace:_,state:S,preventScrollReset:k,relative:P,viewTransition:T,unstable_defaultShouldRevalidate:c,unstable_useTransitions:O}={}){let F=yf(),re=sc(),se=Tg(m,{relative:P});return ee.useCallback(ue=>{if(Yb(ue,h)){ue.preventDefault();let ae=_!==void 0?_:pg(re)===pg(se),Q=()=>F(m,{replace:ae,state:S,preventScrollReset:k,relative:P,viewTransition:T,unstable_defaultShouldRevalidate:c});O?ee.startTransition(()=>Q()):Q()}},[re,F,se,_,S,h,m,k,P,T,c,O])}var _1=0,v1=()=>`__${String(++_1)}__`;function b1(){let{router:m}=H0("useSubmit"),{basename:h}=ee.useContext(ll),_=Fb(),S=m.fetch,k=m.navigate;return ee.useCallback(async(P,T={})=>{let{action:c,method:O,encType:F,formData:re,body:se}=Jb(P,h);if(T.navigate===!1){let ue=T.fetcherKey||v1();await S(ue,_,T.action||c,{unstable_defaultShouldRevalidate:T.unstable_defaultShouldRevalidate,preventScrollReset:T.preventScrollReset,formData:re,body:se,formMethod:T.method||O,formEncType:T.encType||F,flushSync:T.flushSync})}else await k(T.action||c,{unstable_defaultShouldRevalidate:T.unstable_defaultShouldRevalidate,preventScrollReset:T.preventScrollReset,formData:re,body:se,formMethod:T.method||O,formEncType:T.encType||F,replace:T.replace,state:T.state,fromRouteId:_,flushSync:T.flushSync,viewTransition:T.viewTransition})},[S,k,h,_])}function w1(m,{relative:h}={}){let{basename:_}=ee.useContext(ll),S=ee.useContext(qc);_i(S,"useFormAction must be used inside a RouteContext");let[k]=S.matches.slice(-1),P={...Tg(m||".",{relative:h})},T=sc();if(m==null){P.search=T.search;let c=new URLSearchParams(P.search),O=c.getAll("index");if(O.some(re=>re==="")){c.delete("index"),O.filter(se=>se).forEach(se=>c.append("index",se));let re=c.toString();P.search=re?`?${re}`:""}}return(!m||m===".")&&k.route.index&&(P.search=P.search?P.search.replace(/^\?/,"?index&"):"?index"),_!=="/"&&(P.pathname=P.pathname==="/"?_:Hu([_,P.pathname])),pg(P)}function S1(m,{relative:h}={}){let _=ee.useContext(z0);_i(_!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:S}=H0("useViewTransitionState"),k=Tg(m,{relative:h});if(!_.isTransitioning)return!1;let P=Wu(_.currentLocation.pathname,S)||_.currentLocation.pathname,T=Wu(_.nextLocation.pathname,S)||_.nextLocation.pathname;return Hy(k.pathname,T)!=null||Hy(k.pathname,P)!=null}function sx(m,h){var _={};for(var S in m)Object.prototype.hasOwnProperty.call(m,S)&&h.indexOf(S)<0&&(_[S]=m[S]);if(m!=null&&typeof Object.getOwnPropertySymbols=="function")for(var k=0,S=Object.getOwnPropertySymbols(m);k<S.length;k++)h.indexOf(S[k])<0&&Object.prototype.propertyIsEnumerable.call(m,S[k])&&(_[S[k]]=m[S[k]]);return _}function j1(m,h,_,S){function k(P){return P instanceof _?P:new _(function(T){T(P)})}return new(_||(_=Promise))(function(P,T){function c(re){try{F(S.next(re))}catch(se){T(se)}}function O(re){try{F(S.throw(re))}catch(se){T(se)}}function F(re){re.done?P(re.value):k(re.value).then(c,O)}F((S=S.apply(m,h||[])).next())})}const T1=m=>m?(...h)=>m(...h):(...h)=>fetch(...h);class m_ extends Error{constructor(h,_="FunctionsError",S){super(h),this.name=_,this.context=S}}class N1 extends m_{constructor(h){super("Failed to send a request to the Edge Function","FunctionsFetchError",h)}}class W_ extends m_{constructor(h){super("Relay Error invoking the Edge Function","FunctionsRelayError",h)}}class Y_ extends m_{constructor(h){super("Edge Function returned a non-2xx status code","FunctionsHttpError",h)}}var Wx;(function(m){m.Any="any",m.ApNortheast1="ap-northeast-1",m.ApNortheast2="ap-northeast-2",m.ApSouth1="ap-south-1",m.ApSoutheast1="ap-southeast-1",m.ApSoutheast2="ap-southeast-2",m.CaCentral1="ca-central-1",m.EuCentral1="eu-central-1",m.EuWest1="eu-west-1",m.EuWest2="eu-west-2",m.EuWest3="eu-west-3",m.SaEast1="sa-east-1",m.UsEast1="us-east-1",m.UsWest1="us-west-1",m.UsWest2="us-west-2"})(Wx||(Wx={}));class E1{constructor(h,{headers:_={},customFetch:S,region:k=Wx.Any}={}){this.url=h,this.headers=_,this.region=k,this.fetch=T1(S)}setAuth(h){this.headers.Authorization=`Bearer ${h}`}invoke(h){return j1(this,arguments,void 0,function*(_,S={}){var k;let P,T;try{const{headers:c,method:O,body:F,signal:re,timeout:se}=S;let ue={},{region:ae}=S;ae||(ae=this.region);const Q=new URL(`${this.url}/${_}`);ae&&ae!=="any"&&(ue["x-region"]=ae,Q.searchParams.set("forceFunctionRegion",ae));let Y;F&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)?typeof Blob<"u"&&F instanceof Blob||F instanceof ArrayBuffer?(ue["Content-Type"]="application/octet-stream",Y=F):typeof F=="string"?(ue["Content-Type"]="text/plain",Y=F):typeof FormData<"u"&&F instanceof FormData?Y=F:(ue["Content-Type"]="application/json",Y=JSON.stringify(F)):F&&typeof F!="string"&&!(typeof Blob<"u"&&F instanceof Blob)&&!(F instanceof ArrayBuffer)&&!(typeof FormData<"u"&&F instanceof FormData)?Y=JSON.stringify(F):Y=F;let G=re;se&&(T=new AbortController,P=setTimeout(()=>T.abort(),se),re?(G=T.signal,re.addEventListener("abort",()=>T.abort())):G=T.signal);const pe=yield this.fetch(Q.toString(),{method:O||"POST",headers:Object.assign(Object.assign(Object.assign({},ue),this.headers),c),body:Y,signal:G}).catch(Be=>{throw new N1(Be)}),_e=pe.headers.get("x-relay-error");if(_e&&_e==="true")throw new W_(pe);if(!pe.ok)throw new Y_(pe);let Ne=((k=pe.headers.get("Content-Type"))!==null&&k!==void 0?k:"text/plain").split(";")[0].trim(),Oe;return Ne==="application/json"?Oe=yield pe.json():Ne==="application/octet-stream"||Ne==="application/pdf"?Oe=yield pe.blob():Ne==="text/event-stream"?Oe=pe:Ne==="multipart/form-data"?Oe=yield pe.formData():Oe=yield pe.text(),{data:Oe,error:null,response:pe}}catch(c){return{data:null,error:c,response:c instanceof Y_||c instanceof W_?c.context:void 0}}finally{P&&clearTimeout(P)}})}}var C1=class extends Error{constructor(m){super(m.message),this.name="PostgrestError",this.details=m.details,this.hint=m.hint,this.code=m.code}},A1=class{constructor(m){var h,_,S;this.shouldThrowOnError=!1,this.method=m.method,this.url=m.url,this.headers=new Headers(m.headers),this.schema=m.schema,this.body=m.body,this.shouldThrowOnError=(h=m.shouldThrowOnError)!==null&&h!==void 0?h:!1,this.signal=m.signal,this.isMaybeSingle=(_=m.isMaybeSingle)!==null&&_!==void 0?_:!1,this.urlLengthLimit=(S=m.urlLengthLimit)!==null&&S!==void 0?S:8e3,m.fetch?this.fetch=m.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(m,h){return this.headers=new Headers(this.headers),this.headers.set(m,h),this}then(m,h){var _=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const S=this.fetch;let k=S(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async P=>{let T=null,c=null,O=null,F=P.status,re=P.statusText;if(P.ok){var se,ue;if(_.method!=="HEAD"){var ae;const pe=await P.text();pe===""||(_.headers.get("Accept")==="text/csv"||_.headers.get("Accept")&&(!((ae=_.headers.get("Accept"))===null||ae===void 0)&&ae.includes("application/vnd.pgrst.plan+text"))?c=pe:c=JSON.parse(pe))}const Y=(se=_.headers.get("Prefer"))===null||se===void 0?void 0:se.match(/count=(exact|planned|estimated)/),G=(ue=P.headers.get("content-range"))===null||ue===void 0?void 0:ue.split("/");Y&&G&&G.length>1&&(O=parseInt(G[1])),_.isMaybeSingle&&_.method==="GET"&&Array.isArray(c)&&(c.length>1?(T={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,O=null,F=406,re="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{var Q;const Y=await P.text();try{T=JSON.parse(Y),Array.isArray(T)&&P.status===404&&(c=[],T=null,F=200,re="OK")}catch{P.status===404&&Y===""?(F=204,re="No Content"):T={message:Y}}if(T&&_.isMaybeSingle&&(!(T==null||(Q=T.details)===null||Q===void 0)&&Q.includes("0 rows"))&&(T=null,F=200,re="OK"),T&&_.shouldThrowOnError)throw new C1(T)}return{error:T,data:c,count:O,status:F,statusText:re}});return this.shouldThrowOnError||(k=k.catch(P=>{var T;let c="",O="",F="";const re=P?.cause;if(re){var se,ue,ae,Q;const pe=(se=re?.message)!==null&&se!==void 0?se:"",_e=(ue=re?.code)!==null&&ue!==void 0?ue:"";c=`${(ae=P?.name)!==null&&ae!==void 0?ae:"FetchError"}: ${P?.message}`,c+=`

Caused by: ${(Q=re?.name)!==null&&Q!==void 0?Q:"Error"}: ${pe}`,_e&&(c+=` (${_e})`),re?.stack&&(c+=`
${re.stack}`)}else{var Y;c=(Y=P?.stack)!==null&&Y!==void 0?Y:""}const G=this.url.toString().length;return P?.name==="AbortError"||P?.code==="ABORT_ERR"?(F="",O="Request was aborted (timeout or manual cancellation)",G>this.urlLengthLimit&&(O+=`. Note: Your request URL is ${G} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(re?.name==="HeadersOverflowError"||re?.code==="UND_ERR_HEADERS_OVERFLOW")&&(F="",O="HTTP headers exceeded server limits (typically 16KB)",G>this.urlLengthLimit&&(O+=`. Your request URL is ${G} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(T=P?.name)!==null&&T!==void 0?T:"FetchError"}: ${P?.message}`,details:c,hint:O,code:F},data:null,count:null,status:0,statusText:""}})),k.then(m,h)}returns(){return this}overrideTypes(){return this}},k1=class extends A1{select(m){let h=!1;const _=(m??"*").split("").map(S=>/\s/.test(S)&&!h?"":(S==='"'&&(h=!h),S)).join("");return this.url.searchParams.set("select",_),this.headers.append("Prefer","return=representation"),this}order(m,{ascending:h=!0,nullsFirst:_,foreignTable:S,referencedTable:k=S}={}){const P=k?`${k}.order`:"order",T=this.url.searchParams.get(P);return this.url.searchParams.set(P,`${T?`${T},`:""}${m}.${h?"asc":"desc"}${_===void 0?"":_?".nullsfirst":".nullslast"}`),this}limit(m,{foreignTable:h,referencedTable:_=h}={}){const S=typeof _>"u"?"limit":`${_}.limit`;return this.url.searchParams.set(S,`${m}`),this}range(m,h,{foreignTable:_,referencedTable:S=_}={}){const k=typeof S>"u"?"offset":`${S}.offset`,P=typeof S>"u"?"limit":`${S}.limit`;return this.url.searchParams.set(k,`${m}`),this.url.searchParams.set(P,`${h-m+1}`),this}abortSignal(m){return this.signal=m,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:m=!1,verbose:h=!1,settings:_=!1,buffers:S=!1,wal:k=!1,format:P="text"}={}){var T;const c=[m?"analyze":null,h?"verbose":null,_?"settings":null,S?"buffers":null,k?"wal":null].filter(Boolean).join("|"),O=(T=this.headers.get("Accept"))!==null&&T!==void 0?T:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${P}; for="${O}"; options=${c};`),P==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(m){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${m}`),this}};const X_=new RegExp("[,()]");var Wp=class extends k1{eq(m,h){return this.url.searchParams.append(m,`eq.${h}`),this}neq(m,h){return this.url.searchParams.append(m,`neq.${h}`),this}gt(m,h){return this.url.searchParams.append(m,`gt.${h}`),this}gte(m,h){return this.url.searchParams.append(m,`gte.${h}`),this}lt(m,h){return this.url.searchParams.append(m,`lt.${h}`),this}lte(m,h){return this.url.searchParams.append(m,`lte.${h}`),this}like(m,h){return this.url.searchParams.append(m,`like.${h}`),this}likeAllOf(m,h){return this.url.searchParams.append(m,`like(all).{${h.join(",")}}`),this}likeAnyOf(m,h){return this.url.searchParams.append(m,`like(any).{${h.join(",")}}`),this}ilike(m,h){return this.url.searchParams.append(m,`ilike.${h}`),this}ilikeAllOf(m,h){return this.url.searchParams.append(m,`ilike(all).{${h.join(",")}}`),this}ilikeAnyOf(m,h){return this.url.searchParams.append(m,`ilike(any).{${h.join(",")}}`),this}regexMatch(m,h){return this.url.searchParams.append(m,`match.${h}`),this}regexIMatch(m,h){return this.url.searchParams.append(m,`imatch.${h}`),this}is(m,h){return this.url.searchParams.append(m,`is.${h}`),this}isDistinct(m,h){return this.url.searchParams.append(m,`isdistinct.${h}`),this}in(m,h){const _=Array.from(new Set(h)).map(S=>typeof S=="string"&&X_.test(S)?`"${S}"`:`${S}`).join(",");return this.url.searchParams.append(m,`in.(${_})`),this}notIn(m,h){const _=Array.from(new Set(h)).map(S=>typeof S=="string"&&X_.test(S)?`"${S}"`:`${S}`).join(",");return this.url.searchParams.append(m,`not.in.(${_})`),this}contains(m,h){return typeof h=="string"?this.url.searchParams.append(m,`cs.${h}`):Array.isArray(h)?this.url.searchParams.append(m,`cs.{${h.join(",")}}`):this.url.searchParams.append(m,`cs.${JSON.stringify(h)}`),this}containedBy(m,h){return typeof h=="string"?this.url.searchParams.append(m,`cd.${h}`):Array.isArray(h)?this.url.searchParams.append(m,`cd.{${h.join(",")}}`):this.url.searchParams.append(m,`cd.${JSON.stringify(h)}`),this}rangeGt(m,h){return this.url.searchParams.append(m,`sr.${h}`),this}rangeGte(m,h){return this.url.searchParams.append(m,`nxl.${h}`),this}rangeLt(m,h){return this.url.searchParams.append(m,`sl.${h}`),this}rangeLte(m,h){return this.url.searchParams.append(m,`nxr.${h}`),this}rangeAdjacent(m,h){return this.url.searchParams.append(m,`adj.${h}`),this}overlaps(m,h){return typeof h=="string"?this.url.searchParams.append(m,`ov.${h}`):this.url.searchParams.append(m,`ov.{${h.join(",")}}`),this}textSearch(m,h,{config:_,type:S}={}){let k="";S==="plain"?k="pl":S==="phrase"?k="ph":S==="websearch"&&(k="w");const P=_===void 0?"":`(${_})`;return this.url.searchParams.append(m,`${k}fts${P}.${h}`),this}match(m){return Object.entries(m).forEach(([h,_])=>{this.url.searchParams.append(h,`eq.${_}`)}),this}not(m,h,_){return this.url.searchParams.append(m,`not.${h}.${_}`),this}or(m,{foreignTable:h,referencedTable:_=h}={}){const S=_?`${_}.or`:"or";return this.url.searchParams.append(S,`(${m})`),this}filter(m,h,_){return this.url.searchParams.append(m,`${h}.${_}`),this}},M1=class{constructor(m,{headers:h={},schema:_,fetch:S,urlLengthLimit:k=8e3}){this.url=m,this.headers=new Headers(h),this.schema=_,this.fetch=S,this.urlLengthLimit=k}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(m,h){const{head:_=!1,count:S}=h??{},k=_?"HEAD":"GET";let P=!1;const T=(m??"*").split("").map(F=>/\s/.test(F)&&!P?"":(F==='"'&&(P=!P),F)).join(""),{url:c,headers:O}=this.cloneRequestState();return c.searchParams.set("select",T),S&&O.append("Prefer",`count=${S}`),new Wp({method:k,url:c,headers:O,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(m,{count:h,defaultToNull:_=!0}={}){var S;const k="POST",{url:P,headers:T}=this.cloneRequestState();if(h&&T.append("Prefer",`count=${h}`),_||T.append("Prefer","missing=default"),Array.isArray(m)){const c=m.reduce((O,F)=>O.concat(Object.keys(F)),[]);if(c.length>0){const O=[...new Set(c)].map(F=>`"${F}"`);P.searchParams.set("columns",O.join(","))}}return new Wp({method:k,url:P,headers:T,schema:this.schema,body:m,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(m,{onConflict:h,ignoreDuplicates:_=!1,count:S,defaultToNull:k=!0}={}){var P;const T="POST",{url:c,headers:O}=this.cloneRequestState();if(O.append("Prefer",`resolution=${_?"ignore":"merge"}-duplicates`),h!==void 0&&c.searchParams.set("on_conflict",h),S&&O.append("Prefer",`count=${S}`),k||O.append("Prefer","missing=default"),Array.isArray(m)){const F=m.reduce((re,se)=>re.concat(Object.keys(se)),[]);if(F.length>0){const re=[...new Set(F)].map(se=>`"${se}"`);c.searchParams.set("columns",re.join(","))}}return new Wp({method:T,url:c,headers:O,schema:this.schema,body:m,fetch:(P=this.fetch)!==null&&P!==void 0?P:fetch,urlLengthLimit:this.urlLengthLimit})}update(m,{count:h}={}){var _;const S="PATCH",{url:k,headers:P}=this.cloneRequestState();return h&&P.append("Prefer",`count=${h}`),new Wp({method:S,url:k,headers:P,schema:this.schema,body:m,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:m}={}){var h;const _="DELETE",{url:S,headers:k}=this.cloneRequestState();return m&&k.append("Prefer",`count=${m}`),new Wp({method:_,url:S,headers:k,schema:this.schema,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch,urlLengthLimit:this.urlLengthLimit})}};function mg(m){"@babel/helpers - typeof";return mg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},mg(m)}function P1(m,h){if(mg(m)!="object"||!m)return m;var _=m[Symbol.toPrimitive];if(_!==void 0){var S=_.call(m,h);if(mg(S)!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(m)}function D1(m){var h=P1(m,"string");return mg(h)=="symbol"?h:h+""}function R1(m,h,_){return(h=D1(h))in m?Object.defineProperty(m,h,{value:_,enumerable:!0,configurable:!0,writable:!0}):m[h]=_,m}function K_(m,h){var _=Object.keys(m);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(m);h&&(S=S.filter(function(k){return Object.getOwnPropertyDescriptor(m,k).enumerable})),_.push.apply(_,S)}return _}function Ry(m){for(var h=1;h<arguments.length;h++){var _=arguments[h]!=null?arguments[h]:{};h%2?K_(Object(_),!0).forEach(function(S){R1(m,S,_[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):K_(Object(_)).forEach(function(S){Object.defineProperty(m,S,Object.getOwnPropertyDescriptor(_,S))})}return m}var I1=class Z0{constructor(h,{headers:_={},schema:S,fetch:k,timeout:P,urlLengthLimit:T=8e3}={}){this.url=h,this.headers=new Headers(_),this.schemaName=S,this.urlLengthLimit=T;const c=k??globalThis.fetch;P!==void 0&&P>0?this.fetch=(O,F)=>{const re=new AbortController,se=setTimeout(()=>re.abort(),P),ue=F?.signal;if(ue){if(ue.aborted)return clearTimeout(se),c(O,F);const ae=()=>{clearTimeout(se),re.abort()};return ue.addEventListener("abort",ae,{once:!0}),c(O,Ry(Ry({},F),{},{signal:re.signal})).finally(()=>{clearTimeout(se),ue.removeEventListener("abort",ae)})}return c(O,Ry(Ry({},F),{},{signal:re.signal})).finally(()=>clearTimeout(se))}:this.fetch=c}from(h){if(!h||typeof h!="string"||h.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new M1(new URL(`${this.url}/${h}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(h){return new Z0(this.url,{headers:this.headers,schema:h,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(h,_={},{head:S=!1,get:k=!1,count:P}={}){var T;let c;const O=new URL(`${this.url}/rpc/${h}`);let F;const re=ae=>ae!==null&&typeof ae=="object"&&(!Array.isArray(ae)||ae.some(re)),se=S&&Object.values(_).some(re);se?(c="POST",F=_):S||k?(c=S?"HEAD":"GET",Object.entries(_).filter(([ae,Q])=>Q!==void 0).map(([ae,Q])=>[ae,Array.isArray(Q)?`{${Q.join(",")}}`:`${Q}`]).forEach(([ae,Q])=>{O.searchParams.append(ae,Q)})):(c="POST",F=_);const ue=new Headers(this.headers);return se?ue.set("Prefer",P?`count=${P},return=minimal`:"return=minimal"):P&&ue.set("Prefer",`count=${P}`),new Wp({method:c,url:O,headers:ue,schema:this.schemaName,body:F,fetch:(T=this.fetch)!==null&&T!==void 0?T:fetch,urlLengthLimit:this.urlLengthLimit})}};class z1{constructor(){}static detectEnvironment(){var h;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((h=navigator.userAgent)===null||h===void 0)&&h.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const _=globalThis.process;if(_){const S=_.versions;if(S&&S.node){const k=S.node,P=parseInt(k.replace(/^v/,"").split(".")[0]);return P>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${P} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${P} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const h=this.detectEnvironment();if(h.constructor)return h.constructor;let _=h.error||"WebSocket not supported in this environment.";throw h.workaround&&(_+=`

Suggested solution: ${h.workaround}`),new Error(_)}static createWebSocket(h,_){const S=this.getWebSocketConstructor();return new S(h,_)}static isWebSocketSupported(){try{const h=this.detectEnvironment();return h.type==="native"||h.type==="ws"}catch{return!1}}}const O1="2.95.3",L1=`realtime-js/${O1}`,B1="1.0.0",W0="2.0.0",J_=W0,Yx=1e4,F1=1e3,U1=100;var Hd;(function(m){m[m.connecting=0]="connecting",m[m.open=1]="open",m[m.closing=2]="closing",m[m.closed=3]="closed"})(Hd||(Hd={}));var sa;(function(m){m.closed="closed",m.errored="errored",m.joined="joined",m.joining="joining",m.leaving="leaving"})(sa||(sa={}));var tc;(function(m){m.close="phx_close",m.error="phx_error",m.join="phx_join",m.reply="phx_reply",m.leave="phx_leave",m.access_token="access_token"})(tc||(tc={}));var Xx;(function(m){m.websocket="websocket"})(Xx||(Xx={}));var uf;(function(m){m.Connecting="connecting",m.Open="open",m.Closing="closing",m.Closed="closed"})(uf||(uf={}));class $1{constructor(h){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=h??[]}encode(h,_){if(h.event===this.BROADCAST_EVENT&&!(h.payload instanceof ArrayBuffer)&&typeof h.payload.event=="string")return _(this._binaryEncodeUserBroadcastPush(h));let S=[h.join_ref,h.ref,h.topic,h.event,h.payload];return _(JSON.stringify(S))}_binaryEncodeUserBroadcastPush(h){var _;return this._isArrayBuffer((_=h.payload)===null||_===void 0?void 0:_.payload)?this._encodeBinaryUserBroadcastPush(h):this._encodeJsonUserBroadcastPush(h)}_encodeBinaryUserBroadcastPush(h){var _,S;const k=(S=(_=h.payload)===null||_===void 0?void 0:_.payload)!==null&&S!==void 0?S:new ArrayBuffer(0);return this._encodeUserBroadcastPush(h,this.BINARY_ENCODING,k)}_encodeJsonUserBroadcastPush(h){var _,S;const k=(S=(_=h.payload)===null||_===void 0?void 0:_.payload)!==null&&S!==void 0?S:{},T=new TextEncoder().encode(JSON.stringify(k)).buffer;return this._encodeUserBroadcastPush(h,this.JSON_ENCODING,T)}_encodeUserBroadcastPush(h,_,S){var k,P;const T=h.topic,c=(k=h.ref)!==null&&k!==void 0?k:"",O=(P=h.join_ref)!==null&&P!==void 0?P:"",F=h.payload.event,re=this.allowedMetadataKeys?this._pick(h.payload,this.allowedMetadataKeys):{},se=Object.keys(re).length===0?"":JSON.stringify(re);if(O.length>255)throw new Error(`joinRef length ${O.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`ref length ${c.length} exceeds maximum of 255`);if(T.length>255)throw new Error(`topic length ${T.length} exceeds maximum of 255`);if(F.length>255)throw new Error(`userEvent length ${F.length} exceeds maximum of 255`);if(se.length>255)throw new Error(`metadata length ${se.length} exceeds maximum of 255`);const ue=this.USER_BROADCAST_PUSH_META_LENGTH+O.length+c.length+T.length+F.length+se.length,ae=new ArrayBuffer(this.HEADER_LENGTH+ue);let Q=new DataView(ae),Y=0;Q.setUint8(Y++,this.KINDS.userBroadcastPush),Q.setUint8(Y++,O.length),Q.setUint8(Y++,c.length),Q.setUint8(Y++,T.length),Q.setUint8(Y++,F.length),Q.setUint8(Y++,se.length),Q.setUint8(Y++,_),Array.from(O,pe=>Q.setUint8(Y++,pe.charCodeAt(0))),Array.from(c,pe=>Q.setUint8(Y++,pe.charCodeAt(0))),Array.from(T,pe=>Q.setUint8(Y++,pe.charCodeAt(0))),Array.from(F,pe=>Q.setUint8(Y++,pe.charCodeAt(0))),Array.from(se,pe=>Q.setUint8(Y++,pe.charCodeAt(0)));var G=new Uint8Array(ae.byteLength+S.byteLength);return G.set(new Uint8Array(ae),0),G.set(new Uint8Array(S),ae.byteLength),G.buffer}decode(h,_){if(this._isArrayBuffer(h)){let S=this._binaryDecode(h);return _(S)}if(typeof h=="string"){const S=JSON.parse(h),[k,P,T,c,O]=S;return _({join_ref:k,ref:P,topic:T,event:c,payload:O})}return _({})}_binaryDecode(h){const _=new DataView(h),S=_.getUint8(0),k=new TextDecoder;switch(S){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(h,_,k)}}_decodeUserBroadcast(h,_,S){const k=_.getUint8(1),P=_.getUint8(2),T=_.getUint8(3),c=_.getUint8(4);let O=this.HEADER_LENGTH+4;const F=S.decode(h.slice(O,O+k));O=O+k;const re=S.decode(h.slice(O,O+P));O=O+P;const se=S.decode(h.slice(O,O+T));O=O+T;const ue=h.slice(O,h.byteLength),ae=c===this.JSON_ENCODING?JSON.parse(S.decode(ue)):ue,Q={type:this.BROADCAST_EVENT,event:re,payload:ae};return T>0&&(Q.meta=JSON.parse(se)),{join_ref:null,ref:null,topic:F,event:this.BROADCAST_EVENT,payload:Q}}_isArrayBuffer(h){var _;return h instanceof ArrayBuffer||((_=h?.constructor)===null||_===void 0?void 0:_.name)==="ArrayBuffer"}_pick(h,_){return!h||typeof h!="object"?{}:Object.fromEntries(Object.entries(h).filter(([S])=>_.includes(S)))}}let Y0=class{constructor(h,_){this.callback=h,this.timerCalc=_,this.timer=void 0,this.tries=0,this.callback=h,this.timerCalc=_}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var Qr;(function(m){m.abstime="abstime",m.bool="bool",m.date="date",m.daterange="daterange",m.float4="float4",m.float8="float8",m.int2="int2",m.int4="int4",m.int4range="int4range",m.int8="int8",m.int8range="int8range",m.json="json",m.jsonb="jsonb",m.money="money",m.numeric="numeric",m.oid="oid",m.reltime="reltime",m.text="text",m.time="time",m.timestamp="timestamp",m.timestamptz="timestamptz",m.timetz="timetz",m.tsrange="tsrange",m.tstzrange="tstzrange"})(Qr||(Qr={}));const Q_=(m,h,_={})=>{var S;const k=(S=_.skipTypes)!==null&&S!==void 0?S:[];return h?Object.keys(h).reduce((P,T)=>(P[T]=V1(T,m,h,k),P),{}):{}},V1=(m,h,_,S)=>{const k=h.find(c=>c.name===m),P=k?.type,T=_[m];return P&&!S.includes(P)?X0(P,T):Kx(T)},X0=(m,h)=>{if(m.charAt(0)==="_"){const _=m.slice(1,m.length);return Z1(h,_)}switch(m){case Qr.bool:return q1(h);case Qr.float4:case Qr.float8:case Qr.int2:case Qr.int4:case Qr.int8:case Qr.numeric:case Qr.oid:return G1(h);case Qr.json:case Qr.jsonb:return H1(h);case Qr.timestamp:return W1(h);case Qr.abstime:case Qr.date:case Qr.daterange:case Qr.int4range:case Qr.int8range:case Qr.money:case Qr.reltime:case Qr.text:case Qr.time:case Qr.timestamptz:case Qr.timetz:case Qr.tsrange:case Qr.tstzrange:return Kx(h);default:return Kx(h)}},Kx=m=>m,q1=m=>{switch(m){case"t":return!0;case"f":return!1;default:return m}},G1=m=>{if(typeof m=="string"){const h=parseFloat(m);if(!Number.isNaN(h))return h}return m},H1=m=>{if(typeof m=="string")try{return JSON.parse(m)}catch{return m}return m},Z1=(m,h)=>{if(typeof m!="string")return m;const _=m.length-1,S=m[_];if(m[0]==="{"&&S==="}"){let P;const T=m.slice(1,_);try{P=JSON.parse("["+T+"]")}catch{P=T?T.split(","):[]}return P.map(c=>X0(h,c))}return m},W1=m=>typeof m=="string"?m.replace(" ","T"):m,K0=m=>{const h=new URL(m);return h.protocol=h.protocol.replace(/^ws/i,"http"),h.pathname=h.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),h.pathname===""||h.pathname==="/"?h.pathname="/api/broadcast":h.pathname=h.pathname+"/api/broadcast",h.href};class Ox{constructor(h,_,S={},k=Yx){this.channel=h,this.event=_,this.payload=S,this.timeout=k,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(h){this.timeout=h,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(h){this.payload=Object.assign(Object.assign({},this.payload),h)}receive(h,_){var S;return this._hasReceived(h)&&_((S=this.receivedResp)===null||S===void 0?void 0:S.response),this.recHooks.push({status:h,callback:_}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const h=_=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=_,this._matchReceive(_)};this.channel._on(this.refEvent,{},h),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(h,_){this.refEvent&&this.channel._trigger(this.refEvent,{status:h,response:_})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:h,response:_}){this.recHooks.filter(S=>S.status===h).forEach(S=>S.callback(_))}_hasReceived(h){return this.receivedResp&&this.receivedResp.status===h}}var e0;(function(m){m.SYNC="sync",m.JOIN="join",m.LEAVE="leave"})(e0||(e0={}));class ug{constructor(h,_){this.channel=h,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const S=_?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(S.state,{},k=>{const{onJoin:P,onLeave:T,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ug.syncState(this.state,k,P,T),this.pendingDiffs.forEach(O=>{this.state=ug.syncDiff(this.state,O,P,T)}),this.pendingDiffs=[],c()}),this.channel._on(S.diff,{},k=>{const{onJoin:P,onLeave:T,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(k):(this.state=ug.syncDiff(this.state,k,P,T),c())}),this.onJoin((k,P,T)=>{this.channel._trigger("presence",{event:"join",key:k,currentPresences:P,newPresences:T})}),this.onLeave((k,P,T)=>{this.channel._trigger("presence",{event:"leave",key:k,currentPresences:P,leftPresences:T})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(h,_,S,k){const P=this.cloneDeep(h),T=this.transformState(_),c={},O={};return this.map(P,(F,re)=>{T[F]||(O[F]=re)}),this.map(T,(F,re)=>{const se=P[F];if(se){const ue=re.map(G=>G.presence_ref),ae=se.map(G=>G.presence_ref),Q=re.filter(G=>ae.indexOf(G.presence_ref)<0),Y=se.filter(G=>ue.indexOf(G.presence_ref)<0);Q.length>0&&(c[F]=Q),Y.length>0&&(O[F]=Y)}else c[F]=re}),this.syncDiff(P,{joins:c,leaves:O},S,k)}static syncDiff(h,_,S,k){const{joins:P,leaves:T}={joins:this.transformState(_.joins),leaves:this.transformState(_.leaves)};return S||(S=()=>{}),k||(k=()=>{}),this.map(P,(c,O)=>{var F;const re=(F=h[c])!==null&&F!==void 0?F:[];if(h[c]=this.cloneDeep(O),re.length>0){const se=h[c].map(ae=>ae.presence_ref),ue=re.filter(ae=>se.indexOf(ae.presence_ref)<0);h[c].unshift(...ue)}S(c,re,O)}),this.map(T,(c,O)=>{let F=h[c];if(!F)return;const re=O.map(se=>se.presence_ref);F=F.filter(se=>re.indexOf(se.presence_ref)<0),h[c]=F,k(c,F,O),F.length===0&&delete h[c]}),h}static map(h,_){return Object.getOwnPropertyNames(h).map(S=>_(S,h[S]))}static transformState(h){return h=this.cloneDeep(h),Object.getOwnPropertyNames(h).reduce((_,S)=>{const k=h[S];return"metas"in k?_[S]=k.metas.map(P=>(P.presence_ref=P.phx_ref,delete P.phx_ref,delete P.phx_ref_prev,P)):_[S]=k,_},{})}static cloneDeep(h){return JSON.parse(JSON.stringify(h))}onJoin(h){this.caller.onJoin=h}onLeave(h){this.caller.onLeave=h}onSync(h){this.caller.onSync=h}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var t0;(function(m){m.ALL="*",m.INSERT="INSERT",m.UPDATE="UPDATE",m.DELETE="DELETE"})(t0||(t0={}));var dg;(function(m){m.BROADCAST="broadcast",m.PRESENCE="presence",m.POSTGRES_CHANGES="postgres_changes",m.SYSTEM="system"})(dg||(dg={}));var qu;(function(m){m.SUBSCRIBED="SUBSCRIBED",m.TIMED_OUT="TIMED_OUT",m.CLOSED="CLOSED",m.CHANNEL_ERROR="CHANNEL_ERROR"})(qu||(qu={}));class Kp{constructor(h,_={config:{}},S){var k,P;if(this.topic=h,this.params=_,this.socket=S,this.bindings={},this.state=sa.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=h.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},_.config),this.timeout=this.socket.timeout,this.joinPush=new Ox(this,tc.join,this.params,this.timeout),this.rejoinTimer=new Y0(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=sa.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(T=>T.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=sa.closed,this.socket._remove(this)}),this._onError(T=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,T),this.state=sa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=sa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",T=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,T),this.state=sa.errored,this.rejoinTimer.scheduleTimeout())}),this._on(tc.reply,{},(T,c)=>{this._trigger(this._replyEventName(c),T)}),this.presence=new ug(this),this.broadcastEndpointURL=K0(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((P=(k=this.params.config)===null||k===void 0?void 0:k.broadcast)===null||P===void 0)&&P.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(h,_=this.timeout){var S,k,P;if(this.socket.isConnected()||this.socket.connect(),this.state==sa.closed){const{config:{broadcast:T,presence:c,private:O}}=this.params,F=(k=(S=this.bindings.postgres_changes)===null||S===void 0?void 0:S.map(ae=>ae.filter))!==null&&k!==void 0?k:[],re=!!this.bindings[dg.PRESENCE]&&this.bindings[dg.PRESENCE].length>0||((P=this.params.config.presence)===null||P===void 0?void 0:P.enabled)===!0,se={},ue={broadcast:T,presence:Object.assign(Object.assign({},c),{enabled:re}),postgres_changes:F,private:O};this.socket.accessTokenValue&&(se.access_token=this.socket.accessTokenValue),this._onError(ae=>h?.(qu.CHANNEL_ERROR,ae)),this._onClose(()=>h?.(qu.CLOSED)),this.updateJoinPayload(Object.assign({config:ue},se)),this.joinedOnce=!0,this._rejoin(_),this.joinPush.receive("ok",async({postgres_changes:ae})=>{var Q;if(this.socket._isManualToken()||this.socket.setAuth(),ae===void 0){h?.(qu.SUBSCRIBED);return}else{const Y=this.bindings.postgres_changes,G=(Q=Y?.length)!==null&&Q!==void 0?Q:0,pe=[];for(let _e=0;_e<G;_e++){const Ne=Y[_e],{filter:{event:Oe,schema:Be,table:xt,filter:$e}}=Ne,de=ae&&ae[_e];if(de&&de.event===Oe&&Kp.isFilterValueEqual(de.schema,Be)&&Kp.isFilterValueEqual(de.table,xt)&&Kp.isFilterValueEqual(de.filter,$e))pe.push(Object.assign(Object.assign({},Ne),{id:de.id}));else{this.unsubscribe(),this.state=sa.errored,h?.(qu.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=pe,h&&h(qu.SUBSCRIBED);return}}).receive("error",ae=>{this.state=sa.errored,h?.(qu.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(ae).join(", ")||"error")))}).receive("timeout",()=>{h?.(qu.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(h,_={}){return await this.send({type:"presence",event:"track",payload:h},_.timeout||this.timeout)}async untrack(h={}){return await this.send({type:"presence",event:"untrack"},h)}on(h,_,S){return this.state===sa.joined&&h===dg.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(h,_,S)}async httpSend(h,_,S={}){var k;if(_==null)return Promise.reject("Payload is required for httpSend()");const P={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(P.Authorization=`Bearer ${this.socket.accessTokenValue}`);const T={method:"POST",headers:P,body:JSON.stringify({messages:[{topic:this.subTopic,event:h,payload:_,private:this.private}]})},c=await this._fetchWithTimeout(this.broadcastEndpointURL,T,(k=S.timeout)!==null&&k!==void 0?k:this.timeout);if(c.status===202)return{success:!0};let O=c.statusText;try{const F=await c.json();O=F.error||F.message||O}catch{}return Promise.reject(new Error(O))}async send(h,_={}){var S,k;if(!this._canPush()&&h.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:P,payload:T}=h,c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);const O={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:P,payload:T,private:this.private}]})};try{const F=await this._fetchWithTimeout(this.broadcastEndpointURL,O,(S=_.timeout)!==null&&S!==void 0?S:this.timeout);return await((k=F.body)===null||k===void 0?void 0:k.cancel()),F.ok?"ok":"error"}catch(F){return F.name==="AbortError"?"timed out":"error"}}else return new Promise(P=>{var T,c,O;const F=this._push(h.type,h,_.timeout||this.timeout);h.type==="broadcast"&&!(!((O=(c=(T=this.params)===null||T===void 0?void 0:T.config)===null||c===void 0?void 0:c.broadcast)===null||O===void 0)&&O.ack)&&P("ok"),F.receive("ok",()=>P("ok")),F.receive("error",()=>P("error")),F.receive("timeout",()=>P("timed out"))})}updateJoinPayload(h){this.joinPush.updatePayload(h)}unsubscribe(h=this.timeout){this.state=sa.leaving;const _=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(tc.close,"leave",this._joinRef())};this.joinPush.destroy();let S=null;return new Promise(k=>{S=new Ox(this,tc.leave,{},h),S.receive("ok",()=>{_(),k("ok")}).receive("timeout",()=>{_(),k("timed out")}).receive("error",()=>{k("error")}),S.send(),this._canPush()||S.trigger("ok",{})}).finally(()=>{S?.destroy()})}teardown(){this.pushBuffer.forEach(h=>h.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=sa.closed,this.bindings={}}async _fetchWithTimeout(h,_,S){const k=new AbortController,P=setTimeout(()=>k.abort(),S),T=await this.socket.fetch(h,Object.assign(Object.assign({},_),{signal:k.signal}));return clearTimeout(P),T}_push(h,_,S=this.timeout){if(!this.joinedOnce)throw`tried to push '${h}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let k=new Ox(this,h,_,S);return this._canPush()?k.send():this._addToPushBuffer(k),k}_addToPushBuffer(h){if(h.startTimeout(),this.pushBuffer.push(h),this.pushBuffer.length>U1){const _=this.pushBuffer.shift();_&&(_.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${_.event}`,_.payload))}}_onMessage(h,_,S){return _}_isMember(h){return this.topic===h}_joinRef(){return this.joinPush.ref}_trigger(h,_,S){var k,P;const T=h.toLocaleLowerCase(),{close:c,error:O,leave:F,join:re}=tc;if(S&&[c,O,F,re].indexOf(T)>=0&&S!==this._joinRef())return;let ue=this._onMessage(T,_,S);if(_&&!ue)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(T)?(k=this.bindings.postgres_changes)===null||k===void 0||k.filter(ae=>{var Q,Y,G;return((Q=ae.filter)===null||Q===void 0?void 0:Q.event)==="*"||((G=(Y=ae.filter)===null||Y===void 0?void 0:Y.event)===null||G===void 0?void 0:G.toLocaleLowerCase())===T}).map(ae=>ae.callback(ue,S)):(P=this.bindings[T])===null||P===void 0||P.filter(ae=>{var Q,Y,G,pe,_e,Ne;if(["broadcast","presence","postgres_changes"].includes(T))if("id"in ae){const Oe=ae.id,Be=(Q=ae.filter)===null||Q===void 0?void 0:Q.event;return Oe&&((Y=_.ids)===null||Y===void 0?void 0:Y.includes(Oe))&&(Be==="*"||Be?.toLocaleLowerCase()===((G=_.data)===null||G===void 0?void 0:G.type.toLocaleLowerCase()))}else{const Oe=(_e=(pe=ae?.filter)===null||pe===void 0?void 0:pe.event)===null||_e===void 0?void 0:_e.toLocaleLowerCase();return Oe==="*"||Oe===((Ne=_?.event)===null||Ne===void 0?void 0:Ne.toLocaleLowerCase())}else return ae.type.toLocaleLowerCase()===T}).map(ae=>{if(typeof ue=="object"&&"ids"in ue){const Q=ue.data,{schema:Y,table:G,commit_timestamp:pe,type:_e,errors:Ne}=Q;ue=Object.assign(Object.assign({},{schema:Y,table:G,commit_timestamp:pe,eventType:_e,new:{},old:{},errors:Ne}),this._getPayloadRecords(Q))}ae.callback(ue,S)})}_isClosed(){return this.state===sa.closed}_isJoined(){return this.state===sa.joined}_isJoining(){return this.state===sa.joining}_isLeaving(){return this.state===sa.leaving}_replyEventName(h){return`chan_reply_${h}`}_on(h,_,S){const k=h.toLocaleLowerCase(),P={type:k,filter:_,callback:S};return this.bindings[k]?this.bindings[k].push(P):this.bindings[k]=[P],this}_off(h,_){const S=h.toLocaleLowerCase();return this.bindings[S]&&(this.bindings[S]=this.bindings[S].filter(k=>{var P;return!(((P=k.type)===null||P===void 0?void 0:P.toLocaleLowerCase())===S&&Kp.isEqual(k.filter,_))})),this}static isEqual(h,_){if(Object.keys(h).length!==Object.keys(_).length)return!1;for(const S in h)if(h[S]!==_[S])return!1;return!0}static isFilterValueEqual(h,_){return(h??void 0)===(_??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(h){this._on(tc.close,{},h)}_onError(h){this._on(tc.error,{},_=>h(_))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(h=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=sa.joining,this.joinPush.resend(h))}_getPayloadRecords(h){const _={new:{},old:{}};return(h.type==="INSERT"||h.type==="UPDATE")&&(_.new=Q_(h.columns,h.record)),(h.type==="UPDATE"||h.type==="DELETE")&&(_.old=Q_(h.columns,h.old_record)),_}}const Lx=()=>{},Iy={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Y1=[1e3,2e3,5e3,1e4],X1=1e4,K1=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class J1{constructor(h,_){var S;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Yx,this.transport=null,this.heartbeatIntervalMs=Iy.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Lx,this.ref=0,this.reconnectTimer=null,this.vsn=J_,this.logger=Lx,this.conn=null,this.sendBuffer=[],this.serializer=new $1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=k=>k?(...P)=>k(...P):(...P)=>fetch(...P),!(!((S=_?.params)===null||S===void 0)&&S.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=_.params.apikey,this.endPoint=`${h}/${Xx.websocket}`,this.httpEndpoint=K0(h),this._initializeOptions(_),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(_?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=z1.createWebSocket(this.endpointURL())}catch(h){this._setConnectionState("disconnected");const _=h.message;throw _.includes("Node.js")?new Error(`${_}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${_}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(h,_){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const S=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(S),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(h?this.conn.close(h,_??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(h){const _=await h.unsubscribe();return _==="ok"&&this._remove(h),this.channels.length===0&&this.disconnect(),_}async removeAllChannels(){const h=await Promise.all(this.channels.map(_=>_.unsubscribe()));return this.channels=[],this.disconnect(),h}log(h,_,S){this.logger(h,_,S)}connectionState(){switch(this.conn&&this.conn.readyState){case Hd.connecting:return uf.Connecting;case Hd.open:return uf.Open;case Hd.closing:return uf.Closing;default:return uf.Closed}}isConnected(){return this.connectionState()===uf.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(h,_={config:{}}){const S=`realtime:${h}`,k=this.getChannels().find(P=>P.topic===S);if(k)return k;{const P=new Kp(`realtime:${h}`,_,this);return this.channels.push(P),P}}push(h){const{topic:_,event:S,payload:k,ref:P}=h,T=()=>{this.encode(h,c=>{var O;(O=this.conn)===null||O===void 0||O.send(c)})};this.log("push",`${_} ${S} (${P})`,k),this.isConnected()?T():this.sendBuffer.push(T)}async setAuth(h=null){this._authPromise=this._performAuth(h);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var h;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(_){this.log("error","error in heartbeat callback",_)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(_){this.log("error","error in heartbeat callback",_)}this._wasManualDisconnect=!1,(h=this.conn)===null||h===void 0||h.close(F1,"heartbeat timeout"),setTimeout(()=>{var _;this.isConnected()||(_=this.reconnectTimer)===null||_===void 0||_.scheduleTimeout()},Iy.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(_){this.log("error","error in heartbeat callback",_)}this._setAuthSafely("heartbeat")}onHeartbeat(h){this.heartbeatCallback=h}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(h=>h()),this.sendBuffer=[])}_makeRef(){let h=this.ref+1;return h===this.ref?this.ref=0:this.ref=h,this.ref.toString()}_leaveOpenTopic(h){let _=this.channels.find(S=>S.topic===h&&(S._isJoined()||S._isJoining()));_&&(this.log("transport",`leaving duplicate topic "${h}"`),_.unsubscribe())}_remove(h){this.channels=this.channels.filter(_=>_.topic!==h.topic)}_onConnMessage(h){this.decode(h.data,_=>{if(_.topic==="phoenix"&&_.event==="phx_reply"&&_.ref&&_.ref===this.pendingHeartbeatRef){const F=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(_.payload.status==="ok"?"ok":"error",F)}catch(re){this.log("error","error in heartbeat callback",re)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:S,event:k,payload:P,ref:T}=_,c=T?`(${T})`:"",O=P.status||"";this.log("receive",`${O} ${S} ${k} ${c}`.trim(),P),this.channels.filter(F=>F._isMember(S)).forEach(F=>F._trigger(k,P,T)),this._triggerStateCallbacks("message",_)})}_clearTimer(h){var _;h==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):h==="reconnect"&&((_=this.reconnectTimer)===null||_===void 0||_.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=h=>this._onConnError(h),this.conn.onmessage=h=>this._onConnMessage(h),this.conn.onclose=h=>this._onConnClose(h),this.conn.readyState===Hd.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Hd.open||this.conn.readyState===Hd.connecting)try{this.conn.close()}catch(h){this.log("error","Error closing connection",h)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(h=>h.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(_=>{this.log("error","error waiting for auth on connect",_),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const h=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(h),this.workerRef.onerror=_=>{this.log("worker","worker error",_.message),this._terminateWorker()},this.workerRef.onmessage=_=>{_.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(h){var _;this._setConnectionState("disconnected"),this.log("transport","close",h),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(_=this.reconnectTimer)===null||_===void 0||_.scheduleTimeout(),this._triggerStateCallbacks("close",h)}_onConnError(h){this._setConnectionState("disconnected"),this.log("transport",`${h}`),this._triggerChanError(),this._triggerStateCallbacks("error",h);try{this.heartbeatCallback("error")}catch(_){this.log("error","error in heartbeat callback",_)}}_triggerChanError(){this.channels.forEach(h=>h._trigger(tc.error))}_appendParams(h,_){if(Object.keys(_).length===0)return h;const S=h.match(/\?/)?"&":"?",k=new URLSearchParams(_);return`${h}${S}${k}`}_workerObjectUrl(h){let _;if(h)_=h;else{const S=new Blob([K1],{type:"application/javascript"});_=URL.createObjectURL(S)}return _}_setConnectionState(h,_=!1){this._connectionState=h,h==="connecting"?this._wasManualDisconnect=!1:h==="disconnecting"&&(this._wasManualDisconnect=_)}async _performAuth(h=null){let _,S=!1;if(h)_=h,S=!0;else if(this.accessToken)try{_=await this.accessToken()}catch(k){this.log("error","Error fetching access token from callback",k),_=this.accessTokenValue}else _=this.accessTokenValue;S?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=_&&(this.accessTokenValue=_,this.channels.forEach(k=>{const P={access_token:_,version:L1};_&&k.updateJoinPayload(P),k.joinedOnce&&k._isJoined()&&k._push(tc.access_token,{access_token:_})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(h="general"){this._isManualToken()||this.setAuth().catch(_=>{this.log("error",`Error setting auth in ${h}`,_)})}_triggerStateCallbacks(h,_){try{this.stateChangeCallbacks[h].forEach(S=>{try{S(_)}catch(k){this.log("error",`error in ${h} callback`,k)}})}catch(S){this.log("error",`error triggering ${h} callbacks`,S)}}_setupReconnectionTimer(){this.reconnectTimer=new Y0(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Iy.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(h){var _,S,k,P,T,c,O,F,re,se,ue,ae;switch(this.transport=(_=h?.transport)!==null&&_!==void 0?_:null,this.timeout=(S=h?.timeout)!==null&&S!==void 0?S:Yx,this.heartbeatIntervalMs=(k=h?.heartbeatIntervalMs)!==null&&k!==void 0?k:Iy.HEARTBEAT_INTERVAL,this.worker=(P=h?.worker)!==null&&P!==void 0?P:!1,this.accessToken=(T=h?.accessToken)!==null&&T!==void 0?T:null,this.heartbeatCallback=(c=h?.heartbeatCallback)!==null&&c!==void 0?c:Lx,this.vsn=(O=h?.vsn)!==null&&O!==void 0?O:J_,h?.params&&(this.params=h.params),h?.logger&&(this.logger=h.logger),(h?.logLevel||h?.log_level)&&(this.logLevel=h.logLevel||h.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(F=h?.reconnectAfterMs)!==null&&F!==void 0?F:(Q=>Y1[Q-1]||X1),this.vsn){case B1:this.encode=(re=h?.encode)!==null&&re!==void 0?re:((Q,Y)=>Y(JSON.stringify(Q))),this.decode=(se=h?.decode)!==null&&se!==void 0?se:((Q,Y)=>Y(JSON.parse(Q)));break;case W0:this.encode=(ue=h?.encode)!==null&&ue!==void 0?ue:this.serializer.encode.bind(this.serializer),this.decode=(ae=h?.decode)!==null&&ae!==void 0?ae:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=h?.workerUrl}}}var gg=class extends Error{constructor(m,h){super(m),this.name="IcebergError",this.status=h.status,this.icebergType=h.icebergType,this.icebergCode=h.icebergCode,this.details=h.details,this.isCommitStateUnknown=h.icebergType==="CommitStateUnknownException"||[500,502,504].includes(h.status)&&h.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Q1(m,h,_){const S=new URL(h,m);if(_)for(const[k,P]of Object.entries(_))P!==void 0&&S.searchParams.set(k,P);return S.toString()}async function ew(m){return!m||m.type==="none"?{}:m.type==="bearer"?{Authorization:`Bearer ${m.token}`}:m.type==="header"?{[m.name]:m.value}:m.type==="custom"?await m.getHeaders():{}}function tw(m){const h=m.fetchImpl??globalThis.fetch;return{async request({method:_,path:S,query:k,body:P,headers:T}){const c=Q1(m.baseUrl,S,k),O=await ew(m.auth),F=await h(c,{method:_,headers:{...P?{"Content-Type":"application/json"}:{},...O,...T},body:P?JSON.stringify(P):void 0}),re=await F.text(),se=(F.headers.get("content-type")||"").includes("application/json"),ue=se&&re?JSON.parse(re):re;if(!F.ok){const ae=se?ue:void 0,Q=ae?.error;throw new gg(Q?.message??`Request failed with status ${F.status}`,{status:F.status,icebergType:Q?.type,icebergCode:Q?.code,details:ae})}return{status:F.status,headers:F.headers,data:ue}}}}function zy(m){return m.join("")}var sw=class{constructor(m,h=""){this.client=m,this.prefix=h}async listNamespaces(m){const h=m?{parent:zy(m.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:h})).data.namespaces.map(S=>({namespace:S}))}async createNamespace(m,h){const _={namespace:m.namespace,properties:h?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:_})).data}async dropNamespace(m){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${zy(m.namespace)}`})}async loadNamespaceMetadata(m){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${zy(m.namespace)}`})).data.properties}}async namespaceExists(m){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${zy(m.namespace)}`}),!0}catch(h){if(h instanceof gg&&h.status===404)return!1;throw h}}async createNamespaceIfNotExists(m,h){try{return await this.createNamespace(m,h)}catch(_){if(_ instanceof gg&&_.status===409)return;throw _}}};function $p(m){return m.join("")}var rw=class{constructor(m,h="",_){this.client=m,this.prefix=h,this.accessDelegation=_}async listTables(m){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${$p(m.namespace)}/tables`})).data.identifiers}async createTable(m,h){const _={};return this.accessDelegation&&(_["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${$p(m.namespace)}/tables`,body:h,headers:_})).data.metadata}async updateTable(m,h){const _=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${$p(m.namespace)}/tables/${m.name}`,body:h});return{"metadata-location":_.data["metadata-location"],metadata:_.data.metadata}}async dropTable(m,h){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${$p(m.namespace)}/tables/${m.name}`,query:{purgeRequested:String(h?.purge??!1)}})}async loadTable(m){const h={};return this.accessDelegation&&(h["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${$p(m.namespace)}/tables/${m.name}`,headers:h})).data.metadata}async tableExists(m){const h={};this.accessDelegation&&(h["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${$p(m.namespace)}/tables/${m.name}`,headers:h}),!0}catch(_){if(_ instanceof gg&&_.status===404)return!1;throw _}}async createTableIfNotExists(m,h){try{return await this.createTable(m,h)}catch(_){if(_ instanceof gg&&_.status===409)return await this.loadTable({namespace:m.namespace,name:h.name});throw _}}},iw=class{constructor(m){let h="v1";m.catalogName&&(h+=`/${m.catalogName}`);const _=m.baseUrl.endsWith("/")?m.baseUrl:`${m.baseUrl}/`;this.client=tw({baseUrl:_,auth:m.auth,fetchImpl:m.fetch}),this.accessDelegation=m.accessDelegation?.join(","),this.namespaceOps=new sw(this.client,h),this.tableOps=new rw(this.client,h,this.accessDelegation)}async listNamespaces(m){return this.namespaceOps.listNamespaces(m)}async createNamespace(m,h){return this.namespaceOps.createNamespace(m,h)}async dropNamespace(m){await this.namespaceOps.dropNamespace(m)}async loadNamespaceMetadata(m){return this.namespaceOps.loadNamespaceMetadata(m)}async listTables(m){return this.tableOps.listTables(m)}async createTable(m,h){return this.tableOps.createTable(m,h)}async updateTable(m,h){return this.tableOps.updateTable(m,h)}async dropTable(m,h){await this.tableOps.dropTable(m,h)}async loadTable(m){return this.tableOps.loadTable(m)}async namespaceExists(m){return this.namespaceOps.namespaceExists(m)}async tableExists(m){return this.tableOps.tableExists(m)}async createNamespaceIfNotExists(m,h){return this.namespaceOps.createNamespaceIfNotExists(m,h)}async createTableIfNotExists(m,h){return this.tableOps.createTableIfNotExists(m,h)}},rx=class extends Error{constructor(m,h="storage",_,S){super(m),this.__isStorageError=!0,this.namespace=h,this.name=h==="vectors"?"StorageVectorsError":"StorageError",this.status=_,this.statusCode=S}};function ix(m){return typeof m=="object"&&m!==null&&"__isStorageError"in m}var Oy=class extends rx{constructor(m,h,_,S="storage"){super(m,S,h,_),this.name=S==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=h,this.statusCode=_}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},J0=class extends rx{constructor(m,h,_="storage"){super(m,_),this.name=_==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=h}};const aw=m=>m?(...h)=>m(...h):(...h)=>fetch(...h),nw=m=>{if(typeof m!="object"||m===null)return!1;const h=Object.getPrototypeOf(m);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in m)&&!(Symbol.iterator in m)},Jx=m=>{if(Array.isArray(m))return m.map(_=>Jx(_));if(typeof m=="function"||m!==Object(m))return m;const h={};return Object.entries(m).forEach(([_,S])=>{const k=_.replace(/([-_][a-z])/gi,P=>P.toUpperCase().replace(/[-_]/g,""));h[k]=Jx(S)}),h},ow=m=>!m||typeof m!="string"||m.length===0||m.length>100||m.trim()!==m||m.includes("/")||m.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(m);function yg(m){"@babel/helpers - typeof";return yg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},yg(m)}function lw(m,h){if(yg(m)!="object"||!m)return m;var _=m[Symbol.toPrimitive];if(_!==void 0){var S=_.call(m,h);if(yg(S)!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(m)}function cw(m){var h=lw(m,"string");return yg(h)=="symbol"?h:h+""}function uw(m,h,_){return(h=cw(h))in m?Object.defineProperty(m,h,{value:_,enumerable:!0,configurable:!0,writable:!0}):m[h]=_,m}function s0(m,h){var _=Object.keys(m);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(m);h&&(S=S.filter(function(k){return Object.getOwnPropertyDescriptor(m,k).enumerable})),_.push.apply(_,S)}return _}function bs(m){for(var h=1;h<arguments.length;h++){var _=arguments[h]!=null?arguments[h]:{};h%2?s0(Object(_),!0).forEach(function(S){uw(m,S,_[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):s0(Object(_)).forEach(function(S){Object.defineProperty(m,S,Object.getOwnPropertyDescriptor(_,S))})}return m}const r0=m=>{var h;return m.msg||m.message||m.error_description||(typeof m.error=="string"?m.error:(h=m.error)===null||h===void 0?void 0:h.message)||JSON.stringify(m)},dw=async(m,h,_,S)=>{if(m&&typeof m=="object"&&"status"in m&&"ok"in m&&typeof m.status=="number"&&!_?.noResolveJson){const k=m,P=k.status||500;if(typeof k.json=="function")k.json().then(T=>{const c=T?.statusCode||T?.code||P+"";h(new Oy(r0(T),P,c,S))}).catch(()=>{if(S==="vectors"){const T=P+"";h(new Oy(k.statusText||`HTTP ${P} error`,P,T,S))}else{const T=P+"";h(new Oy(k.statusText||`HTTP ${P} error`,P,T,S))}});else{const T=P+"";h(new Oy(k.statusText||`HTTP ${P} error`,P,T,S))}}else h(new J0(r0(m),m,S))},hw=(m,h,_,S)=>{const k={method:m,headers:h?.headers||{}};return m==="GET"||m==="HEAD"||!S?bs(bs({},k),_):(nw(S)?(k.headers=bs({"Content-Type":"application/json"},h?.headers),k.body=JSON.stringify(S)):k.body=S,h?.duplex&&(k.duplex=h.duplex),bs(bs({},k),_))};async function og(m,h,_,S,k,P,T){return new Promise((c,O)=>{m(_,hw(h,S,k,P)).then(F=>{if(!F.ok)throw F;if(S?.noResolveJson)return F;if(T==="vectors"){const re=F.headers.get("content-type");if(F.headers.get("content-length")==="0"||F.status===204)return{};if(!re||!re.includes("application/json"))return{}}return F.json()}).then(F=>c(F)).catch(F=>dw(F,O,S,T))})}function Q0(m="storage"){return{get:async(h,_,S,k)=>og(h,"GET",_,S,k,void 0,m),post:async(h,_,S,k,P)=>og(h,"POST",_,k,P,S,m),put:async(h,_,S,k,P)=>og(h,"PUT",_,k,P,S,m),head:async(h,_,S,k)=>og(h,"HEAD",_,bs(bs({},S),{},{noResolveJson:!0}),k,void 0,m),remove:async(h,_,S,k,P)=>og(h,"DELETE",_,k,P,S,m)}}const fw=Q0("storage"),{get:xg,post:ec,put:Qx,head:pw,remove:g_}=fw,ko=Q0("vectors");var tm=class{constructor(m,h={},_,S="storage"){this.shouldThrowOnError=!1,this.url=m,this.headers=h,this.fetch=aw(_),this.namespace=S}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(m){var h=this;try{return{data:await m(),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(ix(_))return{data:null,error:_};throw _}}},mw=class{constructor(m,h){this.downloadFn=m,this.shouldThrowOnError=h}then(m,h){return this.execute().then(m,h)}async execute(){var m=this;try{return{data:(await m.downloadFn()).body,error:null}}catch(h){if(m.shouldThrowOnError)throw h;if(ix(h))return{data:null,error:h};throw h}}};let ev;ev=Symbol.toStringTag;var gw=class{constructor(m,h){this.downloadFn=m,this.shouldThrowOnError=h,this[ev]="BlobDownloadBuilder",this.promise=null}asStream(){return new mw(this.downloadFn,this.shouldThrowOnError)}then(m,h){return this.getPromise().then(m,h)}catch(m){return this.getPromise().catch(m)}finally(m){return this.getPromise().finally(m)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var m=this;try{return{data:await(await m.downloadFn()).blob(),error:null}}catch(h){if(m.shouldThrowOnError)throw h;if(ix(h))return{data:null,error:h};throw h}}};const yw={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},i0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var xw=class extends tm{constructor(m,h={},_,S){super(m,h,S,"storage"),this.bucketId=_}async uploadOrUpdate(m,h,_,S){var k=this;return k.handleOperation(async()=>{let P;const T=bs(bs({},i0),S);let c=bs(bs({},k.headers),m==="POST"&&{"x-upsert":String(T.upsert)});const O=T.metadata;typeof Blob<"u"&&_ instanceof Blob?(P=new FormData,P.append("cacheControl",T.cacheControl),O&&P.append("metadata",k.encodeMetadata(O)),P.append("",_)):typeof FormData<"u"&&_ instanceof FormData?(P=_,P.has("cacheControl")||P.append("cacheControl",T.cacheControl),O&&!P.has("metadata")&&P.append("metadata",k.encodeMetadata(O))):(P=_,c["cache-control"]=`max-age=${T.cacheControl}`,c["content-type"]=T.contentType,O&&(c["x-metadata"]=k.toBase64(k.encodeMetadata(O))),(typeof ReadableStream<"u"&&P instanceof ReadableStream||P&&typeof P=="object"&&"pipe"in P&&typeof P.pipe=="function")&&!T.duplex&&(T.duplex="half")),S?.headers&&(c=bs(bs({},c),S.headers));const F=k._removeEmptyFolders(h),re=k._getFinalPath(F),se=await(m=="PUT"?Qx:ec)(k.fetch,`${k.url}/object/${re}`,P,bs({headers:c},T?.duplex?{duplex:T.duplex}:{}));return{path:F,id:se.Id,fullPath:se.Key}})}async upload(m,h,_){return this.uploadOrUpdate("POST",m,h,_)}async uploadToSignedUrl(m,h,_,S){var k=this;const P=k._removeEmptyFolders(m),T=k._getFinalPath(P),c=new URL(k.url+`/object/upload/sign/${T}`);return c.searchParams.set("token",h),k.handleOperation(async()=>{let O;const F=bs({upsert:i0.upsert},S),re=bs(bs({},k.headers),{"x-upsert":String(F.upsert)});return typeof Blob<"u"&&_ instanceof Blob?(O=new FormData,O.append("cacheControl",F.cacheControl),O.append("",_)):typeof FormData<"u"&&_ instanceof FormData?(O=_,O.append("cacheControl",F.cacheControl)):(O=_,re["cache-control"]=`max-age=${F.cacheControl}`,re["content-type"]=F.contentType),{path:P,fullPath:(await Qx(k.fetch,c.toString(),O,{headers:re})).Key}})}async createSignedUploadUrl(m,h){var _=this;return _.handleOperation(async()=>{let S=_._getFinalPath(m);const k=bs({},_.headers);h?.upsert&&(k["x-upsert"]="true");const P=await ec(_.fetch,`${_.url}/object/upload/sign/${S}`,{},{headers:k}),T=new URL(_.url+P.url),c=T.searchParams.get("token");if(!c)throw new rx("No token returned by API");return{signedUrl:T.toString(),path:m,token:c}})}async update(m,h,_){return this.uploadOrUpdate("PUT",m,h,_)}async move(m,h,_){var S=this;return S.handleOperation(async()=>await ec(S.fetch,`${S.url}/object/move`,{bucketId:S.bucketId,sourceKey:m,destinationKey:h,destinationBucket:_?.destinationBucket},{headers:S.headers}))}async copy(m,h,_){var S=this;return S.handleOperation(async()=>({path:(await ec(S.fetch,`${S.url}/object/copy`,{bucketId:S.bucketId,sourceKey:m,destinationKey:h,destinationBucket:_?.destinationBucket},{headers:S.headers})).Key}))}async createSignedUrl(m,h,_){var S=this;return S.handleOperation(async()=>{let k=S._getFinalPath(m),P=await ec(S.fetch,`${S.url}/object/sign/${k}`,bs({expiresIn:h},_?.transform?{transform:_.transform}:{}),{headers:S.headers});const T=_?.download?`&download=${_.download===!0?"":_.download}`:"";return{signedUrl:encodeURI(`${S.url}${P.signedURL}${T}`)}})}async createSignedUrls(m,h,_){var S=this;return S.handleOperation(async()=>{const k=await ec(S.fetch,`${S.url}/object/sign/${S.bucketId}`,{expiresIn:h,paths:m},{headers:S.headers}),P=_?.download?`&download=${_.download===!0?"":_.download}`:"";return k.map(T=>bs(bs({},T),{},{signedUrl:T.signedURL?encodeURI(`${S.url}${T.signedURL}${P}`):null}))})}download(m,h,_){const S=typeof h?.transform<"u"?"render/image/authenticated":"object",k=this.transformOptsToQueryString(h?.transform||{}),P=k?`?${k}`:"",T=this._getFinalPath(m),c=()=>xg(this.fetch,`${this.url}/${S}/${T}${P}`,{headers:this.headers,noResolveJson:!0},_);return new gw(c,this.shouldThrowOnError)}async info(m){var h=this;const _=h._getFinalPath(m);return h.handleOperation(async()=>Jx(await xg(h.fetch,`${h.url}/object/info/${_}`,{headers:h.headers})))}async exists(m){var h=this;const _=h._getFinalPath(m);try{return await pw(h.fetch,`${h.url}/object/${_}`,{headers:h.headers}),{data:!0,error:null}}catch(S){if(h.shouldThrowOnError)throw S;if(ix(S)&&S instanceof J0){const k=S.originalError;if([400,404].includes(k?.status))return{data:!1,error:S}}throw S}}getPublicUrl(m,h){const _=this._getFinalPath(m),S=[],k=h?.download?`download=${h.download===!0?"":h.download}`:"";k!==""&&S.push(k);const P=typeof h?.transform<"u"?"render/image":"object",T=this.transformOptsToQueryString(h?.transform||{});T!==""&&S.push(T);let c=S.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${P}/public/${_}${c}`)}}}async remove(m){var h=this;return h.handleOperation(async()=>await g_(h.fetch,`${h.url}/object/${h.bucketId}`,{prefixes:m},{headers:h.headers}))}async list(m,h,_){var S=this;return S.handleOperation(async()=>{const k=bs(bs(bs({},yw),h),{},{prefix:m||""});return await ec(S.fetch,`${S.url}/object/list/${S.bucketId}`,k,{headers:S.headers},_)})}async listV2(m,h){var _=this;return _.handleOperation(async()=>{const S=bs({},m);return await ec(_.fetch,`${_.url}/object/list-v2/${_.bucketId}`,S,{headers:_.headers},h)})}encodeMetadata(m){return JSON.stringify(m)}toBase64(m){return typeof Buffer<"u"?Buffer.from(m).toString("base64"):btoa(m)}_getFinalPath(m){return`${this.bucketId}/${m.replace(/^\/+/,"")}`}_removeEmptyFolders(m){return m.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(m){const h=[];return m.width&&h.push(`width=${m.width}`),m.height&&h.push(`height=${m.height}`),m.resize&&h.push(`resize=${m.resize}`),m.format&&h.push(`format=${m.format}`),m.quality&&h.push(`quality=${m.quality}`),h.join("&")}};const _w="2.95.3",Ng={"X-Client-Info":`storage-js/${_w}`};var vw=class extends tm{constructor(m,h={},_,S){const k=new URL(m);S?.useNewHostname&&/supabase\.(co|in|red)$/.test(k.hostname)&&!k.hostname.includes("storage.supabase.")&&(k.hostname=k.hostname.replace("supabase.","storage.supabase."));const P=k.href.replace(/\/$/,""),T=bs(bs({},Ng),h);super(P,T,_,"storage")}async listBuckets(m){var h=this;return h.handleOperation(async()=>{const _=h.listBucketOptionsToQueryString(m);return await xg(h.fetch,`${h.url}/bucket${_}`,{headers:h.headers})})}async getBucket(m){var h=this;return h.handleOperation(async()=>await xg(h.fetch,`${h.url}/bucket/${m}`,{headers:h.headers}))}async createBucket(m,h={public:!1}){var _=this;return _.handleOperation(async()=>await ec(_.fetch,`${_.url}/bucket`,{id:m,name:m,type:h.type,public:h.public,file_size_limit:h.fileSizeLimit,allowed_mime_types:h.allowedMimeTypes},{headers:_.headers}))}async updateBucket(m,h){var _=this;return _.handleOperation(async()=>await Qx(_.fetch,`${_.url}/bucket/${m}`,{id:m,name:m,public:h.public,file_size_limit:h.fileSizeLimit,allowed_mime_types:h.allowedMimeTypes},{headers:_.headers}))}async emptyBucket(m){var h=this;return h.handleOperation(async()=>await ec(h.fetch,`${h.url}/bucket/${m}/empty`,{},{headers:h.headers}))}async deleteBucket(m){var h=this;return h.handleOperation(async()=>await g_(h.fetch,`${h.url}/bucket/${m}`,{},{headers:h.headers}))}listBucketOptionsToQueryString(m){const h={};return m&&("limit"in m&&(h.limit=String(m.limit)),"offset"in m&&(h.offset=String(m.offset)),m.search&&(h.search=m.search),m.sortColumn&&(h.sortColumn=m.sortColumn),m.sortOrder&&(h.sortOrder=m.sortOrder)),Object.keys(h).length>0?"?"+new URLSearchParams(h).toString():""}},bw=class extends tm{constructor(m,h={},_){const S=m.replace(/\/$/,""),k=bs(bs({},Ng),h);super(S,k,_,"storage")}async createBucket(m){var h=this;return h.handleOperation(async()=>await ec(h.fetch,`${h.url}/bucket`,{name:m},{headers:h.headers}))}async listBuckets(m){var h=this;return h.handleOperation(async()=>{const _=new URLSearchParams;m?.limit!==void 0&&_.set("limit",m.limit.toString()),m?.offset!==void 0&&_.set("offset",m.offset.toString()),m?.sortColumn&&_.set("sortColumn",m.sortColumn),m?.sortOrder&&_.set("sortOrder",m.sortOrder),m?.search&&_.set("search",m.search);const S=_.toString(),k=S?`${h.url}/bucket?${S}`:`${h.url}/bucket`;return await xg(h.fetch,k,{headers:h.headers})})}async deleteBucket(m){var h=this;return h.handleOperation(async()=>await g_(h.fetch,`${h.url}/bucket/${m}`,{},{headers:h.headers}))}from(m){var h=this;if(!ow(m))throw new rx("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const _=new iw({baseUrl:this.url,catalogName:m,auth:{type:"custom",getHeaders:async()=>h.headers},fetch:this.fetch}),S=this.shouldThrowOnError;return new Proxy(_,{get(k,P){const T=k[P];return typeof T!="function"?T:async(...c)=>{try{return{data:await T.apply(k,c),error:null}}catch(O){if(S)throw O;return{data:null,error:O}}}}})}},ww=class extends tm{constructor(m,h={},_){const S=m.replace(/\/$/,""),k=bs(bs({},Ng),{},{"Content-Type":"application/json"},h);super(S,k,_,"vectors")}async createIndex(m){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/CreateIndex`,m,{headers:h.headers})||{})}async getIndex(m,h){var _=this;return _.handleOperation(async()=>await ko.post(_.fetch,`${_.url}/GetIndex`,{vectorBucketName:m,indexName:h},{headers:_.headers}))}async listIndexes(m){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/ListIndexes`,m,{headers:h.headers}))}async deleteIndex(m,h){var _=this;return _.handleOperation(async()=>await ko.post(_.fetch,`${_.url}/DeleteIndex`,{vectorBucketName:m,indexName:h},{headers:_.headers})||{})}},Sw=class extends tm{constructor(m,h={},_){const S=m.replace(/\/$/,""),k=bs(bs({},Ng),{},{"Content-Type":"application/json"},h);super(S,k,_,"vectors")}async putVectors(m){var h=this;if(m.vectors.length<1||m.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/PutVectors`,m,{headers:h.headers})||{})}async getVectors(m){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/GetVectors`,m,{headers:h.headers}))}async listVectors(m){var h=this;if(m.segmentCount!==void 0){if(m.segmentCount<1||m.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(m.segmentIndex!==void 0&&(m.segmentIndex<0||m.segmentIndex>=m.segmentCount))throw new Error(`segmentIndex must be between 0 and ${m.segmentCount-1}`)}return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/ListVectors`,m,{headers:h.headers}))}async queryVectors(m){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/QueryVectors`,m,{headers:h.headers}))}async deleteVectors(m){var h=this;if(m.keys.length<1||m.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/DeleteVectors`,m,{headers:h.headers})||{})}},jw=class extends tm{constructor(m,h={},_){const S=m.replace(/\/$/,""),k=bs(bs({},Ng),{},{"Content-Type":"application/json"},h);super(S,k,_,"vectors")}async createBucket(m){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/CreateVectorBucket`,{vectorBucketName:m},{headers:h.headers})||{})}async getBucket(m){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/GetVectorBucket`,{vectorBucketName:m},{headers:h.headers}))}async listBuckets(m={}){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/ListVectorBuckets`,m,{headers:h.headers}))}async deleteBucket(m){var h=this;return h.handleOperation(async()=>await ko.post(h.fetch,`${h.url}/DeleteVectorBucket`,{vectorBucketName:m},{headers:h.headers})||{})}},Tw=class extends jw{constructor(m,h={}){super(m,h.headers||{},h.fetch)}from(m){return new Nw(this.url,this.headers,m,this.fetch)}async createBucket(m){var h=()=>super.createBucket,_=this;return h().call(_,m)}async getBucket(m){var h=()=>super.getBucket,_=this;return h().call(_,m)}async listBuckets(m={}){var h=()=>super.listBuckets,_=this;return h().call(_,m)}async deleteBucket(m){var h=()=>super.deleteBucket,_=this;return h().call(_,m)}},Nw=class extends ww{constructor(m,h,_,S){super(m,h,S),this.vectorBucketName=_}async createIndex(m){var h=()=>super.createIndex,_=this;return h().call(_,bs(bs({},m),{},{vectorBucketName:_.vectorBucketName}))}async listIndexes(m={}){var h=()=>super.listIndexes,_=this;return h().call(_,bs(bs({},m),{},{vectorBucketName:_.vectorBucketName}))}async getIndex(m){var h=()=>super.getIndex,_=this;return h().call(_,_.vectorBucketName,m)}async deleteIndex(m){var h=()=>super.deleteIndex,_=this;return h().call(_,_.vectorBucketName,m)}index(m){return new Ew(this.url,this.headers,this.vectorBucketName,m,this.fetch)}},Ew=class extends Sw{constructor(m,h,_,S,k){super(m,h,k),this.vectorBucketName=_,this.indexName=S}async putVectors(m){var h=()=>super.putVectors,_=this;return h().call(_,bs(bs({},m),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async getVectors(m){var h=()=>super.getVectors,_=this;return h().call(_,bs(bs({},m),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async listVectors(m={}){var h=()=>super.listVectors,_=this;return h().call(_,bs(bs({},m),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async queryVectors(m){var h=()=>super.queryVectors,_=this;return h().call(_,bs(bs({},m),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async deleteVectors(m){var h=()=>super.deleteVectors,_=this;return h().call(_,bs(bs({},m),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}},Cw=class extends vw{constructor(m,h={},_,S){super(m,h,_,S)}from(m){return new xw(this.url,this.headers,m,this.fetch)}get vectors(){return new Tw(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new bw(this.url+"/iceberg",this.headers,this.fetch)}};const tv="2.95.3",Yp=30*1e3,e_=3,Bx=e_*Yp,Aw="http://localhost:9999",kw="supabase.auth.token",Mw={"X-Client-Info":`gotrue-js/${tv}`},t_="X-Supabase-Api-Version",sv={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Pw=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Dw=600*1e3;class _g extends Error{constructor(h,_,S){super(h),this.__isAuthError=!0,this.name="AuthError",this.status=_,this.code=S}}function os(m){return typeof m=="object"&&m!==null&&"__isAuthError"in m}class Rw extends _g{constructor(h,_,S){super(h,_,S),this.name="AuthApiError",this.status=_,this.code=S}}function Iw(m){return os(m)&&m.name==="AuthApiError"}class df extends _g{constructor(h,_){super(h),this.name="AuthUnknownError",this.originalError=_}}class Yu extends _g{constructor(h,_,S,k){super(h,S,k),this.name=_,this.status=S}}class Ao extends Yu{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Fx(m){return os(m)&&m.name==="AuthSessionMissingError"}class Vp extends Yu{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ly extends Yu{constructor(h){super(h,"AuthInvalidCredentialsError",400,void 0)}}class By extends Yu{constructor(h,_=null){super(h,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=_}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function zw(m){return os(m)&&m.name==="AuthImplicitGrantRedirectError"}class a0 extends Yu{constructor(h,_=null){super(h,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=_}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ow extends Yu{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class s_ extends Yu{constructor(h,_){super(h,"AuthRetryableFetchError",_,void 0)}}function Ux(m){return os(m)&&m.name==="AuthRetryableFetchError"}class n0 extends Yu{constructor(h,_,S){super(h,"AuthWeakPasswordError",_,"weak_password"),this.reasons=S}}class r_ extends Yu{constructor(h){super(h,"AuthInvalidJwtError",400,"invalid_jwt")}}const Zy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),o0=` 	
\r=`.split(""),Lw=(()=>{const m=new Array(128);for(let h=0;h<m.length;h+=1)m[h]=-1;for(let h=0;h<o0.length;h+=1)m[o0[h].charCodeAt(0)]=-2;for(let h=0;h<Zy.length;h+=1)m[Zy[h].charCodeAt(0)]=h;return m})();function l0(m,h,_){if(m!==null)for(h.queue=h.queue<<8|m,h.queuedBits+=8;h.queuedBits>=6;){const S=h.queue>>h.queuedBits-6&63;_(Zy[S]),h.queuedBits-=6}else if(h.queuedBits>0)for(h.queue=h.queue<<6-h.queuedBits,h.queuedBits=6;h.queuedBits>=6;){const S=h.queue>>h.queuedBits-6&63;_(Zy[S]),h.queuedBits-=6}}function rv(m,h,_){const S=Lw[m];if(S>-1)for(h.queue=h.queue<<6|S,h.queuedBits+=6;h.queuedBits>=8;)_(h.queue>>h.queuedBits-8&255),h.queuedBits-=8;else{if(S===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(m)}"`)}}function c0(m){const h=[],_=T=>{h.push(String.fromCodePoint(T))},S={utf8seq:0,codepoint:0},k={queue:0,queuedBits:0},P=T=>{Uw(T,S,_)};for(let T=0;T<m.length;T+=1)rv(m.charCodeAt(T),k,P);return h.join("")}function Bw(m,h){if(m<=127){h(m);return}else if(m<=2047){h(192|m>>6),h(128|m&63);return}else if(m<=65535){h(224|m>>12),h(128|m>>6&63),h(128|m&63);return}else if(m<=1114111){h(240|m>>18),h(128|m>>12&63),h(128|m>>6&63),h(128|m&63);return}throw new Error(`Unrecognized Unicode codepoint: ${m.toString(16)}`)}function Fw(m,h){for(let _=0;_<m.length;_+=1){let S=m.charCodeAt(_);if(S>55295&&S<=56319){const k=(S-55296)*1024&65535;S=(m.charCodeAt(_+1)-56320&65535|k)+65536,_+=1}Bw(S,h)}}function Uw(m,h,_){if(h.utf8seq===0){if(m<=127){_(m);return}for(let S=1;S<6;S+=1)if((m>>7-S&1)===0){h.utf8seq=S;break}if(h.utf8seq===2)h.codepoint=m&31;else if(h.utf8seq===3)h.codepoint=m&15;else if(h.utf8seq===4)h.codepoint=m&7;else throw new Error("Invalid UTF-8 sequence");h.utf8seq-=1}else if(h.utf8seq>0){if(m<=127)throw new Error("Invalid UTF-8 sequence");h.codepoint=h.codepoint<<6|m&63,h.utf8seq-=1,h.utf8seq===0&&_(h.codepoint)}}function Jp(m){const h=[],_={queue:0,queuedBits:0},S=k=>{h.push(k)};for(let k=0;k<m.length;k+=1)rv(m.charCodeAt(k),_,S);return new Uint8Array(h)}function $w(m){const h=[];return Fw(m,_=>h.push(_)),new Uint8Array(h)}function hf(m){const h=[],_={queue:0,queuedBits:0},S=k=>{h.push(k)};return m.forEach(k=>l0(k,_,S)),l0(null,_,S),h.join("")}function Vw(m){return Math.round(Date.now()/1e3)+m}function qw(){return Symbol("auth-callback")}const Va=()=>typeof window<"u"&&typeof document<"u",of={tested:!1,writable:!1},iv=()=>{if(!Va())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(of.tested)return of.writable;const m=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(m,m),globalThis.localStorage.removeItem(m),of.tested=!0,of.writable=!0}catch{of.tested=!0,of.writable=!1}return of.writable};function Gw(m){const h={},_=new URL(m);if(_.hash&&_.hash[0]==="#")try{new URLSearchParams(_.hash.substring(1)).forEach((k,P)=>{h[P]=k})}catch{}return _.searchParams.forEach((S,k)=>{h[k]=S}),h}const av=m=>m?(...h)=>m(...h):(...h)=>fetch(...h),Hw=m=>typeof m=="object"&&m!==null&&"status"in m&&"ok"in m&&"json"in m&&typeof m.json=="function",Xp=async(m,h,_)=>{await m.setItem(h,JSON.stringify(_))},lf=async(m,h)=>{const _=await m.getItem(h);if(!_)return null;try{return JSON.parse(_)}catch{return _}},$a=async(m,h)=>{await m.removeItem(h)};class ax{constructor(){this.promise=new ax.promiseConstructor((h,_)=>{this.resolve=h,this.reject=_})}}ax.promiseConstructor=Promise;function Fy(m){const h=m.split(".");if(h.length!==3)throw new r_("Invalid JWT structure");for(let S=0;S<h.length;S++)if(!Pw.test(h[S]))throw new r_("JWT not in base64url format");return{header:JSON.parse(c0(h[0])),payload:JSON.parse(c0(h[1])),signature:Jp(h[2]),raw:{header:h[0],payload:h[1]}}}async function Zw(m){return await new Promise(h=>{setTimeout(()=>h(null),m)})}function Ww(m,h){return new Promise((S,k)=>{(async()=>{for(let P=0;P<1/0;P++)try{const T=await m(P);if(!h(P,null,T)){S(T);return}}catch(T){if(!h(P,T)){k(T);return}}})()})}function Yw(m){return("0"+m.toString(16)).substr(-2)}function Xw(){const h=new Uint32Array(56);if(typeof crypto>"u"){const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",S=_.length;let k="";for(let P=0;P<56;P++)k+=_.charAt(Math.floor(Math.random()*S));return k}return crypto.getRandomValues(h),Array.from(h,Yw).join("")}async function Kw(m){const _=new TextEncoder().encode(m),S=await crypto.subtle.digest("SHA-256",_),k=new Uint8Array(S);return Array.from(k).map(P=>String.fromCharCode(P)).join("")}async function Jw(m){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),m;const _=await Kw(m);return btoa(_).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function qp(m,h,_=!1){const S=Xw();let k=S;_&&(k+="/PASSWORD_RECOVERY"),await Xp(m,`${h}-code-verifier`,k);const P=await Jw(S);return[P,S===P?"plain":"s256"]}const Qw=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function e2(m){const h=m.headers.get(t_);if(!h||!h.match(Qw))return null;try{return new Date(`${h}T00:00:00.0Z`)}catch{return null}}function t2(m){if(!m)throw new Error("Missing exp claim");const h=Math.floor(Date.now()/1e3);if(m<=h)throw new Error("JWT has expired")}function s2(m){switch(m){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const r2=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Gp(m){if(!r2.test(m))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function $x(){const m={};return new Proxy(m,{get:(h,_)=>{if(_==="__isUserNotAvailableProxy")return!0;if(typeof _=="symbol"){const S=_.toString();if(S==="Symbol(Symbol.toPrimitive)"||S==="Symbol(Symbol.toStringTag)"||S==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${_}" property of the session object is not supported. Please use getUser() instead.`)},set:(h,_)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${_}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(h,_)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${_}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function i2(m,h){return new Proxy(m,{get:(_,S,k)=>{if(S==="__isInsecureUserWarningProxy")return!0;if(typeof S=="symbol"){const P=S.toString();if(P==="Symbol(Symbol.toPrimitive)"||P==="Symbol(Symbol.toStringTag)"||P==="Symbol(util.inspect.custom)"||P==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(_,S,k)}return!h.value&&typeof S=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),h.value=!0),Reflect.get(_,S,k)}})}function u0(m){return JSON.parse(JSON.stringify(m))}const cf=m=>m.msg||m.message||m.error_description||m.error||JSON.stringify(m),a2=[502,503,504];async function d0(m){var h;if(!Hw(m))throw new s_(cf(m),0);if(a2.includes(m.status))throw new s_(cf(m),m.status);let _;try{_=await m.json()}catch(P){throw new df(cf(P),P)}let S;const k=e2(m);if(k&&k.getTime()>=sv["2024-01-01"].timestamp&&typeof _=="object"&&_&&typeof _.code=="string"?S=_.code:typeof _=="object"&&_&&typeof _.error_code=="string"&&(S=_.error_code),S){if(S==="weak_password")throw new n0(cf(_),m.status,((h=_.weak_password)===null||h===void 0?void 0:h.reasons)||[]);if(S==="session_not_found")throw new Ao}else if(typeof _=="object"&&_&&typeof _.weak_password=="object"&&_.weak_password&&Array.isArray(_.weak_password.reasons)&&_.weak_password.reasons.length&&_.weak_password.reasons.reduce((P,T)=>P&&typeof T=="string",!0))throw new n0(cf(_),m.status,_.weak_password.reasons);throw new Rw(cf(_),m.status||500,S)}const n2=(m,h,_,S)=>{const k={method:m,headers:h?.headers||{}};return m==="GET"?k:(k.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},h?.headers),k.body=JSON.stringify(S),Object.assign(Object.assign({},k),_))};async function vs(m,h,_,S){var k;const P=Object.assign({},S?.headers);P[t_]||(P[t_]=sv["2024-01-01"].name),S?.jwt&&(P.Authorization=`Bearer ${S.jwt}`);const T=(k=S?.query)!==null&&k!==void 0?k:{};S?.redirectTo&&(T.redirect_to=S.redirectTo);const c=Object.keys(T).length?"?"+new URLSearchParams(T).toString():"",O=await o2(m,h,_+c,{headers:P,noResolveJson:S?.noResolveJson},{},S?.body);return S?.xform?S?.xform(O):{data:Object.assign({},O),error:null}}async function o2(m,h,_,S,k,P){const T=n2(h,S,k,P);let c;try{c=await m(_,Object.assign({},T))}catch(O){throw console.error(O),new s_(cf(O),0)}if(c.ok||await d0(c),S?.noResolveJson)return c;try{return await c.json()}catch(O){await d0(O)}}function Ql(m){var h;let _=null;u2(m)&&(_=Object.assign({},m),m.expires_at||(_.expires_at=Vw(m.expires_in)));const S=(h=m.user)!==null&&h!==void 0?h:m;return{data:{session:_,user:S},error:null}}function h0(m){const h=Ql(m);return!h.error&&m.weak_password&&typeof m.weak_password=="object"&&Array.isArray(m.weak_password.reasons)&&m.weak_password.reasons.length&&m.weak_password.message&&typeof m.weak_password.message=="string"&&m.weak_password.reasons.reduce((_,S)=>_&&typeof S=="string",!0)&&(h.data.weak_password=m.weak_password),h}function Zd(m){var h;return{data:{user:(h=m.user)!==null&&h!==void 0?h:m},error:null}}function l2(m){return{data:m,error:null}}function c2(m){const{action_link:h,email_otp:_,hashed_token:S,redirect_to:k,verification_type:P}=m,T=sx(m,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:h,email_otp:_,hashed_token:S,redirect_to:k,verification_type:P},O=Object.assign({},T);return{data:{properties:c,user:O},error:null}}function f0(m){return m}function u2(m){return m.access_token&&m.refresh_token&&m.expires_in}const Vx=["global","local","others"];class d2{constructor({url:h="",headers:_={},fetch:S}){this.url=h,this.headers=_,this.fetch=av(S),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(h,_=Vx[0]){if(Vx.indexOf(_)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Vx.join(", ")}`);try{return await vs(this.fetch,"POST",`${this.url}/logout?scope=${_}`,{headers:this.headers,jwt:h,noResolveJson:!0}),{data:null,error:null}}catch(S){if(os(S))return{data:null,error:S};throw S}}async inviteUserByEmail(h,_={}){try{return await vs(this.fetch,"POST",`${this.url}/invite`,{body:{email:h,data:_.data},headers:this.headers,redirectTo:_.redirectTo,xform:Zd})}catch(S){if(os(S))return{data:{user:null},error:S};throw S}}async generateLink(h){try{const{options:_}=h,S=sx(h,["options"]),k=Object.assign(Object.assign({},S),_);return"newEmail"in S&&(k.new_email=S?.newEmail,delete k.newEmail),await vs(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:k,headers:this.headers,xform:c2,redirectTo:_?.redirectTo})}catch(_){if(os(_))return{data:{properties:null,user:null},error:_};throw _}}async createUser(h){try{return await vs(this.fetch,"POST",`${this.url}/admin/users`,{body:h,headers:this.headers,xform:Zd})}catch(_){if(os(_))return{data:{user:null},error:_};throw _}}async listUsers(h){var _,S,k,P,T,c,O;try{const F={nextPage:null,lastPage:0,total:0},re=await vs(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(S=(_=h?.page)===null||_===void 0?void 0:_.toString())!==null&&S!==void 0?S:"",per_page:(P=(k=h?.perPage)===null||k===void 0?void 0:k.toString())!==null&&P!==void 0?P:""},xform:f0});if(re.error)throw re.error;const se=await re.json(),ue=(T=re.headers.get("x-total-count"))!==null&&T!==void 0?T:0,ae=(O=(c=re.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&O!==void 0?O:[];return ae.length>0&&(ae.forEach(Q=>{const Y=parseInt(Q.split(";")[0].split("=")[1].substring(0,1)),G=JSON.parse(Q.split(";")[1].split("=")[1]);F[`${G}Page`]=Y}),F.total=parseInt(ue)),{data:Object.assign(Object.assign({},se),F),error:null}}catch(F){if(os(F))return{data:{users:[]},error:F};throw F}}async getUserById(h){Gp(h);try{return await vs(this.fetch,"GET",`${this.url}/admin/users/${h}`,{headers:this.headers,xform:Zd})}catch(_){if(os(_))return{data:{user:null},error:_};throw _}}async updateUserById(h,_){Gp(h);try{return await vs(this.fetch,"PUT",`${this.url}/admin/users/${h}`,{body:_,headers:this.headers,xform:Zd})}catch(S){if(os(S))return{data:{user:null},error:S};throw S}}async deleteUser(h,_=!1){Gp(h);try{return await vs(this.fetch,"DELETE",`${this.url}/admin/users/${h}`,{headers:this.headers,body:{should_soft_delete:_},xform:Zd})}catch(S){if(os(S))return{data:{user:null},error:S};throw S}}async _listFactors(h){Gp(h.userId);try{const{data:_,error:S}=await vs(this.fetch,"GET",`${this.url}/admin/users/${h.userId}/factors`,{headers:this.headers,xform:k=>({data:{factors:k},error:null})});return{data:_,error:S}}catch(_){if(os(_))return{data:null,error:_};throw _}}async _deleteFactor(h){Gp(h.userId),Gp(h.id);try{return{data:await vs(this.fetch,"DELETE",`${this.url}/admin/users/${h.userId}/factors/${h.id}`,{headers:this.headers}),error:null}}catch(_){if(os(_))return{data:null,error:_};throw _}}async _listOAuthClients(h){var _,S,k,P,T,c,O;try{const F={nextPage:null,lastPage:0,total:0},re=await vs(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(S=(_=h?.page)===null||_===void 0?void 0:_.toString())!==null&&S!==void 0?S:"",per_page:(P=(k=h?.perPage)===null||k===void 0?void 0:k.toString())!==null&&P!==void 0?P:""},xform:f0});if(re.error)throw re.error;const se=await re.json(),ue=(T=re.headers.get("x-total-count"))!==null&&T!==void 0?T:0,ae=(O=(c=re.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&O!==void 0?O:[];return ae.length>0&&(ae.forEach(Q=>{const Y=parseInt(Q.split(";")[0].split("=")[1].substring(0,1)),G=JSON.parse(Q.split(";")[1].split("=")[1]);F[`${G}Page`]=Y}),F.total=parseInt(ue)),{data:Object.assign(Object.assign({},se),F),error:null}}catch(F){if(os(F))return{data:{clients:[]},error:F};throw F}}async _createOAuthClient(h){try{return await vs(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:h,headers:this.headers,xform:_=>({data:_,error:null})})}catch(_){if(os(_))return{data:null,error:_};throw _}}async _getOAuthClient(h){try{return await vs(this.fetch,"GET",`${this.url}/admin/oauth/clients/${h}`,{headers:this.headers,xform:_=>({data:_,error:null})})}catch(_){if(os(_))return{data:null,error:_};throw _}}async _updateOAuthClient(h,_){try{return await vs(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${h}`,{body:_,headers:this.headers,xform:S=>({data:S,error:null})})}catch(S){if(os(S))return{data:null,error:S};throw S}}async _deleteOAuthClient(h){try{return await vs(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${h}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(_){if(os(_))return{data:null,error:_};throw _}}async _regenerateOAuthClientSecret(h){try{return await vs(this.fetch,"POST",`${this.url}/admin/oauth/clients/${h}/regenerate_secret`,{headers:this.headers,xform:_=>({data:_,error:null})})}catch(_){if(os(_))return{data:null,error:_};throw _}}}function p0(m={}){return{getItem:h=>m[h]||null,setItem:(h,_)=>{m[h]=_},removeItem:h=>{delete m[h]}}}const Hp={debug:!!(globalThis&&iv()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class nv extends Error{constructor(h){super(h),this.isAcquireTimeout=!0}}class h2 extends nv{}async function f2(m,h,_){Hp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",m,h);const S=new globalThis.AbortController;return h>0&&setTimeout(()=>{S.abort(),Hp.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",m)},h),await Promise.resolve().then(()=>globalThis.navigator.locks.request(m,h===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:S.signal},async k=>{if(k){Hp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",m,k.name);try{return await _()}finally{Hp.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",m,k.name)}}else{if(h===0)throw Hp.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",m),new h2(`Acquiring an exclusive Navigator LockManager lock "${m}" immediately failed`);if(Hp.debug)try{const P=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(P,null,"  "))}catch(P){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",P)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await _()}}))}function p2(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function ov(m){if(!/^0x[a-fA-F0-9]{40}$/.test(m))throw new Error(`@supabase/auth-js: Address "${m}" is invalid.`);return m.toLowerCase()}function m2(m){return parseInt(m,16)}function g2(m){const h=new TextEncoder().encode(m);return"0x"+Array.from(h,S=>S.toString(16).padStart(2,"0")).join("")}function y2(m){var h;const{chainId:_,domain:S,expirationTime:k,issuedAt:P=new Date,nonce:T,notBefore:c,requestId:O,resources:F,scheme:re,uri:se,version:ue}=m;{if(!Number.isInteger(_))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${_}`);if(!S)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(T&&T.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${T}`);if(!se)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(ue!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${ue}`);if(!((h=m.statement)===null||h===void 0)&&h.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${m.statement}`)}const ae=ov(m.address),Q=re?`${re}://${S}`:S,Y=m.statement?`${m.statement}
`:"",G=`${Q} wants you to sign in with your Ethereum account:
${ae}

${Y}`;let pe=`URI: ${se}
Version: ${ue}
Chain ID: ${_}${T?`
Nonce: ${T}`:""}
Issued At: ${P.toISOString()}`;if(k&&(pe+=`
Expiration Time: ${k.toISOString()}`),c&&(pe+=`
Not Before: ${c.toISOString()}`),O&&(pe+=`
Request ID: ${O}`),F){let _e=`
Resources:`;for(const Ne of F){if(!Ne||typeof Ne!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Ne}`);_e+=`
- ${Ne}`}pe+=_e}return`${G}
${pe}`}class qi extends Error{constructor({message:h,code:_,cause:S,name:k}){var P;super(h,{cause:S}),this.__isWebAuthnError=!0,this.name=(P=k??(S instanceof Error?S.name:void 0))!==null&&P!==void 0?P:"Unknown Error",this.code=_}}class Wy extends qi{constructor(h,_){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:_,message:h}),this.name="WebAuthnUnknownError",this.originalError=_}}function x2({error:m,options:h}){var _,S,k;const{publicKey:P}=h;if(!P)throw Error("options was missing required publicKey property");if(m.name==="AbortError"){if(h.signal instanceof AbortSignal)return new qi({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:m})}else if(m.name==="ConstraintError"){if(((_=P.authenticatorSelection)===null||_===void 0?void 0:_.requireResidentKey)===!0)return new qi({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:m});if(h.mediation==="conditional"&&((S=P.authenticatorSelection)===null||S===void 0?void 0:S.userVerification)==="required")return new qi({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:m});if(((k=P.authenticatorSelection)===null||k===void 0?void 0:k.userVerification)==="required")return new qi({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:m})}else{if(m.name==="InvalidStateError")return new qi({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:m});if(m.name==="NotAllowedError")return new qi({message:m.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:m});if(m.name==="NotSupportedError")return P.pubKeyCredParams.filter(c=>c.type==="public-key").length===0?new qi({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:m}):new qi({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:m});if(m.name==="SecurityError"){const T=window.location.hostname;if(lv(T)){if(P.rp.id!==T)return new qi({message:`The RP ID "${P.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:m})}else return new qi({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:m})}else if(m.name==="TypeError"){if(P.user.id.byteLength<1||P.user.id.byteLength>64)return new qi({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:m})}else if(m.name==="UnknownError")return new qi({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:m})}return new qi({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:m})}function _2({error:m,options:h}){const{publicKey:_}=h;if(!_)throw Error("options was missing required publicKey property");if(m.name==="AbortError"){if(h.signal instanceof AbortSignal)return new qi({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:m})}else{if(m.name==="NotAllowedError")return new qi({message:m.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:m});if(m.name==="SecurityError"){const S=window.location.hostname;if(lv(S)){if(_.rpId!==S)return new qi({message:`The RP ID "${_.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:m})}else return new qi({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:m})}else if(m.name==="UnknownError")return new qi({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:m})}return new qi({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:m})}class v2{createNewAbortSignal(){if(this.controller){const _=new Error("Cancelling existing WebAuthn API call for new one");_.name="AbortError",this.controller.abort(_)}const h=new AbortController;return this.controller=h,h.signal}cancelCeremony(){if(this.controller){const h=new Error("Manually cancelling existing WebAuthn API call");h.name="AbortError",this.controller.abort(h),this.controller=void 0}}}const b2=new v2;function w2(m){if(!m)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(m);const{challenge:h,user:_,excludeCredentials:S}=m,k=sx(m,["challenge","user","excludeCredentials"]),P=Jp(h).buffer,T=Object.assign(Object.assign({},_),{id:Jp(_.id).buffer}),c=Object.assign(Object.assign({},k),{challenge:P,user:T});if(S&&S.length>0){c.excludeCredentials=new Array(S.length);for(let O=0;O<S.length;O++){const F=S[O];c.excludeCredentials[O]=Object.assign(Object.assign({},F),{id:Jp(F.id).buffer,type:F.type||"public-key",transports:F.transports})}}return c}function S2(m){if(!m)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(m);const{challenge:h,allowCredentials:_}=m,S=sx(m,["challenge","allowCredentials"]),k=Jp(h).buffer,P=Object.assign(Object.assign({},S),{challenge:k});if(_&&_.length>0){P.allowCredentials=new Array(_.length);for(let T=0;T<_.length;T++){const c=_[T];P.allowCredentials[T]=Object.assign(Object.assign({},c),{id:Jp(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return P}function j2(m){var h;if("toJSON"in m&&typeof m.toJSON=="function")return m.toJSON();const _=m;return{id:m.id,rawId:m.id,response:{attestationObject:hf(new Uint8Array(m.response.attestationObject)),clientDataJSON:hf(new Uint8Array(m.response.clientDataJSON))},type:"public-key",clientExtensionResults:m.getClientExtensionResults(),authenticatorAttachment:(h=_.authenticatorAttachment)!==null&&h!==void 0?h:void 0}}function T2(m){var h;if("toJSON"in m&&typeof m.toJSON=="function")return m.toJSON();const _=m,S=m.getClientExtensionResults(),k=m.response;return{id:m.id,rawId:m.id,response:{authenticatorData:hf(new Uint8Array(k.authenticatorData)),clientDataJSON:hf(new Uint8Array(k.clientDataJSON)),signature:hf(new Uint8Array(k.signature)),userHandle:k.userHandle?hf(new Uint8Array(k.userHandle)):void 0},type:"public-key",clientExtensionResults:S,authenticatorAttachment:(h=_.authenticatorAttachment)!==null&&h!==void 0?h:void 0}}function lv(m){return m==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(m)}function m0(){var m,h;return!!(Va()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((m=navigator?.credentials)===null||m===void 0?void 0:m.create)=="function"&&typeof((h=navigator?.credentials)===null||h===void 0?void 0:h.get)=="function")}async function N2(m){try{const h=await navigator.credentials.create(m);return h?h instanceof PublicKeyCredential?{data:h,error:null}:{data:null,error:new Wy("Browser returned unexpected credential type",h)}:{data:null,error:new Wy("Empty credential response",h)}}catch(h){return{data:null,error:x2({error:h,options:m})}}}async function E2(m){try{const h=await navigator.credentials.get(m);return h?h instanceof PublicKeyCredential?{data:h,error:null}:{data:null,error:new Wy("Browser returned unexpected credential type",h)}:{data:null,error:new Wy("Empty credential response",h)}}catch(h){return{data:null,error:_2({error:h,options:m})}}}const C2={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},A2={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Yy(...m){const h=k=>k!==null&&typeof k=="object"&&!Array.isArray(k),_=k=>k instanceof ArrayBuffer||ArrayBuffer.isView(k),S={};for(const k of m)if(k)for(const P in k){const T=k[P];if(T!==void 0)if(Array.isArray(T))S[P]=T;else if(_(T))S[P]=T;else if(h(T)){const c=S[P];h(c)?S[P]=Yy(c,T):S[P]=Yy(T)}else S[P]=T}return S}function k2(m,h){return Yy(C2,m,h||{})}function M2(m,h){return Yy(A2,m,h||{})}class P2{constructor(h){this.client=h,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(h){return this.client.mfa.enroll(Object.assign(Object.assign({},h),{factorType:"webauthn"}))}async _challenge({factorId:h,webauthn:_,friendlyName:S,signal:k},P){var T;try{const{data:c,error:O}=await this.client.mfa.challenge({factorId:h,webauthn:_});if(!c)return{data:null,error:O};const F=k??b2.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:re}=c.webauthn.credential_options.publicKey;if(!re.name){const se=S;if(se)re.name=`${re.id}:${se}`;else{const ae=(await this.client.getUser()).data.user,Q=((T=ae?.user_metadata)===null||T===void 0?void 0:T.name)||ae?.email||ae?.id||"User";re.name=`${re.id}:${Q}`}}re.displayName||(re.displayName=re.name)}switch(c.webauthn.type){case"create":{const re=k2(c.webauthn.credential_options.publicKey,P?.create),{data:se,error:ue}=await N2({publicKey:re,signal:F});return se?{data:{factorId:h,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:se}},error:null}:{data:null,error:ue}}case"request":{const re=M2(c.webauthn.credential_options.publicKey,P?.request),{data:se,error:ue}=await E2(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:re,signal:F}));return se?{data:{factorId:h,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:se}},error:null}:{data:null,error:ue}}}}catch(c){return os(c)?{data:null,error:c}:{data:null,error:new df("Unexpected error in challenge",c)}}}async _verify({challengeId:h,factorId:_,webauthn:S}){return this.client.mfa.verify({factorId:_,challengeId:h,webauthn:S})}async _authenticate({factorId:h,webauthn:{rpId:_=typeof window<"u"?window.location.hostname:void 0,rpOrigins:S=typeof window<"u"?[window.location.origin]:void 0,signal:k}={}},P){if(!_)return{data:null,error:new _g("rpId is required for WebAuthn authentication")};try{if(!m0())return{data:null,error:new df("Browser does not support WebAuthn",null)};const{data:T,error:c}=await this.challenge({factorId:h,webauthn:{rpId:_,rpOrigins:S},signal:k},{request:P});if(!T)return{data:null,error:c};const{webauthn:O}=T;return this._verify({factorId:h,challengeId:T.challengeId,webauthn:{type:O.type,rpId:_,rpOrigins:S,credential_response:O.credential_response}})}catch(T){return os(T)?{data:null,error:T}:{data:null,error:new df("Unexpected error in authenticate",T)}}}async _register({friendlyName:h,webauthn:{rpId:_=typeof window<"u"?window.location.hostname:void 0,rpOrigins:S=typeof window<"u"?[window.location.origin]:void 0,signal:k}={}},P){if(!_)return{data:null,error:new _g("rpId is required for WebAuthn registration")};try{if(!m0())return{data:null,error:new df("Browser does not support WebAuthn",null)};const{data:T,error:c}=await this._enroll({friendlyName:h});if(!T)return await this.client.mfa.listFactors().then(re=>{var se;return(se=re.data)===null||se===void 0?void 0:se.all.find(ue=>ue.factor_type==="webauthn"&&ue.friendly_name===h&&ue.status!=="unverified")}).then(re=>re?this.client.mfa.unenroll({factorId:re?.id}):void 0),{data:null,error:c};const{data:O,error:F}=await this._challenge({factorId:T.id,friendlyName:T.friendly_name,webauthn:{rpId:_,rpOrigins:S},signal:k},{create:P});return O?this._verify({factorId:T.id,challengeId:O.challengeId,webauthn:{rpId:_,rpOrigins:S,type:O.webauthn.type,credential_response:O.webauthn.credential_response}}):{data:null,error:F}}catch(T){return os(T)?{data:null,error:T}:{data:null,error:new df("Unexpected error in register",T)}}}}p2();const D2={url:Aw,storageKey:kw,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Mw,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function g0(m,h,_){return await _()}const Zp={};class vg{get jwks(){var h,_;return(_=(h=Zp[this.storageKey])===null||h===void 0?void 0:h.jwks)!==null&&_!==void 0?_:{keys:[]}}set jwks(h){Zp[this.storageKey]=Object.assign(Object.assign({},Zp[this.storageKey]),{jwks:h})}get jwks_cached_at(){var h,_;return(_=(h=Zp[this.storageKey])===null||h===void 0?void 0:h.cachedAt)!==null&&_!==void 0?_:Number.MIN_SAFE_INTEGER}set jwks_cached_at(h){Zp[this.storageKey]=Object.assign(Object.assign({},Zp[this.storageKey]),{cachedAt:h})}constructor(h){var _,S,k;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const P=Object.assign(Object.assign({},D2),h);if(this.storageKey=P.storageKey,this.instanceID=(_=vg.nextInstanceID[this.storageKey])!==null&&_!==void 0?_:0,vg.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!P.debug,typeof P.debug=="function"&&(this.logger=P.debug),this.instanceID>0&&Va()){const T=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(T),this.logDebugMessages&&console.trace(T)}if(this.persistSession=P.persistSession,this.autoRefreshToken=P.autoRefreshToken,this.admin=new d2({url:P.url,headers:P.headers,fetch:P.fetch}),this.url=P.url,this.headers=P.headers,this.fetch=av(P.fetch),this.lock=P.lock||g0,this.detectSessionInUrl=P.detectSessionInUrl,this.flowType=P.flowType,this.hasCustomAuthorizationHeader=P.hasCustomAuthorizationHeader,this.throwOnError=P.throwOnError,this.lockAcquireTimeout=P.lockAcquireTimeout,P.lock?this.lock=P.lock:this.persistSession&&Va()&&(!((S=globalThis?.navigator)===null||S===void 0)&&S.locks)?this.lock=f2:this.lock=g0,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new P2(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(P.storage?this.storage=P.storage:iv()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=p0(this.memoryStorage)),P.userStorage&&(this.userStorage=P.userStorage)):(this.memoryStorage={},this.storage=p0(this.memoryStorage)),Va()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(T){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",T)}(k=this.broadcastChannel)===null||k===void 0||k.addEventListener("message",async T=>{this._debug("received broadcast notification from other tab or client",T);try{await this._notifyAllSubscribers(T.data.event,T.data.session,!1)}catch(c){this._debug("#broadcastChannel","error",c)}})}this.initialize().catch(T=>{this._debug("#initialize()","error",T)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(h){if(this.throwOnError&&h&&h.error)throw h.error;return h}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${tv}) ${new Date().toISOString()}`}_debug(...h){return this.logDebugMessages&&this.logger(this._logPrefix(),...h),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var h;try{let _={},S="none";if(Va()&&(_=Gw(window.location.href),this._isImplicitGrantCallback(_)?S="implicit":await this._isPKCECallback(_)&&(S="pkce")),Va()&&this.detectSessionInUrl&&S!=="none"){const{data:k,error:P}=await this._getSessionFromURL(_,S);if(P){if(this._debug("#_initialize()","error detecting session from URL",P),zw(P)){const O=(h=P.details)===null||h===void 0?void 0:h.code;if(O==="identity_already_exists"||O==="identity_not_found"||O==="single_identity_not_deletable")return{error:P}}return{error:P}}const{session:T,redirectType:c}=k;return this._debug("#_initialize()","detected session in URL",T,"redirect type",c),await this._saveSession(T),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",T):await this._notifyAllSubscribers("SIGNED_IN",T)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(_){return os(_)?this._returnResult({error:_}):this._returnResult({error:new df("Unexpected error during initialization",_)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(h){var _,S,k;try{const P=await vs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(S=(_=h?.options)===null||_===void 0?void 0:_.data)!==null&&S!==void 0?S:{},gotrue_meta_security:{captcha_token:(k=h?.options)===null||k===void 0?void 0:k.captchaToken}},xform:Ql}),{data:T,error:c}=P;if(c||!T)return this._returnResult({data:{user:null,session:null},error:c});const O=T.session,F=T.user;return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",O)),this._returnResult({data:{user:F,session:O},error:null})}catch(P){if(os(P))return this._returnResult({data:{user:null,session:null},error:P});throw P}}async signUp(h){var _,S,k;try{let P;if("email"in h){const{email:re,password:se,options:ue}=h;let ae=null,Q=null;this.flowType==="pkce"&&([ae,Q]=await qp(this.storage,this.storageKey)),P=await vs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:ue?.emailRedirectTo,body:{email:re,password:se,data:(_=ue?.data)!==null&&_!==void 0?_:{},gotrue_meta_security:{captcha_token:ue?.captchaToken},code_challenge:ae,code_challenge_method:Q},xform:Ql})}else if("phone"in h){const{phone:re,password:se,options:ue}=h;P=await vs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:re,password:se,data:(S=ue?.data)!==null&&S!==void 0?S:{},channel:(k=ue?.channel)!==null&&k!==void 0?k:"sms",gotrue_meta_security:{captcha_token:ue?.captchaToken}},xform:Ql})}else throw new Ly("You must provide either an email or phone number and a password");const{data:T,error:c}=P;if(c||!T)return await $a(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:c});const O=T.session,F=T.user;return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",O)),this._returnResult({data:{user:F,session:O},error:null})}catch(P){if(await $a(this.storage,`${this.storageKey}-code-verifier`),os(P))return this._returnResult({data:{user:null,session:null},error:P});throw P}}async signInWithPassword(h){try{let _;if("email"in h){const{email:P,password:T,options:c}=h;_=await vs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:P,password:T,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:h0})}else if("phone"in h){const{phone:P,password:T,options:c}=h;_=await vs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:P,password:T,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:h0})}else throw new Ly("You must provide either an email or phone number and a password");const{data:S,error:k}=_;if(k)return this._returnResult({data:{user:null,session:null},error:k});if(!S||!S.session||!S.user){const P=new Vp;return this._returnResult({data:{user:null,session:null},error:P})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({user:S.user,session:S.session},S.weak_password?{weakPassword:S.weak_password}:null),error:k})}catch(_){if(os(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithOAuth(h){var _,S,k,P;return await this._handleProviderSignIn(h.provider,{redirectTo:(_=h.options)===null||_===void 0?void 0:_.redirectTo,scopes:(S=h.options)===null||S===void 0?void 0:S.scopes,queryParams:(k=h.options)===null||k===void 0?void 0:k.queryParams,skipBrowserRedirect:(P=h.options)===null||P===void 0?void 0:P.skipBrowserRedirect})}async exchangeCodeForSession(h){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(h))}async signInWithWeb3(h){const{chain:_}=h;switch(_){case"ethereum":return await this.signInWithEthereum(h);case"solana":return await this.signInWithSolana(h);default:throw new Error(`@supabase/auth-js: Unsupported chain "${_}"`)}}async signInWithEthereum(h){var _,S,k,P,T,c,O,F,re,se,ue;let ae,Q;if("message"in h)ae=h.message,Q=h.signature;else{const{chain:Y,wallet:G,statement:pe,options:_e}=h;let Ne;if(Va())if(typeof G=="object")Ne=G;else{const Ae=window;if("ethereum"in Ae&&typeof Ae.ethereum=="object"&&"request"in Ae.ethereum&&typeof Ae.ethereum.request=="function")Ne=Ae.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof G!="object"||!_e?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Ne=G}const Oe=new URL((_=_e?.url)!==null&&_!==void 0?_:window.location.href),Be=await Ne.request({method:"eth_requestAccounts"}).then(Ae=>Ae).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Be||Be.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const xt=ov(Be[0]);let $e=(S=_e?.signInWithEthereum)===null||S===void 0?void 0:S.chainId;if(!$e){const Ae=await Ne.request({method:"eth_chainId"});$e=m2(Ae)}const de={domain:Oe.host,address:xt,statement:pe,uri:Oe.href,version:"1",chainId:$e,nonce:(k=_e?.signInWithEthereum)===null||k===void 0?void 0:k.nonce,issuedAt:(T=(P=_e?.signInWithEthereum)===null||P===void 0?void 0:P.issuedAt)!==null&&T!==void 0?T:new Date,expirationTime:(c=_e?.signInWithEthereum)===null||c===void 0?void 0:c.expirationTime,notBefore:(O=_e?.signInWithEthereum)===null||O===void 0?void 0:O.notBefore,requestId:(F=_e?.signInWithEthereum)===null||F===void 0?void 0:F.requestId,resources:(re=_e?.signInWithEthereum)===null||re===void 0?void 0:re.resources};ae=y2(de),Q=await Ne.request({method:"personal_sign",params:[g2(ae),xt]})}try{const{data:Y,error:G}=await vs(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:ae,signature:Q},!((se=h.options)===null||se===void 0)&&se.captchaToken?{gotrue_meta_security:{captcha_token:(ue=h.options)===null||ue===void 0?void 0:ue.captchaToken}}:null),xform:Ql});if(G)throw G;if(!Y||!Y.session||!Y.user){const pe=new Vp;return this._returnResult({data:{user:null,session:null},error:pe})}return Y.session&&(await this._saveSession(Y.session),await this._notifyAllSubscribers("SIGNED_IN",Y.session)),this._returnResult({data:Object.assign({},Y),error:G})}catch(Y){if(os(Y))return this._returnResult({data:{user:null,session:null},error:Y});throw Y}}async signInWithSolana(h){var _,S,k,P,T,c,O,F,re,se,ue,ae;let Q,Y;if("message"in h)Q=h.message,Y=h.signature;else{const{chain:G,wallet:pe,statement:_e,options:Ne}=h;let Oe;if(Va())if(typeof pe=="object")Oe=pe;else{const xt=window;if("solana"in xt&&typeof xt.solana=="object"&&("signIn"in xt.solana&&typeof xt.solana.signIn=="function"||"signMessage"in xt.solana&&typeof xt.solana.signMessage=="function"))Oe=xt.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof pe!="object"||!Ne?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Oe=pe}const Be=new URL((_=Ne?.url)!==null&&_!==void 0?_:window.location.href);if("signIn"in Oe&&Oe.signIn){const xt=await Oe.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Ne?.signInWithSolana),{version:"1",domain:Be.host,uri:Be.href}),_e?{statement:_e}:null));let $e;if(Array.isArray(xt)&&xt[0]&&typeof xt[0]=="object")$e=xt[0];else if(xt&&typeof xt=="object"&&"signedMessage"in xt&&"signature"in xt)$e=xt;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in $e&&"signature"in $e&&(typeof $e.signedMessage=="string"||$e.signedMessage instanceof Uint8Array)&&$e.signature instanceof Uint8Array)Q=typeof $e.signedMessage=="string"?$e.signedMessage:new TextDecoder().decode($e.signedMessage),Y=$e.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Oe)||typeof Oe.signMessage!="function"||!("publicKey"in Oe)||typeof Oe!="object"||!Oe.publicKey||!("toBase58"in Oe.publicKey)||typeof Oe.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");Q=[`${Be.host} wants you to sign in with your Solana account:`,Oe.publicKey.toBase58(),..._e?["",_e,""]:[""],"Version: 1",`URI: ${Be.href}`,`Issued At: ${(k=(S=Ne?.signInWithSolana)===null||S===void 0?void 0:S.issuedAt)!==null&&k!==void 0?k:new Date().toISOString()}`,...!((P=Ne?.signInWithSolana)===null||P===void 0)&&P.notBefore?[`Not Before: ${Ne.signInWithSolana.notBefore}`]:[],...!((T=Ne?.signInWithSolana)===null||T===void 0)&&T.expirationTime?[`Expiration Time: ${Ne.signInWithSolana.expirationTime}`]:[],...!((c=Ne?.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${Ne.signInWithSolana.chainId}`]:[],...!((O=Ne?.signInWithSolana)===null||O===void 0)&&O.nonce?[`Nonce: ${Ne.signInWithSolana.nonce}`]:[],...!((F=Ne?.signInWithSolana)===null||F===void 0)&&F.requestId?[`Request ID: ${Ne.signInWithSolana.requestId}`]:[],...!((se=(re=Ne?.signInWithSolana)===null||re===void 0?void 0:re.resources)===null||se===void 0)&&se.length?["Resources",...Ne.signInWithSolana.resources.map($e=>`- ${$e}`)]:[]].join(`
`);const xt=await Oe.signMessage(new TextEncoder().encode(Q),"utf8");if(!xt||!(xt instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");Y=xt}}try{const{data:G,error:pe}=await vs(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:Q,signature:hf(Y)},!((ue=h.options)===null||ue===void 0)&&ue.captchaToken?{gotrue_meta_security:{captcha_token:(ae=h.options)===null||ae===void 0?void 0:ae.captchaToken}}:null),xform:Ql});if(pe)throw pe;if(!G||!G.session||!G.user){const _e=new Vp;return this._returnResult({data:{user:null,session:null},error:_e})}return G.session&&(await this._saveSession(G.session),await this._notifyAllSubscribers("SIGNED_IN",G.session)),this._returnResult({data:Object.assign({},G),error:pe})}catch(G){if(os(G))return this._returnResult({data:{user:null,session:null},error:G});throw G}}async _exchangeCodeForSession(h){const _=await lf(this.storage,`${this.storageKey}-code-verifier`),[S,k]=(_??"").split("/");try{if(!S&&this.flowType==="pkce")throw new Ow;const{data:P,error:T}=await vs(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:h,code_verifier:S},xform:Ql});if(await $a(this.storage,`${this.storageKey}-code-verifier`),T)throw T;if(!P||!P.session||!P.user){const c=new Vp;return this._returnResult({data:{user:null,session:null,redirectType:null},error:c})}return P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),this._returnResult({data:Object.assign(Object.assign({},P),{redirectType:k??null}),error:T})}catch(P){if(await $a(this.storage,`${this.storageKey}-code-verifier`),os(P))return this._returnResult({data:{user:null,session:null,redirectType:null},error:P});throw P}}async signInWithIdToken(h){try{const{options:_,provider:S,token:k,access_token:P,nonce:T}=h,c=await vs(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:S,id_token:k,access_token:P,nonce:T,gotrue_meta_security:{captcha_token:_?.captchaToken}},xform:Ql}),{data:O,error:F}=c;if(F)return this._returnResult({data:{user:null,session:null},error:F});if(!O||!O.session||!O.user){const re=new Vp;return this._returnResult({data:{user:null,session:null},error:re})}return O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("SIGNED_IN",O.session)),this._returnResult({data:O,error:F})}catch(_){if(os(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithOtp(h){var _,S,k,P,T;try{if("email"in h){const{email:c,options:O}=h;let F=null,re=null;this.flowType==="pkce"&&([F,re]=await qp(this.storage,this.storageKey));const{error:se}=await vs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(_=O?.data)!==null&&_!==void 0?_:{},create_user:(S=O?.shouldCreateUser)!==null&&S!==void 0?S:!0,gotrue_meta_security:{captcha_token:O?.captchaToken},code_challenge:F,code_challenge_method:re},redirectTo:O?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:se})}if("phone"in h){const{phone:c,options:O}=h,{data:F,error:re}=await vs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(k=O?.data)!==null&&k!==void 0?k:{},create_user:(P=O?.shouldCreateUser)!==null&&P!==void 0?P:!0,gotrue_meta_security:{captcha_token:O?.captchaToken},channel:(T=O?.channel)!==null&&T!==void 0?T:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:F?.message_id},error:re})}throw new Ly("You must provide either an email or phone number.")}catch(c){if(await $a(this.storage,`${this.storageKey}-code-verifier`),os(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async verifyOtp(h){var _,S;try{let k,P;"options"in h&&(k=(_=h.options)===null||_===void 0?void 0:_.redirectTo,P=(S=h.options)===null||S===void 0?void 0:S.captchaToken);const{data:T,error:c}=await vs(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},h),{gotrue_meta_security:{captcha_token:P}}),redirectTo:k,xform:Ql});if(c)throw c;if(!T)throw new Error("An error occurred on token verification.");const O=T.session,F=T.user;return O?.access_token&&(await this._saveSession(O),await this._notifyAllSubscribers(h.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",O)),this._returnResult({data:{user:F,session:O},error:null})}catch(k){if(os(k))return this._returnResult({data:{user:null,session:null},error:k});throw k}}async signInWithSSO(h){var _,S,k,P,T;try{let c=null,O=null;this.flowType==="pkce"&&([c,O]=await qp(this.storage,this.storageKey));const F=await vs(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in h?{provider_id:h.providerId}:null),"domain"in h?{domain:h.domain}:null),{redirect_to:(S=(_=h.options)===null||_===void 0?void 0:_.redirectTo)!==null&&S!==void 0?S:void 0}),!((k=h?.options)===null||k===void 0)&&k.captchaToken?{gotrue_meta_security:{captcha_token:h.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:c,code_challenge_method:O}),headers:this.headers,xform:l2});return!((P=F.data)===null||P===void 0)&&P.url&&Va()&&!(!((T=h.options)===null||T===void 0)&&T.skipBrowserRedirect)&&window.location.assign(F.data.url),this._returnResult(F)}catch(c){if(await $a(this.storage,`${this.storageKey}-code-verifier`),os(c))return this._returnResult({data:null,error:c});throw c}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async h=>{const{data:{session:_},error:S}=h;if(S)throw S;if(!_)throw new Ao;const{error:k}=await vs(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:_.access_token});return this._returnResult({data:{user:null,session:null},error:k})})}catch(h){if(os(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async resend(h){try{const _=`${this.url}/resend`;if("email"in h){const{email:S,type:k,options:P}=h,{error:T}=await vs(this.fetch,"POST",_,{headers:this.headers,body:{email:S,type:k,gotrue_meta_security:{captcha_token:P?.captchaToken}},redirectTo:P?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:T})}else if("phone"in h){const{phone:S,type:k,options:P}=h,{data:T,error:c}=await vs(this.fetch,"POST",_,{headers:this.headers,body:{phone:S,type:k,gotrue_meta_security:{captcha_token:P?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:T?.message_id},error:c})}throw new Ly("You must provide either an email or phone number and a type")}catch(_){if(os(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async _=>_))}async _acquireLock(h,_){this._debug("#_acquireLock","begin",h);try{if(this.lockAcquired){const S=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),k=(async()=>(await S,await _()))();return this.pendingInLock.push((async()=>{try{await k}catch{}})()),k}return await this.lock(`lock:${this.storageKey}`,h,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const S=_();for(this.pendingInLock.push((async()=>{try{await S}catch{}})()),await S;this.pendingInLock.length;){const k=[...this.pendingInLock];await Promise.all(k),this.pendingInLock.splice(0,k.length)}return await S}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(h){this._debug("#_useSession","begin");try{const _=await this.__loadSession();return await h(_)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let h=null;const _=await lf(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",_),_!==null&&(this._isValidSession(_)?h=_:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!h)return{data:{session:null},error:null};const S=h.expires_at?h.expires_at*1e3-Date.now()<Bx:!1;if(this._debug("#__loadSession()",`session has${S?"":" not"} expired`,"expires_at",h.expires_at),!S){if(this.userStorage){const T=await lf(this.userStorage,this.storageKey+"-user");T?.user?h.user=T.user:h.user=$x()}if(this.storage.isServer&&h.user&&!h.user.__isUserNotAvailableProxy){const T={value:this.suppressGetSessionWarning};h.user=i2(h.user,T),T.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:h},error:null}}const{data:k,error:P}=await this._callRefreshToken(h.refresh_token);return P?this._returnResult({data:{session:null},error:P}):this._returnResult({data:{session:k},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(h){if(h)return await this._getUser(h);await this.initializePromise;const _=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return _.data.user&&(this.suppressGetSessionWarning=!0),_}async _getUser(h){try{return h?await vs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:h,xform:Zd}):await this._useSession(async _=>{var S,k,P;const{data:T,error:c}=_;if(c)throw c;return!(!((S=T.session)===null||S===void 0)&&S.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ao}:await vs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(P=(k=T.session)===null||k===void 0?void 0:k.access_token)!==null&&P!==void 0?P:void 0,xform:Zd})})}catch(_){if(os(_))return Fx(_)&&(await this._removeSession(),await $a(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:_});throw _}}async updateUser(h,_={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(h,_))}async _updateUser(h,_={}){try{return await this._useSession(async S=>{const{data:k,error:P}=S;if(P)throw P;if(!k.session)throw new Ao;const T=k.session;let c=null,O=null;this.flowType==="pkce"&&h.email!=null&&([c,O]=await qp(this.storage,this.storageKey));const{data:F,error:re}=await vs(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:_?.emailRedirectTo,body:Object.assign(Object.assign({},h),{code_challenge:c,code_challenge_method:O}),jwt:T.access_token,xform:Zd});if(re)throw re;return T.user=F.user,await this._saveSession(T),await this._notifyAllSubscribers("USER_UPDATED",T),this._returnResult({data:{user:T.user},error:null})})}catch(S){if(await $a(this.storage,`${this.storageKey}-code-verifier`),os(S))return this._returnResult({data:{user:null},error:S});throw S}}async setSession(h){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(h))}async _setSession(h){try{if(!h.access_token||!h.refresh_token)throw new Ao;const _=Date.now()/1e3;let S=_,k=!0,P=null;const{payload:T}=Fy(h.access_token);if(T.exp&&(S=T.exp,k=S<=_),k){const{data:c,error:O}=await this._callRefreshToken(h.refresh_token);if(O)return this._returnResult({data:{user:null,session:null},error:O});if(!c)return{data:{user:null,session:null},error:null};P=c}else{const{data:c,error:O}=await this._getUser(h.access_token);if(O)return this._returnResult({data:{user:null,session:null},error:O});P={access_token:h.access_token,refresh_token:h.refresh_token,user:c.user,token_type:"bearer",expires_in:S-_,expires_at:S},await this._saveSession(P),await this._notifyAllSubscribers("SIGNED_IN",P)}return this._returnResult({data:{user:P.user,session:P},error:null})}catch(_){if(os(_))return this._returnResult({data:{session:null,user:null},error:_});throw _}}async refreshSession(h){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(h))}async _refreshSession(h){try{return await this._useSession(async _=>{var S;if(!h){const{data:T,error:c}=_;if(c)throw c;h=(S=T.session)!==null&&S!==void 0?S:void 0}if(!h?.refresh_token)throw new Ao;const{data:k,error:P}=await this._callRefreshToken(h.refresh_token);return P?this._returnResult({data:{user:null,session:null},error:P}):k?this._returnResult({data:{user:k.user,session:k},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(_){if(os(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async _getSessionFromURL(h,_){try{if(!Va())throw new By("No browser detected.");if(h.error||h.error_description||h.error_code)throw new By(h.error_description||"Error in URL with unspecified error_description",{error:h.error||"unspecified_error",code:h.error_code||"unspecified_code"});switch(_){case"implicit":if(this.flowType==="pkce")throw new a0("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new By("Not a valid implicit grant flow url.");break;default:}if(_==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!h.code)throw new a0("No code detected.");const{data:_e,error:Ne}=await this._exchangeCodeForSession(h.code);if(Ne)throw Ne;const Oe=new URL(window.location.href);return Oe.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Oe.toString()),{data:{session:_e.session,redirectType:null},error:null}}const{provider_token:S,provider_refresh_token:k,access_token:P,refresh_token:T,expires_in:c,expires_at:O,token_type:F}=h;if(!P||!c||!T||!F)throw new By("No session defined in URL");const re=Math.round(Date.now()/1e3),se=parseInt(c);let ue=re+se;O&&(ue=parseInt(O));const ae=ue-re;ae*1e3<=Yp&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${ae}s, should have been closer to ${se}s`);const Q=ue-se;re-Q>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Q,ue,re):re-Q<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Q,ue,re);const{data:Y,error:G}=await this._getUser(P);if(G)throw G;const pe={provider_token:S,provider_refresh_token:k,access_token:P,expires_in:se,expires_at:ue,refresh_token:T,token_type:F,user:Y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:pe,redirectType:h.type},error:null})}catch(S){if(os(S))return this._returnResult({data:{session:null,redirectType:null},error:S});throw S}}_isImplicitGrantCallback(h){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),h):!!(h.access_token||h.error_description)}async _isPKCECallback(h){const _=await lf(this.storage,`${this.storageKey}-code-verifier`);return!!(h.code&&_)}async signOut(h={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(h))}async _signOut({scope:h}={scope:"global"}){return await this._useSession(async _=>{var S;const{data:k,error:P}=_;if(P&&!Fx(P))return this._returnResult({error:P});const T=(S=k.session)===null||S===void 0?void 0:S.access_token;if(T){const{error:c}=await this.admin.signOut(T,h);if(c&&!(Iw(c)&&(c.status===404||c.status===401||c.status===403)||Fx(c)))return this._returnResult({error:c})}return h!=="others"&&(await this._removeSession(),await $a(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(h){const _=qw(),S={id:_,callback:h,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",_),this.stateChangeEmitters.delete(_)}};return this._debug("#onAuthStateChange()","registered callback with id",_),this.stateChangeEmitters.set(_,S),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(_)})))(),{data:{subscription:S}}}async _emitInitialSession(h){return await this._useSession(async _=>{var S,k;try{const{data:{session:P},error:T}=_;if(T)throw T;await((S=this.stateChangeEmitters.get(h))===null||S===void 0?void 0:S.callback("INITIAL_SESSION",P)),this._debug("INITIAL_SESSION","callback id",h,"session",P)}catch(P){await((k=this.stateChangeEmitters.get(h))===null||k===void 0?void 0:k.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",h,"error",P),console.error(P)}})}async resetPasswordForEmail(h,_={}){let S=null,k=null;this.flowType==="pkce"&&([S,k]=await qp(this.storage,this.storageKey,!0));try{return await vs(this.fetch,"POST",`${this.url}/recover`,{body:{email:h,code_challenge:S,code_challenge_method:k,gotrue_meta_security:{captcha_token:_.captchaToken}},headers:this.headers,redirectTo:_.redirectTo})}catch(P){if(await $a(this.storage,`${this.storageKey}-code-verifier`),os(P))return this._returnResult({data:null,error:P});throw P}}async getUserIdentities(){var h;try{const{data:_,error:S}=await this.getUser();if(S)throw S;return this._returnResult({data:{identities:(h=_.user.identities)!==null&&h!==void 0?h:[]},error:null})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}}async linkIdentity(h){return"token"in h?this.linkIdentityIdToken(h):this.linkIdentityOAuth(h)}async linkIdentityOAuth(h){var _;try{const{data:S,error:k}=await this._useSession(async P=>{var T,c,O,F,re;const{data:se,error:ue}=P;if(ue)throw ue;const ae=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,h.provider,{redirectTo:(T=h.options)===null||T===void 0?void 0:T.redirectTo,scopes:(c=h.options)===null||c===void 0?void 0:c.scopes,queryParams:(O=h.options)===null||O===void 0?void 0:O.queryParams,skipBrowserRedirect:!0});return await vs(this.fetch,"GET",ae,{headers:this.headers,jwt:(re=(F=se.session)===null||F===void 0?void 0:F.access_token)!==null&&re!==void 0?re:void 0})});if(k)throw k;return Va()&&!(!((_=h.options)===null||_===void 0)&&_.skipBrowserRedirect)&&window.location.assign(S?.url),this._returnResult({data:{provider:h.provider,url:S?.url},error:null})}catch(S){if(os(S))return this._returnResult({data:{provider:h.provider,url:null},error:S});throw S}}async linkIdentityIdToken(h){return await this._useSession(async _=>{var S;try{const{error:k,data:{session:P}}=_;if(k)throw k;const{options:T,provider:c,token:O,access_token:F,nonce:re}=h,se=await vs(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(S=P?.access_token)!==null&&S!==void 0?S:void 0,body:{provider:c,id_token:O,access_token:F,nonce:re,link_identity:!0,gotrue_meta_security:{captcha_token:T?.captchaToken}},xform:Ql}),{data:ue,error:ae}=se;return ae?this._returnResult({data:{user:null,session:null},error:ae}):!ue||!ue.session||!ue.user?this._returnResult({data:{user:null,session:null},error:new Vp}):(ue.session&&(await this._saveSession(ue.session),await this._notifyAllSubscribers("USER_UPDATED",ue.session)),this._returnResult({data:ue,error:ae}))}catch(k){if(await $a(this.storage,`${this.storageKey}-code-verifier`),os(k))return this._returnResult({data:{user:null,session:null},error:k});throw k}})}async unlinkIdentity(h){try{return await this._useSession(async _=>{var S,k;const{data:P,error:T}=_;if(T)throw T;return await vs(this.fetch,"DELETE",`${this.url}/user/identities/${h.identity_id}`,{headers:this.headers,jwt:(k=(S=P.session)===null||S===void 0?void 0:S.access_token)!==null&&k!==void 0?k:void 0})})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}}async _refreshAccessToken(h){const _=`#_refreshAccessToken(${h.substring(0,5)}...)`;this._debug(_,"begin");try{const S=Date.now();return await Ww(async k=>(k>0&&await Zw(200*Math.pow(2,k-1)),this._debug(_,"refreshing attempt",k),await vs(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:h},headers:this.headers,xform:Ql})),(k,P)=>{const T=200*Math.pow(2,k);return P&&Ux(P)&&Date.now()+T-S<Yp})}catch(S){if(this._debug(_,"error",S),os(S))return this._returnResult({data:{session:null,user:null},error:S});throw S}finally{this._debug(_,"end")}}_isValidSession(h){return typeof h=="object"&&h!==null&&"access_token"in h&&"refresh_token"in h&&"expires_at"in h}async _handleProviderSignIn(h,_){const S=await this._getUrlForProvider(`${this.url}/authorize`,h,{redirectTo:_.redirectTo,scopes:_.scopes,queryParams:_.queryParams});return this._debug("#_handleProviderSignIn()","provider",h,"options",_,"url",S),Va()&&!_.skipBrowserRedirect&&window.location.assign(S),{data:{provider:h,url:S},error:null}}async _recoverAndRefresh(){var h,_;const S="#_recoverAndRefresh()";this._debug(S,"begin");try{const k=await lf(this.storage,this.storageKey);if(k&&this.userStorage){let T=await lf(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!T&&(T={user:k.user},await Xp(this.userStorage,this.storageKey+"-user",T)),k.user=(h=T?.user)!==null&&h!==void 0?h:$x()}else if(k&&!k.user&&!k.user){const T=await lf(this.storage,this.storageKey+"-user");T&&T?.user?(k.user=T.user,await $a(this.storage,this.storageKey+"-user"),await Xp(this.storage,this.storageKey,k)):k.user=$x()}if(this._debug(S,"session from storage",k),!this._isValidSession(k)){this._debug(S,"session is not valid"),k!==null&&await this._removeSession();return}const P=((_=k.expires_at)!==null&&_!==void 0?_:1/0)*1e3-Date.now()<Bx;if(this._debug(S,`session has${P?"":" not"} expired with margin of ${Bx}s`),P){if(this.autoRefreshToken&&k.refresh_token){const{error:T}=await this._callRefreshToken(k.refresh_token);T&&(console.error(T),Ux(T)||(this._debug(S,"refresh failed with a non-retryable error, removing the session",T),await this._removeSession()))}}else if(k.user&&k.user.__isUserNotAvailableProxy===!0)try{const{data:T,error:c}=await this._getUser(k.access_token);!c&&T?.user?(k.user=T.user,await this._saveSession(k),await this._notifyAllSubscribers("SIGNED_IN",k)):this._debug(S,"could not get user data, skipping SIGNED_IN notification")}catch(T){console.error("Error getting user data:",T),this._debug(S,"error getting user data, skipping SIGNED_IN notification",T)}else await this._notifyAllSubscribers("SIGNED_IN",k)}catch(k){this._debug(S,"error",k),console.error(k);return}finally{this._debug(S,"end")}}async _callRefreshToken(h){var _,S;if(!h)throw new Ao;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const k=`#_callRefreshToken(${h.substring(0,5)}...)`;this._debug(k,"begin");try{this.refreshingDeferred=new ax;const{data:P,error:T}=await this._refreshAccessToken(h);if(T)throw T;if(!P.session)throw new Ao;await this._saveSession(P.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",P.session);const c={data:P.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(P){if(this._debug(k,"error",P),os(P)){const T={data:null,error:P};return Ux(P)||await this._removeSession(),(_=this.refreshingDeferred)===null||_===void 0||_.resolve(T),T}throw(S=this.refreshingDeferred)===null||S===void 0||S.reject(P),P}finally{this.refreshingDeferred=null,this._debug(k,"end")}}async _notifyAllSubscribers(h,_,S=!0){const k=`#_notifyAllSubscribers(${h})`;this._debug(k,"begin",_,`broadcast = ${S}`);try{this.broadcastChannel&&S&&this.broadcastChannel.postMessage({event:h,session:_});const P=[],T=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(h,_)}catch(O){P.push(O)}});if(await Promise.all(T),P.length>0){for(let c=0;c<P.length;c+=1)console.error(P[c]);throw P[0]}}finally{this._debug(k,"end")}}async _saveSession(h){this._debug("#_saveSession()",h),this.suppressGetSessionWarning=!0,await $a(this.storage,`${this.storageKey}-code-verifier`);const _=Object.assign({},h),S=_.user&&_.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!S&&_.user&&await Xp(this.userStorage,this.storageKey+"-user",{user:_.user});const k=Object.assign({},_);delete k.user;const P=u0(k);await Xp(this.storage,this.storageKey,P)}else{const k=u0(_);await Xp(this.storage,this.storageKey,k)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await $a(this.storage,this.storageKey),await $a(this.storage,this.storageKey+"-code-verifier"),await $a(this.storage,this.storageKey+"-user"),this.userStorage&&await $a(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const h=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{h&&Va()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",h)}catch(_){console.error("removing visibilitychange callback failed",_)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const h=setInterval(()=>this._autoRefreshTokenTick(),Yp);this.autoRefreshTicker=h,h&&typeof h=="object"&&typeof h.unref=="function"?h.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(h);const _=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=_,_&&typeof _=="object"&&typeof _.unref=="function"?_.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(_)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const h=this.autoRefreshTicker;this.autoRefreshTicker=null,h&&clearInterval(h);const _=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,_&&clearTimeout(_)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const h=Date.now();try{return await this._useSession(async _=>{const{data:{session:S}}=_;if(!S||!S.refresh_token||!S.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const k=Math.floor((S.expires_at*1e3-h)/Yp);this._debug("#_autoRefreshTokenTick()",`access token expires in ${k} ticks, a tick lasts ${Yp}ms, refresh threshold is ${e_} ticks`),k<=e_&&await this._callRefreshToken(S.refresh_token)})}catch(_){console.error("Auto refresh tick failed with error. This is likely a transient error.",_)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(h){if(h.isAcquireTimeout||h instanceof nv)this._debug("auto refresh token tick lock not available");else throw h}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Va()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(h){this._debug("#visibilityChangedCallback","error",h)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(h){console.error("_handleVisibilityChange",h)}}async _onVisibilityChanged(h){const _=`#_onVisibilityChanged(${h})`;this._debug(_,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),h||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(_,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(h,_,S){const k=[`provider=${encodeURIComponent(_)}`];if(S?.redirectTo&&k.push(`redirect_to=${encodeURIComponent(S.redirectTo)}`),S?.scopes&&k.push(`scopes=${encodeURIComponent(S.scopes)}`),this.flowType==="pkce"){const[P,T]=await qp(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(P)}`,code_challenge_method:`${encodeURIComponent(T)}`});k.push(c.toString())}if(S?.queryParams){const P=new URLSearchParams(S.queryParams);k.push(P.toString())}return S?.skipBrowserRedirect&&k.push(`skip_http_redirect=${S.skipBrowserRedirect}`),`${h}?${k.join("&")}`}async _unenroll(h){try{return await this._useSession(async _=>{var S;const{data:k,error:P}=_;return P?this._returnResult({data:null,error:P}):await vs(this.fetch,"DELETE",`${this.url}/factors/${h.factorId}`,{headers:this.headers,jwt:(S=k?.session)===null||S===void 0?void 0:S.access_token})})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}}async _enroll(h){try{return await this._useSession(async _=>{var S,k;const{data:P,error:T}=_;if(T)return this._returnResult({data:null,error:T});const c=Object.assign({friendly_name:h.friendlyName,factor_type:h.factorType},h.factorType==="phone"?{phone:h.phone}:h.factorType==="totp"?{issuer:h.issuer}:{}),{data:O,error:F}=await vs(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(S=P?.session)===null||S===void 0?void 0:S.access_token});return F?this._returnResult({data:null,error:F}):(h.factorType==="totp"&&O.type==="totp"&&(!((k=O?.totp)===null||k===void 0)&&k.qr_code)&&(O.totp.qr_code=`data:image/svg+xml;utf-8,${O.totp.qr_code}`),this._returnResult({data:O,error:null}))})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}}async _verify(h){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async _=>{var S;const{data:k,error:P}=_;if(P)return this._returnResult({data:null,error:P});const T=Object.assign({challenge_id:h.challengeId},"webauthn"in h?{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_response:h.webauthn.type==="create"?j2(h.webauthn.credential_response):T2(h.webauthn.credential_response)})}:{code:h.code}),{data:c,error:O}=await vs(this.fetch,"POST",`${this.url}/factors/${h.factorId}/verify`,{body:T,headers:this.headers,jwt:(S=k?.session)===null||S===void 0?void 0:S.access_token});return O?this._returnResult({data:null,error:O}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),this._returnResult({data:c,error:O}))})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}})}async _challenge(h){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async _=>{var S;const{data:k,error:P}=_;if(P)return this._returnResult({data:null,error:P});const T=await vs(this.fetch,"POST",`${this.url}/factors/${h.factorId}/challenge`,{body:h,headers:this.headers,jwt:(S=k?.session)===null||S===void 0?void 0:S.access_token});if(T.error)return T;const{data:c}=T;if(c.type!=="webauthn")return{data:c,error:null};switch(c.webauthn.type){case"create":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:w2(c.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:S2(c.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}})}async _challengeAndVerify(h){const{data:_,error:S}=await this._challenge({factorId:h.factorId});return S?this._returnResult({data:null,error:S}):await this._verify({factorId:h.factorId,challengeId:_.id,code:h.code})}async _listFactors(){var h;const{data:{user:_},error:S}=await this.getUser();if(S)return{data:null,error:S};const k={all:[],phone:[],totp:[],webauthn:[]};for(const P of(h=_?.factors)!==null&&h!==void 0?h:[])k.all.push(P),P.status==="verified"&&k[P.factor_type].push(P);return{data:k,error:null}}async _getAuthenticatorAssuranceLevel(h){var _,S,k,P;if(h)try{const{payload:ae}=Fy(h);let Q=null;ae.aal&&(Q=ae.aal);let Y=Q;const{data:{user:G},error:pe}=await this.getUser(h);if(pe)return this._returnResult({data:null,error:pe});((S=(_=G?.factors)===null||_===void 0?void 0:_.filter(Oe=>Oe.status==="verified"))!==null&&S!==void 0?S:[]).length>0&&(Y="aal2");const Ne=ae.amr||[];return{data:{currentLevel:Q,nextLevel:Y,currentAuthenticationMethods:Ne},error:null}}catch(ae){if(os(ae))return this._returnResult({data:null,error:ae});throw ae}const{data:{session:T},error:c}=await this.getSession();if(c)return this._returnResult({data:null,error:c});if(!T)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:O}=Fy(T.access_token);let F=null;O.aal&&(F=O.aal);let re=F;((P=(k=T.user.factors)===null||k===void 0?void 0:k.filter(ae=>ae.status==="verified"))!==null&&P!==void 0?P:[]).length>0&&(re="aal2");const ue=O.amr||[];return{data:{currentLevel:F,nextLevel:re,currentAuthenticationMethods:ue},error:null}}async _getAuthorizationDetails(h){try{return await this._useSession(async _=>{const{data:{session:S},error:k}=_;return k?this._returnResult({data:null,error:k}):S?await vs(this.fetch,"GET",`${this.url}/oauth/authorizations/${h}`,{headers:this.headers,jwt:S.access_token,xform:P=>({data:P,error:null})}):this._returnResult({data:null,error:new Ao})})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}}async _approveAuthorization(h,_){try{return await this._useSession(async S=>{const{data:{session:k},error:P}=S;if(P)return this._returnResult({data:null,error:P});if(!k)return this._returnResult({data:null,error:new Ao});const T=await vs(this.fetch,"POST",`${this.url}/oauth/authorizations/${h}/consent`,{headers:this.headers,jwt:k.access_token,body:{action:"approve"},xform:c=>({data:c,error:null})});return T.data&&T.data.redirect_url&&Va()&&!_?.skipBrowserRedirect&&window.location.assign(T.data.redirect_url),T})}catch(S){if(os(S))return this._returnResult({data:null,error:S});throw S}}async _denyAuthorization(h,_){try{return await this._useSession(async S=>{const{data:{session:k},error:P}=S;if(P)return this._returnResult({data:null,error:P});if(!k)return this._returnResult({data:null,error:new Ao});const T=await vs(this.fetch,"POST",`${this.url}/oauth/authorizations/${h}/consent`,{headers:this.headers,jwt:k.access_token,body:{action:"deny"},xform:c=>({data:c,error:null})});return T.data&&T.data.redirect_url&&Va()&&!_?.skipBrowserRedirect&&window.location.assign(T.data.redirect_url),T})}catch(S){if(os(S))return this._returnResult({data:null,error:S});throw S}}async _listOAuthGrants(){try{return await this._useSession(async h=>{const{data:{session:_},error:S}=h;return S?this._returnResult({data:null,error:S}):_?await vs(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:_.access_token,xform:k=>({data:k,error:null})}):this._returnResult({data:null,error:new Ao})})}catch(h){if(os(h))return this._returnResult({data:null,error:h});throw h}}async _revokeOAuthGrant(h){try{return await this._useSession(async _=>{const{data:{session:S},error:k}=_;return k?this._returnResult({data:null,error:k}):S?(await vs(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:S.access_token,query:{client_id:h.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ao})})}catch(_){if(os(_))return this._returnResult({data:null,error:_});throw _}}async fetchJwk(h,_={keys:[]}){let S=_.keys.find(c=>c.kid===h);if(S)return S;const k=Date.now();if(S=this.jwks.keys.find(c=>c.kid===h),S&&this.jwks_cached_at+Dw>k)return S;const{data:P,error:T}=await vs(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(T)throw T;return!P.keys||P.keys.length===0||(this.jwks=P,this.jwks_cached_at=k,S=P.keys.find(c=>c.kid===h),!S)?null:S}async getClaims(h,_={}){try{let S=h;if(!S){const{data:ae,error:Q}=await this.getSession();if(Q||!ae.session)return this._returnResult({data:null,error:Q});S=ae.session.access_token}const{header:k,payload:P,signature:T,raw:{header:c,payload:O}}=Fy(S);_?.allowExpired||t2(P.exp);const F=!k.alg||k.alg.startsWith("HS")||!k.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(k.kid,_?.keys?{keys:_.keys}:_?.jwks);if(!F){const{error:ae}=await this.getUser(S);if(ae)throw ae;return{data:{claims:P,header:k,signature:T},error:null}}const re=s2(k.alg),se=await crypto.subtle.importKey("jwk",F,re,!0,["verify"]);if(!await crypto.subtle.verify(re,se,T,$w(`${c}.${O}`)))throw new r_("Invalid JWT signature");return{data:{claims:P,header:k,signature:T},error:null}}catch(S){if(os(S))return this._returnResult({data:null,error:S});throw S}}}vg.nextInstanceID={};const R2=vg,I2="2.95.3";let cg="";typeof Deno<"u"?cg="deno":typeof document<"u"?cg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?cg="react-native":cg="node";const z2={"X-Client-Info":`supabase-js-${cg}/${I2}`},O2={headers:z2},L2={schema:"public"},B2={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},F2={};function bg(m){"@babel/helpers - typeof";return bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},bg(m)}function U2(m,h){if(bg(m)!="object"||!m)return m;var _=m[Symbol.toPrimitive];if(_!==void 0){var S=_.call(m,h);if(bg(S)!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(m)}function $2(m){var h=U2(m,"string");return bg(h)=="symbol"?h:h+""}function V2(m,h,_){return(h=$2(h))in m?Object.defineProperty(m,h,{value:_,enumerable:!0,configurable:!0,writable:!0}):m[h]=_,m}function y0(m,h){var _=Object.keys(m);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(m);h&&(S=S.filter(function(k){return Object.getOwnPropertyDescriptor(m,k).enumerable})),_.push.apply(_,S)}return _}function Pi(m){for(var h=1;h<arguments.length;h++){var _=arguments[h]!=null?arguments[h]:{};h%2?y0(Object(_),!0).forEach(function(S){V2(m,S,_[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):y0(Object(_)).forEach(function(S){Object.defineProperty(m,S,Object.getOwnPropertyDescriptor(_,S))})}return m}const q2=m=>m?(...h)=>m(...h):(...h)=>fetch(...h),G2=()=>Headers,H2=(m,h,_)=>{const S=q2(_),k=G2();return async(P,T)=>{var c;const O=(c=await h())!==null&&c!==void 0?c:m;let F=new k(T?.headers);return F.has("apikey")||F.set("apikey",m),F.has("Authorization")||F.set("Authorization",`Bearer ${O}`),S(P,Pi(Pi({},T),{},{headers:F}))}};function Z2(m){return m.endsWith("/")?m:m+"/"}function W2(m,h){var _,S;const{db:k,auth:P,realtime:T,global:c}=m,{db:O,auth:F,realtime:re,global:se}=h,ue={db:Pi(Pi({},O),k),auth:Pi(Pi({},F),P),realtime:Pi(Pi({},re),T),storage:{},global:Pi(Pi(Pi({},se),c),{},{headers:Pi(Pi({},(_=se?.headers)!==null&&_!==void 0?_:{}),(S=c?.headers)!==null&&S!==void 0?S:{})}),accessToken:async()=>""};return m.accessToken?ue.accessToken=m.accessToken:delete ue.accessToken,ue}function Y2(m){const h=m?.trim();if(!h)throw new Error("supabaseUrl is required.");if(!h.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Z2(h))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var X2=class extends R2{constructor(m){super(m)}},K2=class{constructor(m,h,_){var S,k;this.supabaseUrl=m,this.supabaseKey=h;const P=Y2(m);if(!h)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",P),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",P),this.storageUrl=new URL("storage/v1",P),this.functionsUrl=new URL("functions/v1",P);const T=`sb-${P.hostname.split(".")[0]}-auth-token`,c={db:L2,realtime:F2,auth:Pi(Pi({},B2),{},{storageKey:T}),global:O2},O=W2(_??{},c);if(this.storageKey=(S=O.auth.storageKey)!==null&&S!==void 0?S:"",this.headers=(k=O.global.headers)!==null&&k!==void 0?k:{},O.accessToken)this.accessToken=O.accessToken,this.auth=new Proxy({},{get:(re,se)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(se)} is not possible`)}});else{var F;this.auth=this._initSupabaseAuthClient((F=O.auth)!==null&&F!==void 0?F:{},this.headers,O.global.fetch)}this.fetch=H2(h,this._getAccessToken.bind(this),O.global.fetch),this.realtime=this._initRealtimeClient(Pi({headers:this.headers,accessToken:this._getAccessToken.bind(this)},O.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(re=>this.realtime.setAuth(re)).catch(re=>console.warn("Failed to set initial Realtime auth token:",re)),this.rest=new I1(new URL("rest/v1",P).href,{headers:this.headers,schema:O.db.schema,fetch:this.fetch,timeout:O.db.timeout,urlLengthLimit:O.db.urlLengthLimit}),this.storage=new Cw(this.storageUrl.href,this.headers,this.fetch,_?.storage),O.accessToken||this._listenForAuthEvents()}get functions(){return new E1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(m){return this.rest.from(m)}schema(m){return this.rest.schema(m)}rpc(m,h={},_={head:!1,get:!1,count:void 0}){return this.rest.rpc(m,h,_)}channel(m,h={config:{}}){return this.realtime.channel(m,h)}getChannels(){return this.realtime.getChannels()}removeChannel(m){return this.realtime.removeChannel(m)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var m=this,h,_;if(m.accessToken)return await m.accessToken();const{data:S}=await m.auth.getSession();return(h=(_=S.session)===null||_===void 0?void 0:_.access_token)!==null&&h!==void 0?h:m.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:m,persistSession:h,detectSessionInUrl:_,storage:S,userStorage:k,storageKey:P,flowType:T,lock:c,debug:O,throwOnError:F},re,se){const ue={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new X2({url:this.authUrl.href,headers:Pi(Pi({},ue),re),storageKey:P,autoRefreshToken:m,persistSession:h,detectSessionInUrl:_,storage:S,userStorage:k,flowType:T,lock:c,debug:O,throwOnError:F,fetch:se,hasCustomAuthorizationHeader:Object.keys(this.headers).some(ae=>ae.toLowerCase()==="authorization")})}_initRealtimeClient(m){return new J1(this.realtimeUrl.href,Pi(Pi({},m),{},{params:Pi(Pi({},{apikey:this.supabaseKey}),m?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((m,h)=>{this._handleTokenChanged(m,"CLIENT",h?.access_token)})}_handleTokenChanged(m,h,_){(m==="TOKEN_REFRESHED"||m==="SIGNED_IN")&&this.changedAccessToken!==_?(this.changedAccessToken=_,this.realtime.setAuth(_)):m==="SIGNED_OUT"&&(this.realtime.setAuth(),h=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const J2=(m,h,_)=>new K2(m,h,_);function Q2(){if(typeof window<"u")return!1;const m=globalThis.process;if(!m)return!1;const h=m.version;if(h==null)return!1;const _=h.match(/^v(\d+)\./);return _?parseInt(_[1],10)<=18:!1}Q2()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const eS="https://vqppcsvpqoamxspkesbe.supabase.co",tS="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxcHBjc3ZwcW9hbXhzcGtlc2JlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MzIxNDAsImV4cCI6MjA4NjQwODE0MH0.qhIMQnFRob6rbSp1KXNFK1Lr_7LFLPv-E_pfW0Jg1S0",vt=J2(eS,tS),cv=ee.createContext(void 0);function sS({children:m}){const[h,_]=ee.useState(null),[S,k]=ee.useState(null),[P,T]=ee.useState(null),[c,O]=ee.useState(!0),F=async pe=>{const{data:_e,error:Ne}=await vt.from("users").select("*").eq("id",pe).single();return Ne?(console.error("Error fetching profile:",Ne),null):_e},re=async(pe,_e,Ne)=>{const{data:Oe,error:Be}=await vt.from("users").insert({id:pe,email:_e,full_name:Ne,is_verified:!1}).select().single();return Be?(console.error("Error creating profile:",Be),null):Oe};ee.useEffect(()=>{vt.auth.getSession().then(({data:{session:_e}})=>{T(_e),_(_e?.user??null),_e?.user&&F(_e.user.id).then(k),O(!1)});const{data:{subscription:pe}}=vt.auth.onAuthStateChange(async(_e,Ne)=>{if(T(Ne),_(Ne?.user??null),_e==="SIGNED_IN"&&Ne?.user){const Oe=await F(Ne.user.id);Oe&&k(Oe)}_e==="SIGNED_OUT"&&k(null),O(!1)});return()=>pe.unsubscribe()},[]);const G={user:h,profile:S,session:P,loading:c,signUp:async(pe,_e,Ne)=>{try{const{data:Oe,error:Be}=await vt.auth.signUp({email:pe,password:_e,options:{data:{full_name:Ne}}});if(Be)return{error:Be};if(Oe.user){const xt=await re(Oe.user.id,pe,Ne);k(xt),await vt.from("referral_codes").insert({user_id:Oe.user.id,code:Ne.toUpperCase().replace(/\s/g,"").slice(0,4)+"10"}),await vt.from("user_preferences").insert({user_id:Oe.user.id})}return{error:null}}catch(Oe){return{error:Oe}}},signIn:async(pe,_e)=>{try{const{error:Ne}=await vt.auth.signInWithPassword({email:pe,password:_e});return Ne?{error:Ne}:{error:null}}catch(Ne){return{error:Ne}}},signOut:async()=>{await vt.auth.signOut(),_(null),k(null),T(null)},resetPassword:async pe=>{try{const{error:_e}=await vt.auth.resetPasswordForEmail(pe,{redirectTo:`${window.location.origin}/reset-password`});return{error:_e}}catch(_e){return{error:_e}}},updateProfile:async pe=>{if(!h)return{error:new Error("Not authenticated")};try{const{error:_e}=await vt.from("users").update(pe).eq("id",h.id);return _e||k(Ne=>Ne?{...Ne,...pe}:null),{error:_e}}catch(_e){return{error:_e}}}};return n.jsx(cv.Provider,{value:G,children:m})}function ao(){const m=ee.useContext(cv);if(m===void 0)throw new Error("useAuth must be used within an AuthProvider");return m}const uv=(...m)=>m.filter((h,_,S)=>!!h&&h.trim()!==""&&S.indexOf(h)===_).join(" ").trim();const rS=m=>m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const iS=m=>m.replace(/^([A-Z])|[\s-_]+(\w)/g,(h,_,S)=>S?S.toUpperCase():_.toLowerCase());const x0=m=>{const h=iS(m);return h.charAt(0).toUpperCase()+h.slice(1)};var aS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const nS=m=>{for(const h in m)if(h.startsWith("aria-")||h==="role"||h==="title")return!0;return!1};const oS=ee.forwardRef(({color:m="currentColor",size:h=24,strokeWidth:_=2,absoluteStrokeWidth:S,className:k="",children:P,iconNode:T,...c},O)=>ee.createElement("svg",{ref:O,...aS,width:h,height:h,stroke:m,strokeWidth:S?Number(_)*24/Number(h):_,className:uv("lucide",k),...!P&&!nS(c)&&{"aria-hidden":"true"},...c},[...T.map(([F,re])=>ee.createElement(F,re)),...Array.isArray(P)?P:[P]]));const Yt=(m,h)=>{const _=ee.forwardRef(({className:S,...k},P)=>ee.createElement(oS,{ref:P,iconNode:h,className:uv(`lucide-${rS(x0(m))}`,`lucide-${m}`,S),...k}));return _.displayName=x0(m),_};const lS=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],cS=Yt("arrow-left",lS);const uS=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],_0=Yt("banknote",uS);const dS=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],hS=Yt("bell",dS);const fS=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],pS=Yt("briefcase",fS);const mS=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],gS=Yt("building",mS);const yS=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],dv=Yt("calendar",yS);const xS=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Gu=Yt("check",xS);const _S=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],vS=Yt("chevron-down",_S);const bS=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],wS=Yt("chevron-left",bS);const SS=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Dn=Yt("chevron-right",SS);const jS=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],TS=Yt("chevron-up",jS);const NS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],$c=Yt("circle-alert",NS);const ES=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ni=Yt("circle-check-big",ES);const CS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],wg=Yt("circle-x",CS);const AS=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],kS=Yt("clipboard-list",AS);const MS=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],hg=Yt("clock",MS);const PS=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],v0=Yt("copy",PS);const DS=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],b0=Yt("credit-card",DS);const RS=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],Zu=Yt("crown",RS);const IS=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Wd=Yt("dollar-sign",IS);const zS=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],i_=Yt("download",zS);const OS=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],Xy=Yt("droplets",OS);const LS=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],a_=Yt("eye-off",LS);const BS=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ky=Yt("eye",BS);const FS=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],w0=Yt("flag",FS);const US=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],$S=Yt("footprints",US);const VS=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],qS=Yt("funnel",VS);const GS=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],mf=Yt("gift",GS);const HS=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],y_=Yt("history",HS);const ZS=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],hv=Yt("house",ZS);const WS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],n_=Yt("info",WS);const YS=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],XS=Yt("leaf",YS);const KS=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ss=Yt("loader-circle",KS);const JS=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],QS=Yt("lock",JS);const ej=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],o_=Yt("log-out",ej);const tj=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],fg=Yt("mail",tj);const sj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],qa=Yt("map-pin",sj);const rj=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],ij=Yt("menu",rj);const aj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],gf=Yt("message-square",aj);const nj=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],oj=Yt("navigation",nj);const lj=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],_a=Yt("package",lj);const cj=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],uj=Yt("pen-line",cj);const dj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],sm=Yt("pen",dj);const hj=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],fv=Yt("percent",hj);const fj=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],qy=Yt("phone",fj);const pj=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Vc=Yt("plus",pj);const mj=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],pv=Yt("printer",mj);const gj=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],io=Yt("refresh-cw",gj);const yj=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],mv=Yt("save",yj);const xj=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],x_=Yt("search",xj);const _j=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],gv=Yt("settings",_j);const vj=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],bj=Yt("share-2",vj);const wj=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Jy=Yt("shield",wj);const Sj=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],ff=Yt("shirt",Sj);const jj=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],Qy=Yt("shopping-bag",jj);const Tj=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],Nj=Yt("shopping-cart",Tj);const Ej=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],qx=Yt("smartphone",Ej);const Cj=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Pn=Yt("sparkles",Cj);const Aj=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ro=Yt("star",Aj);const kj=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],pf=Yt("tag",kj);const Mj=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],Pj=Yt("thermometer",Mj);const Dj=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],Rj=Yt("timer",Dj);const Ij=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],zj=Yt("toggle-left",Ij);const Oj=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],Lj=Yt("toggle-right",Oj);const Bj=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Eg=Yt("trash-2",Bj);const Fj=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Uj=Yt("trending-down",Fj);const $j=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],S0=Yt("trending-up",$j);const Vj=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],qj=Yt("triangle-alert",Vj);const Gj=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],Yd=Yt("truck",Gj);const Hj=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Zj=Yt("user-check",Hj);const Wj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],j0=Yt("user-plus",Wj);const Yj=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Xd=Yt("user",Yj);const Xj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],nx=Yt("users",Xj);const Kj=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],Gx=Yt("wind",Kj);const Jj=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ga=Yt("x",Jj);function Cg(){const[m,h]=ee.useState([]),[_,S]=ee.useState(!0),[k,P]=ee.useState(null),T=async()=>{try{S(!0);const{data:Q,error:Y}=await vt.from("app_settings").select("*").order("category").order("sort_order");if(Y)throw Y;h(Q||[])}catch(Q){console.error("Error fetching settings:",Q),P(Q.message)}finally{S(!1)}};return ee.useEffect(()=>{T()},[]),{settings:m,loading:_,error:k,getSetting:(Q,Y="")=>m.find(pe=>pe.key===Q)?.value||Y,getNumberSetting:(Q,Y=0)=>{const G=m.find(_e=>_e.key===Q);if(!G)return Y;const pe=parseFloat(G.value);return isNaN(pe)?Y:pe},getBooleanSetting:(Q,Y=!1)=>{const G=m.find(pe=>pe.key===Q);return G?G.value==="true"||G.value==="1":Y},getSettingsByCategory:Q=>m.filter(Y=>Y.category===Q),updateSetting:async(Q,Y)=>{try{const{error:G}=await vt.from("app_settings").update({value:Y,updated_at:new Date().toISOString()}).eq("key",Q);if(G)throw G;return h(pe=>pe.map(_e=>_e.key===Q?{..._e,value:Y}:_e)),{success:!0,message:"Setting updated successfully"}}catch(G){return console.error("Error updating setting:",G),{success:!1,message:G.message||"Failed to update setting"}}},updateSettings:async Q=>{try{for(const Y of Q){const{error:G}=await vt.from("app_settings").update({value:Y.value,updated_at:new Date().toISOString()}).eq("key",Y.key);if(G)throw G}return await T(),{success:!0,message:"Settings updated successfully"}}catch(Y){return console.error("Error updating settings:",Y),{success:!1,message:Y.message||"Failed to update settings"}}},addSetting:async Q=>{try{const{error:Y}=await vt.from("app_settings").insert([Q]);if(Y)throw Y;return await T(),{success:!0,message:"Setting added successfully"}}catch(Y){return console.error("Error adding setting:",Y),{success:!1,message:Y.message||"Failed to add setting"}}},refetch:T}}function ox(){const[m,h]=ee.useState(null),[_,S]=ee.useState([]),[k,P]=ee.useState([]),[T,c]=ee.useState({totalReferrals:0,pendingReferrals:0,completedReferrals:0,totalEarned:0,creditBalance:0}),[O,F]=ee.useState(!0),[re,se]=ee.useState(null),[ue,ae]=ee.useState(10),[Q,Y]=ee.useState(10),{getNumberSetting:G,settings:pe}=Cg();ee.useEffect(()=>{ae(G("referral_referrer_bonus",10)),Y(G("referral_referee_bonus",10))},[pe,G]);const _e=async()=>{const{data:{user:Pe}}=await vt.auth.getUser();return Pe?.id||null},Ne=async()=>{try{const Pe=await _e();if(!Pe)return null;const{data:le,error:Le}=await vt.from("referral_codes").select("*").eq("user_id",Pe).single();return Le&&Le.code!=="PGRST116"?(console.error("Error fetching referral code:",Le),null):le?(h(le),le):await Oe(Pe)}catch(Pe){return console.error("Error in fetchReferralCode:",Pe),null}},Oe=async Pe=>{try{const{data:le}=await vt.from("users").select("full_name").eq("id",Pe).single();let Le="";if(le?.full_name){const Ot=le.full_name.replace(/[^a-zA-Z]/g,"").substring(0,6).toUpperCase(),Mt=Math.floor(Math.random()*100).toString().padStart(2,"0");Le=`${Ot}${Mt}`}else Le=`BUBBLE${Math.floor(Math.random()*1e4).toString().padStart(4,"0")}`;const{data:nt,error:lt}=await vt.from("referral_codes").insert({user_id:Pe,code:Le,is_active:!0}).select().single();return lt?(console.error("Error creating referral code:",lt),null):(h(nt),nt)}catch(le){return console.error("Error in createReferralCode:",le),null}},Be=async()=>{try{const Pe=await _e();if(!Pe)return[];const{data:le,error:Le}=await vt.from("referrals").select(`
          *,
          referee:users!referrals_referee_id_fkey(full_name, email)
        `).eq("referrer_id",Pe).order("created_at",{ascending:!1});if(Le){const{data:nt,error:lt}=await vt.from("referrals").select("*").eq("referrer_id",Pe).order("created_at",{ascending:!1});return lt?(console.error("Error fetching referrals:",lt),[]):(S(nt||[]),nt||[])}return S(le||[]),le||[]}catch(Pe){return console.error("Error in fetchReferrals:",Pe),[]}},xt=async()=>{try{const Pe=await _e();if(!Pe)return[];const{data:le,error:Le}=await vt.from("user_credits").select("*").eq("user_id",Pe).order("created_at",{ascending:!1});return Le?(console.error("Error fetching credits:",Le),[]):(P(le||[]),le||[])}catch(Pe){return console.error("Error in fetchCredits:",Pe),[]}},$e=async()=>{try{const Pe=await _e();if(!Pe)return 0;const{data:le,error:Le}=await vt.from("user_credits").select("amount, type, expires_at").eq("user_id",Pe);if(Le)return console.error("Error getting credit balance:",Le),0;const nt=new Date,lt=(le||[]).reduce((Ot,Mt)=>{if(Mt.expires_at&&new Date(Mt.expires_at)<nt)return Ot;const mt=Number(Mt.amount)||0,Dt=Mt.type==="used"&&mt>0?-mt:mt;return Ot+Dt},0);return Math.max(0,lt)}catch(Pe){return console.error("Error in getCreditBalance:",Pe),0}},de=async()=>{try{if(!await _e())return;const le=await Be(),Le=await $e(),nt=le.filter(Mt=>Mt.status==="pending").length,lt=le.filter(Mt=>Mt.status==="completed"),Ot=lt.reduce((Mt,mt)=>Mt+(mt.referrer_credit_amount||ue),0);c({totalReferrals:le.length,pendingReferrals:nt,completedReferrals:lt.length,totalEarned:Ot,creditBalance:Le})}catch(Pe){console.error("Error calculating stats:",Pe)}},Ae=async Pe=>{try{const{data:le,error:Le}=await vt.from("referral_codes").select("*").eq("code",Pe.toUpperCase()).eq("is_active",!0).single();return Le||!le?{valid:!1,message:"Invalid referral code"}:le.max_uses&&le.uses_count>=le.max_uses?{valid:!1,message:"This referral code has reached its maximum uses"}:{valid:!0,message:`Valid referral code! You'll get $${(le.reward_amount??Q).toFixed(2)} credit.`}}catch(le){return console.error("Error validating referral code:",le),{valid:!1,message:"Error validating code"}}},Ye=async Pe=>{try{const le=await _e();if(!le)return{success:!1,message:"You must be logged in to use a referral code"};const{data:Le}=await vt.from("referrals").select("id").eq("referee_id",le).single();if(Le)return{success:!1,message:"You have already used a referral code"};const{data:nt,error:lt}=await vt.from("referral_codes").select("*").eq("code",Pe.toUpperCase()).eq("is_active",!0).single();if(lt||!nt)return{success:!1,message:"Invalid or expired referral code"};if(nt.user_id===le)return{success:!1,message:"You cannot use your own referral code"};if(nt.max_uses&&nt.uses_count>=nt.max_uses)return{success:!1,message:"This referral code has reached its maximum uses"};const Ot=nt.reward_amount??ue,Mt=Q,{data:mt,error:Dt}=await vt.from("referrals").insert({referrer_id:nt.user_id,referee_id:le,referral_code_id:nt.id,code_used:Pe.toUpperCase(),status:"pending",referee_credited:!0,referrer_credited:!1,referrer_credit_amount:Ot,referee_credit_amount:Mt}).select().single();return Dt?(console.error("Error creating referral:",Dt),{success:!1,message:"Failed to apply referral code"}):(await vt.from("referral_codes").update({uses_count:nt.uses_count+1}).eq("id",nt.id),await vt.from("user_credits").insert({user_id:le,amount:Mt,type:"referee_bonus",source_type:"referral",source_id:mt.id,description:`Welcome bonus for using referral code ${Pe.toUpperCase()}`}),await vt.from("users").update({referred_by:nt.user_id,referral_code_used:Pe.toUpperCase()}).eq("id",le),await xt(),await de(),{success:!0,message:`Referral code applied! You received $${Mt.toFixed(2)} credit.`,creditAmount:Mt})}catch(le){return console.error("Error applying referral code:",le),{success:!1,message:"Error applying referral code"}}},_t=async(Pe,le)=>{try{const Le=await _e();if(!Le)return{success:!1,message:"You must be logged in"};const nt=await $e();if(nt<Pe)return{success:!1,message:`Insufficient credits. You have $${nt.toFixed(2)} available.`};const{data:lt,error:Ot}=await vt.from("user_credits").insert({user_id:Le,amount:-Pe,type:"used",source_type:"order",source_id:le,description:`Credits applied to order ${le}`}).select().single();return Ot?(console.error("Error using credits:",Ot),{success:!1,message:"Failed to record credit usage"}):(console.log("Credits recorded",lt),await xt(),await de(),{success:!0,message:`Applied $${Pe.toFixed(2)} credit to your order`})}catch(Le){return console.error("Error in useCredits:",Le),{success:!1,message:"Error using credits"}}},Et=()=>m?`${window.location.origin}?ref=${m.code}`:"",zt=()=>m?`Get $${Q.toFixed(2)} off your first laundry order at The Bubble Box! Use my code: ${m.code} or sign up here: ${Et()}`:"",ht=()=>{const Pe=encodeURIComponent(zt());window.open(`https://wa.me/?text=${Pe}`,"_blank")},Qe=()=>{const Pe=encodeURIComponent(zt());window.open(`https://twitter.com/intent/tweet?text=${Pe}`,"_blank")},Ce=()=>{const Pe=encodeURIComponent(Et());window.open(`https://www.facebook.com/sharer/sharer.php?u=${Pe}`,"_blank")},We=async()=>{try{return await navigator.clipboard.writeText(Et()),!0}catch(Pe){return console.error("Failed to copy:",Pe),!1}},dt=async()=>{try{return m?(await navigator.clipboard.writeText(m.code),!0):!1}catch(Pe){return console.error("Failed to copy:",Pe),!1}},Ze=async()=>{F(!0),se(null);try{await Ne(),await Be(),await xt(),await de()}catch(Pe){console.error("Error loading referral data:",Pe),se("Failed to load referral data")}finally{F(!1)}};return ee.useEffect(()=>{Ze()},[]),{referralCode:m,referrals:_,credits:k,stats:T,loading:O,error:re,fetchReferralCode:Ne,fetchReferrals:Be,fetchCredits:xt,validateReferralCode:Ae,applyReferralCode:Ye,useCredits:_t,getCreditBalance:$e,calculateStats:de,loadAll:Ze,referrerBonus:ue,refereeBonus:Q,getShareUrl:Et,getShareMessage:zt,shareOnWhatsApp:ht,shareOnTwitter:Qe,shareOnFacebook:Ce,copyShareLink:We,copyCode:dt}}function lx({isOpen:m,onClose:h,initialMode:_="signin"}){const[S,k]=ee.useState(_),[P,T]=ee.useState(""),[c,O]=ee.useState(""),[F,re]=ee.useState(""),[se,ue]=ee.useState(""),[ae,Q]=ee.useState(null),[Y,G]=ee.useState(""),[pe,_e]=ee.useState(!1),[Ne,Oe]=ee.useState(!1),[Be,xt]=ee.useState(!1),[$e,de]=ee.useState(null),[Ae,Ye]=ee.useState(null),{signIn:_t,signUp:Et,resetPassword:zt}=ao(),{validateReferralCode:ht,applyReferralCode:Qe}=ox();ee.useEffect(()=>{const Le=new URLSearchParams(window.location.search).get("ref");Le&&S==="signup"&&(ue(Le),Ce(Le))},[S]);const Ce=async le=>{if(!le||le.length<3){Q(null),G("");return}xt(!0);const Le=await ht(le);Q(Le.valid),G(Le.message),xt(!1)},We=()=>{T(""),O(""),re(""),ue(""),Q(null),G(""),de(null),Ye(null)},dt=le=>{const Le=le.target.value.toUpperCase();ue(Le),Le.length>=3?Ce(Le):(Q(null),G(""))},Ze=async le=>{le.preventDefault(),Oe(!0),de(null),Ye(null);try{if(S==="signin"){const{error:Le}=await _t(P,c);Le?de(Le.message):(We(),h())}else if(S==="signup"){if(!F.trim()){de("Please enter your full name"),Oe(!1);return}const{error:Le}=await Et(P,c,F);Le?de(Le.message):(se&&ae&&setTimeout(async()=>{await Qe(se)},500),Ye("Account created!"+(se&&ae?" Referral bonus of $10 applied!":" Please check your email to verify.")),setTimeout(()=>{We(),h()},3e3))}else if(S==="forgot"){const{error:Le}=await zt(P);Le?de(Le.message):Ye("Password reset email sent! Check your inbox.")}}catch{de("An unexpected error occurred. Please try again.")}finally{Oe(!1)}},Pe=le=>{k(le),de(null),Ye(null)};return m?n.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:[n.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:h}),n.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-[#e14171] to-pink-600 p-6 text-white",children:[n.jsx("button",{onClick:h,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition-colors",children:n.jsx(Ga,{className:"h-5 w-5"})}),n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"bg-white/20 p-2 rounded-lg",children:n.jsxs("svg",{className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("circle",{cx:"12",cy:"12",r:"3"}),n.jsx("circle",{cx:"12",cy:"12",r:"8",strokeDasharray:"4 2"}),n.jsx("circle",{cx:"6",cy:"6",r:"2",fill:"currentColor"})]})}),n.jsx("span",{className:"font-bold text-lg",children:"The Bubble Box"})]}),n.jsxs("h2",{className:"text-2xl font-bold",children:[S==="signin"&&"Welcome Back!",S==="signup"&&"Create Account",S==="forgot"&&"Reset Password"]}),n.jsxs("p",{className:"text-pink-100 text-sm mt-1",children:[S==="signin"&&"Sign in to track orders and manage preferences",S==="signup"&&"Join us for free delivery and exclusive perks",S==="forgot"&&"Enter your email to reset your password"]})]}),n.jsxs("form",{onSubmit:Ze,className:"p-6 space-y-4",children:[$e&&n.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:$e}),Ae&&n.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-xl text-sm",children:Ae}),S==="signup"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),n.jsxs("div",{className:"relative",children:[n.jsx(Xd,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),n.jsx("input",{type:"text",value:F,onChange:le=>re(le.target.value),placeholder:"John Doe",className:"w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] focus:border-transparent",required:!0})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Referral Code ",n.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),n.jsxs("div",{className:"relative",children:[n.jsx(mf,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),n.jsx("input",{type:"text",value:se,onChange:dt,placeholder:"Enter referral code",className:`w-full pl-12 pr-12 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] focus:border-transparent uppercase ${ae===!0?"border-green-500 bg-green-50":ae===!1?"border-red-500 bg-red-50":"border-gray-200"}`}),Be&&n.jsx(Ss,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 animate-spin"}),!Be&&ae===!0&&n.jsx(Gu,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-green-500"}),!Be&&ae===!1&&n.jsx($c,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-red-500"})]}),Y&&n.jsx("p",{className:`text-xs mt-1 ${ae?"text-green-600":"text-red-600"}`,children:Y}),!se&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Have a friend's code? Get $10 off your first order!"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(fg,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),n.jsx("input",{type:"email",value:P,onChange:le=>T(le.target.value),placeholder:"you@example.com",className:"w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] focus:border-transparent",required:!0})]})]}),S!=="forgot"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(QS,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),n.jsx("input",{type:pe?"text":"password",value:c,onChange:le=>O(le.target.value),placeholder:"",className:"w-full pl-12 pr-12 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] focus:border-transparent",required:!0,minLength:6}),n.jsx("button",{type:"button",onClick:()=>_e(!pe),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:pe?n.jsx(a_,{className:"h-5 w-5"}):n.jsx(Ky,{className:"h-5 w-5"})})]}),S==="signup"&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Must be at least 6 characters"})]}),S==="signin"&&n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{type:"button",onClick:()=>Pe("forgot"),className:"text-sm text-[#e14171] hover:underline",children:"Forgot password?"})}),n.jsxs("button",{type:"submit",disabled:Ne,className:"w-full bg-[#e14171] text-white py-3 rounded-xl font-semibold hover:bg-[#c73562] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[Ne&&n.jsx(Ss,{className:"h-5 w-5 animate-spin"}),S==="signin"&&"Sign In",S==="signup"&&"Create Account",S==="forgot"&&"Send Reset Link"]}),n.jsxs("div",{className:"text-center text-sm text-gray-600",children:[S==="signin"&&n.jsxs(n.Fragment,{children:["Don't have an account?"," ",n.jsx("button",{type:"button",onClick:()=>Pe("signup"),className:"text-[#e14171] font-medium hover:underline",children:"Sign up"})]}),S==="signup"&&n.jsxs(n.Fragment,{children:["Already have an account?"," ",n.jsx("button",{type:"button",onClick:()=>Pe("signin"),className:"text-[#e14171] font-medium hover:underline",children:"Sign in"})]}),S==="forgot"&&n.jsx("button",{type:"button",onClick:()=>Pe("signin"),className:"text-[#e14171] font-medium hover:underline",children:"Back to sign in"})]})]})]})]}):null}const yv=()=>{const{user:m}=ao(),[h,_]=ee.useState("customer"),[S,k]=ee.useState([]),[P,T]=ee.useState(!0);ee.useEffect(()=>{m?c():(_("customer"),k([]),T(!1))},[m]);const c=async()=>{try{T(!0);const{data:G,error:pe}=await vt.from("users").select("role").eq("id",m?.id).single();if(pe){console.error("Error fetching user role:",pe),_("customer"),k([]);return}const _e=G?.role||"customer";if(_(_e),_e==="super_admin"){const{data:Be}=await vt.from("permissions").select("name");k((Be||[]).map(xt=>xt.name));return}const{data:Ne,error:Oe}=await vt.from("role_permissions").select("permission_name").eq("role_name",_e);if(Oe){console.error("Error fetching permissions:",Oe),k([]);return}k((Ne||[]).map(Be=>Be.permission_name))}catch(G){console.error("Error in fetchUserPermissions:",G),k([])}finally{T(!1)}};return{userRole:h,userPermissions:S,loading:P,hasPermission:G=>h==="super_admin"?!0:S.includes(G),hasAnyPermission:G=>h==="super_admin"?!0:G.some(pe=>S.includes(pe)),hasAllPermissions:G=>h==="super_admin"?!0:G.every(pe=>S.includes(pe)),isSuperAdmin:()=>h==="super_admin",isAdmin:()=>["super_admin","admin"].includes(h),isManager:()=>["super_admin","admin","manager"].includes(h),isStaff:()=>["super_admin","admin","manager","staff"].includes(h),canAccessAdmin:()=>["super_admin","admin","manager","staff"].includes(h),refreshPermissions:c}};function Qj(){const[m,h]=ee.useState(!1),[_,S]=ee.useState(!1),[k,P]=ee.useState("signin"),T=sc(),{user:c,profile:O,signOut:F,loading:re}=ao(),{canAccessAdmin:se}=yv(),ue=[{name:"Home",path:"/"},{name:"Pricing",path:"/pricing"},{name:"Services",path:"/services"},{name:"Bubble Pass",path:"/subscription"},...se()?[{name:"Admin",path:"/admin"}]:[]],ae=_e=>T.pathname===_e,Q=()=>{P("signin"),S(!0)},Y=()=>{P("signup"),S(!0)},G=async()=>{await F(),h(!1)},pe=O?.full_name||c?.email?.split("@")[0]||"User";return n.jsxs(n.Fragment,{children:[n.jsxs("header",{className:"sticky top-0 z-50 bg-black shadow-sm",children:[n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"flex justify-between items-center h-16",children:[n.jsxs(wr,{to:"/",className:"flex items-center gap-2",children:[n.jsx("img",{src:"https://af6815798a.imgdist.com/pub/bfra/knkjywkm/2no/pvb/dgk/logocroped-removebg-preview.png",alt:"The Bubble Box Logo",className:"h-14 w-14 rounded-full object-cover"}),n.jsx("span",{className:"font-bold text-xl text-white",children:"The Bubble Box"})]}),n.jsx("nav",{className:"hidden md:flex items-center gap-8",children:ue.map(_e=>n.jsx(wr,{to:_e.path,className:`text-sm font-medium transition-colors ${ae(_e.path)?"text-[#e14171]":"text-gray-300 hover:text-[#e14171]"}`,children:_e.name},_e.path))}),n.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[re?n.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-700 animate-pulse"}):c?n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs(wr,{to:"/portal",className:"flex items-center gap-2 text-sm text-gray-300 hover:text-[#e14171]",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-[#e14171] flex items-center justify-center text-white font-medium",children:pe.charAt(0).toUpperCase()}),n.jsx("span",{children:pe})]}),n.jsx("button",{onClick:G,className:"text-gray-400 hover:text-gray-200",children:n.jsx(o_,{className:"h-5 w-5"})})]}):n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{onClick:Q,className:"text-sm font-medium text-gray-300 hover:text-[#e14171]",children:"Sign In"}),n.jsx("button",{onClick:Y,className:"text-sm font-medium text-white bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-full",children:"Sign Up"})]}),n.jsx(wr,{to:"/booking",className:"bg-[#e14171] text-white px-5 py-2 rounded-full text-sm font-medium hover:bg-[#c73562] transition-colors",children:"Book Now"})]}),n.jsx("button",{className:"md:hidden p-2",onClick:()=>h(!m),children:m?n.jsx(Ga,{className:"h-6 w-6 text-white"}):n.jsx(ij,{className:"h-6 w-6 text-white"})})]})}),m&&n.jsx("div",{className:"md:hidden bg-black border-t border-gray-800",children:n.jsxs("div",{className:"px-4 py-4 space-y-3",children:[ue.map(_e=>n.jsx(wr,{to:_e.path,onClick:()=>h(!1),className:`block py-2 text-base font-medium ${ae(_e.path)?"text-[#e14171]":"text-gray-300"}`,children:_e.name},_e.path)),n.jsx("div",{className:"pt-4 border-t border-gray-800",children:c?n.jsxs("div",{className:"space-y-3",children:[n.jsxs(wr,{to:"/portal",onClick:()=>h(!1),className:"flex items-center gap-2 py-2 text-gray-300",children:[n.jsx(Xd,{className:"h-5 w-5"}),n.jsx("span",{children:"My Account"})]}),n.jsxs("button",{onClick:G,className:"flex items-center gap-2 py-2 text-gray-300",children:[n.jsx(o_,{className:"h-5 w-5"}),n.jsx("span",{children:"Sign Out"})]})]}):n.jsxs("div",{className:"space-y-3",children:[n.jsx("button",{onClick:()=>{h(!1),Q()},className:"w-full py-2 text-left text-gray-300 font-medium",children:"Sign In"}),n.jsx("button",{onClick:()=>{h(!1),Y()},className:"w-full py-2 text-left text-[#e14171] font-medium",children:"Create Account"})]})})]})})]}),n.jsx(lx,{isOpen:_,onClose:()=>S(!1),initialMode:k})]})}function eT(){const m=sc();return m.pathname==="/booking"||m.pathname.startsWith("/admin")?null:n.jsx("div",{className:"fixed bottom-0 left-0 right-0 md:hidden bg-black border-t border-gray-800 p-4 z-40",children:n.jsxs(wr,{to:"/booking",className:"flex items-center justify-center gap-2 w-full bg-[#e14171] text-white py-3 rounded-full font-semibold hover:bg-[#c73562] transition-colors shadow-lg",children:[n.jsx(Qy,{className:"h-5 w-5"}),n.jsx("span",{children:"Book Now"})]})})}function xv(){const[m,h]=ee.useState([]),[_,S]=ee.useState(!0),[k,P]=ee.useState(null),T=ee.useCallback(async()=>{try{S(!0);const{data:Q,error:Y}=await vt.from("reviews").select("*").order("created_at",{ascending:!1});if(Y)throw Y;h(Q||[])}catch(Q){console.error("Error fetching reviews:",Q),P(Q instanceof Error?Q.message:"Failed to fetch reviews")}finally{S(!1)}},[]);ee.useEffect(()=>{T()},[T]);const c=ee.useCallback(async()=>{try{const{data:Q,error:Y}=await vt.from("reviews").select("*").eq("is_featured",!0).eq("is_approved",!0).order("created_at",{ascending:!1});if(Y)throw Y;return Q||[]}catch(Q){return console.error("Error fetching featured reviews:",Q),[]}},[]),O=async Q=>{try{const{error:Y}=await vt.from("reviews").insert([{customer_name:Q.customer_name,customer_location:Q.customer_location||null,rating:Q.rating,comment:Q.comment,service_type:Q.service_type||"laundry",is_featured:Q.is_featured??!1,is_approved:Q.is_approved??!0}]);if(Y)throw Y;return await T(),{success:!0,message:"Review added successfully"}}catch(Y){return console.error("Error adding review:",Y),{success:!1,message:Y instanceof Error?Y.message:"Failed to add review"}}},F=async(Q,Y)=>{try{const G={};Y.customer_name!==void 0&&(G.customer_name=Y.customer_name),Y.customer_location!==void 0&&(G.customer_location=Y.customer_location),Y.rating!==void 0&&(G.rating=Y.rating),Y.comment!==void 0&&(G.comment=Y.comment),Y.service_type!==void 0&&(G.service_type=Y.service_type),Y.is_featured!==void 0&&(G.is_featured=Y.is_featured),Y.is_approved!==void 0&&(G.is_approved=Y.is_approved);const{error:pe}=await vt.from("reviews").update(G).eq("id",Q);if(pe)throw pe;return await T(),{success:!0,message:"Review updated successfully"}}catch(G){return console.error("Error updating review:",G),{success:!1,message:G instanceof Error?G.message:"Failed to update review"}}},re=async Q=>{try{const{error:Y}=await vt.from("reviews").delete().eq("id",Q);if(Y)throw Y;return await T(),{success:!0,message:"Review deleted successfully"}}catch(Y){return console.error("Error deleting review:",Y),{success:!1,message:Y instanceof Error?Y.message:"Failed to delete review"}}},se=async(Q,Y)=>F(Q,{is_featured:Y}),ue=async(Q,Y)=>F(Q,{is_approved:Y}),ae={total:m.length,featured:m.filter(Q=>Q.is_featured).length,approved:m.filter(Q=>Q.is_approved).length,averageRating:m.length>0?m.reduce((Q,Y)=>Q+Y.rating,0)/m.length:0};return{reviews:m,loading:_,error:k,stats:ae,fetchReviews:T,getFeaturedReviews:c,addReview:O,updateReview:F,deleteReview:re,toggleFeatured:se,toggleApproved:ue}}function cx(){const[m,h]=ee.useState([]),[_,S]=ee.useState(!0),[k,P]=ee.useState(null),T=async()=>{try{S(!0),P(null);const{data:Y,error:G}=await vt.from("subscription_plans").select("*").order("sort_order",{ascending:!0});if(G){console.error("Error fetching subscription plans:",G),P(G.message);return}const pe=(Y||[]).map(_e=>({..._e,features:typeof _e.features=="string"?JSON.parse(_e.features):_e.features||[]}));h(pe)}catch(Y){console.error("Error fetching plans:",Y),P(Y instanceof Error?Y.message:"Failed to fetch plans")}finally{S(!1)}},c=()=>m.filter(Y=>Y.is_active),O=Y=>m.find(G=>G.slug===Y),F=async(Y,G)=>{try{const pe={};G.name!==void 0&&(pe.name=G.name),G.description!==void 0&&(pe.description=G.description),G.monthly_price!==void 0&&(pe.monthly_price=G.monthly_price),G.yearly_price!==void 0&&(pe.yearly_price=G.yearly_price),G.features!==void 0&&(pe.features=G.features),G.is_popular!==void 0&&(pe.is_popular=G.is_popular),G.is_active!==void 0&&(pe.is_active=G.is_active),G.sort_order!==void 0&&(pe.sort_order=G.sort_order),console.log("Updating plan:",Y,"with data:",pe);const{data:_e,error:Ne}=await vt.from("subscription_plans").update(pe).eq("id",Y).select();return Ne?(console.error("Error updating plan:",Ne),{success:!1,message:`Database error: ${Ne.message}`}):(console.log("Update result:",_e),!_e||_e.length===0?{success:!1,message:"No rows updated. Check RLS policies."}:(await T(),{success:!0,message:"Plan updated successfully"}))}catch(pe){return console.error("Error updating plan:",pe),{success:!1,message:pe instanceof Error?pe.message:"Failed to update plan"}}},re=async(Y,G)=>F(Y,{features:G}),se=async(Y,G)=>{const pe=m.find(Ne=>Ne.id===Y);if(!pe)return{success:!1,message:"Plan not found"};const _e=[...pe.features,G];return re(Y,_e)},ue=async(Y,G)=>{const pe=m.find(Ne=>Ne.id===Y);if(!pe)return{success:!1,message:"Plan not found"};const _e=pe.features.filter((Ne,Oe)=>Oe!==G);return re(Y,_e)},ae=async Y=>{const G=m.find(pe=>pe.id===Y);return G?F(Y,{is_active:!G.is_active}):{success:!1,message:"Plan not found"}},Q=async Y=>{try{await vt.from("subscription_plans").update({is_popular:!1}).neq("id","00000000-0000-0000-0000-000000000000");const{error:G}=await vt.from("subscription_plans").update({is_popular:!0}).eq("id",Y);return G?{success:!1,message:G.message}:(await T(),{success:!0,message:"Popular plan updated"})}catch(G){return{success:!1,message:G instanceof Error?G.message:"Failed to update"}}};return ee.useEffect(()=>{T()},[]),{plans:m,loading:_,error:k,fetchPlans:T,getActivePlans:c,getPlanBySlug:O,updatePlan:F,updatePlanFeatures:re,addFeature:se,removeFeature:ue,togglePlanActive:ae,setPopularPlan:Q}}function _v(){const{user:m}=ao(),[h,_]=ee.useState(!1),[S,k]=ee.useState(null),[P,T]=ee.useState(null),c=()=>{k(null),T(null)},O=ee.useCallback(async re=>{if(c(),!re)return T("Please enter an email"),{success:!1};_(!0);try{const{error:se}=await vt.from("marketing_subscriptions").upsert({email:re.toLowerCase(),user_id:m?.id||null,opted_in:!0,unsubscribed_at:null,source:"website"},{onConflict:"email"});if(se)throw se;return k("You are subscribed to our monthly newsletter. You can unsubscribe anytime."),{success:!0}}catch(se){return T(se.message||"Subscription failed. Please try again."),{success:!1}}finally{_(!1)}},[m]),F=ee.useCallback(async re=>{c();const se=(re||m?.email||"").toLowerCase();if(!se)return T("Email is required to unsubscribe."),{success:!1};_(!0);try{const{error:ue}=await vt.from("marketing_subscriptions").update({opted_in:!1,unsubscribed_at:new Date().toISOString()}).eq("email",se);if(ue)throw ue;return k("You have been unsubscribed from marketing emails. Transactional emails will continue."),{success:!0}}catch(ue){return T(ue.message||"Unsubscribe failed. Please try again."),{success:!1}}finally{_(!1)}},[m]);return{loading:h,message:S,error:P,subscribe:O,unsubscribe:F,clear:c}}function tT(){const[m,h]=ee.useState(""),[_,S]=ee.useState(null),[k,P]=ee.useState(!1),[T,c]=ee.useState(null),{reviews:O,loading:F,getFeaturedReviews:re}=xv(),{plans:se,loading:ue,fetchPlans:ae}=cx(),{subscribe:Q,loading:Y,message:G,error:pe,clear:_e}=_v(),[Ne,Oe]=ee.useState(""),Be=se.find(Ye=>Ye.slug==="bubble-pass")||se.find(Ye=>Ye.is_popular)||null;ee.useEffect(()=>{re(),ae()},[]);const xt=()=>{m.length>5?S(!0):S(!1)},$e=async()=>{if(!navigator.geolocation){c("Geolocation not supported in this browser.");return}if(!window.isSecureContext){c("Location requires HTTPS or localhost. Please open the site over https:// or http://localhost.");return}c(null),P(!0);try{const Ye=await new Promise((Ce,We)=>{navigator.geolocation.getCurrentPosition(Ce,We,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),{latitude:_t,longitude:Et}=Ye.coords,Qe=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${_t}&lon=${Et}&zoom=18&addressdetails=1&email=dev@bubblebox.com`,{headers:{Accept:"application/json","User-Agent":"bubblebox-app/1.0"}})).json())?.display_name;h(Qe||`${_t.toFixed(5)}, ${Et.toFixed(5)}`),S(!0)}catch(Ye){console.error("Geolocation error",Ye),Ye?.code===1?c("Permission denied. Click the lock icon in your browser and allow location, then try again."):Ye?.code===2?c("Position unavailable. Please check your connection/GPS and retry."):Ye?.code===3?c("Timed out fetching location. Please retry."):c(Ye?.message||"Please allow location access and try again.")}finally{P(!1)}},de=[{customer_name:"Sarah M.",customer_location:"Downtown",rating:5,comment:"The Bubble Box has transformed my weekly routine. No more laundry days!",service_type:"laundry"},{customer_name:"James L.",customer_location:"Westside",rating:5,comment:"The 24h turnaround is incredible. My suits have never looked better.",service_type:"suit"},{customer_name:"Maria K.",customer_location:"Northgate",rating:5,comment:"Amazing shoe cleaning service. My sneakers look brand new!",service_type:"shoe"}],Ae=O.length>0?O:de;return n.jsxs("div",{className:"pb-20 md:pb-0",children:[n.jsx("section",{className:"bg-gradient-to-br from-black via-gray-900 to-black text-white py-16 lg:py-24",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6 animate-[float_6s_ease-in-out_infinite]",children:[n.jsx("img",{src:"https://af6815798a.imgdist.com/pub/bfra/knkjywkm/2no/pvb/dgk/logocroped-removebg-preview.png",alt:"The Bubble Box Logo",className:"h-24 w-24 rounded-full object-cover shadow-2xl"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-[#e14171] font-semibold",children:"Bubble Box"}),n.jsx("p",{className:"text-lg font-semibold text-white",children:"Premium Pickup & Delivery"})]})]}),n.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold leading-tight mb-6",children:["Premium Cleaning,",n.jsx("br",{}),n.jsx("span",{className:"text-[#e14171]",children:"Delivered to Your Door"})]}),n.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"Expert laundry, suit cleaning, shoe restoration & dry cleaning with free pickup & delivery. Save time for what matters most."}),n.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-xl",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx(qa,{className:"h-5 w-5 text-[#e14171]"}),n.jsx("span",{className:"text-gray-700 font-medium",children:"Check if we deliver to you"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",placeholder:"Enter your address or drop a pin...",value:m,onChange:Ye=>h(Ye.target.value),className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#e14171]"}),n.jsx("button",{onClick:xt,className:"px-6 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] transition-colors",children:"Check"})]}),_!==null&&n.jsx("div",{className:`mt-3 flex items-center gap-2 ${_?"text-green-600":"text-red-500"}`,children:_?n.jsxs(n.Fragment,{children:[n.jsx(ni,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium",children:"Great news! We deliver to your area."})]}):n.jsxs(n.Fragment,{children:[n.jsx("span",{children:""}),n.jsx("span",{className:"font-medium",children:"Please enter a valid address with landmark"})]})}),n.jsxs("button",{onClick:$e,disabled:k,className:"mt-3 flex items-center gap-2 text-[#e14171] text-sm font-medium disabled:text-gray-400",children:[k?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(qa,{className:"h-4 w-4"}),"Use my current location"]}),T&&n.jsx("p",{className:"text-xs text-red-500 mt-1",children:T})]})]}),n.jsx("div",{className:"hidden lg:block",children:n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute -top-4 -left-4 w-72 h-72 bg-[#e14171] rounded-full opacity-20 blur-3xl"}),n.jsx("img",{src:"https://images.unsplash.com/photo-1545173168-9f1947eebb7f?w=600&h=500&fit=crop",alt:"Fresh folded laundry",className:"rounded-2xl shadow-2xl relative z-10"}),n.jsx("div",{className:"absolute -bottom-6 -right-6 bg-white rounded-2xl p-4 shadow-xl z-20",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"bg-green-500 p-2 rounded-full",children:n.jsx(ni,{className:"h-6 w-6 text-white"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-900 font-semibold",children:"Order Complete!"}),n.jsx("p",{className:"text-gray-500 text-sm",children:"Delivered in 24h"})]})]})})]})})]})})}),n.jsx("section",{className:"py-16 bg-white",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"text-center mb-12",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Our Services"}),n.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"From everyday laundry to specialized suit and shoe cleaning, we handle it all with care."})]}),n.jsx("div",{className:"grid md:grid-cols-4 gap-6",children:[{icon:_a,title:"Laundry Services",desc:"Wash, fold & iron",color:"bg-pink-100 text-[#e14171]"},{icon:ff,title:"Suit Cleaning",desc:"Professional care",color:"bg-gray-100 text-gray-800"},{icon:Pn,title:"Shoe Cleaning",desc:"Restore & refresh",color:"bg-pink-100 text-[#e14171]"},{icon:ro,title:"Dry Cleaning",desc:"Delicate fabrics",color:"bg-gray-100 text-gray-800"}].map((Ye,_t)=>n.jsxs(wr,{to:"/services",className:"bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all hover:-translate-y-1 group",children:[n.jsx("div",{className:`w-14 h-14 ${Ye.color} rounded-xl flex items-center justify-center mb-4`,children:n.jsx(Ye.icon,{className:"h-7 w-7"})}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:Ye.title}),n.jsx("p",{className:"text-gray-600 text-sm",children:Ye.desc})]},_t))})]})}),n.jsx("section",{className:"py-16 bg-black text-white",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-center",children:[n.jsx("div",{className:"flex justify-center",children:n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"bg-gradient-to-br from-[#e14171] to-pink-600 rounded-3xl p-8 transform rotate-3",children:n.jsx(Pn,{className:"h-32 w-32 text-white/90"})}),n.jsx("div",{className:"absolute -bottom-4 -right-4 bg-white rounded-xl p-3 shadow-lg",children:n.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Premium Quality"})})]})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Your Items in Safe Hands"}),n.jsx("ul",{className:"space-y-4",children:[{icon:Jy,text:"Sanitized Process - Hospital-grade cleaning standards"},{icon:_a,text:"Separate Care - Your items never mix with others"},{icon:Rj,text:"24h Turnaround - Order today, receive tomorrow"},{icon:Pn,text:"Expert Technicians - Trained specialists for each service"}].map((Ye,_t)=>n.jsxs("li",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"bg-[#e14171]/20 p-2 rounded-lg",children:n.jsx(Ye.icon,{className:"h-5 w-5 text-[#e14171]"})}),n.jsx("span",{className:"text-gray-300",children:Ye.text})]},_t))})]})]})})}),n.jsx("section",{className:"py-16 bg-gray-50",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"text-center mb-12",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"How It Works"}),n.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Getting your items cleaned has never been easier. Three simple steps to fresh, clean results."})]}),n.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:[{step:"1",icon:qa,title:"Schedule Pickup",description:"Choose a 2-hour window that works for you. Our driver comes right to your door."},{step:"2",icon:Pn,title:"We Clean & Care",description:"Your items are cleaned according to your preferences. Track progress in real-time."},{step:"3",icon:Yd,title:"Fresh Delivery",description:"Receive your perfectly cleaned items, packaged exactly how you like."}].map((Ye,_t)=>n.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-md transition-shadow",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[n.jsx("div",{className:"bg-[#e14171] text-white w-10 h-10 rounded-full flex items-center justify-center font-bold",children:Ye.step}),n.jsx(Ye.icon,{className:"h-8 w-8 text-[#e14171]"})]}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:Ye.title}),n.jsx("p",{className:"text-gray-600",children:Ye.description})]},_t))}),n.jsx("div",{className:"text-center mt-12",children:n.jsxs(wr,{to:"/booking",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-8 py-4 rounded-full font-semibold hover:bg-[#c73562] transition-colors",children:["Get Started Today",n.jsx(Dn,{className:"h-5 w-5"})]})})]})}),n.jsx("section",{className:"py-12 bg-[#e14171]",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8 text-white text-center",children:[{number:"50K+",label:"Happy Customers"},{number:"24h",label:"Avg. Turnaround"},{number:"99%",label:"Satisfaction Rate"},{number:"500+",label:"Daily Pickups"}].map((Ye,_t)=>n.jsxs("div",{children:[n.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-1",children:Ye.number}),n.jsx("div",{className:"text-pink-100",children:Ye.label})]},_t))})})}),n.jsx("section",{className:"py-16 bg-gradient-to-br from-gray-50 to-white",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"bg-gradient-to-r from-black to-gray-900 rounded-3xl p-8 md:p-12 overflow-hidden relative",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-[#e14171] rounded-full opacity-10 blur-3xl -translate-y-1/2 translate-x-1/2"}),n.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-pink-500 rounded-full opacity-10 blur-3xl translate-y-1/2 -translate-x-1/2"}),n.jsxs("div",{className:"relative z-10 grid md:grid-cols-2 gap-8 items-center",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"inline-flex items-center gap-2 bg-[#e14171]/20 text-[#e14171] px-4 py-2 rounded-full text-sm font-medium mb-4",children:[n.jsx(Zu,{className:"h-4 w-4"}),"Exclusive Membership"]}),n.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:ue?"The Bubble Box Pass":Be?.name||"The Bubble Box Pass"}),n.jsx("p",{className:"text-gray-300 text-lg mb-6",children:Be?.description||"Get unlimited free delivery and exclusive member discounts."}),n.jsx("ul",{className:"space-y-3 mb-8",children:Be?.features&&Be.features.length>0?Be.features.slice(0,4).map((Ye,_t)=>n.jsxs("li",{className:"flex items-center gap-3 text-gray-300",children:[n.jsx(ni,{className:"h-5 w-5 text-[#e14171] flex-shrink-0"}),n.jsx("span",{children:Ye})]},_t)):n.jsxs(n.Fragment,{children:[n.jsxs("li",{className:"flex items-center gap-3 text-gray-300",children:[n.jsx(ni,{className:"h-5 w-5 text-[#e14171] flex-shrink-0"}),n.jsx("span",{children:"Free pickup & delivery (normally $5)"})]}),n.jsxs("li",{className:"flex items-center gap-3 text-gray-300",children:[n.jsx(ni,{className:"h-5 w-5 text-[#e14171] flex-shrink-0"}),n.jsx("span",{children:"10% off all services"})]}),n.jsxs("li",{className:"flex items-center gap-3 text-gray-300",children:[n.jsx(ni,{className:"h-5 w-5 text-[#e14171] flex-shrink-0"}),n.jsx("span",{children:"Priority scheduling"})]}),n.jsxs("li",{className:"flex items-center gap-3 text-gray-300",children:[n.jsx(ni,{className:"h-5 w-5 text-[#e14171] flex-shrink-0"}),n.jsx("span",{children:"Exclusive member promotions"})]})]})}),n.jsxs(wr,{to:"/subscription",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-6 py-3 rounded-full font-semibold hover:bg-[#c73562] transition-colors",children:["Learn More About Bubble Pass",n.jsx(Dn,{className:"h-5 w-5"})]})]}),n.jsx("div",{className:"flex justify-center md:justify-end",children:n.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-2xl max-w-xs w-full",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"bg-[#e14171]/10 text-[#e14171] px-3 py-1 rounded-full text-sm font-medium inline-block mb-4",children:"Most Popular"}),n.jsx("div",{className:"mb-4",children:ue?n.jsx("div",{className:"flex justify-center",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):n.jsxs(n.Fragment,{children:[n.jsxs("span",{className:"text-5xl font-bold text-gray-900",children:["$",Be?.monthly_price?.toFixed(2)||"9.99"]}),n.jsx("span",{className:"text-gray-500 ml-2",children:"per month"})]})}),n.jsxs("p",{className:"text-gray-500 text-sm mb-6",children:["or $",Be?.yearly_price?.toFixed(2)||"99.99","/year (save ",Be?Math.round((Be.monthly_price*12-Be.yearly_price)/(Be.monthly_price*12)*100):17,"%)"]}),n.jsx(wr,{to:"/subscription",className:"block w-full bg-black text-white py-3 rounded-xl font-semibold hover:bg-gray-800 transition-colors",children:"Get Bubble Pass"}),n.jsx("p",{className:"text-gray-400 text-xs mt-4",children:"Cancel anytime. No commitment."})]})})})]})]})})}),n.jsx("section",{className:"py-16 bg-white",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"text-center mb-12",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"What Our Customers Say"}),n.jsx("p",{className:"text-gray-600",children:"Real reviews from our valued customers"})]}),F?n.jsx("div",{className:"flex justify-center py-12",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):Ae.length>0?n.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:Ae.slice(0,6).map((Ye,_t)=>n.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-shadow",children:[n.jsxs("div",{className:"flex gap-1 mb-4",children:[[...Array(Ye.rating)].map((Et,zt)=>n.jsx(ro,{className:"h-5 w-5 fill-[#e14171] text-[#e14171]"},zt)),[...Array(5-Ye.rating)].map((Et,zt)=>n.jsx(ro,{className:"h-5 w-5 text-gray-300"},zt))]}),n.jsxs("p",{className:"text-gray-700 mb-6",children:["",Ye.comment,""]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#e14171] to-pink-400 flex items-center justify-center text-white font-bold text-lg",children:Ye.customer_name.charAt(0)}),n.jsxs("div",{children:[n.jsx("span",{className:"font-medium text-gray-900 block",children:Ye.customer_name}),Ye.customer_location&&n.jsx("span",{className:"text-gray-500 text-sm",children:Ye.customer_location})]})]}),n.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full capitalize",children:Ye.service_type})]})]},_t))}):n.jsx("div",{className:"text-center py-12 text-gray-500",children:n.jsx("p",{children:"No reviews yet. Be the first to experience our service!"})})]})}),n.jsx("section",{className:"bg-white py-14",children:n.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-2xl p-6 md:p-8 shadow-sm",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold text-[#e14171]",children:"Monthly Newsletter"}),n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Get deals, care tips, and service updates"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Opt in to marketing emails. You can unsubscribe anytime (transactional emails will still arrive)."})]}),n.jsxs("form",{onSubmit:async Ye=>{Ye.preventDefault(),_e(),await Q(Ne)},className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[n.jsx("input",{type:"email",required:!0,value:Ne,onChange:Ye=>{_e(),Oe(Ye.target.value)},placeholder:"you@example.com",className:"flex-1 min-w-[240px] px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"}),n.jsx("button",{type:"submit",disabled:Y,className:"px-5 py-3 bg-[#e14171] text-white rounded-xl font-semibold hover:bg-[#c73562] disabled:opacity-50",children:Y?"Subscribing":"Subscribe"})]})]}),(G||pe)&&n.jsx("div",{className:`mt-4 p-3 rounded-xl text-sm ${G?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:G||pe})]})})}),n.jsx("section",{className:"py-16 bg-gradient-to-r from-black to-gray-900",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Ready to Reclaim Your Time?"}),n.jsx("p",{className:"text-xl text-gray-400 mb-8 max-w-2xl mx-auto",children:"Join thousands of customers who have made cleaning day a thing of the past."}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n.jsxs(wr,{to:"/booking",className:"inline-flex items-center justify-center gap-2 bg-[#e14171] text-white px-8 py-4 rounded-full font-semibold hover:bg-[#c73562] transition-colors",children:["Book Your First Pickup",n.jsx(Dn,{className:"h-5 w-5"})]}),n.jsx(wr,{to:"/pricing",className:"inline-flex items-center justify-center gap-2 border-2 border-white text-white px-8 py-4 rounded-full font-semibold hover:bg-white/10 transition-colors",children:"View Pricing"})]})]})}),n.jsx("footer",{className:"bg-black text-white py-12",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("div",{className:"bg-[#e14171] p-2 rounded-lg",children:n.jsx(Pn,{className:"h-5 w-5 text-white"})}),n.jsx("span",{className:"font-bold text-lg",children:"The Bubble Box"})]}),n.jsx("p",{className:"text-gray-400",children:"Premium cleaning services with free pickup and delivery."})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Services"}),n.jsxs("ul",{className:"space-y-2 text-gray-400",children:[n.jsx("li",{children:n.jsx(wr,{to:"/services",className:"hover:text-[#e14171]",children:"Laundry Services"})}),n.jsx("li",{children:n.jsx(wr,{to:"/services",className:"hover:text-[#e14171]",children:"Suit Cleaning"})}),n.jsx("li",{children:n.jsx(wr,{to:"/services",className:"hover:text-[#e14171]",children:"Shoe Cleaning"})}),n.jsx("li",{children:n.jsx(wr,{to:"/services",className:"hover:text-[#e14171]",children:"Dry Cleaning"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),n.jsxs("ul",{className:"space-y-2 text-gray-400",children:[n.jsx("li",{children:n.jsx(wr,{to:"/pricing",className:"hover:text-[#e14171]",children:"Pricing"})}),n.jsx("li",{children:n.jsx(wr,{to:"/subscription",className:"hover:text-[#e14171]",children:"Bubble Pass"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"hover:text-[#e14171]",children:"About Us"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"hover:text-[#e14171]",children:"Contact"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Support"}),n.jsxs("ul",{className:"space-y-2 text-gray-400",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"hover:text-[#e14171]",children:"Help Center"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"hover:text-[#e14171]",children:"WhatsApp Support"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"hover:text-[#e14171]",children:"Terms of Service"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"hover:text-[#e14171]",children:"Privacy Policy"})})]})]})]}),n.jsx("div",{className:"border-t border-gray-800 mt-12 pt-8 text-center text-gray-400",children:n.jsx("p",{children:" 2024 The Bubble Box. All rights reserved."})})]})})]})}function __(){const[m,h]=ee.useState([]),[_,S]=ee.useState(!1),[k,P]=ee.useState(null),T=ee.useCallback(async()=>{S(!0),P(null);try{const{data:ae,error:Q}=await vt.from("products").select("*").order("category").order("sort_order").order("name");if(Q)throw Q;h(ae||[])}catch(ae){console.error("Error fetching products:",ae),P(ae instanceof Error?ae.message:"Failed to fetch products")}finally{S(!1)}},[]),c=ee.useCallback(ae=>m.filter(Q=>Q.category===ae&&Q.is_active),[m]),O=ee.useCallback(ae=>m.filter(Q=>Q.category===ae),[m]),F=ee.useCallback(async ae=>{try{const{data:Q,error:Y}=await vt.from("products").insert([{...ae,is_active:ae.is_active??!0,sort_order:ae.sort_order??0}]).select().single();if(Y)throw Y;return h(G=>[...G,Q]),{success:!0,message:"Product added successfully",product:Q}}catch(Q){return console.error("Error adding product:",Q),{success:!1,message:Q instanceof Error?Q.message:"Failed to add product"}}},[]),re=ee.useCallback(async(ae,Q)=>{try{const{error:Y}=await vt.from("products").update(Q).eq("id",ae);if(Y)throw Y;return h(G=>G.map(pe=>pe.id===ae?{...pe,...Q}:pe)),{success:!0,message:"Product updated successfully"}}catch(Y){return console.error("Error updating product:",Y),{success:!1,message:Y instanceof Error?Y.message:"Failed to update product"}}},[]),se=ee.useCallback(async ae=>{try{const{error:Q}=await vt.from("products").delete().eq("id",ae);if(Q)throw Q;return h(Y=>Y.filter(G=>G.id!==ae)),{success:!0,message:"Product deleted successfully"}}catch(Q){return console.error("Error deleting product:",Q),{success:!1,message:Q instanceof Error?Q.message:"Failed to delete product"}}},[]),ue=ee.useCallback(async(ae,Q)=>re(ae,{is_active:Q}),[re]);return ee.useEffect(()=>{T()},[T]),{products:m,loading:_,error:k,fetchProducts:T,getProductsByCategory:c,getAllProductsByCategory:O,addProduct:F,updateProduct:re,deleteProduct:se,toggleProductActive:ue}}function sT(){const{products:m,loading:h,fetchProducts:_}=__(),{plans:S,fetchPlans:k}=cx(),[P,T]=ee.useState([]),[c,O]=ee.useState([]),[F,re]=ee.useState([]),[se,ue]=ee.useState([]),[ae,Q]=ee.useState([]),Y=S.find(Ae=>Ae.slug==="bubble-pass")||S.find(Ae=>Ae.name.toLowerCase().includes("bubble")),G=Y?.name||"Bubble Pass",pe=Y?.description||"Get unlimited free delivery and exclusive member discounts.",_e=Y?.monthly_price||9.99,Ne=Y?.yearly_price||99.99,Oe=Y?.features||["Free pickup & delivery (normally $5)","10% off all services","Priority scheduling","Exclusive member promotions"],Be=Math.round((_e*12-Ne)/(_e*12)*100);ee.useEffect(()=>{_(),k()},[]),ee.useEffect(()=>{m.length>0&&(T(m.filter(Ae=>Ae.category==="laundry"&&Ae.is_active)),O(m.filter(Ae=>Ae.category==="suit"&&Ae.is_active)),re(m.filter(Ae=>Ae.category==="shoe"&&Ae.is_active)),ue(m.filter(Ae=>Ae.category==="dry-clean"&&Ae.is_active)),Q(m.filter(Ae=>Ae.category==="addon"&&Ae.is_active)))},[m]);const xt=Ae=>`$${Ae.toFixed(2).replace(/\.00$/,"")}`,$e=Ae=>{switch(Ae){case"per_item":return"each";case"per_kg":return"per kg";case"per_bag":return"per bag";case"per_pair":return"per pair";default:return Ae}},de=[{name:"Laundry Services",icon:Qy,color:"bg-[#e14171]",items:P},{name:"Suit Cleaning",icon:ff,color:"bg-black",items:c},{name:"Shoe Cleaning",icon:$S,color:"bg-[#e14171]",items:F},{name:"Dry Cleaning",icon:Pn,color:"bg-black",items:se}];return h?n.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Ss,{className:"h-12 w-12 animate-spin text-[#e14171] mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600",children:"Loading prices..."})]})}):n.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[n.jsx("section",{className:"bg-gradient-to-r from-black to-gray-900 text-white py-12",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Simple, Transparent Pricing"}),n.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"No hidden fees. Pay only for what you use. Final charge calculated after we process your items."})]})}),n.jsx("section",{className:"py-8",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"bg-pink-50 border border-pink-200 rounded-2xl p-6 flex items-start gap-4",children:[n.jsx(n_,{className:"h-6 w-6 text-[#e14171] flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"How Our Pricing Works"}),n.jsx("p",{className:"text-gray-600",children:"We place a small authorization hold ($20) when you book. After pickup, we process your items at our facility and charge you only for the actual service. The final receipt is sent via WhatsApp and email."})]})]})})}),n.jsx("section",{className:"py-8",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"grid lg:grid-cols-2 gap-8",children:de.map((Ae,Ye)=>n.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[n.jsx("div",{className:`${Ae.color} p-6 text-white`,children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Ae.icon,{className:"h-8 w-8"}),n.jsx("h2",{className:"text-2xl font-bold",children:Ae.name})]})}),n.jsx("div",{className:"p-6",children:Ae.items.length===0?n.jsx("p",{className:"text-gray-500 text-center py-4",children:"No products available"}):n.jsx("table",{className:"w-full",children:n.jsx("tbody",{children:Ae.items.map((_t,Et)=>n.jsxs("tr",{className:"border-b last:border-0",children:[n.jsxs("td",{className:"py-4",children:[n.jsx("div",{className:"font-medium text-gray-900",children:_t.name}),_t.description&&n.jsx("div",{className:"text-sm text-gray-500",children:_t.description})]}),n.jsxs("td",{className:"py-4 text-right",children:[n.jsx("div",{className:"font-bold text-[#e14171]",children:xt(_t.price)}),n.jsx("div",{className:"text-sm text-gray-500",children:$e(_t.unit)})]})]},Et))})})})]},Ye))})})}),n.jsx("section",{className:"py-12",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Add-On Services"}),ae.length===0?n.jsx("p",{className:"text-gray-500 text-center py-8",children:"No add-on services available"}):n.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:ae.map((Ae,Ye)=>n.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-100",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsx("span",{className:"font-medium text-gray-900",children:Ae.name}),n.jsx("span",{className:"font-bold text-[#e14171]",children:xt(Ae.price)})]}),n.jsx("p",{className:"text-sm text-gray-500",children:Ae.description||$e(Ae.unit)})]},Ye))})]})}),n.jsx("section",{className:"py-12 bg-gradient-to-r from-[#e14171] to-pink-600",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"bg-white rounded-3xl p-8 md:p-12 flex flex-col md:flex-row items-center gap-8",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 bg-pink-100 text-[#e14171] px-4 py-1 rounded-full text-sm font-medium mb-4",children:[n.jsx(Zu,{className:"h-4 w-4"}),"Save More"]}),n.jsxs("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:["The ",G]}),n.jsx("p",{className:"text-gray-600 mb-6",children:pe}),n.jsx("ul",{className:"space-y-3 mb-6",children:Oe.slice(0,4).map((Ae,Ye)=>n.jsxs("li",{className:"flex items-center gap-3",children:[n.jsx(ni,{className:"h-5 w-5 text-green-500"}),n.jsx("span",{className:"text-gray-700",children:Ae})]},Ye))}),n.jsx(wr,{to:"/subscription",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-6 py-3 rounded-full font-semibold hover:bg-[#c73562] transition-colors",children:"Learn More About Bubble Pass"})]}),n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"text-6xl font-bold text-[#e14171]",children:["$",_e.toFixed(2).replace(/\.00$/,"")]}),n.jsx("div",{className:"text-gray-500",children:"per month"}),Be>0&&n.jsxs("div",{className:"mt-4 text-sm",children:[n.jsx("span",{className:"text-gray-500",children:"or "}),n.jsxs("span",{className:"font-semibold text-gray-900",children:["$",Ne.toFixed(2).replace(/\.00$/,""),"/year"]}),n.jsxs("span",{className:"ml-2 bg-green-100 text-green-700 px-2 py-0.5 rounded-full text-xs font-medium",children:["Save ",Be,"%"]})]})]})]})})}),n.jsx("section",{className:"py-16 bg-gray-50",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Ready to Get Started?"}),n.jsx("p",{className:"text-gray-600 mb-8",children:"Schedule your first pickup today and experience the difference."}),n.jsx(wr,{to:"/booking",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-8 py-4 rounded-full font-semibold hover:bg-[#c73562] transition-colors",children:"Book Now"})]})})]})}function vv(){const[m,h]=ee.useState([]),[_,S]=ee.useState(!0),[k,P]=ee.useState(null),T=async()=>{try{S(!0);const{data:ae,error:Q}=await vt.from("service_categories").select("*").order("sort_order",{ascending:!0});if(Q)throw Q;const Y=(ae||[]).map(G=>({...G,features:typeof G.features=="string"?JSON.parse(G.features):G.features||[]}));h(Y)}catch(ae){console.error("Error fetching service categories:",ae),P(ae instanceof Error?ae.message:"Failed to fetch service categories")}finally{S(!1)}};ee.useEffect(()=>{T()},[]);const c=()=>m.filter(ae=>ae.is_active),O=ae=>m.find(Q=>Q.slug===ae),F=async(ae,Q)=>{try{console.log("Updating service category:",ae,Q);const Y={updated_at:new Date().toISOString()};Q.name!==void 0&&(Y.name=Q.name),Q.tagline!==void 0&&(Y.tagline=Q.tagline),Q.description!==void 0&&(Y.description=Q.description),Q.price_range!==void 0&&(Y.price_range=Q.price_range),Q.price_note!==void 0&&(Y.price_note=Q.price_note),Q.icon!==void 0&&(Y.icon=Q.icon),Q.features!==void 0&&(Y.features=Q.features),Q.is_active!==void 0&&(Y.is_active=Q.is_active),Q.sort_order!==void 0&&(Y.sort_order=Q.sort_order),console.log("Update data being sent:",Y);const{data:G,error:pe}=await vt.from("service_categories").update(Y).eq("id",ae).select();if(pe)throw console.error("Supabase error:",pe),pe;if(console.log("Update result:",G),!G||G.length===0)throw new Error("Update failed - no rows returned");return await T(),{success:!0,message:"Service category updated successfully"}}catch(Y){return console.error("Error updating service category:",Y),{success:!1,message:Y instanceof Error?Y.message:"Failed to update service category"}}};return{categories:m,loading:_,error:k,fetchCategories:T,getActiveCategories:c,getCategoryBySlug:O,updateCategory:F,addFeature:async(ae,Q)=>{try{const Y=m.find(pe=>pe.id===ae);if(!Y)throw new Error("Category not found");const G=[...Y.features,Q];return await F(ae,{features:G})}catch(Y){return console.error("Error adding feature:",Y),{success:!1,message:Y instanceof Error?Y.message:"Failed to add feature"}}},removeFeature:async(ae,Q)=>{try{const Y=m.find(pe=>pe.id===ae);if(!Y)throw new Error("Category not found");const G=Y.features.filter((pe,_e)=>_e!==Q);return await F(ae,{features:G})}catch(Y){return console.error("Error removing feature:",Y),{success:!1,message:Y instanceof Error?Y.message:"Failed to remove feature"}}},toggleActive:async ae=>{try{const Q=m.find(Y=>Y.id===ae);if(!Q)throw new Error("Category not found");return await F(ae,{is_active:!Q.is_active})}catch(Q){return console.error("Error toggling category active state:",Q),{success:!1,message:Q instanceof Error?Q.message:"Failed to toggle category"}}}}}const T0=[{id:"laundry",name:"Laundry Services",icon:Xy,color:"bg-[#e14171]",description:"Complete wash, dry & fold service",longDescription:"Our comprehensive laundry service handles all your everyday clothing with expert care. We sort, wash, dry, and fold your items to perfection. Choose from multiple detergent options and customize your folding preferences.",features:["Sorted by color and fabric type","Choice of detergent (standard, eco, hypoallergenic)","Multiple folding styles available","Fabric softener optional","Stain pre-treatment included","Ironing service available"],priceRange:"$2.50/kg or $12/bag",turnaround:"24 hours",image:"https://images.unsplash.com/photo-1582735689369-4fe89db7114c?w=600&h=400&fit=crop"},{id:"suit-cleaning",name:"Suit Cleaning",icon:ff,color:"bg-black",description:"Professional suit care & pressing",longDescription:"Trust your finest suits to our expert cleaning team. We use specialized techniques to clean, press, and restore your suits to their showroom condition. Perfect for business professionals who demand the best.",features:["Specialized suit cleaning solvents","Expert pressing and finishing","Button and seam inspection","Protective garment bags included","Minor repairs at no extra cost","Same-day service available"],priceRange:"$18-$30 per suit",turnaround:"48 hours",image:"https://images.unsplash.com/photo-1594938298603-c8148c4dae35?w=600&h=400&fit=crop"},{id:"shoe-cleaning",name:"Shoe Cleaning",icon:Pn,color:"bg-[#e14171]",description:"Restore your footwear to like-new",longDescription:"Our shoe cleaning experts can restore any type of footwear - from everyday sneakers to premium leather shoes. We use specialized products and techniques for each material type to ensure the best results.",features:["Deep cleaning for all shoe types","Leather conditioning and polishing","Suede and nubuck restoration","Sole cleaning and whitening","Deodorizing treatment","Color restoration available"],priceRange:"$15-$35 per pair",turnaround:"48-72 hours",image:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=600&h=400&fit=crop"},{id:"dry-cleaning",name:"Dry Cleaning",icon:_a,color:"bg-black",description:"Delicate fabric specialists",longDescription:"Our dry cleaning service is perfect for delicate fabrics that require special care. From silk blouses to cashmere sweaters, we handle your finest garments with the expertise they deserve.",features:["Eco-friendly dry cleaning solvents","Expert stain removal","Hand finishing available","Protective garment bags","Beading and sequin safe","Wedding dress specialists"],priceRange:"$5-$150 per item",turnaround:"48-72 hours",image:"https://images.unsplash.com/photo-1558171813-4c088753af8f?w=600&h=400&fit=crop"}];function rT({service:m}){return n.jsxs(wr,{to:`/services/${m.id}`,className:"bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-lg transition-all group",children:[n.jsx("div",{className:"h-48 overflow-hidden",children:n.jsx("img",{src:m.image,alt:m.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:`${m.color} p-2 rounded-lg text-white`,children:n.jsx(m.icon,{className:"h-5 w-5"})}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:m.name})]}),n.jsx("p",{className:"text-gray-600 mb-4",children:m.description}),n.jsxs("div",{className:"flex items-center justify-between text-sm",children:[n.jsx("span",{className:"text-[#e14171] font-medium",children:m.priceRange}),n.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:["Learn more ",n.jsx(Dn,{className:"h-4 w-4"})]})]})]})]})}function iT({service:m}){return n.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:n.jsxs(wr,{to:"/services",className:"inline-flex items-center gap-2 text-gray-600 hover:text-[#e14171]",children:[n.jsx(cS,{className:"h-5 w-5"}),"Back to Services"]})}),n.jsx("section",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12",children:n.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[n.jsxs("div",{children:[n.jsxs("div",{className:`inline-flex items-center gap-2 ${m.color} text-white px-4 py-2 rounded-full mb-6`,children:[n.jsx(m.icon,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium",children:m.name})]}),n.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:m.name}),n.jsx("p",{className:"text-xl text-gray-600 mb-8",children:m.longDescription}),n.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[n.jsxs("div",{className:"bg-white rounded-xl px-6 py-4 shadow-sm",children:[n.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Price Range"}),n.jsx("div",{className:"text-xl font-bold text-[#e14171]",children:m.priceRange})]}),n.jsxs("div",{className:"bg-white rounded-xl px-6 py-4 shadow-sm",children:[n.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Turnaround"}),n.jsx("div",{className:"text-xl font-bold text-gray-900",children:m.turnaround})]})]}),n.jsxs(wr,{to:"/booking",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-8 py-4 rounded-full font-semibold hover:bg-[#c73562] transition-colors",children:["Book This Service",n.jsx(Dn,{className:"h-5 w-5"})]})]}),n.jsx("div",{className:"rounded-2xl overflow-hidden shadow-xl",children:n.jsx("img",{src:m.image,alt:m.name,className:"w-full h-80 lg:h-96 object-cover"})})]})}),n.jsx("section",{className:"bg-white py-12",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-8",children:"What's Included"}),n.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:m.features.map((h,_)=>n.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-xl p-4",children:[n.jsx(ni,{className:"h-5 w-5 text-green-500 flex-shrink-0"}),n.jsx("span",{className:"text-gray-700",children:h})]},_))})]})}),n.jsx("section",{className:"py-16",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Ready to Get Started?"}),n.jsxs("p",{className:"text-gray-600 mb-8 max-w-xl mx-auto",children:["Schedule your pickup today and experience our premium ",m.name.toLowerCase()," service."]}),n.jsx(wr,{to:"/booking",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-8 py-4 rounded-full font-semibold hover:bg-[#c73562] transition-colors",children:"Schedule Pickup"})]})})]})}function N0(){const{serviceId:m}=kb(),{categories:h,loading:_}=vv(),[S,k]=ee.useState(T0);if(ee.useEffect(()=>{if(h.length>0){const P=T0.map(T=>{const O={laundry:"laundry","suit-cleaning":"suit","shoe-cleaning":"shoe","dry-cleaning":"dry-clean"}[T.id],F=h.find(re=>re.slug===O);return F?{...T,name:F.name,description:F.tagline||T.description,longDescription:F.description||T.longDescription,priceRange:F.price_range,features:F.features.length>0?F.features:T.features}:T});k(P)}},[h]),m){const P=S.find(T=>T.id===m);if(P)return n.jsx(iT,{service:P})}return n.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[n.jsx("section",{className:"bg-gradient-to-r from-black to-gray-900 text-white py-12",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Our Services"}),n.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"From everyday laundry to specialized suit and shoe cleaning, we handle it all with expert care."})]})}),n.jsx("section",{className:"py-12",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:_?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):n.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:S.map(P=>n.jsx(rT,{service:P},P.id))})})}),n.jsx("section",{className:"py-12 bg-white",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"text-center mb-12",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Need Something Special?"}),n.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Have an unusual item or special request? Contact us and we'll create a custom solution for you."})]}),n.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:[{title:"Designer Items",desc:"Expert care for luxury brands"},{title:"Vintage Restoration",desc:"Careful restoration of antique pieces"},{title:"Bulk Orders",desc:"Corporate and hotel services"}].map((P,T)=>n.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 text-center",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:P.title}),n.jsx("p",{className:"text-gray-600 text-sm",children:P.desc})]},T))})]})})]})}function aT(){const m=yf(),[h,_]=ee.useState("monthly"),[S,k]=ee.useState(null),{plans:P,loading:T}=cx(),[c,O]=ee.useState([{name:"Basic",slug:"basic",description:"Perfect for occasional use",monthlyPrice:0,yearlyPrice:0,features:[{text:"Standard pricing",included:!0},{text:"$5 delivery fee per order",included:!0},{text:"Email support",included:!0},{text:"Order tracking",included:!0},{text:"Free delivery",included:!1},{text:"Member discounts",included:!1},{text:"Priority scheduling",included:!1}],cta:"Current Plan",popular:!1},{name:"Bubble Pass",slug:"bubble-pass",description:"Best value for regulars",monthlyPrice:9.99,yearlyPrice:99,features:[{text:"Standard pricing",included:!0},{text:"FREE delivery on all orders",included:!0},{text:"WhatsApp priority support",included:!0},{text:"Real-time order tracking",included:!0},{text:"10% off all services",included:!0},{text:"Priority scheduling",included:!0},{text:"Monthly surprise perks",included:!0}],cta:"Get Bubble Pass",popular:!0},{name:"Family Pass",slug:"family-pass",description:"For households with heavy loads",monthlyPrice:19.99,yearlyPrice:199,features:[{text:"All Bubble Pass benefits",included:!0},{text:"15% off all services",included:!0},{text:"Up to 4 family members",included:!0},{text:"Free bag upgrades",included:!0},{text:"Dedicated account manager",included:!0},{text:"Same-day service available",included:!0},{text:"Free minor repairs",included:!0}],cta:"Get Family Pass",popular:!1}]);ee.useEffect(()=>{P.length>0&&O(se=>se.map(ue=>{const ae=P.find(Q=>Q.slug===ue.slug);return ae?{...ue,name:ae.name,description:ae.description,monthlyPrice:ae.monthly_price,yearlyPrice:ae.yearly_price,popular:ae.is_popular,features:ae.features.length>0?ae.features.map(Q=>({text:Q,included:!0})):ue.features,cta:ue.slug==="basic"?"Current Plan":`Get ${ae.name}`}:ue}))},[P]);const F=[{icon:Yd,title:"Free Delivery Forever",description:"Never pay for pickup or delivery again. Save $5+ per order."},{icon:fv,title:"Member Discounts",description:"Enjoy 10-15% off on all cleaning services."},{icon:dv,title:"Priority Scheduling",description:"Book the best time slots before they fill up."},{icon:mf,title:"Surprise Perks",description:"Get monthly bonuses like free stain treatment or scent boosters."}],re=[{q:"How do I cancel my subscription?",a:"You can cancel anytime from your account settings. No cancellation fees, and your benefits continue until the end of your billing period."},{q:"Can I pause my subscription?",a:"Yes! Going on vacation? Pause your subscription for up to 3 months and resume when you're back."},{q:"Is there a minimum order requirement?",a:"No minimum order required. Free delivery applies to all orders, even just a single item."},{q:"Can I share with family members?",a:"The Family Pass allows up to 4 members. Each member gets their own login and can place orders independently."}];return n.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[n.jsx("section",{className:"bg-gradient-to-r from-black via-gray-900 to-black text-white py-16",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 bg-[#e14171]/20 px-4 py-2 rounded-full mb-6",children:[n.jsx(Zu,{className:"h-5 w-5 text-[#e14171]"}),n.jsx("span",{className:"font-medium text-[#e14171]",children:"Bubble Pass"})]}),n.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold mb-4",children:["Unlimited Free Delivery.",n.jsx("br",{}),n.jsx("span",{className:"text-[#e14171]",children:"Exclusive Perks."})]}),n.jsx("p",{className:"text-xl text-gray-400 max-w-2xl mx-auto",children:"Join thousands of members who save time and money every month with Bubble Pass."})]})}),n.jsx("section",{className:"py-8",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"flex items-center justify-center gap-4",children:[n.jsx("button",{onClick:()=>_("monthly"),className:`px-6 py-2 rounded-full font-medium transition-colors ${h==="monthly"?"bg-[#e14171] text-white":"bg-white text-gray-600"}`,children:"Monthly"}),n.jsxs("button",{onClick:()=>_("yearly"),className:`px-6 py-2 rounded-full font-medium transition-colors flex items-center gap-2 ${h==="yearly"?"bg-[#e14171] text-white":"bg-white text-gray-600"}`,children:["Yearly",n.jsx("span",{className:"bg-green-500 text-white text-xs px-2 py-0.5 rounded-full",children:"Save 17%"})]})]})})}),n.jsx("section",{className:"py-8",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[T&&n.jsxs("div",{className:"flex items-center justify-center py-8 mb-8",children:[n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"}),n.jsx("span",{className:"ml-3 text-gray-600",children:"Loading pricing..."})]}),n.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:c.map((se,ue)=>n.jsxs("div",{className:`relative bg-white rounded-2xl overflow-hidden transition-all duration-300 flex flex-col h-full ${se.popular?"ring-2 ring-[#e14171] shadow-xl":"shadow-sm"} ${S===se.name?"ring-2 ring-[#e14171] shadow-xl transform scale-[1.02]":""}`,children:[se.popular&&n.jsxs("div",{className:"absolute top-0 left-0 right-0 bg-[#e14171] text-white text-center py-2 text-sm font-medium",children:[n.jsx(ro,{className:"h-4 w-4 inline mr-1"}),"Most Popular"]}),S===se.name&&!se.popular&&n.jsxs("div",{className:"absolute top-0 left-0 right-0 bg-green-500 text-white text-center py-2 text-sm font-medium",children:[n.jsx(Gu,{className:"h-4 w-4 inline mr-1"}),"Selected"]}),n.jsxs("div",{className:`flex flex-col h-full p-6 sm:p-8 ${se.popular||S===se.name?"pt-12 sm:pt-14":""}`,children:[n.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-2",children:se.name}),n.jsx("p",{className:"text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base",children:se.description}),n.jsxs("div",{className:"mb-4 sm:mb-6",children:[n.jsxs("span",{className:"text-3xl sm:text-4xl font-bold text-gray-900",children:["$",h==="monthly"?se.monthlyPrice:se.yearlyPrice]}),n.jsxs("span",{className:"text-gray-500",children:["/",h==="monthly"?"mo":"yr"]}),h==="yearly"&&se.monthlyPrice>0&&n.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["Save $",(se.monthlyPrice*12-se.yearlyPrice).toFixed(0),"/year"]})]}),n.jsx("ul",{className:"space-y-2 sm:space-y-3 mb-6 sm:mb-8",children:se.features.map((ae,Q)=>n.jsxs("li",{className:"flex items-start gap-2 sm:gap-3",children:[ae.included?n.jsx(ni,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}):n.jsx(Ga,{className:"h-5 w-5 text-gray-300 flex-shrink-0 mt-0.5"}),n.jsx("span",{className:`text-sm sm:text-base ${ae.included?"text-gray-700":"text-gray-400"}`,children:ae.text})]},Q))}),se.monthlyPrice===0?n.jsx("button",{onClick:()=>k(se.name),className:`mt-auto w-full h-12 sm:h-14 rounded-full font-semibold transition-all duration-200 text-sm sm:text-base active:scale-95 flex items-center justify-center ${S===se.name?"bg-gray-900 text-white shadow-lg":"bg-white border-2 border-gray-200 text-gray-700 shadow-sm hover:border-gray-400 hover:shadow-md"}`,children:S===se.name?"Selected":"Select Basic"}):n.jsx("button",{onClick:()=>k(se.name),className:`mt-auto w-full h-12 sm:h-14 rounded-full font-semibold transition-all duration-200 text-sm sm:text-base active:scale-95 flex items-center justify-center gap-2 ${S===se.name?"bg-green-500 text-white hover:bg-green-600 shadow-lg":se.popular?"bg-[#e14171] text-white hover:bg-[#c73562] shadow-lg hover:shadow-xl":"bg-gray-100 text-gray-900 hover:bg-gray-200 shadow-sm hover:shadow-md"}`,children:S===se.name?n.jsxs("span",{className:"flex items-center justify-center gap-2",children:[n.jsx(Gu,{className:"h-5 w-5"}),"Selected"]}):se.cta})]})]},ue))}),S&&S!=="Basic"&&n.jsxs("div",{className:"mt-8 text-center",children:[n.jsxs("button",{onClick:()=>m("/booking"),className:"inline-flex items-center justify-center gap-2 bg-[#e14171] text-white px-8 py-4 rounded-full font-semibold hover:bg-[#c73562] transition-all duration-200 shadow-lg hover:shadow-xl active:scale-95 text-sm sm:text-base",children:["Continue with ",S,n.jsx(Dn,{className:"h-5 w-5"})]}),n.jsxs("p",{className:"text-gray-500 text-sm mt-3",children:[h==="yearly"?"Billed annually":"Billed monthly","  Cancel anytime"]})]})]})}),n.jsx("section",{className:"py-16 bg-white",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"text-center mb-12",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Member Benefits"}),n.jsx("p",{className:"text-gray-600",children:"Everything you get with your Bubble Pass subscription"})]}),n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-8",children:F.map((se,ue)=>n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-pink-100 rounded-2xl mb-4",children:n.jsx(se.icon,{className:"h-8 w-8 text-[#e14171]"})}),n.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:se.title}),n.jsx("p",{className:"text-gray-600 text-sm",children:se.description})]},ue))})]})}),n.jsx("section",{className:"py-16 bg-gradient-to-r from-[#e14171] to-pink-600 text-white",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-center",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-3xl font-bold mb-4",children:"See Your Savings"}),n.jsx("p",{className:"text-pink-100 mb-6",children:"If you use our services just twice a month, you're already saving money with Bubble Pass."}),n.jsxs("div",{className:"bg-white/10 rounded-2xl p-6",children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsx("span",{className:"text-pink-100",children:"2 orders/month  $5 delivery"}),n.jsx("span",{className:"font-semibold",children:"$10/month"})]}),n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsx("span",{className:"text-pink-100",children:"Bubble Pass cost"}),n.jsx("span",{className:"font-semibold",children:"-$9.99/month"})]}),n.jsx("div",{className:"border-t border-white/20 pt-4",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"font-semibold",children:"You save"}),n.jsx("span",{className:"text-2xl font-bold text-green-300",children:"$0.01+"})]})})]}),n.jsx("p",{className:"text-sm text-pink-100 mt-4",children:"* Plus 10% off all services and exclusive perks!"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 sm:p-8 text-gray-900",children:[n.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-4",children:"Start saving today"}),n.jsx("p",{className:"text-gray-600 mb-6 text-sm sm:text-base",children:"Get your first month free when you sign up for an annual plan."}),n.jsxs("button",{onClick:()=>{k("Bubble Pass"),_("yearly"),window.scrollTo({top:400,behavior:"smooth"})},className:"w-full bg-[#e14171] text-white py-3 sm:py-4 rounded-full font-medium hover:bg-[#c73562] transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base active:scale-95 shadow-lg hover:shadow-xl",children:["Get Bubble Pass Now",n.jsx(Dn,{className:"h-5 w-5"})]})]})]})})}),n.jsx("section",{className:"py-16",children:n.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-8 text-center",children:"Frequently Asked Questions"}),n.jsx("div",{className:"space-y-4",children:re.map((se,ue)=>n.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:se.q}),n.jsx("p",{className:"text-gray-600",children:se.a})]},ue))})]})}),n.jsx("section",{className:"py-12 sm:py-16 bg-white",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-4",children:"Ready to Join Thousands of Happy Members?"}),n.jsx("p",{className:"text-gray-600 mb-6 sm:mb-8 text-sm sm:text-base",children:"Start your Bubble Pass subscription today."}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center",children:[n.jsxs("button",{onClick:()=>{k("Bubble Pass"),window.scrollTo({top:400,behavior:"smooth"})},className:"inline-flex items-center justify-center gap-2 bg-[#e14171] text-white px-6 sm:px-8 py-3 sm:py-4 rounded-full font-semibold hover:bg-[#c73562] transition-all duration-200 active:scale-95 shadow-lg hover:shadow-xl text-sm sm:text-base",children:["Subscribe Now",n.jsx(Dn,{className:"h-5 w-5"})]}),n.jsx(wr,{to:"/booking",className:"inline-flex items-center justify-center gap-2 border-2 border-gray-300 text-gray-700 px-6 sm:px-8 py-3 sm:py-4 rounded-full font-semibold hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 active:scale-95 text-sm sm:text-base",children:"Try Without Subscribing"})]})]})})]})}function Ag(m){const[h,_]=ee.useState([]),[S,k]=ee.useState(!0),[P,T]=ee.useState(null),c=async(de,Ae,Ye)=>{if(!Ae)return;const{data:_t}=await vt.from("driver_trips").select("id").eq("order_id",de).eq("trip_type",Ye).is("completed_at",null).limit(1).single();_t?await vt.from("driver_trips").update({driver_id:Ae,started_at:new Date().toISOString()}).eq("id",_t.id):await vt.from("driver_trips").insert({order_id:de,driver_id:Ae,trip_type:Ye,started_at:new Date().toISOString()})},O=async(de,Ae)=>{await vt.from("driver_trips").update({completed_at:new Date().toISOString()}).eq("order_id",de).eq("trip_type",Ae).is("completed_at",null)},F=async()=>{if(!m){k(!1);return}try{const{data:de,error:Ae}=await vt.from("orders").select(`
          *,
          order_items (*),
          order_preferences (*),
          order_addons (*)
        `).eq("user_id",m).order("created_at",{ascending:!1});if(Ae)throw Ae;const Ye=(de||[]).map(zt=>zt.id);let _t={};if(Ye.length>0){const{data:zt,error:ht}=await vt.from("user_credits").select("source_id, amount, type, source_type").in("source_id",Ye).eq("source_type","order");!ht&&zt&&(_t=zt.reduce((Qe,Ce)=>{if(Ce.source_id){const We=Number(Ce.amount)||0,dt=Ce.type==="used"&&We>0?We:We<0?Math.abs(We):0;Qe[Ce.source_id]=(Qe[Ce.source_id]||0)+dt}return Qe},{}))}const Et=(de||[]).map(zt=>({...zt,order_items:zt.order_items||[],order_preferences:zt.order_preferences?.[0]||zt.order_preferences||null,order_addons:zt.order_addons||[],applied_credit:_t[zt.id]||0}));_(Et)}catch(de){T(de)}finally{k(!1)}},re=async de=>{try{const[Ae,Ye,_t,Et]=await Promise.all([vt.from("orders").select("*").eq("id",de).single(),vt.from("order_items").select("*").eq("order_id",de),vt.from("order_preferences").select("*").eq("order_id",de).single(),vt.from("order_addons").select("*").eq("order_id",de)]);if(Ae.error)throw Ae.error;return{order:Ae.data,items:Ye.data||[],preferences:_t.data,addons:Et.data||[]}}catch(Ae){throw Ae}},se=async de=>{if(!m)throw new Error("User not authenticated");try{const Ae=`BB-${new Date().getFullYear()}-${Math.floor(1e3+Math.random()*9e3)}`,Ye=new Date;Ye.setDate(Ye.getDate()+1);const _t=new Date;_t.setDate(_t.getDate()+2);const{data:Et,error:zt}=await vt.from("orders").insert({user_id:m,order_number:Ae,service_type:de.serviceType,status:"pending",subtotal:de.subtotal,delivery_fee:de.deliveryFee,discount:de.discount||0,promo_code:de.promoCode||null,total:de.total,pickup_address:de.pickupAddress,pickup_landmark:de.pickupLandmark||null,pickup_date:de.pickupDate||Ye.toISOString().split("T")[0],delivery_date:de.deliveryDate||_t.toISOString().split("T")[0]}).select().single();if(zt)throw console.error("Order creation error:",zt),new Error(`Failed to create order: ${zt.message}`);if(de.items.length>0){const Ze=de.items.map(le=>({order_id:Et.id,item_type:le.itemType,item_name:le.itemName,quantity:le.quantity,unit_price:le.unitPrice,total_price:le.unitPrice*le.quantity})),{error:Pe}=await vt.from("order_items").insert(Ze);if(Pe)throw console.error("Order items error:",Pe),new Error(`Failed to add items: ${Pe.message}`)}const ht={order_id:Et.id,fabric_softener:de.preferences.fabricSoftener||!1,shirts_hung:de.preferences.shirtsHung||!1,pants_creased:de.preferences.pantsCreased||!1};de.preferences.detergentType&&(ht.detergent_type=de.preferences.detergentType),de.preferences.waterTemp&&(ht.water_temp=de.preferences.waterTemp),de.preferences.dryingHeat&&(ht.drying_heat=de.preferences.dryingHeat),de.preferences.foldingStyle&&(ht.folding_style=de.preferences.foldingStyle),de.preferences.dropoffInstructions&&(ht.dropoff_instructions=de.preferences.dropoffInstructions),de.preferences.customDropoffInstruction&&(ht.custom_dropoff_instruction=de.preferences.customDropoffInstruction),de.preferences.packagingType&&(ht.packaging_type=de.preferences.packagingType),de.preferences.notificationStyle&&(ht.notification_style=de.preferences.notificationStyle);const{error:Qe}=await vt.from("order_preferences").insert(ht);if(Qe)throw console.error("Order preferences error:",Qe),new Error(`Failed to save preferences: ${Qe.message}`);const Ce=[];if(de.addons.stainTreatment&&Ce.push({order_id:Et.id,addon_type:"stain_treatment",price:3,notes:de.addons.stainNote}),de.addons.whitening&&Ce.push({order_id:Et.id,addon_type:"whitening",price:4}),de.addons.scentBoosters&&Ce.push({order_id:Et.id,addon_type:"scent_boosters",price:3}),de.addons.repairs&&Ce.push({order_id:Et.id,addon_type:"repairs",price:5}),Ce.length>0){const{error:Ze}=await vt.from("order_addons").insert(Ce);if(Ze)throw console.error("Order addons error:",Ze),new Error(`Failed to add addons: ${Ze.message}`)}const{error:We}=await vt.from("payments").insert({order_id:Et.id,user_id:m,amount:de.total,payment_method:de.paymentMethod,status:de.paymentMethod==="cash"?"pending":"authorized"});if(We)throw console.error("Payment error:",We),new Error(`Failed to create payment: ${We.message}`);const{error:dt}=await vt.from("order_status_history").insert({order_id:Et.id,status:"pending",notes:"Order placed"});if(dt)throw console.error("Status history error:",dt),new Error(`Failed to record status: ${dt.message}`);return await F(),Et}catch(Ae){throw Ae}},ue=()=>h.find(de=>!["delivered","cancelled"].includes(de.status)),ae=()=>h.filter(de=>!["delivered","cancelled"].includes(de.status)),Q=async de=>{if(!m)return{success:!1,message:"You must be logged in to cancel an order"};try{const{data:Ae,error:Ye}=await vt.from("orders").select("status").eq("id",de).eq("user_id",m).single();if(Ye)throw Ye;if(!Ae)return{success:!1,message:"Order not found"};if(!["pending","confirmed","scheduled"].includes(Ae.status))return{success:!1,message:`Cannot cancel order. Order is already "${Ae.status}". Only pending, confirmed, or scheduled orders can be cancelled.`};const{error:Et}=await vt.from("orders").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("id",de).eq("user_id",m);if(Et)throw Et;return await vt.from("order_status_history").insert({order_id:de,status:"cancelled",notes:"Cancelled by customer"}),await vt.from("payments").update({status:"refunded",updated_at:new Date().toISOString()}).eq("order_id",de),await F(),{success:!0,message:"Order cancelled successfully. Any payment will be refunded."}}catch(Ae){return{success:!1,message:Ae instanceof Error?Ae.message:"Failed to cancel order"}}},Y=async()=>{try{const{data:de,error:Ae}=await vt.from("orders").select(`
          *,
          order_items (*),
          order_preferences (*),
          order_addons (*)
        `).order("created_at",{ascending:!1});if(Ae)throw console.error("Error fetching orders:",Ae),Ae;if(!de||de.length===0)return[];const Ye=[...new Set(de.map(zt=>zt.user_id).filter(Boolean))];let _t=new Map;if(Ye.length>0){const{data:zt,error:ht}=await vt.from("users").select("id, email, full_name, phone").in("id",Ye);ht?console.error("Error fetching users:",ht):zt&&zt.forEach(Qe=>{_t.set(Qe.id,Qe)})}return de.map(zt=>({...zt,order_items:zt.order_items||[],order_preferences:zt.order_preferences?.[0]||zt.order_preferences||null,order_addons:zt.order_addons||[],customer:_t.get(zt.user_id)||null}))}catch(de){return console.error("Error fetching all orders:",de),[]}},G=async de=>{try{const{data:Ae,error:Ye}=await vt.from("orders").select("id, user_id").eq("id",de).single();if(Ye||!Ae?.user_id)return;const{count:_t}=await vt.from("orders").select("id",{head:!0,count:"exact"}).eq("user_id",Ae.user_id).eq("status","delivered");if((_t??0)>1)return;const{data:Et,error:zt}=await vt.from("referrals").select("*").eq("referee_id",Ae.user_id).order("created_at",{ascending:!0}).limit(1).single();if(zt||!Et||Et.referrer_credited)return;let ht=Et.referrer_credit_amount||0;if(!ht||ht<=0){const{data:Qe}=await vt.from("app_settings").select("value").eq("key","referral_referrer_bonus").single();ht=Qe&&parseFloat(Qe.value)||10}await vt.from("user_credits").insert({user_id:Et.referrer_id,amount:ht,type:"referral_bonus",description:`Referral bonus for order ${Ae.id}`,reference_id:Et.id}),await vt.from("referrals").update({status:"completed",referrer_credited:!0,referrer_credit_amount:ht,completed_at:new Date().toISOString()}).eq("id",Et.id)}catch(Ae){console.error("Error awarding referral bonus:",Ae)}},pe=async(de,Ae,Ye)=>{try{const{data:_t,error:Et}=await vt.from("orders").select("id, driver_id").eq("id",de).single();if(Et)throw Et;const zt=_t?.driver_id||null,{error:ht}=await vt.from("orders").update({status:Ae,updated_at:new Date().toISOString()}).eq("id",de);if(ht)throw ht;const{error:Qe}=await vt.from("order_status_history").insert({order_id:de,status:Ae,notes:Ye||`Status updated to ${Ae}`});if(Qe)throw Qe;return Ae==="picked_up"&&await c(de,zt,"pickup"),Ae==="at_facility"&&await O(de,"pickup"),Ae==="out_for_delivery"&&await c(de,zt,"delivery"),Ae==="delivered"&&await O(de,"delivery"),Ae==="delivered"&&await G(de),{success:!0,message:"Order status updated"}}catch(_t){return{success:!1,message:_t instanceof Error?_t.message:"Failed to update status"}}},_e=(de,Ae)=>{const Ye=vt.channel(`order-${de}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`id=eq.${de}`},_t=>{Ae(_t.new)}).subscribe();return()=>{Ye.unsubscribe()}};return ee.useEffect(()=>{F()},[m]),{orders:h,loading:S,error:P,fetchOrders:F,fetchAllOrders:Y,fetchOrderDetails:re,createOrder:se,getActiveOrder:ue,getActiveOrders:ae,cancelOrder:Q,updateOrderStatus:pe,subscribeToOrderUpdates:_e,assignDriver:async(de,Ae,Ye)=>{try{const{error:_t}=await vt.from("orders").update({driver_id:Ae,assigned_at:Ae?new Date().toISOString():null,assigned_by:Ae?Ye:null}).eq("id",de);if(_t)throw _t;return await vt.from("order_status_history").insert({order_id:de,status:Ae?"driver_assigned":"driver_unassigned",notes:Ae?"Driver assigned":"Driver unassigned",changed_by:Ye}),Ae&&await c(de,Ae,"pickup"),{success:!0}}catch(_t){return console.error("Error assigning driver:",_t),{success:!1,error:_t}}},togglePriority:async(de,Ae)=>{try{const{error:Ye}=await vt.from("orders").update({is_priority:Ae}).eq("id",de);if(Ye)throw Ye;return{success:!0}}catch(Ye){return console.error("Error toggling priority:",Ye),{success:!1,error:Ye}}},updateInternalNotes:async(de,Ae)=>{try{const{error:Ye}=await vt.from("orders").update({internal_notes:Ae}).eq("id",de);if(Ye)throw Ye;return{success:!0}}catch(Ye){return console.error("Error updating notes:",Ye),{success:!1,error:Ye}}},getOrderHistory:async de=>{try{const{data:Ae,error:Ye}=await vt.from("order_status_history").select("*").eq("order_id",de).order("created_at",{ascending:!0});if(Ye)throw Ye;return Ae||[]}catch(Ae){return console.error("Error fetching order history:",Ae),[]}},recordActualTime:async(de,Ae)=>{try{const Ye=Ae==="pickup"?"actual_pickup_time":"actual_delivery_time",{error:_t}=await vt.from("orders").update({[Ye]:new Date().toISOString()}).eq("id",de);if(_t)throw _t;return{success:!0}}catch(Ye){return console.error("Error recording time:",Ye),{success:!1,error:Ye}}}}}function nT(){const[m,h]=ee.useState(!1),[_,S]=ee.useState(null),[k,P]=ee.useState(0),{getNumberSetting:T}=Cg(),c=async(se,ue,ae)=>{if(!se.trim())return{valid:!1,promo:null,message:"Please enter a promo code",discountAmount:0};h(!0);try{const Q=ae??T("delivery_fee",5),{data:Y,error:G}=await vt.from("promo_codes").select("*").eq("code",se.toUpperCase().trim()).single();if(G||!Y)return{valid:!1,promo:null,message:"Invalid promo code. Please check and try again.",discountAmount:0};if(!Y.is_active)return{valid:!1,promo:null,message:"This promo code is no longer active.",discountAmount:0};if(Y.expires_at&&new Date(Y.expires_at)<new Date)return{valid:!1,promo:null,message:"This promo code has expired.",discountAmount:0};if(Y.max_uses&&Y.uses_count>=Y.max_uses)return{valid:!1,promo:null,message:"This promo code has reached its maximum uses.",discountAmount:0};if(Y.min_order_amount&&ue<Y.min_order_amount)return{valid:!1,promo:null,message:`Minimum order amount of $${Y.min_order_amount.toFixed(2)} required for this code.`,discountAmount:0};let pe=0;return Y.discount_type==="percentage"?pe=ue*Y.discount_value/100:Y.discount_type==="fixed"?pe=Y.discount_value:Y.discount_type==="free_delivery"&&(pe=Q),pe=Math.min(pe,ue),{valid:!0,promo:Y,message:oT(Y),discountAmount:pe}}catch(Q){return console.error("Error validating promo code:",Q),{valid:!1,promo:null,message:"Error validating promo code. Please try again.",discountAmount:0}}finally{h(!1)}};return{loading:m,appliedPromo:_,discountAmount:k,applyPromoCode:async(se,ue,ae)=>{const Q=await c(se,ue,ae);return Q.valid&&Q.promo&&(S(Q.promo),P(Q.discountAmount)),Q},removePromoCode:()=>{S(null),P(0)},incrementPromoUsage:async se=>{try{const{error:ue}=await vt.from("promo_codes").update({uses_count:(_?.uses_count||0)+1}).eq("id",se);ue&&console.error("Error incrementing promo usage:",ue)}catch(ue){console.error("Error incrementing promo usage:",ue)}}}}function oT(m){return m.discount_type==="percentage"?`${m.discount_value}% discount applied!`:m.discount_type==="fixed"?`$${m.discount_value.toFixed(2)} discount applied!`:m.discount_type==="free_delivery"?"Free delivery applied!":"Promo code applied!"}function bv(){const{user:m}=ao(),[h,_]=ee.useState([]),[S,k]=ee.useState(!0),[P,T]=ee.useState(null),c=ee.useCallback(async()=>{if(!m){_([]),k(!1);return}try{k(!0),T(null);const{data:ae,error:Q}=await vt.from("user_addresses").select("id, user_id, label, address, landmark, is_default, created_at, latitude, longitude").eq("user_id",m.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(Q)throw Q;_(ae||[])}catch(ae){console.error("Error fetching addresses:",ae),T("Failed to load addresses")}finally{k(!1)}},[m]);ee.useEffect(()=>{c()},[c]);const O=async ae=>{if(!m)return{success:!1,message:"Please sign in to save addresses"};try{if(ae.is_default){const{error:pe}=await vt.from("user_addresses").update({is_default:!1}).eq("user_id",m.id);pe&&console.error("Error updating default status:",pe)}const Q=h.length===0,{data:Y,error:G}=await vt.from("user_addresses").insert({user_id:m.id,label:ae.label,address:ae.address,landmark:ae.landmark||"",latitude:ae.latitude??null,longitude:ae.longitude??null,is_default:ae.is_default||Q}).select().single();if(G)throw console.error("Insert error details:",G),G;return await c(),{success:!0,message:"Address saved successfully!",address:Y}}catch(Q){return console.error("Error adding address:",Q),{success:!1,message:`Failed to save address: ${Q instanceof Error?Q.message:typeof Q=="object"&&Q!==null&&"message"in Q?String(Q.message):"Failed to save address. Please try again."}`}}},F=async(ae,Q)=>{if(!m)return{success:!1,message:"Please sign in to update addresses"};try{if(Q.is_default){const{error:_e}=await vt.from("user_addresses").update({is_default:!1}).eq("user_id",m.id);_e&&console.error("Error clearing default status:",_e)}const Y={};Q.label!==void 0&&(Y.label=Q.label),Q.address!==void 0&&(Y.address=Q.address),Q.landmark!==void 0&&(Y.landmark=Q.landmark),Q.is_default!==void 0&&(Y.is_default=Q.is_default),Q.latitude!==void 0&&(Y.latitude=Q.latitude),Q.longitude!==void 0&&(Y.longitude=Q.longitude),console.log("Updating address:",{addressId:ae,updateData:Y,userId:m.id});const{data:G,error:pe}=await vt.from("user_addresses").update(Y).eq("id",ae).eq("user_id",m.id).select();return console.log("Update response:",{data:G,updateError:pe}),pe?(console.error("Update error details:",pe),{success:!1,message:`Failed to update address: ${pe.message}`}):!G||G.length===0?{success:!1,message:"Address not found or you do not have permission to update it"}:(await c(),{success:!0,message:"Address updated successfully!"})}catch(Y){return console.error("Error updating address:",Y),{success:!1,message:`Failed to update address: ${Y instanceof Error?Y.message:typeof Y=="object"&&Y!==null&&"message"in Y?String(Y.message):"Unknown error occurred"}`}}};return{addresses:h,loading:S,error:P,fetchAddresses:c,addAddress:O,updateAddress:F,deleteAddress:async ae=>{if(!m)return{success:!1,message:"Please sign in to delete addresses"};try{const Q=h.find(G=>G.id===ae),{error:Y}=await vt.from("user_addresses").delete().eq("id",ae).eq("user_id",m.id);if(Y)throw Y;if(Q?.is_default&&h.length>1){const G=h.filter(pe=>pe.id!==ae);G.length>0&&await vt.from("user_addresses").update({is_default:!0}).eq("id",G[0].id)}return await c(),{success:!0,message:"Address deleted successfully!"}}catch(Q){return console.error("Error deleting address:",Q),{success:!1,message:"Failed to delete address. Please try again."}}},setDefaultAddress:async ae=>F(ae,{is_default:!0}),getDefaultAddress:()=>h.find(ae=>ae.is_default)||h[0]||null}}function lT(){const m=yf(),{user:h}=ao(),{createOrder:_}=Ag(h?.id),{addresses:S,loading:k,addAddress:P}=bv(),{loading:T,appliedPromo:c,discountAmount:O,applyPromoCode:F,removePromoCode:re,incrementPromoUsage:se}=nT(),{products:ue,loading:ae,fetchProducts:Q}=__(),{getNumberSetting:Y}=Cg(),{getCreditBalance:G,useCredits:pe}=ox(),_e=Y("delivery_fee",5);ee.useEffect(()=>{Q()},[Q]),ee.useEffect(()=>{let xe=!0;return(async()=>{if(!h){xe&&le(0);return}const Ft=await G();xe&&(le(Ft),Ot(Gt=>Math.min(Gt,Ft)))})(),()=>{xe=!1}},[h,G]),ee.useEffect(()=>{ue.length>0&&(console.log("Products loaded:",ue.length,"items"),console.log("Laundry products:",ue.filter(xe=>xe.category==="laundry")))},[ue]);const Ne=ue.filter(xe=>xe.category==="laundry"&&xe.is_active),Oe=ue.filter(xe=>xe.category==="suit"&&xe.is_active),Be=ue.filter(xe=>xe.category==="shoe"&&xe.is_active),xt=ue.filter(xe=>xe.category==="dry-clean"&&xe.is_active),$e=ue.filter(xe=>xe.category==="addon"&&xe.is_active),[de,Ae]=ee.useState(1),[Ye,_t]=ee.useState(!1),[Et,zt]=ee.useState(!1),[ht,Qe]=ee.useState(""),[Ce,We]=ee.useState(""),[dt,Ze]=ee.useState(!1),[Pe,le]=ee.useState(0),[Le,nt]=ee.useState(!1),[lt,Ot]=ee.useState(0),[Mt,mt]=ee.useState({address:"",landmark:"",usingGPS:!1}),[Dt,ys]=ee.useState(null),[js,ks]=ee.useState(null),[Es,Rr]=ee.useState(!1),[us,xs]=ee.useState([]),[Is,Os]=ee.useState([]),[ar,vi]=ee.useState([]),[wt,qs]=ee.useState(""),[yr,Ha]=ee.useState(""),[Ms,oi]=ee.useState(""),[Fr,Oi]=ee.useState(""),[Gi,Fs]=ee.useState(null),[Ls,Fe]=ee.useState({detergent:null,softener:!1,waterTemp:null,dryingHeat:null}),[H,K]=ee.useState({foldingStyle:null,shirtsHung:!1,pantsCreased:!1}),[U,he]=ee.useState({dropoffInstructions:"",packagingType:null,notificationStyle:null}),[ve,Ve]=ee.useState({stainTreatment:!1,whitening:!1,scentBoosters:!1,repairs:!1}),[He,Ue]=ee.useState(""),[Re,ot]=ee.useState(null),[rt,Te]=ee.useState(""),[Vt,as]=ee.useState(null),[Kt,ss]=ee.useState(!1),[Qt,ls]=ee.useState(""),[xr,Sr]=ee.useState(!1),Gs=Ne.find(xe=>xe.name.toLowerCase().includes("regular")),vr=Ne.find(xe=>xe.name.toLowerCase().includes("large")),Rs=Ne.find(xe=>xe.name.toLowerCase().includes("hang")),Nt=xe=>`$${xe.toFixed(0)}`,Ps=Oe.map(xe=>({id:xe.id,name:xe.name,price:Nt(xe.price),priceNum:xe.price})),Ks=Be.map(xe=>({id:xe.id,name:xe.name,price:Nt(xe.price),priceNum:xe.price})),li=xt.map(xe=>({id:xe.id,name:xe.name,price:Nt(xe.price),priceNum:xe.price}));ee.useEffect(()=>{if(xr)return;const xe=sessionStorage.getItem("reorderData");if(xe)try{const Pt=JSON.parse(xe);if(console.log("Loading reorder data:",Pt),Pt.serviceType&&ys(Pt.serviceType),Pt.items&&Array.isArray(Pt.items)&&Pt.items.forEach(Ft=>{if(Ft.item_type==="laundry_bag")Ft.item_name.toLowerCase().includes("large")?ks("large"):ks("regular");else if(Ft.item_type==="addon"&&Ft.item_name.toLowerCase().includes("hang"))Rr(!0);else if(Ft.item_type==="suit"){const Gt=Ps.find(Ht=>Ht.name.toLowerCase()===Ft.item_name.toLowerCase());Gt&&xs(Ht=>[...Ht,Gt.id])}else if(Ft.item_type==="shoe"){const Gt=Ks.find(Ht=>Ht.name.toLowerCase()===Ft.item_name.toLowerCase());Gt&&Os(Ht=>[...Ht,Gt.id])}else if(Ft.item_type==="dry_clean"){const Gt=li.find(Ht=>Ht.name.toLowerCase()===Ft.item_name.toLowerCase());Gt&&vi(Ht=>[...Ht,Gt.id])}}),Pt.preferences){const Ft=Pt.preferences;Ft.detergent_type&&Fe(Gt=>({...Gt,detergent:Ft.detergent_type})),Ft.fabric_softener!==void 0&&Fe(Gt=>({...Gt,softener:Ft.fabric_softener})),Ft.water_temp&&Fe(Gt=>({...Gt,waterTemp:Ft.water_temp})),Ft.drying_heat&&Fe(Gt=>({...Gt,dryingHeat:Ft.drying_heat})),Ft.folding_style&&K(Gt=>({...Gt,foldingStyle:Ft.folding_style})),Ft.shirts_hung!==void 0&&K(Gt=>({...Gt,shirtsHung:Ft.shirts_hung})),Ft.pants_creased!==void 0&&K(Gt=>({...Gt,pantsCreased:Ft.pants_creased})),Ft.dropoff_instructions&&he(Gt=>({...Gt,dropoffInstructions:Ft.dropoff_instructions})),Ft.custom_dropoff_instruction&&Te(Ft.custom_dropoff_instruction),Ft.packaging_type&&he(Gt=>({...Gt,packagingType:Ft.packaging_type})),Ft.notification_style&&he(Gt=>({...Gt,notificationStyle:Ft.notification_style}))}Pt.addons&&Array.isArray(Pt.addons)&&Pt.addons.forEach(Ft=>{Ft.addon_type==="stain_treatment"?Ve(Gt=>({...Gt,stainTreatment:!0})):Ft.addon_type==="whitening"?Ve(Gt=>({...Gt,whitening:!0})):Ft.addon_type==="scent_boosters"?Ve(Gt=>({...Gt,scentBoosters:!0})):Ft.addon_type==="repairs"&&Ve(Gt=>({...Gt,repairs:!0}))}),sessionStorage.removeItem("reorderData"),Sr(!0)}catch(Pt){console.error("Error parsing reorder data:",Pt),sessionStorage.removeItem("reorderData")}Sr(!0)},[xr]);const Hs=[{num:1,title:"Location",icon:qa},{num:2,title:"Services",icon:Qy},{num:3,title:"Schedule",icon:hg},{num:4,title:"Checkout",icon:b0}],Ct=[{id:"9-11",label:"9:00 AM - 11:00 AM",available:!0},{id:"11-1",label:"11:00 AM - 1:00 PM",available:!0},{id:"1-3",label:"1:00 PM - 3:00 PM",available:!0},{id:"3-5",label:"3:00 PM - 5:00 PM",available:!0},{id:"5-7",label:"5:00 PM - 7:00 PM",available:!0},{id:"7-9",label:"7:00 PM - 9:00 PM",available:!0}],es=(()=>{const xe=[],Pt=new Date;for(let Ft=1;Ft<=14;Ft++){const Gt=new Date(Pt);Gt.setDate(Pt.getDate()+Ft),xe.push({date:Gt.toISOString().split("T")[0],dayName:Gt.toLocaleDateString("en-US",{weekday:"short"}),dayNum:Gt.getDate(),monthName:Gt.toLocaleDateString("en-US",{month:"short"}),fullDisplay:Gt.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})})}return xe})(),rc=(()=>{if(!wt)return es.slice(1);const xe=es.findIndex(Pt=>Pt.date===wt);return es.slice(xe+1)})(),va=[{id:"executive",name:"The Executive",description:"Everything on hangers, starched, premium scent",settings:{cleaning:{detergent:"standard",softener:!0,waterTemp:"warm",dryingHeat:"medium"},finishing:{foldingStyle:"square",shirtsHung:!0,pantsCreased:!0}}},{id:"family",name:"The Family",description:"Fragrance-free, folded, large bags, cold wash",settings:{cleaning:{detergent:"hypoallergenic",softener:!1,waterTemp:"cold",dryingHeat:"low"},finishing:{foldingStyle:"square",shirtsHung:!1,pantsCreased:!1}}},{id:"eco",name:"The Eco-Warrior",description:"Cold wash, eco-detergent, paper bags, no dryer",settings:{cleaning:{detergent:"eco",softener:!1,waterTemp:"cold",dryingHeat:"low"},finishing:{foldingStyle:"rolled",shirtsHung:!1,pantsCreased:!1}}}],ds=xe=>{Fs(xe);const Pt=va.find(Ft=>Ft.id===xe);Pt&&(Fe(Pt.settings.cleaning),K(Pt.settings.finishing),xe==="eco"&&he(Ft=>({...Ft,packagingType:"paper"})))},no=()=>{mt({address:"123 Main Street, Downtown District",landmark:"Near City Center Mall",usingGPS:!0})},ba=()=>{switch(de){case 1:return Mt.address.trim().length>=3;case 2:return Dt?Dt==="laundry"?js!==null:Dt==="suit"?us.length>0:Dt==="shoe"?Is.length>0:Dt==="dry-clean"?ar.length>0:Dt==="multiple"?js!==null||us.length>0||Is.length>0||ar.length>0:!0:!1;case 3:return wt&&yr&&Ms&&Fr;case 4:return Re!==null;default:return!0}},Za=()=>{let xe=0;(Dt==="laundry"||Dt==="multiple")&&(js==="regular"&&Gs?xe+=Gs.price:js==="large"&&vr&&(xe+=vr.price),Es&&Rs&&(xe+=Rs.price)),(Dt==="suit"||Dt==="multiple")&&us.forEach(Js=>{const fi=Ps.find(ia=>ia.id===Js);fi&&(xe+=fi.priceNum)}),(Dt==="shoe"||Dt==="multiple")&&Is.forEach(Js=>{const fi=Ks.find(ia=>ia.id===Js);fi&&(xe+=fi.priceNum)}),(Dt==="dry-clean"||Dt==="multiple")&&ar.forEach(Js=>{const fi=li.find(ia=>ia.id===Js);fi&&(xe+=fi.priceNum)});const Pt=$e.find(Js=>Js.name.toLowerCase().includes("stain")),Ft=$e.find(Js=>Js.name.toLowerCase().includes("whiten")),Gt=$e.find(Js=>Js.name.toLowerCase().includes("scent")),Ht=$e.find(Js=>Js.name.toLowerCase().includes("repair")&&!Js.name.toLowerCase().includes("minor"));return ve.stainTreatment&&Pt&&(xe+=Pt.price),ve.whitening&&Ft&&(xe+=Ft.price),ve.scentBoosters&&Gt&&(xe+=Gt.price),ve.repairs&&Ht&&(xe+=Ht.price),xe},hi=()=>{const xe=Za(),Pt=c?.discount_type==="free_delivery"?0:_e,Ft=O,Gt=xe+Pt-Ft,Ht=Math.min(Pe,Gt),Js=Le?Math.min(lt||0,Ht):0,fi=Math.max(0,Gt-Js);return{subtotal:xe,orderDeliveryFee:Pt,discount:Ft,totalBeforeCredit:Gt,appliedCredit:Js,payable:fi,maxCredit:Ht}};return n.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[n.jsx("div",{className:"bg-black shadow-sm sticky top-16 z-30",children:n.jsx("div",{className:"max-w-3xl mx-auto px-4 py-4",children:n.jsx("div",{className:"flex items-center justify-between",children:Hs.map((xe,Pt)=>n.jsxs("div",{className:"flex items-center",children:[n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${de>xe.num?"bg-green-500 text-white":de===xe.num?"bg-[#e14171] text-white":"bg-gray-700 text-gray-400"}`,children:de>xe.num?n.jsx(Gu,{className:"h-5 w-5"}):n.jsx(xe.icon,{className:"h-5 w-5"})}),n.jsx("span",{className:`text-xs mt-1 hidden sm:block ${de===xe.num?"text-[#e14171] font-medium":"text-gray-400"}`,children:xe.title})]}),Pt<Hs.length-1&&n.jsx("div",{className:`w-12 sm:w-24 h-1 mx-2 rounded ${de>xe.num?"bg-green-500":"bg-gray-700"}`})]},xe.num))})})}),n.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[de===1&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Where should we pick up?"}),n.jsx("p",{className:"text-gray-600",children:"Help us find you with precise location details."})]}),h&&S.length>0&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[n.jsx(qa,{className:"h-5 w-5 text-[#e14171]"}),"Saved Addresses"]}),k?n.jsx("div",{className:"flex items-center justify-center py-4",children:n.jsx(Ss,{className:"h-6 w-6 animate-spin text-[#e14171]"})}):n.jsx("div",{className:"space-y-3",children:S.map(xe=>n.jsx("button",{onClick:()=>{as(xe.id),mt({address:xe.address,landmark:xe.landmark,usingGPS:!1}),ss(!1)},className:`w-full p-4 rounded-xl border-2 text-left transition-all ${Vt===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${Vt===xe.id?"bg-[#e14171] text-white":"bg-gray-100 text-gray-500"}`,children:n.jsx(qa,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"font-medium text-gray-900",children:xe.label}),xe.is_default&&n.jsx("span",{className:"text-xs bg-pink-100 text-[#e14171] px-2 py-0.5 rounded-full",children:"Default"})]}),n.jsx("p",{className:"text-sm text-gray-600",children:xe.address}),xe.landmark&&n.jsx("p",{className:"text-xs text-gray-500",children:xe.landmark})]})]}),Vt===xe.id&&n.jsx(Gu,{className:"h-5 w-5 text-[#e14171]"})]})},xe.id))}),n.jsxs("div",{className:"relative my-4",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("div",{className:"w-full border-t border-gray-200"})}),n.jsx("div",{className:"relative flex justify-center text-sm",children:n.jsx("span",{className:"px-4 bg-white text-gray-500",children:"or use a new address"})})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm space-y-4",children:[n.jsxs("button",{onClick:()=>{no(),as(null)},className:"w-full flex items-center justify-center gap-2 py-3 border-2 border-dashed border-[#e14171] rounded-xl text-[#e14171] font-medium hover:bg-pink-50 transition-colors",children:[n.jsx(oj,{className:"h-5 w-5"}),Mt.usingGPS?"Location detected!":"Use My Current Location"]}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("div",{className:"w-full border-t border-gray-200"})}),n.jsx("div",{className:"relative flex justify-center text-sm",children:n.jsx("span",{className:"px-4 bg-white text-gray-500",children:"or enter manually"})})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Address / Area ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsxs("div",{className:"relative",children:[n.jsx(qa,{className:`absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 ${Mt.address.trim().length>=3?"text-green-500":"text-gray-400"}`}),n.jsx("input",{type:"text",placeholder:"Enter your street address...",value:Mt.address,onChange:xe=>{mt({...Mt,address:xe.target.value,usingGPS:!1}),as(null)},className:`w-full pl-12 pr-12 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] ${Mt.address.trim().length>=3?"border-green-500":"border-gray-200"}`}),Mt.address.trim().length>=3&&n.jsx(Gu,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-green-500"})]}),Mt.address.trim().length>0&&Mt.address.trim().length<3&&n.jsx("p",{className:"mt-1 text-sm text-red-500",children:"Please enter at least 3 characters"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Landmark (Recommended)"}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"text",placeholder:"e.g., Near the Red Mosque, 2nd floor above the pharmacy",value:Mt.landmark,onChange:xe=>mt({...Mt,landmark:xe.target.value}),className:`w-full px-4 pr-12 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] ${Mt.landmark.trim().length>=3?"border-green-500":"border-gray-200"}`}),Mt.landmark.trim().length>=3&&n.jsx(Gu,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-green-500"})]}),n.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"This helps our drivers find you quickly in areas without clear addresses."})]}),h&&!Vt&&Mt.address.trim().length>=3&&n.jsxs("div",{className:"border-t pt-4 mt-4",children:[n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:Kt,onChange:xe=>ss(xe.target.checked),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Save this address for future orders"})]}),Kt&&n.jsxs("div",{className:"mt-3 ml-8",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address Label"}),n.jsx("div",{className:"flex gap-2 mb-2",children:["Home","Work","Other"].map(xe=>n.jsx("button",{type:"button",onClick:()=>ls(xe),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${Qt===xe?"bg-[#e14171] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:xe},xe))}),n.jsx("input",{type:"text",value:Qt,onChange:xe=>ls(xe.target.value),placeholder:"Or enter custom label...",className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] text-sm"})]})]}),n.jsx("div",{className:"bg-gray-100 rounded-xl h-48 flex items-center justify-center",children:n.jsxs("div",{className:"text-center text-gray-500",children:[n.jsx(qa,{className:"h-12 w-12 mx-auto mb-2 text-[#e14171]"}),n.jsx("p",{children:"Drag the pin to your exact location"})]})})]})]}),de===2&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"What do you need cleaned?"}),n.jsx("p",{className:"text-gray-600",children:"Select your services and preferences."})]}),ae&&n.jsxs("div",{className:"flex items-center justify-center py-8",children:[n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"}),n.jsx("span",{className:"ml-2 text-gray-600",children:"Loading services..."})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Service Type"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3",children:[{id:"laundry",label:"Laundry",icon:Xy},{id:"suit",label:"Suit",icon:ff},{id:"shoe",label:"Shoe",icon:Pn},{id:"dry-clean",label:"Dry Clean",icon:Gx},{id:"multiple",label:"Multiple",icon:Qy}].map(xe=>n.jsxs("button",{onClick:()=>ys(xe.id),className:`p-4 rounded-xl border-2 transition-all ${Dt===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx(xe.icon,{className:`h-6 w-6 mx-auto mb-2 ${Dt===xe.id?"text-[#e14171]":"text-gray-400"}`}),n.jsx("span",{className:`text-sm font-medium ${Dt===xe.id?"text-[#e14171]":"text-gray-700"}`,children:xe.label})]},xe.id))}),!Dt&&n.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"Please select a service type to continue"})]}),(Dt==="laundry"||Dt==="multiple")&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm space-y-4",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:"Laundry Service"}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Bag Size"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Gs&&n.jsxs("button",{onClick:()=>ks("regular"),className:`p-4 rounded-xl border-2 text-left ${js==="regular"?"border-[#e14171] bg-pink-50":"border-gray-200"}`,children:[n.jsx("div",{className:"font-medium",children:Gs.name}),n.jsxs("div",{className:"text-sm text-gray-500",children:[Gs.description,"  $",Gs.price]})]}),vr&&n.jsxs("button",{onClick:()=>ks("large"),className:`p-4 rounded-xl border-2 text-left ${js==="large"?"border-[#e14171] bg-pink-50":"border-gray-200"}`,children:[n.jsx("div",{className:"font-medium",children:vr.name}),n.jsxs("div",{className:"text-sm text-gray-500",children:[vr.description,"  $",vr.price]})]})]})]}),Rs&&n.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-xl cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:Es,onChange:xe=>Rr(xe.target.checked),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[n.jsx(Gx,{className:"h-4 w-4"})," ",Rs.name]}),n.jsxs("div",{className:"text-sm text-gray-500",children:[Rs.description," (+$",Rs.price,")"]})]})]})]}),(Dt==="suit"||Dt==="multiple")&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Suit Cleaning Items"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Ps.map(xe=>n.jsxs("button",{onClick:()=>{xs(Pt=>Pt.includes(xe.id)?Pt.filter(Ft=>Ft!==xe.id):[...Pt,xe.id])},className:`p-4 rounded-xl border-2 text-center ${us.includes(xe.id)?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx(ff,{className:`h-6 w-6 mx-auto mb-2 ${us.includes(xe.id)?"text-[#e14171]":"text-gray-400"}`}),n.jsx("div",{className:"text-sm font-medium",children:xe.name}),n.jsx("div",{className:"text-xs text-gray-500",children:xe.price})]},xe.id))})]}),(Dt==="shoe"||Dt==="multiple")&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Shoe Cleaning Items"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Ks.map(xe=>n.jsxs("button",{onClick:()=>{Os(Pt=>Pt.includes(xe.id)?Pt.filter(Ft=>Ft!==xe.id):[...Pt,xe.id])},className:`p-4 rounded-xl border-2 text-center ${Is.includes(xe.id)?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx(Pn,{className:`h-6 w-6 mx-auto mb-2 ${Is.includes(xe.id)?"text-[#e14171]":"text-gray-400"}`}),n.jsx("div",{className:"text-sm font-medium",children:xe.name}),n.jsx("div",{className:"text-xs text-gray-500",children:xe.price})]},xe.id))})]}),(Dt==="dry-clean"||Dt==="multiple")&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Dry Cleaning Items"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:li.map(xe=>n.jsxs("button",{onClick:()=>{vi(Pt=>Pt.includes(xe.id)?Pt.filter(Ft=>Ft!==xe.id):[...Pt,xe.id])},className:`p-4 rounded-xl border-2 text-center ${ar.includes(xe.id)?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx(Gx,{className:`h-6 w-6 mx-auto mb-2 ${ar.includes(xe.id)?"text-[#e14171]":"text-gray-400"}`}),n.jsx("div",{className:"text-sm font-medium",children:xe.name}),n.jsx("div",{className:"text-xs text-gray-500",children:xe.price})]},xe.id))})]}),(Dt==="laundry"||Dt==="multiple")&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Quick Preference Profiles"}),n.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Choose a preset or customize below"}),n.jsx("div",{className:"grid sm:grid-cols-3 gap-3",children:va.map(xe=>n.jsxs("button",{onClick:()=>ds(xe.id),className:`p-4 rounded-xl border-2 text-left ${Gi===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("div",{className:"font-medium text-gray-900",children:xe.name}),n.jsx("div",{className:"text-xs text-gray-500 mt-1",children:xe.description})]},xe.id))})]}),(Dt==="laundry"||Dt==="multiple")&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm space-y-4",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[n.jsx(Xy,{className:"h-5 w-5 text-[#e14171]"}),"Cleaning Preferences"]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Detergent Type"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{id:"standard",label:"Standard",desc:"Premium scented"},{id:"hypoallergenic",label:"Hypoallergenic",desc:"Scent-free"},{id:"eco",label:"Eco-Friendly",desc:"Plant-based"}].map(xe=>n.jsxs("button",{onClick:()=>{Fe({...Ls,detergent:xe.id}),Fs("custom")},className:`p-3 rounded-lg border-2 text-left ${Ls.detergent===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200"}`,children:[n.jsx("div",{className:"text-sm font-medium",children:xe.label}),n.jsx("div",{className:"text-xs text-gray-500",children:xe.desc})]},xe.id))})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[n.jsx(Pj,{className:"h-4 w-4 inline mr-1"}),"Water Temp"]}),n.jsxs("select",{value:Ls.waterTemp,onChange:xe=>{Fe({...Ls,waterTemp:xe.target.value}),Fs("custom")},className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"cold",children:"Cold (Color safe)"}),n.jsx("option",{value:"warm",children:"Warm (Whites)"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[n.jsx(XS,{className:"h-4 w-4 inline mr-1"}),"Drying Heat"]}),n.jsxs("select",{value:Ls.dryingHeat,onChange:xe=>{Fe({...Ls,dryingHeat:xe.target.value}),Fs("custom")},className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"low",children:"Low (Prevents shrinking)"}),n.jsx("option",{value:"medium",children:"Medium/High"})]})]})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:Ls.softener,onChange:xe=>{Fe({...Ls,softener:xe.target.checked}),Fs("custom")},className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Add fabric softener"})]})]}),(Dt==="laundry"||Dt==="multiple")&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm space-y-4",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[n.jsx(ff,{className:"h-5 w-5 text-[#e14171]"}),"Finishing & Folding"]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Folding Style"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{id:"square",label:"Square Fold",desc:"Classic, stackable"},{id:"kondo",label:"Marie Kondo",desc:"Vertical filing"},{id:"rolled",label:"Rolled",desc:"For travel"}].map(xe=>n.jsxs("button",{onClick:()=>{K({...H,foldingStyle:xe.id}),Fs("custom")},className:`p-3 rounded-lg border-2 ${H.foldingStyle===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200"}`,children:[n.jsx("div",{className:"text-sm font-medium",children:xe.label}),n.jsx("div",{className:"text-xs text-gray-500",children:xe.desc})]},xe.id))})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:H.shirtsHung,onChange:xe=>{K({...H,shirtsHung:xe.target.checked}),Fs("custom")},className:"w-5 h-5 rounded text-[#e14171]"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-700",children:"Shirts on hangers"}),n.jsx("div",{className:"text-xs text-gray-500",children:"Protective cover included"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:H.pantsCreased,onChange:xe=>{K({...H,pantsCreased:xe.target.checked}),Fs("custom")},className:"w-5 h-5 rounded text-[#e14171]"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-700",children:"Crease pants/trousers"}),n.jsx("div",{className:"text-xs text-gray-500",children:"Professional pressed look"})]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm space-y-4",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[n.jsx(Pn,{className:"h-5 w-5 text-[#e14171]"}),"Special Add-ons"]}),n.jsx("div",{className:"grid sm:grid-cols-2 gap-3",children:(()=>{const xe=$e.find(Ht=>Ht.name.toLowerCase().includes("stain")),Pt=$e.find(Ht=>Ht.name.toLowerCase().includes("whiten")),Ft=$e.find(Ht=>Ht.name.toLowerCase().includes("scent")),Gt=$e.find(Ht=>Ht.name.toLowerCase().includes("button")||Ht.name.toLowerCase().includes("repair")&&!Ht.name.toLowerCase().includes("minor"));return[{key:"stainTreatment",label:xe?.name||"Stain Treatment",price:`+$${xe?.price||5}`,hasNote:!0},{key:"whitening",label:Pt?.name||"Brighten Whites",price:`+$${Pt?.price||4}`,hasNote:!1},{key:"scentBoosters",label:Ft?.name||"Scent Boosters",price:`+$${Ft?.price||3}`,hasNote:!1},{key:"repairs",label:Gt?.name||"Small Repairs",price:`+$${Gt?.price||2}`,hasNote:!1}].map(Ht=>n.jsxs("label",{className:`flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer ${ve[Ht.key]?"border-[#e14171] bg-pink-50":"border-gray-200"}`,children:[n.jsx("input",{type:"checkbox",checked:ve[Ht.key],onChange:Js=>Ve({...ve,[Ht.key]:Js.target.checked}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium text-gray-900",children:Ht.label}),n.jsx("div",{className:"text-sm text-gray-500",children:Ht.price})]})]},Ht.key))})()}),ve.stainTreatment&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stain notes (describe location and type)"}),n.jsx("textarea",{value:He,onChange:xe=>Ue(xe.target.value),placeholder:"e.g., Coffee stain on the white polo shirt, right side...",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",rows:2})]})]})]}),de===3&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Choose your time windows"}),n.jsx("p",{className:"text-gray-600",children:"Select a date and 2-hour window for pickup and delivery."})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[n.jsx("div",{className:"w-8 h-8 bg-[#e14171] text-white rounded-full flex items-center justify-center text-sm font-bold",children:"1"}),"Pickup Date & Time"]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Pickup Date"}),n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:es.map(xe=>n.jsxs("button",{onClick:()=>{qs(xe.date),Ms&&Ms<=xe.date&&(oi(""),Oi(""))},className:`flex-shrink-0 w-20 p-3 rounded-xl border-2 text-center transition-all ${wt===xe.date?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("div",{className:`text-xs font-medium ${wt===xe.date?"text-[#e14171]":"text-gray-500"}`,children:xe.dayName}),n.jsx("div",{className:`text-xl font-bold ${wt===xe.date?"text-[#e14171]":"text-gray-900"}`,children:xe.dayNum}),n.jsx("div",{className:`text-xs ${wt===xe.date?"text-[#e14171]":"text-gray-500"}`,children:xe.monthName})]},xe.date))}),wt&&n.jsxs("p",{className:"mt-2 text-sm text-[#e14171] font-medium",children:["Selected: ",es.find(xe=>xe.date===wt)?.fullDisplay]})]}),wt&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Pickup Time Slot"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Ct.map(xe=>n.jsxs("button",{onClick:()=>xe.available&&Ha(xe.id),disabled:!xe.available,className:`p-4 rounded-xl border-2 text-center transition-all ${xe.available?yr===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300":"border-gray-100 bg-gray-50 text-gray-400 cursor-not-allowed"}`,children:[n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx(hg,{className:`h-4 w-4 ${yr===xe.id?"text-[#e14171]":"text-gray-400"}`}),n.jsx("span",{className:`font-medium text-sm ${yr===xe.id?"text-[#e14171]":""}`,children:xe.label})]}),!xe.available&&n.jsx("span",{className:"text-xs bg-gray-200 px-2 py-1 rounded mt-2 inline-block",children:"Full"})]},xe.id))})]}),!wt&&n.jsx("p",{className:"text-sm text-gray-500 italic",children:"Please select a pickup date first"})]}),n.jsxs("div",{className:`bg-white rounded-2xl p-6 shadow-sm ${!wt||!yr?"opacity-50":""}`,children:[n.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${wt&&yr?"bg-[#e14171] text-white":"bg-gray-300 text-gray-500"}`,children:"2"}),"Delivery Date & Time"]}),wt&&yr?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"mb-6",children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Select Delivery Date",n.jsx("span",{className:"text-gray-500 font-normal ml-2",children:"(min. 24h after pickup)"})]}),n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:rc.map(xe=>n.jsxs("button",{onClick:()=>oi(xe.date),className:`flex-shrink-0 w-20 p-3 rounded-xl border-2 text-center transition-all ${Ms===xe.date?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("div",{className:`text-xs font-medium ${Ms===xe.date?"text-[#e14171]":"text-gray-500"}`,children:xe.dayName}),n.jsx("div",{className:`text-xl font-bold ${Ms===xe.date?"text-[#e14171]":"text-gray-900"}`,children:xe.dayNum}),n.jsx("div",{className:`text-xs ${Ms===xe.date?"text-[#e14171]":"text-gray-500"}`,children:xe.monthName})]},xe.date))}),Ms&&n.jsxs("p",{className:"mt-2 text-sm text-[#e14171] font-medium",children:["Selected: ",es.find(xe=>xe.date===Ms)?.fullDisplay]})]}),Ms&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Delivery Time Slot"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Ct.map(xe=>n.jsx("button",{onClick:()=>Oi(xe.id),className:`p-4 rounded-xl border-2 text-center transition-all ${Fr===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx(hg,{className:`h-4 w-4 ${Fr===xe.id?"text-[#e14171]":"text-gray-400"}`}),n.jsx("span",{className:`font-medium text-sm ${Fr===xe.id?"text-[#e14171]":""}`,children:xe.label})]})},xe.id))})]}),!Ms&&n.jsx("p",{className:"text-sm text-gray-500 italic",children:"Please select a delivery date"})]}):n.jsx("p",{className:"text-sm text-gray-500 italic",children:"Please complete pickup selection first"})]}),wt&&yr&&Ms&&Fr&&n.jsxs("div",{className:"bg-green-50 rounded-2xl p-6 border-2 border-green-200",children:[n.jsxs("h3",{className:"font-semibold text-green-800 mb-4 flex items-center gap-2",children:[n.jsx(Gu,{className:"h-5 w-5"}),"Schedule Summary"]}),n.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[n.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Pickup"}),n.jsx("div",{className:"font-semibold text-gray-900",children:es.find(xe=>xe.date===wt)?.fullDisplay}),n.jsx("div",{className:"text-[#e14171] font-medium",children:Ct.find(xe=>xe.id===yr)?.label})]}),n.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[n.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Delivery"}),n.jsx("div",{className:"font-semibold text-gray-900",children:es.find(xe=>xe.date===Ms)?.fullDisplay}),n.jsx("div",{className:"text-[#e14171] font-medium",children:Ct.find(xe=>xe.id===Fr)?.label})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm space-y-4",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[n.jsx(_a,{className:"h-5 w-5 text-[#e14171]"}),"Delivery Preferences"]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Drop-off Instructions"}),n.jsxs("select",{value:U.dropoffInstructions,onChange:xe=>{he({...U,dropoffInstructions:xe.target.value}),xe.target.value!=="custom"&&Te("")},className:"w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] bg-white",children:[n.jsx("option",{value:"",children:"Select an option..."}),n.jsx("option",{value:"security",children:"Leave with Security/Doorman"}),n.jsx("option",{value:"gate",children:"Hang on the gate hook"}),n.jsx("option",{value:"wait",children:"Ring bell and wait"}),n.jsx("option",{value:"custom",children:"Custom instructions"})]}),U.dropoffInstructions==="custom"&&n.jsxs("div",{className:"mt-4 p-4 bg-pink-50 border-2 border-[#e14171] rounded-xl",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter Your Custom Instructions"}),n.jsx("textarea",{value:rt,onChange:xe=>Te(xe.target.value),placeholder:"e.g., 'Leave with the neighbor at apartment 3B' or 'Place inside the blue bin by the front door'",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] focus:border-[#e14171] resize-none bg-white",rows:3}),n.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Please provide clear instructions for our driver."})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Packaging"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{id:"plastic",label:"Plastic Bag",desc:"Rain protection"},{id:"paper",label:"Eco Paper",desc:"Sustainable"},{id:"reusable",label:"Reusable",desc:"For members"}].map(xe=>n.jsxs("button",{onClick:()=>he({...U,packagingType:xe.id}),className:`p-3 rounded-lg border-2 ${U.packagingType===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200"}`,children:[n.jsx("div",{className:"text-sm font-medium",children:xe.label}),n.jsx("div",{className:"text-xs text-gray-500",children:xe.desc})]},xe.id))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notifications"}),n.jsx("div",{className:"space-y-2",children:[{id:"whatsapp",label:"WhatsApp updates",icon:gf},{id:"sms",label:"SMS only when delivered",icon:qx},{id:"quiet",label:"Quiet delivery (photo only)",icon:n_}].map(xe=>n.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer ${U.notificationStyle===xe.id?"border-[#e14171] bg-pink-50":"border-gray-200"}`,children:[n.jsx("input",{type:"radio",name:"notification",checked:U.notificationStyle===xe.id,onChange:()=>he({...U,notificationStyle:xe.id}),className:"w-4 h-4 text-[#e14171]"}),n.jsx(xe.icon,{className:"h-5 w-5 text-gray-400"}),n.jsx("span",{className:"text-gray-700",children:xe.label})]},xe.id))})]})]})]}),de===4&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Review & Pay"}),n.jsx("p",{className:"text-gray-600",children:"Confirm your order details."})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Order Summary"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between py-2 border-b",children:[n.jsx("span",{className:"text-gray-600",children:"Location"}),n.jsxs("span",{className:"text-gray-900 text-right",children:[Mt.address,n.jsx("br",{}),n.jsx("span",{className:"text-sm text-gray-500",children:Mt.landmark})]})]}),n.jsxs("div",{className:"flex justify-between py-2 border-b",children:[n.jsx("span",{className:"text-gray-600",children:"Service"}),n.jsx("span",{className:"text-gray-900 capitalize",children:Dt==="multiple"?"Multiple Services":Dt?Dt.replace("-"," "):"Not selected"})]}),(Dt==="laundry"||Dt==="multiple")&&js&&n.jsxs("div",{className:"flex justify-between py-2 border-b",children:[n.jsxs("span",{className:"text-gray-600",children:[js==="regular"?Gs?.name:vr?.name,Es&&Rs&&` + ${Rs.name}`]}),n.jsxs("span",{className:"text-gray-900",children:["$",js==="regular"?Gs?.price:vr?.price,Es&&Rs&&` + $${Rs.price}`]})]}),us.length>0&&n.jsxs("div",{className:"py-2 border-b",children:[n.jsx("div",{className:"flex justify-between mb-2",children:n.jsx("span",{className:"text-gray-600",children:"Suit Cleaning"})}),us.map(xe=>{const Pt=Ps.find(Ft=>Ft.id===xe);return Pt?n.jsxs("div",{className:"flex justify-between text-sm text-gray-500 ml-4",children:[n.jsx("span",{children:Pt.name}),n.jsx("span",{children:Pt.price})]},xe):null})]}),Is.length>0&&n.jsxs("div",{className:"py-2 border-b",children:[n.jsx("div",{className:"flex justify-between mb-2",children:n.jsx("span",{className:"text-gray-600",children:"Shoe Cleaning"})}),Is.map(xe=>{const Pt=Ks.find(Ft=>Ft.id===xe);return Pt?n.jsxs("div",{className:"flex justify-between text-sm text-gray-500 ml-4",children:[n.jsx("span",{children:Pt.name}),n.jsx("span",{children:Pt.price})]},xe):null})]}),ar.length>0&&n.jsxs("div",{className:"py-2 border-b",children:[n.jsx("div",{className:"flex justify-between mb-2",children:n.jsx("span",{className:"text-gray-600",children:"Dry Cleaning"})}),ar.map(xe=>{const Pt=li.find(Ft=>Ft.id===xe);return Pt?n.jsxs("div",{className:"flex justify-between text-sm text-gray-500 ml-4",children:[n.jsx("span",{children:Pt.name}),n.jsx("span",{children:Pt.price})]},xe):null})]}),n.jsxs("div",{className:"flex justify-between py-2 border-b",children:[n.jsx("span",{className:"text-gray-600",children:"Pickup"}),n.jsxs("span",{className:"text-gray-900 text-right",children:[n.jsx("div",{children:es.find(xe=>xe.date===wt)?.fullDisplay}),n.jsx("div",{className:"text-sm text-[#e14171]",children:Ct.find(xe=>xe.id===yr)?.label})]})]}),n.jsxs("div",{className:"flex justify-between py-2 border-b",children:[n.jsx("span",{className:"text-gray-600",children:"Delivery"}),n.jsxs("span",{className:"text-gray-900 text-right",children:[n.jsx("div",{children:es.find(xe=>xe.date===Ms)?.fullDisplay}),n.jsx("div",{className:"text-sm text-[#e14171]",children:Ct.find(xe=>xe.id===Fr)?.label})]})]}),U.dropoffInstructions&&n.jsxs("div",{className:"py-2 border-b",children:[n.jsx("span",{className:"text-gray-600",children:"Drop-off Instructions"}),n.jsxs("p",{className:"text-gray-900 text-sm mt-1",children:[U.dropoffInstructions==="security"&&"Leave with Security/Doorman",U.dropoffInstructions==="gate"&&"Hang on the gate hook",U.dropoffInstructions==="wait"&&"Ring bell and wait",U.dropoffInstructions==="custom"&&rt]})]}),(ve.stainTreatment||ve.whitening||ve.scentBoosters||ve.repairs)&&n.jsxs("div",{className:"py-2 border-b",children:[n.jsx("div",{className:"text-gray-600 mb-2",children:"Add-ons:"}),n.jsxs("div",{className:"space-y-1 text-sm",children:[ve.stainTreatment&&(()=>{const xe=$e.find(Pt=>Pt.name.toLowerCase().includes("stain"));return xe?n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:xe.name}),n.jsxs("span",{children:["$",xe.price]})]}):null})(),ve.whitening&&(()=>{const xe=$e.find(Pt=>Pt.name.toLowerCase().includes("whiten"));return xe?n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:xe.name}),n.jsxs("span",{children:["$",xe.price]})]}):null})(),ve.scentBoosters&&(()=>{const xe=$e.find(Pt=>Pt.name.toLowerCase().includes("scent"));return xe?n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:xe.name}),n.jsxs("span",{children:["$",xe.price]})]}):null})(),ve.repairs&&(()=>{const xe=$e.find(Pt=>Pt.name.toLowerCase().includes("button")||Pt.name.toLowerCase().includes("repair")&&!Pt.name.toLowerCase().includes("minor"));return xe?n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:xe.name}),n.jsxs("span",{children:["$",xe.price]})]}):null})()]})]}),n.jsxs("div",{className:"flex justify-between py-2 border-b",children:[n.jsx("span",{className:"text-gray-600",children:"Delivery Fee"}),n.jsxs("span",{className:"text-gray-900",children:["$",hi().orderDeliveryFee.toFixed(2)]})]}),n.jsxs("div",{className:"py-4 border-b",children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[n.jsx(pf,{className:"h-4 w-4 inline mr-1"}),"Promo Code"]}),c?n.jsxs("div",{className:"flex items-center justify-between bg-green-50 border-2 border-green-200 rounded-xl px-4 py-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:n.jsx(fv,{className:"h-5 w-5 text-green-600"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-green-800",children:c.code}),n.jsxs("div",{className:"text-sm text-green-600",children:[c.discount_type==="percentage"&&`${c.discount_value}% off`,c.discount_type==="fixed"&&`$${c.discount_value} off`,c.discount_type==="free_delivery"&&"Free delivery"]})]})]}),n.jsx("button",{onClick:()=>{re(),Qe(""),We(""),Ze(!1)},className:"p-2 text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-full transition-colors",children:n.jsx(Ga,{className:"h-5 w-5"})})]}):n.jsxs("div",{className:"flex gap-2",children:[n.jsx("div",{className:"relative flex-1",children:n.jsx("input",{type:"text",value:ht,onChange:xe=>{Qe(xe.target.value.toUpperCase()),We(""),Ze(!1)},placeholder:"Enter promo code",className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] uppercase ${dt?"border-red-300":"border-gray-200"}`})}),n.jsx("button",{onClick:async()=>{const xe=Za(),Pt=await F(ht,xe+_e,_e);We(Pt.message),Ze(!Pt.valid)},disabled:T||!ht.trim(),className:`px-6 py-3 rounded-xl font-medium transition-colors ${T||!ht.trim()?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-[#e14171] text-white hover:bg-[#c73562]"}`,children:T?n.jsx(Ss,{className:"h-5 w-5 animate-spin"}):"Apply"})]}),Ce&&!c&&n.jsx("p",{className:`mt-2 text-sm ${dt?"text-red-500":"text-green-600"}`,children:Ce}),!c&&n.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:[n.jsx("span",{className:"font-medium",children:"Try:"})," WELCOME10, BUBBLE20, FREESHIP"]})]}),n.jsxs("div",{className:"py-4 border-b",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Apply credits"}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Available: $",Pe.toFixed(2)]})]}),n.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer",children:[n.jsx("span",{className:"text-sm text-gray-600",children:"Use credits"}),n.jsx("input",{type:"checkbox",className:"w-5 h-5 text-[#e14171] rounded",checked:Le,disabled:Pe<=0,onChange:xe=>{const Pt=xe.target.checked;if(nt(Pt),Pt){const{maxCredit:Ft}=hi();Ot(Math.min(Ft,Pe))}else Ot(0)}})]})]}),Le&&Pe>0&&n.jsxs("div",{className:"mt-2 space-y-1",children:[n.jsx("input",{type:"number",min:0,step:"0.01",value:lt,onChange:xe=>{const Pt=parseFloat(xe.target.value)||0,{maxCredit:Ft}=hi();Ot(Math.max(0,Math.min(Pt,Ft)))},className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"}),n.jsxs("p",{className:"text-xs text-gray-500",children:["You can apply up to $",hi().maxCredit.toFixed(2)," on this order."]})]})]}),c&&O>0&&n.jsxs("div",{className:"flex justify-between py-2 text-green-600",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(pf,{className:"h-4 w-4"}),"Discount (",c.code,")"]}),n.jsxs("span",{children:["-$",O.toFixed(2)]})]}),Le&&hi().appliedCredit>0&&n.jsxs("div",{className:"flex justify-between py-2 text-green-600",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(pf,{className:"h-4 w-4"}),"Credits Applied"]}),n.jsxs("span",{children:["-$",hi().appliedCredit.toFixed(2)]})]})]}),n.jsxs("div",{className:"flex justify-between pt-4 mt-4 border-t-2",children:[n.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Estimated Total"}),n.jsxs("span",{className:"text-lg font-bold text-[#e14171]",children:["$",hi().payable.toFixed(2)]})]}),n.jsxs("div",{className:"mt-4 bg-pink-50 rounded-xl p-4 flex items-start gap-3",children:[n.jsx(n_,{className:"h-5 w-5 text-[#e14171] flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"text-sm text-gray-600",children:[n.jsx("strong",{children:"Note:"})," We'll place a $20 authorization hold. Final charge is calculated after processing your items. You'll receive the exact amount via WhatsApp."]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Payment Method"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{type:"button",onClick:()=>ot("card"),className:`w-full flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all text-left ${Re==="card"?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${Re==="card"?"border-[#e14171]":"border-gray-400"}`,children:Re==="card"&&n.jsx("div",{className:"w-3 h-3 rounded-full bg-[#e14171]"})}),n.jsx(b0,{className:`h-5 w-5 ${Re==="card"?"text-[#e14171]":"text-gray-600"}`}),n.jsxs("div",{className:"flex-1",children:[n.jsx("span",{className:"font-medium block",children:"Credit/Debit Card"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Secure online payment"})]})]}),n.jsxs("button",{type:"button",onClick:()=>ot("cash"),className:`w-full flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all text-left ${Re==="cash"?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${Re==="cash"?"border-[#e14171]":"border-gray-400"}`,children:Re==="cash"&&n.jsx("div",{className:"w-3 h-3 rounded-full bg-[#e14171]"})}),n.jsx(_0,{className:`h-5 w-5 ${Re==="cash"?"text-[#e14171]":"text-gray-600"}`}),n.jsxs("div",{className:"flex-1",children:[n.jsx("span",{className:"font-medium block",children:"Cash on Delivery"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Pay when your order arrives"})]})]}),n.jsxs("button",{type:"button",onClick:()=>ot("wallet"),className:`w-full flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all text-left ${Re==="wallet"?"border-[#e14171] bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${Re==="wallet"?"border-[#e14171]":"border-gray-400"}`,children:Re==="wallet"&&n.jsx("div",{className:"w-3 h-3 rounded-full bg-[#e14171]"})}),n.jsx(qx,{className:`h-5 w-5 ${Re==="wallet"?"text-[#e14171]":"text-gray-600"}`}),n.jsxs("div",{className:"flex-1",children:[n.jsx("span",{className:"font-medium block",children:"Digital Wallet"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Apple Pay, Google Pay, etc."})]})]})]}),Re==="card"&&n.jsxs("div",{className:"mt-4 space-y-3",children:[n.jsx("input",{type:"text",placeholder:"Card Number",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx("input",{type:"text",placeholder:"MM/YY",className:"px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"}),n.jsx("input",{type:"text",placeholder:"CVV",className:"px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Save card for future orders"})]})]}),Re==="cash"&&n.jsxs("div",{className:"mt-4 bg-yellow-50 rounded-xl p-4 flex items-start gap-3",children:[n.jsx(_0,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"text-sm text-gray-600",children:[n.jsx("strong",{children:"Cash Payment:"})," Please have the exact amount ready when our driver arrives. The final amount will be confirmed via WhatsApp after we weigh your items."]})]}),Re==="wallet"&&n.jsxs("div",{className:"mt-4 bg-blue-50 rounded-xl p-4 flex items-start gap-3",children:[n.jsx(qx,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"text-sm text-gray-600",children:[n.jsx("strong",{children:"Digital Wallet:"})," You'll be redirected to complete the payment after placing your order."]})]})]})]}),n.jsxs("div",{className:"flex gap-4 mt-8",children:[de>1&&n.jsxs("button",{onClick:()=>Ae(de-1),className:"flex-1 flex items-center justify-center gap-2 py-4 border-2 border-gray-300 rounded-full font-medium text-gray-700 hover:bg-gray-50",children:[n.jsx(wS,{className:"h-5 w-5"}),"Back"]}),n.jsx("button",{onClick:async()=>{if(de<4)Ae(de+1);else{if(!h){zt(!0);return}_t(!0);try{const xe=[];if((Dt==="laundry"||Dt==="multiple")&&js){const ei=js==="regular"?Gs:vr;ei&&xe.push({itemType:"laundry_bag",itemName:ei.name,quantity:1,unitPrice:ei.price}),Es&&Rs&&xe.push({itemType:"addon",itemName:Rs.name,quantity:1,unitPrice:Rs.price})}us.forEach(ei=>{const Er=Ps.find(mn=>mn.id===ei);Er&&xe.push({itemType:"suit",itemName:Er.name,quantity:1,unitPrice:Er.priceNum})}),Is.forEach(ei=>{const Er=Ks.find(mn=>mn.id===ei);Er&&xe.push({itemType:"shoe",itemName:Er.name,quantity:1,unitPrice:Er.priceNum})}),ar.forEach(ei=>{const Er=li.find(mn=>mn.id===ei);Er&&xe.push({itemType:"dry_clean",itemName:Er.name,quantity:1,unitPrice:Er.priceNum})});const Pt=hi(),Ft=Pt.subtotal,Gt=Pt.orderDeliveryFee,Ht=Pt.discount,Js=Pt.appliedCredit,fi=Pt.payable,ia=await _({serviceType:Dt,items:xe,preferences:{detergentType:Ls.detergent,fabricSoftener:Ls.softener,waterTemp:Ls.waterTemp,dryingHeat:Ls.dryingHeat,foldingStyle:H.foldingStyle,shirtsHung:H.shirtsHung,pantsCreased:H.pantsCreased,dropoffInstructions:U.dropoffInstructions,customDropoffInstruction:rt,packagingType:U.packagingType,notificationStyle:U.notificationStyle},addons:{stainTreatment:ve.stainTreatment,whitening:ve.whitening,scentBoosters:ve.scentBoosters,repairs:ve.repairs,stainNote:He},pickupAddress:Mt.address,pickupLandmark:Mt.landmark,paymentMethod:Re,subtotal:Ft,deliveryFee:Gt,discount:Ht,promoCode:c?.code||null,total:fi});if(Js>0){const ei=await pe(Js,ia.id);ei.success||alert(`We couldn't record your credit usage: ${ei.message}`);const Er=await G();le(Er),nt(!1),Ot(0)}c&&await se(c.id),Kt&&Qt.trim()&&await P({label:Qt.trim(),address:Mt.address,landmark:Mt.landmark,is_default:S.length===0}),alert("Order placed successfully! You will receive a confirmation via WhatsApp."),m("/portal")}catch(xe){console.error("Error creating order:",xe);const Pt=xe instanceof Error?xe.message:"Unknown error";alert(`There was an error placing your order: ${Pt}`)}finally{_t(!1)}}},disabled:!ba()||Ye,className:`flex-1 flex items-center justify-center gap-2 py-4 rounded-full font-semibold transition-colors ${ba()&&!Ye?"bg-[#e14171] text-white hover:bg-[#c73562]":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:Ye?n.jsxs(n.Fragment,{children:[n.jsx(Ss,{className:"h-5 w-5 animate-spin"}),"Processing..."]}):n.jsxs(n.Fragment,{children:[de===4?"Place Order":"Continue",n.jsx(Dn,{className:"h-5 w-5"})]})})]})]}),n.jsx(lx,{isOpen:Et,onClose:()=>zt(!1),initialMode:"signin"})]})}function cT(m){const[h,_]=ee.useState(null),[S,k]=ee.useState(!0),[P,T]=ee.useState(null),c=async()=>{if(!m){k(!1);return}try{const{data:F,error:re}=await vt.from("user_preferences").select("*").eq("user_id",m).single();if(re&&re.code!=="PGRST116")throw re;_(F)}catch(F){T(F)}finally{k(!1)}},O=async F=>{if(!m)return{error:new Error("Not authenticated")};try{const{error:re}=await vt.from("user_preferences").upsert({user_id:m,...F,updated_at:new Date().toISOString()});if(re)throw re;return await c(),{error:null}}catch(re){return{error:re}}};return ee.useEffect(()=>{c()},[m]),{preferences:h,loading:S,error:P,updatePreferences:O,refetch:c}}function uT({order:m,onClose:h}){const _=ee.useRef(null),S=()=>{const T=_.current?.innerHTML,c=window.open("","_blank");c&&T&&(c.document.write(`
        <html>
          <head>
            <title>Receipt - ${m.order_number}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
              .header { text-align: center; border-bottom: 2px dashed #ccc; padding-bottom: 20px; margin-bottom: 20px; }
              .logo { font-size: 24px; font-weight: bold; color: #e14171; }
              .order-number { color: #666; margin-top: 5px; }
              .section { margin-bottom: 20px; }
              .section-title { font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
              .item { display: flex; justify-content: space-between; padding: 5px 0; }
              .item-name { color: #333; }
              .item-price { color: #333; }
              .total-section { border-top: 2px solid #333; padding-top: 15px; margin-top: 15px; }
              .total { display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; }
              .footer { text-align: center; margin-top: 30px; color: #666; font-size: 12px; }
              .status { display: inline-block; padding: 5px 15px; border-radius: 15px; font-size: 12px; }
              .status-delivered { background: #d4edda; color: #155724; }
              .status-pending { background: #fff3cd; color: #856404; }
              .status-cancelled { background: #f8d7da; color: #721c24; }
            </style>
          </head>
          <body>${T}</body>
        </html>
      `),c.document.close(),c.print())},k=()=>{const T=`
THE BUBBLE BOX
====================
Order Receipt
${m.order_number}
${new Date(m.created_at).toLocaleDateString()}

Status: ${m.status.toUpperCase()}

ITEMS
--------------------
${m.order_items?.map(re=>`${re.item_name.replace(/_/g," ").replace(/\b\w/g,se=>se.toUpperCase())} x${re.quantity} - $${re.total_price.toFixed(2)}`).join(`
`)||"No items"}

${m.order_addons?.length?`ADD-ONS
--------------------
${m.order_addons.map(re=>`${re.addon_type.replace(/_/g," ").replace(/\b\w/g,se=>se.toUpperCase())} - $${re.price.toFixed(2)}`).join(`
`)}
`:""}
SUMMARY
--------------------
Subtotal: $${m.subtotal.toFixed(2)}
Delivery Fee: $${m.delivery_fee.toFixed(2)}
${m.discount>0?`Discount: -$${m.discount.toFixed(2)}`:""}
${m.applied_credit&&m.applied_credit>0?`Credits Applied: -$${m.applied_credit.toFixed(2)}`:""}
--------------------
TOTAL PAID: $${m.total.toFixed(2)}

Thank you for choosing The Bubble Box!
    `,c=new Blob([T],{type:"text/plain"}),O=URL.createObjectURL(c),F=document.createElement("a");F.href=O,F.download=`receipt-${m.order_number}.txt`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(O)},P=T=>T.replace(/_/g," ").replace(/-/g," ").split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ");return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border-b sticky top-0 bg-white rounded-t-2xl",children:[n.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Order Receipt"}),n.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:n.jsx(Ga,{className:"h-5 w-5 text-gray-500"})})]}),n.jsxs("div",{ref:_,className:"p-6",children:[n.jsxs("div",{className:"header text-center border-b-2 border-dashed border-gray-200 pb-6 mb-6",children:[n.jsx("div",{className:"logo text-2xl font-bold text-[#e14171] mb-1",children:"The Bubble Box"}),n.jsx("p",{className:"text-gray-500 text-sm",children:"Premium Laundry Services"}),n.jsx("p",{className:"order-number text-gray-600 mt-3 font-medium",children:m.order_number}),n.jsx("p",{className:"text-sm text-gray-500",children:new Date(m.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),n.jsx("div",{className:`status inline-block mt-3 px-4 py-1 rounded-full text-sm font-medium ${m.status==="delivered"?"status-delivered bg-green-100 text-green-700":m.status==="cancelled"?"status-cancelled bg-red-100 text-red-700":"status-pending bg-yellow-100 text-yellow-700"}`,children:m.status.charAt(0).toUpperCase()+m.status.slice(1).replace("_"," ")})]}),n.jsxs("div",{className:"section mb-6",children:[n.jsx("div",{className:"section-title font-semibold text-gray-900 mb-2 pb-2 border-b",children:"Service"}),n.jsxs("p",{className:"text-gray-700 capitalize",children:[m.service_type.replace("-"," ")," Service"]})]}),n.jsxs("div",{className:"section mb-6",children:[n.jsx("div",{className:"section-title font-semibold text-gray-900 mb-3 pb-2 border-b",children:"Items"}),m.order_items&&m.order_items.length>0?n.jsx("div",{className:"space-y-2",children:m.order_items.map((T,c)=>n.jsxs("div",{className:"item flex justify-between py-1",children:[n.jsxs("span",{className:"item-name text-gray-700",children:[P(T.item_name)," x",T.quantity]}),n.jsxs("span",{className:"item-price text-gray-900 font-medium",children:["$",T.total_price.toFixed(2)]})]},T.id||c))}):n.jsx("p",{className:"text-gray-500",children:"No items recorded"})]}),m.order_addons&&m.order_addons.length>0&&n.jsxs("div",{className:"section mb-6",children:[n.jsx("div",{className:"section-title font-semibold text-gray-900 mb-3 pb-2 border-b",children:"Add-ons"}),n.jsx("div",{className:"space-y-2",children:m.order_addons.map((T,c)=>n.jsxs("div",{className:"item flex justify-between py-1",children:[n.jsx("span",{className:"item-name text-gray-700",children:T.addon_type.replace(/_/g," ").replace(/\b\w/g,O=>O.toUpperCase())}),n.jsxs("span",{className:"item-price text-gray-900 font-medium",children:["$",T.price.toFixed(2)]})]},T.id||c))})]}),m.order_preferences&&n.jsxs("div",{className:"section mb-6",children:[n.jsx("div",{className:"section-title font-semibold text-gray-900 mb-3 pb-2 border-b",children:"Preferences"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[m.order_preferences.detergent_type&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Detergent:"})," ",n.jsx("span",{className:"capitalize",children:m.order_preferences.detergent_type})]}),m.order_preferences.folding_style&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Folding:"})," ",n.jsx("span",{className:"capitalize",children:m.order_preferences.folding_style})]}),m.order_preferences.water_temp&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Water:"})," ",n.jsx("span",{className:"capitalize",children:m.order_preferences.water_temp})]}),m.order_preferences.packaging_type&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Packaging:"})," ",n.jsx("span",{className:"capitalize",children:m.order_preferences.packaging_type})]})]})]}),n.jsxs("div",{className:"section mb-6",children:[n.jsx("div",{className:"section-title font-semibold text-gray-900 mb-3 pb-2 border-b",children:"Delivery Details"}),n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(qa,{className:"h-4 w-4 text-gray-400 mt-0.5"}),n.jsx("span",{className:"text-gray-700",children:m.pickup_address})]}),m.pickup_landmark&&n.jsxs("p",{className:"text-gray-500 ml-6",children:["Landmark: ",m.pickup_landmark]}),n.jsxs("div",{className:"flex justify-between mt-2",children:[n.jsx("span",{className:"text-gray-500",children:"Pickup Date:"}),n.jsx("span",{children:m.pickup_date||"TBD"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-500",children:"Delivery Date:"}),n.jsx("span",{children:m.delivery_date||"TBD"})]})]})]}),n.jsx("div",{className:"total-section border-t-2 border-gray-300 pt-4",children:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"item flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Subtotal"}),n.jsxs("span",{className:"text-gray-900",children:["$",m.subtotal.toFixed(2)]})]}),n.jsxs("div",{className:"item flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Delivery Fee"}),n.jsxs("span",{className:"text-gray-900",children:["$",m.delivery_fee.toFixed(2)]})]}),m.discount>0&&n.jsxs("div",{className:"item flex justify-between text-green-600",children:[n.jsx("span",{children:"Discount"}),n.jsxs("span",{children:["-$",m.discount.toFixed(2)]})]}),m.applied_credit&&m.applied_credit>0&&n.jsxs("div",{className:"item flex justify-between text-[#e14171]",children:[n.jsx("span",{children:"Credits Applied"}),n.jsxs("span",{children:["- $",m.applied_credit.toFixed(2)]})]}),n.jsxs("div",{className:"total flex justify-between text-lg font-bold pt-3 border-t mt-3",children:[n.jsx("span",{className:"text-gray-900",children:"Total Paid"}),n.jsxs("span",{className:"text-[#e14171]",children:["$",m.total.toFixed(2)]})]})]})}),n.jsxs("div",{className:"footer text-center mt-8 text-gray-500 text-sm",children:[n.jsx("p",{children:"Thank you for choosing The Bubble Box!"}),n.jsx("p",{className:"mt-1",children:"Questions? Contact us at support@bubblebox.com"})]})]}),n.jsxs("div",{className:"p-4 border-t flex gap-3 sticky bottom-0 bg-white rounded-b-2xl",children:[n.jsxs("button",{onClick:S,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border border-gray-200 rounded-xl hover:bg-gray-50 font-medium transition-colors",children:[n.jsx(pv,{className:"h-4 w-4"}),"Print"]}),n.jsxs("button",{onClick:k,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-[#e14171] text-white rounded-xl hover:bg-[#c73562] font-medium transition-colors",children:[n.jsx(i_,{className:"h-4 w-4"}),"Download"]})]})]})})}function dT({order:m,onClose:h,onConfirm:_,loading:S}){return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full",children:[n.jsxs("div",{className:"p-6 text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(qj,{className:"h-8 w-8 text-red-600"})}),n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Cancel Order?"}),n.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to cancel order ",n.jsx("span",{className:"font-semibold",children:m.order_number}),"?"]})]}),n.jsxs("div",{className:"px-6 pb-4",children:[n.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[n.jsxs("div",{className:"flex justify-between mb-2",children:[n.jsx("span",{className:"text-gray-500",children:"Service"}),n.jsx("span",{className:"capitalize",children:m.service_type.replace("-"," ")})]}),n.jsxs("div",{className:"flex justify-between mb-2",children:[n.jsx("span",{className:"text-gray-500",children:"Items"}),n.jsxs("span",{children:[m.order_items?.length||0," item(s)"]})]}),n.jsxs("div",{className:"flex justify-between font-semibold",children:[n.jsx("span",{className:"text-gray-700",children:"Total"}),n.jsxs("span",{className:"text-[#e14171]",children:["$",m.total.toFixed(2)]})]})]}),n.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-xl",children:n.jsxs("p",{className:"text-sm text-yellow-800",children:[n.jsx("strong",{children:"Note:"})," If you've already paid, your payment will be refunded within 3-5 business days."]})})]}),n.jsxs("div",{className:"p-4 border-t flex gap-3",children:[n.jsx("button",{onClick:h,disabled:S,className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl hover:bg-gray-50 font-medium transition-colors disabled:opacity-50",children:"Keep Order"}),n.jsx("button",{onClick:_,disabled:S,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 font-medium transition-colors disabled:opacity-50",children:S?n.jsxs(n.Fragment,{children:[n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),"Cancelling..."]}):n.jsxs(n.Fragment,{children:[n.jsx(wg,{className:"h-4 w-4"}),"Cancel Order"]})})]})]})})}function hT(){const{user:m}=ao(),{loading:h,getActiveOrders:_,subscribeToOrderUpdates:S,fetchOrders:k}=Ag(m?.id),[P,T]=ee.useState(null),c=_(),O=c.find(Q=>Q.id===P)||c[0],[F,re]=ee.useState(!1);ee.useEffect(()=>{!P&&c.length>0&&T(c[0].id)},[c,P]),ee.useEffect(()=>{if(!O)return;const Q=S(O.id,()=>{k()});return()=>Q()},[O?.id,S,k]);const se=["pending","confirmed","scheduled","picked_up","at_facility","cleaning","ready","out_for_delivery","delivered"],ue={pending:"Pending",confirmed:"Confirmed",scheduled:"Scheduled",picked_up:"Picked Up",at_facility:"At Facility",cleaning:"Being Cleaned",ready:"Ready for Delivery",out_for_delivery:"Out for Delivery",delivered:"Delivered"},ae=O?(()=>{const Q=se.indexOf(O.status),Y=Q>=0?Q:0,G=Math.max(0,Math.min(1,Y/(se.length-1))),pe=Ne=>{const Oe=se.indexOf(O.status),Be=se.indexOf(Ne);return Oe>=Be&&Be>=0},_e=Ne=>O.status===Ne;return{orderId:O.order_number,status:O.status,statusLabel:ue[O.status]||O.status,progress:G,items:`Order #${O.order_number}`,pickup:O.pickup_date||"Pending",estimatedDelivery:O.delivery_date||"Pending",steps:[{id:"placed",label:"Order Placed",time:new Date(O.created_at).toLocaleString(),done:!0,current:O.status==="pending"},{id:"pickup",label:"Picked Up",time:pe("picked_up")?"Completed":"",done:pe("picked_up"),current:_e("picked_up")},{id:"facility",label:"At Facility",time:"",done:pe("at_facility"),current:_e("at_facility")},{id:"cleaning",label:"Being Cleaned",time:"",done:pe("cleaning"),current:_e("cleaning")},{id:"ready",label:"Ready for Delivery",time:"",done:pe("ready"),current:_e("ready")},{id:"delivery",label:"Out for Delivery",time:"",done:pe("out_for_delivery"),current:_e("out_for_delivery")},{id:"delivered",label:"Delivered",time:"",done:pe("delivered"),current:_e("delivered")}]}})():null;return h?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):ae?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Active Orders"}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[n.jsxs("button",{onClick:async()=>{re(!0),await k(),re(!1)},className:"flex items-center gap-2 px-3 py-2 text-sm border rounded-lg hover:bg-gray-50 disabled:opacity-50",disabled:F,children:[F?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(io,{className:"h-4 w-4"}),"Refresh"]}),c.length>1&&n.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(Q=>n.jsxs("button",{onClick:()=>T(Q.id),className:`px-3 py-2 rounded-full border text-sm ${O?.id===Q.id?"bg-[#e14171] text-white border-[#e14171]":"border-gray-200 text-gray-700 hover:border-[#e14171]"}`,children:[Q.order_number||Q.id.slice(0,6),"  ",Q.status.replace("_"," ")]},Q.id))})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-500",children:"Order ID"}),n.jsx("p",{className:"font-semibold text-gray-900",children:ae.orderId})]}),n.jsx("div",{className:"bg-pink-100 text-[#e14171] px-4 py-2 rounded-full font-medium",children:ae.statusLabel})]}),n.jsxs("div",{className:"mb-6",children:[n.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mb-2",children:[n.jsx("span",{children:"Picked Up"}),n.jsx("span",{children:"Est. Delivery"})]}),n.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-[#e14171] rounded-full",style:{width:`${ae.progress*100}%`}})}),n.jsxs("div",{className:"flex justify-between text-sm font-medium mt-2",children:[n.jsx("span",{children:ae.pickup}),n.jsx("span",{children:ae.estimatedDelivery})]})]}),n.jsx("div",{className:"space-y-4",children:ae.steps.map((Q,Y)=>n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${Q.done?"bg-green-500 text-white":Q.current?"bg-[#e14171] text-white animate-pulse":"bg-gray-200 text-gray-400"}`,children:Q.done?n.jsx(ni,{className:"h-4 w-4"}):Q.current?n.jsx(Pn,{className:"h-4 w-4"}):n.jsx("span",{className:"text-xs",children:Y+1})}),Y<ae.steps.length-1&&n.jsx("div",{className:`w-0.5 h-8 ${Q.done?"bg-green-500":"bg-gray-200"}`})]}),n.jsxs("div",{className:"flex-1 pb-4",children:[n.jsx("p",{className:`font-medium ${Q.done||Q.current?"text-gray-900":"text-gray-400"}`,children:Q.label}),Q.time&&n.jsx("p",{className:`text-sm ${Q.current?"text-[#e14171]":"text-gray-500"}`,children:Q.time})]})]},Q.id))})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Order Details"}),O?.order_items&&O.order_items.length>0&&n.jsxs("div",{className:"mb-4",children:[n.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["Items (",O.order_items.length,")"]}),n.jsx("div",{className:"space-y-2",children:O.order_items.map((Q,Y)=>n.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(_a,{className:"h-4 w-4 text-[#e14171]"}),n.jsx("span",{className:"text-gray-700 capitalize",children:Q.item_name.replace(/_/g," ").replace(/-/g," ")})]}),n.jsxs("span",{className:"text-sm text-gray-500",children:["x",Q.quantity]})]},Q.id||Y))})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(qa,{className:"h-5 w-5 text-gray-400"}),n.jsx("span",{className:"text-gray-700",children:O?.pickup_address||"Address not available"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Yd,{className:"h-5 w-5 text-gray-400"}),n.jsx("span",{className:"text-gray-700",children:"Standard Delivery"})]}),n.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[n.jsx("span",{className:"text-gray-500",children:"Total"}),n.jsxs("span",{className:"font-bold text-lg text-[#e14171]",children:["$",O?.total.toFixed(2)]})]})]}),O&&n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("a",{href:`mailto:support@bubblebox.com?subject=${encodeURIComponent(`Support request for Order ${O.order_number}`)}&body=${encodeURIComponent(`Hi Bubble Box Support,%0D%0A%0D%0AI need help with order ${O.order_number}.%0D%0AStatus: ${O.status}%0D%0APickup: ${O.pickup_date||"n/a"}%0D%0ADelivery: ${O.delivery_date||"n/a"}%0D%0A%0D%0APlease describe your issue here...`)}`,className:"block w-full text-center py-3 border border-gray-200 rounded-xl text-gray-700 font-medium hover:bg-gray-50",children:"Contact Support"}),n.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["If your email app doesnt open, email ",n.jsx("span",{className:"font-medium text-gray-700",children:"support@bubblebox.com"})," and include order ",n.jsx("span",{className:"font-semibold",children:O.order_number}),"."]})]})]})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Active Orders"}),n.jsxs("button",{onClick:async()=>{re(!0),await k(),re(!1)},className:"flex items-center gap-2 px-3 py-2 text-sm border rounded-lg hover:bg-gray-50 disabled:opacity-50",disabled:F,children:[F?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(io,{className:"h-4 w-4"}),"Refresh"]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm text-center",children:[n.jsx(_a,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Active Orders"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"You don't have any orders in progress."}),n.jsxs(wr,{to:"/booking",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-6 py-3 rounded-full font-medium hover:bg-[#c73562]",children:["Place an Order",n.jsx(Dn,{className:"h-5 w-5"})]})]})]})}function fT(){const{user:m}=ao(),{preferences:h,loading:_,updatePreferences:S}=cT(m?.id),[k,P]=ee.useState(!1),[T,c]=ee.useState({detergent:"standard",softener:!0,waterTemp:"cold",dryingHeat:"low",foldingStyle:"square",shirtsHung:!1,pantsCreased:!1,notifications:{whatsapp:!0,email:!0,sms:!1},defaultPackaging:"plastic"});ee.useEffect(()=>{h&&c({detergent:h.detergent_type||"standard",softener:h.fabric_softener??!0,waterTemp:h.water_temp||"cold",dryingHeat:h.drying_heat||"low",foldingStyle:h.folding_style||"square",shirtsHung:h.shirts_hung??!1,pantsCreased:h.pants_creased??!1,notifications:{whatsapp:h.notification_whatsapp??!0,email:h.notification_email??!0,sms:h.notification_sms??!1},defaultPackaging:h.default_packaging||"plastic"})},[h]);const O=async()=>{P(!0),await S({detergent_type:T.detergent,fabric_softener:T.softener,water_temp:T.waterTemp,drying_heat:T.dryingHeat,folding_style:T.foldingStyle,shirts_hung:T.shirtsHung,pants_creased:T.pantsCreased,notification_whatsapp:T.notifications.whatsapp,notification_email:T.notifications.email,notification_sms:T.notifications.sms,default_packaging:T.defaultPackaging}),P(!1)};return _?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):n.jsxs("div",{className:"space-y-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Preference Center"}),n.jsx("p",{className:"text-gray-600",children:"Set your default preferences. These will be applied to all future orders."}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm space-y-6",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[n.jsx(Xy,{className:"h-5 w-5 text-[#e14171]"}),"Cleaning Preferences"]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Detergent"}),n.jsxs("select",{value:T.detergent,onChange:F=>c({...T,detergent:F.target.value}),className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"standard",children:"Standard (Premium Scented)"}),n.jsx("option",{value:"hypoallergenic",children:"Hypoallergenic (Scent-free)"}),n.jsx("option",{value:"eco",children:"Eco-Friendly (Plant-based)"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Water Temperature"}),n.jsxs("select",{value:T.waterTemp,onChange:F=>c({...T,waterTemp:F.target.value}),className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"cold",children:"Cold (Color safe)"}),n.jsx("option",{value:"warm",children:"Warm (For whites)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Drying Heat"}),n.jsxs("select",{value:T.dryingHeat,onChange:F=>c({...T,dryingHeat:F.target.value}),className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"low",children:"Low (Prevents shrinking)"}),n.jsx("option",{value:"medium",children:"Medium/High"})]})]})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T.softener,onChange:F=>c({...T,softener:F.target.checked}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Add fabric softener by default"})]})]})]}),n.jsx("hr",{}),n.jsxs("div",{children:[n.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[n.jsx(ff,{className:"h-5 w-5 text-[#e14171]"}),"Finishing Preferences"]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Folding Style"}),n.jsxs("select",{value:T.foldingStyle,onChange:F=>c({...T,foldingStyle:F.target.value}),className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"square",children:"Square Fold (Classic)"}),n.jsx("option",{value:"kondo",children:"Marie Kondo (Vertical)"}),n.jsx("option",{value:"rolled",children:"Rolled (For travel)"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T.shirtsHung,onChange:F=>c({...T,shirtsHung:F.target.checked}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsxs("div",{children:[n.jsx("span",{className:"text-gray-700",children:"Shirts on hangers by default"}),n.jsx("span",{className:"text-sm text-gray-500 block",children:"+$1 per shirt"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T.pantsCreased,onChange:F=>c({...T,pantsCreased:F.target.checked}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Crease pants/trousers by default"})]})]})]}),n.jsx("hr",{}),n.jsxs("div",{children:[n.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[n.jsx(hS,{className:"h-5 w-5 text-[#e14171]"}),"Notification Preferences"]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T.notifications.whatsapp,onChange:F=>c({...T,notifications:{...T.notifications,whatsapp:F.target.checked}}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"WhatsApp updates"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T.notifications.email,onChange:F=>c({...T,notifications:{...T.notifications,email:F.target.checked}}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Email notifications"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T.notifications.sms,onChange:F=>c({...T,notifications:{...T.notifications,sms:F.target.checked}}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"SMS notifications"})]})]})]}),n.jsxs("button",{onClick:O,disabled:k,className:"w-full py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[k&&n.jsx(Ss,{className:"h-5 w-5 animate-spin"}),"Save Preferences"]})]})]})}function pT(){const{user:m}=ao(),{orders:h,loading:_,cancelOrder:S}=Ag(m?.id),[k,P]=ee.useState(null),[T,c]=ee.useState(null),[O,F]=ee.useState(null),[re,se]=ee.useState(!1),[ue,ae]=ee.useState(null),Q=yf(),Y=async()=>{if(O){se(!0);try{const Oe=await S(O.id);Oe.success?(ae({type:"success",message:Oe.message}),F(null)):ae({type:"error",message:Oe.message})}catch(Oe){console.error("Cancel order error:",Oe),ae({type:"error",message:"An unexpected error occurred. Please try again."})}finally{se(!1),setTimeout(()=>ae(null),5e3)}}},G=Oe=>{sessionStorage.setItem("reorderData",JSON.stringify({serviceType:Oe.service_type,items:Oe.order_items,preferences:Oe.order_preferences,addons:Oe.order_addons})),Q("/booking")},pe=Oe=>["pending","confirmed","scheduled"].includes(Oe);if(_)return n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})});if(h.length===0)return n.jsxs("div",{className:"space-y-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Order History"}),n.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm text-center",children:[n.jsx(y_,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Orders Yet"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Your order history will appear here."}),n.jsxs(wr,{to:"/booking",className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-6 py-3 rounded-full font-medium hover:bg-[#c73562]",children:["Place Your First Order",n.jsx(Dn,{className:"h-5 w-5"})]})]})]});const _e=Oe=>Oe.replace(/_/g," ").replace(/-/g," ").split(" ").map(Be=>Be.charAt(0).toUpperCase()+Be.slice(1)).join(" "),Ne=Oe=>{switch(Oe){case"laundry":return"";case"suit":return"";case"shoe":return"";case"dry-clean":return"";case"multiple":return"";default:return""}};return n.jsxs("div",{className:"space-y-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Order History"}),ue&&n.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-3 ${ue.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[ue.type==="success"?n.jsx(ni,{className:"h-5 w-5 text-green-600"}):n.jsx(wg,{className:"h-5 w-5 text-red-600"}),n.jsx("p",{children:ue.message})]}),n.jsx("div",{className:"space-y-4",children:h.map(Oe=>n.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[n.jsxs("div",{className:"p-6 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>P(k===Oe.id?null:Oe.id),children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-2xl",children:Ne(Oe.service_type)}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-gray-900",children:Oe.order_number}),n.jsx("p",{className:"text-sm text-gray-500",children:new Date(Oe.created_at).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${Oe.status==="delivered"?"bg-green-100 text-green-600":Oe.status==="cancelled"?"bg-red-100 text-red-600":"bg-pink-100 text-[#e14171]"}`,children:Oe.status.replace("_"," ").charAt(0).toUpperCase()+Oe.status.slice(1).replace("_"," ")}),n.jsx(Dn,{className:`h-5 w-5 text-gray-400 transition-transform ${k===Oe.id?"rotate-90":""}`})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("p",{className:"text-gray-700 capitalize",children:[Oe.service_type.replace("-"," ")," Service"]}),n.jsxs("p",{className:"text-sm text-gray-500",children:[Oe.order_items?.length||0," item",(Oe.order_items?.length||0)!==1?"s":""]})]}),n.jsxs("span",{className:"text-xl font-bold text-gray-900",children:["$",Oe.total.toFixed(2)]})]})]}),k===Oe.id&&n.jsxs("div",{className:"border-t border-gray-100",children:[n.jsxs("div",{className:"p-6 bg-gray-50",children:[n.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Items in this Order"}),Oe.order_items&&Oe.order_items.length>0?n.jsx("div",{className:"space-y-3",children:Oe.order_items.map((Be,xt)=>n.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center",children:n.jsx(_a,{className:"h-5 w-5 text-[#e14171]"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:_e(Be.item_name)}),n.jsx("p",{className:"text-sm text-gray-500 capitalize",children:Be.item_type.replace(/_/g," ")})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-medium text-gray-900",children:["$",Be.total_price.toFixed(2)]}),n.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",Be.quantity]})]})]},Be.id||xt))}):n.jsx("p",{className:"text-gray-500 text-center py-4",children:"No items recorded"}),Oe.order_addons&&Oe.order_addons.length>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Add-ons"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:Oe.order_addons.map((Be,xt)=>n.jsxs("span",{className:"px-3 py-1 bg-pink-100 text-[#e14171] rounded-full text-sm",children:[Be.addon_type.replace(/_/g," ").replace(/\b\w/g,$e=>$e.toUpperCase())," (+$",Be.price,")"]},Be.id||xt))})]}),Oe.order_preferences&&n.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg",children:[n.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Preferences"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[Oe.order_preferences.detergent_type&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Detergent:"})," ",n.jsx("span",{className:"capitalize",children:Oe.order_preferences.detergent_type})]}),Oe.order_preferences.folding_style&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Folding:"})," ",n.jsx("span",{className:"capitalize",children:Oe.order_preferences.folding_style})]}),Oe.order_preferences.water_temp&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Water:"})," ",n.jsx("span",{className:"capitalize",children:Oe.order_preferences.water_temp})]}),Oe.order_preferences.packaging_type&&n.jsxs("p",{children:[n.jsx("span",{className:"text-gray-500",children:"Packaging:"})," ",n.jsx("span",{className:"capitalize",children:Oe.order_preferences.packaging_type})]})]})]}),n.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg",children:[n.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Price Breakdown"}),n.jsxs("div",{className:"space-y-1 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-500",children:"Subtotal"}),n.jsxs("span",{children:["$",Oe.subtotal.toFixed(2)]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-500",children:"Delivery Fee"}),n.jsxs("span",{children:["$",Oe.delivery_fee.toFixed(2)]})]}),Oe.discount>0&&n.jsxs("div",{className:"flex justify-between text-green-600",children:[n.jsx("span",{children:"Discount"}),n.jsxs("span",{children:["-$",Oe.discount.toFixed(2)]})]}),Oe.applied_credit&&Oe.applied_credit>0&&n.jsxs("div",{className:"flex justify-between text-[#e14171]",children:[n.jsx("span",{children:"Credits Applied"}),n.jsxs("span",{children:["- $",Oe.applied_credit.toFixed(2)]})]}),n.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t",children:[n.jsx("span",{children:"Total Paid"}),n.jsxs("span",{children:["$",Oe.total.toFixed(2)]})]})]})]})]}),n.jsxs("div",{className:"p-4 flex flex-wrap gap-3 border-t",children:[n.jsxs("button",{onClick:Be=>{Be.stopPropagation(),G(Oe)},className:"flex-1 min-w-[140px] flex items-center justify-center gap-2 px-4 py-3 border border-gray-200 rounded-xl hover:bg-gray-50 font-medium transition-colors",children:[n.jsx(io,{className:"h-4 w-4"}),"Reorder"]}),n.jsx("button",{onClick:Be=>{Be.stopPropagation(),c(Oe)},className:"flex-1 min-w-[140px] px-4 py-3 text-[#e14171] border border-[#e14171] rounded-xl hover:bg-pink-50 font-medium transition-colors",children:"View Receipt"}),pe(Oe.status)&&n.jsxs("button",{onClick:Be=>{Be.stopPropagation(),F(Oe)},className:"flex-1 min-w-[140px] flex items-center justify-center gap-2 px-4 py-3 text-red-600 border border-red-200 rounded-xl hover:bg-red-50 font-medium transition-colors",children:[n.jsx(wg,{className:"h-4 w-4"}),"Cancel Order"]})]})]})]},Oe.id))}),T&&n.jsx(uT,{order:T,onClose:()=>c(null)}),O&&n.jsx(dT,{order:O,onClose:()=>F(null),onConfirm:Y,loading:re})]})}function mT(){const{addresses:m,loading:h,addAddress:_,updateAddress:S,deleteAddress:k,setDefaultAddress:P}=bv(),[T,c]=ee.useState(!1),[O,F]=ee.useState(null),[re,se]=ee.useState(null),[ue,ae]=ee.useState(null),[Q,Y]=ee.useState({label:"",address:"",landmark:"",latitude:null,longitude:null,is_default:!1}),[G,pe]=ee.useState(!1),[_e,Ne]=ee.useState(null),[Oe,Be]=ee.useState(!1),[xt,$e]=ee.useState(null),de=()=>{Y({label:"",address:"",landmark:"",latitude:null,longitude:null,is_default:!1}),ae(null),$e(null)},Ae=()=>{de(),F(null),c(!0)},Ye=Ce=>{Y({label:Ce.label,address:Ce.address,landmark:Ce.landmark,latitude:Ce.latitude??null,longitude:Ce.longitude??null,is_default:Ce.is_default}),F(Ce),c(!0)},_t=async()=>{if(!Q.label||!Q.address){ae("Please fill in all required fields");return}pe(!0),ae(null);try{let Ce;O?Ce=await S(O.id,Q):Ce=await _(Q),Ce.success?(se({type:"success",message:Ce.message}),c(!1),de(),F(null)):ae(Ce.message)}catch(Ce){const We=Ce instanceof Error?Ce.message:"An unexpected error occurred";ae(We)}finally{pe(!1)}},Et=async()=>{if(!navigator.geolocation){$e("Geolocation is not supported in this browser.");return}if(!window.isSecureContext){$e("Location requires HTTPS or localhost. Please open the site over https:// or http://localhost.");return}$e(null),Be(!0);try{const Ce=await new Promise((lt,Ot)=>{navigator.geolocation.getCurrentPosition(lt,Ot,{enableHighAccuracy:!0,timeout:12e3,maximumAge:0})}),{latitude:We,longitude:dt}=Ce.coords,Ze=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${We}&lon=${dt}&zoom=18&addressdetails=1&email=dev@bubblebox.com`,le=await(await fetch(Ze,{headers:{Accept:"application/json","User-Agent":"bubblebox-app/1.0"}})).json(),Le=le?.display_name,nt=le?.address?.suburb||le?.address?.neighbourhood||le?.address?.city||le?.address?.road||"";Y(lt=>({...lt,address:Le||`Pinned location (${We.toFixed(5)}, ${dt.toFixed(5)})`,landmark:lt.landmark||nt,latitude:We,longitude:dt}))}catch(Ce){console.error("Geo error",Ce),Ce?.code===1?$e("Permission denied. Allow location (browser lock icon) then try again."):Ce?.code===2?$e("Position unavailable. Check connection/GPS and retry."):Ce?.code===3?$e("Timed out fetching location. Please retry."):$e(Ce?.message||"Unable to fetch current location. Please allow location access.")}finally{Be(!1)}},zt=async Ce=>{Ne(Ce);try{const We=await k(Ce);We.success?se({type:"success",message:We.message}):se({type:"error",message:We.message})}catch{se({type:"error",message:"Failed to delete address"})}finally{Ne(null),setTimeout(()=>se(null),3e3)}},ht=async Ce=>{try{const We=await P(Ce);We.success?se({type:"success",message:"Default address updated"}):se({type:"error",message:We.message})}catch{se({type:"error",message:"Failed to set default address"})}setTimeout(()=>se(null),3e3)},Qe=Ce=>{const We=Ce.toLowerCase();return We.includes("home")?n.jsx(hv,{className:"h-5 w-5"}):We.includes("work")||We.includes("office")?n.jsx(pS,{className:"h-5 w-5"}):n.jsx(qa,{className:"h-5 w-5"})};return h?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Saved Addresses"}),n.jsxs("button",{onClick:Ae,className:"flex items-center gap-2 px-4 py-2 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] transition-colors",children:[n.jsx(Vc,{className:"h-5 w-5"}),"Add Address"]})]}),re&&n.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-3 ${re.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[re.type==="success"?n.jsx(ni,{className:"h-5 w-5 text-green-600"}):n.jsx(wg,{className:"h-5 w-5 text-red-600"}),n.jsx("p",{children:re.message})]}),m.length===0?n.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm text-center",children:[n.jsx(qa,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Saved Addresses"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Add your first address to speed up checkout."}),n.jsxs("button",{onClick:Ae,className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-6 py-3 rounded-full font-medium hover:bg-[#c73562]",children:[n.jsx(Vc,{className:"h-5 w-5"}),"Add Your First Address"]})]}):n.jsx("div",{className:"space-y-4",children:m.map(Ce=>n.jsx("div",{className:`bg-white rounded-2xl p-6 shadow-sm border-2 ${Ce.is_default?"border-[#e14171]":"border-transparent"}`,children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${Ce.is_default?"bg-pink-100 text-[#e14171]":"bg-gray-100 text-gray-500"}`,children:Qe(Ce.label)}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:Ce.label}),Ce.is_default&&n.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-pink-100 text-[#e14171] rounded-full text-xs font-medium",children:[n.jsx(ro,{className:"h-3 w-3 fill-current"}),"Default"]})]}),n.jsx("p",{className:"text-gray-700",children:Ce.address}),Ce.landmark&&n.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.jsx("span",{className:"font-medium",children:"Landmark:"})," ",Ce.landmark]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[!Ce.is_default&&n.jsx("button",{onClick:()=>ht(Ce.id),className:"p-2 text-gray-400 hover:text-[#e14171] hover:bg-pink-50 rounded-lg transition-colors",title:"Set as default",children:n.jsx(ro,{className:"h-5 w-5"})}),n.jsx("button",{onClick:()=>Ye(Ce),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:n.jsx(uj,{className:"h-5 w-5"})}),n.jsx("button",{onClick:()=>zt(Ce.id),disabled:_e===Ce.id,className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Delete",children:_e===Ce.id?n.jsx(Ss,{className:"h-5 w-5 animate-spin"}):n.jsx(Eg,{className:"h-5 w-5"})})]})]})},Ce.id))}),T&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:O?"Edit Address":"Add New Address"}),n.jsx("button",{onClick:()=>{c(!1),F(null),de()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:n.jsx(Ga,{className:"h-5 w-5 text-gray-500"})})]}),n.jsxs("div",{className:"p-6 space-y-4",children:[ue&&n.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl flex items-start gap-3",children:[n.jsx(wg,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-red-800",children:"Error saving address"}),n.jsx("p",{className:"text-sm text-red-600 mt-1",children:ue})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Label ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsx("div",{className:"flex gap-2 mb-2",children:["Home","Work","Other"].map(Ce=>n.jsx("button",{type:"button",onClick:()=>Y({...Q,label:Ce}),className:`px-4 py-2 rounded-lg font-medium transition-colors ${Q.label===Ce?"bg-[#e14171] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Ce},Ce))}),n.jsx("input",{type:"text",value:Q.label,onChange:Ce=>Y({...Q,label:Ce.target.value}),placeholder:"Or enter custom label...",className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Address ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm",children:[n.jsxs("button",{type:"button",onClick:Et,className:"flex items-center gap-2 text-[#e14171] font-medium hover:underline disabled:text-gray-400",disabled:Oe,children:[Oe?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(qa,{className:"h-4 w-4"}),"Use my current location"]}),xt&&n.jsx("span",{className:"text-red-500 text-xs",children:xt})]}),n.jsx("textarea",{value:Q.address,onChange:Ce=>Y({...Q,address:Ce.target.value}),placeholder:"Enter your full address",rows:3,className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"}),Q.latitude!==null&&Q.longitude!==null&&n.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Saved pin: ",Q.latitude.toFixed(5),", ",Q.longitude.toFixed(5)]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Landmark"}),n.jsx("input",{type:"text",value:Q.landmark,onChange:Ce=>Y({...Q,landmark:Ce.target.value}),placeholder:"e.g., Near the Red Mosque, 2nd floor",className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:Q.is_default,onChange:Ce=>Y({...Q,is_default:Ce.target.checked}),className:"w-5 h-5 rounded text-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Set as default address"})]})]}),n.jsxs("div",{className:"p-6 border-t flex gap-3",children:[n.jsx("button",{onClick:()=>{c(!1),F(null),de()},className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:_t,disabled:G||!Q.label||!Q.address,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-[#e14171] text-white rounded-xl hover:bg-[#c73562] font-medium transition-colors disabled:opacity-50",children:[G&&n.jsx(Ss,{className:"h-5 w-5 animate-spin"}),O?"Save Changes":"Add Address"]})]})]})})]})}function gT(){const{user:m}=ao(),{orders:h,loading:_}=Ag(m?.id),S=yf(),k=h.filter(P=>P.status==="delivered").sort((P,T)=>new Date(T.created_at).getTime()-new Date(P.created_at).getTime());return _?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):k.length===0?n.jsxs("div",{className:"space-y-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Completed Orders"}),n.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm text-center",children:[n.jsx(_a,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No completed orders yet"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Once your orders are delivered, they will appear here."}),n.jsxs("button",{onClick:()=>S("/booking"),className:"inline-flex items-center gap-2 bg-[#e14171] text-white px-6 py-3 rounded-full font-medium hover:bg-[#c73562]",children:["Book a Pickup",n.jsx(Dn,{className:"h-5 w-5"})]})]})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Completed Orders"}),n.jsx("div",{className:"space-y-4",children:k.map(P=>n.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-gray-900",children:P.order_number}),n.jsx("p",{className:"text-sm text-gray-500",children:new Date(P.created_at).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),n.jsxs("p",{className:"text-sm text-gray-500 capitalize mt-1",children:[P.service_type.replace("-"," ")," Service"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-medium",children:"Delivered"}),n.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["$",P.total.toFixed(2)]})]})]}),P.order_items&&P.order_items.length>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Items"}),n.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-gray-600",children:P.order_items.map((T,c)=>n.jsxs("span",{className:"px-3 py-1 bg-gray-100 rounded-full",children:[T.item_name.replace(/_/g," ")," x",T.quantity]},c))})]})]},P.id))})]})}function yT(){const{referralCode:m,referrals:h,stats:_,referrerBonus:S,refereeBonus:k,loading:P,copyCode:T,shareOnWhatsApp:c,getShareUrl:O}=ox(),[F,re]=ee.useState(!1),[se,ue]=ee.useState(!1),ae=async()=>{await T()&&(re(!0),setTimeout(()=>re(!1),2e3))},Q=async()=>{try{await navigator.clipboard.writeText(O()),ue(!0),setTimeout(()=>ue(!1),2e3)}catch(Y){console.error("Failed to copy link:",Y)}};return P?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):n.jsxs("div",{className:"space-y-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Referral Program"}),n.jsxs("div",{className:"bg-gradient-to-r from-[#e14171] to-pink-600 rounded-2xl p-8 text-white",children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx(mf,{className:"h-16 w-16 mx-auto mb-4 opacity-90"}),n.jsxs("h3",{className:"text-2xl font-bold mb-2",children:["Give $",k.toFixed(0),", Get $",S.toFixed(0)]}),n.jsx("p",{className:"text-pink-100",children:"Share your code with friends. When they complete their first order, you both get credit!"})]}),n.jsxs("div",{className:"bg-white/20 rounded-xl p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-pink-100",children:"Your referral code"}),n.jsx("p",{className:"text-2xl font-bold",children:m?.code||"Loading..."})]}),n.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:[n.jsx(v0,{className:"h-5 w-5"}),F?"Copied!":"Copy Code"]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-green-500 rounded-lg hover:bg-green-600 transition-colors",children:[n.jsx(bj,{className:"h-4 w-4"}),"Share on WhatsApp"]}),n.jsxs("button",{onClick:Q,className:"flex items-center gap-2 px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:[n.jsx(v0,{className:"h-4 w-4"}),se?"Link Copied!":"Copy Link"]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Your Stats"}),n.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[n.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-xl",children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:_.totalReferrals}),n.jsx("p",{className:"text-sm text-gray-500",children:"Friends Referred"})]}),n.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-xl",children:[n.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["$",_.totalEarned.toFixed(2)]}),n.jsx("p",{className:"text-sm text-gray-500",children:"Earned"})]}),n.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-xl",children:[n.jsxs("p",{className:"text-2xl font-bold text-[#e14171]",children:["$",_.creditBalance.toFixed(2)]}),n.jsx("p",{className:"text-sm text-gray-500",children:"Available"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[n.jsxs("div",{className:"p-4 bg-yellow-50 rounded-xl border border-yellow-200",children:[n.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:_.pendingReferrals}),n.jsx("p",{className:"text-sm text-yellow-700",children:"Pending (waiting for first order)"})]}),n.jsxs("div",{className:"p-4 bg-green-50 rounded-xl border border-green-200",children:[n.jsx("p",{className:"text-2xl font-bold text-green-600",children:_.completedReferrals}),n.jsx("p",{className:"text-sm text-green-700",children:"Completed"})]})]}),h.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Referrals"}),n.jsx("div",{className:"space-y-3",children:h.slice(0,5).map(Y=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${Y.status==="completed"?"bg-green-100":"bg-yellow-100"}`,children:n.jsx(Xd,{className:`h-5 w-5 ${Y.status==="completed"?"text-green-600":"text-yellow-600"}`})}),n.jsxs("div",{children:[n.jsx("span",{className:"font-medium text-gray-900",children:Y.referee?.full_name||`Friend #${Y.referee_id.slice(0,6)}`}),n.jsx("p",{className:"text-xs text-gray-500",children:new Date(Y.created_at).toLocaleDateString()})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${Y.status==="completed"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:Y.status==="completed"?"Completed":"Pending"}),n.jsx("p",{className:"font-medium mt-1",children:Y.status==="completed"?`+$${Y.referrer_credit_amount}`:"Waiting..."})]})]},Y.id))})]}),h.length===0&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(mf,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{className:"text-gray-500",children:"No referrals yet. Share your code to start earning!"})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"How It Works"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-[#e14171] font-bold",children:"1"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Share your code"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Send your unique code to friends and family"})]})]}),n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-[#e14171] font-bold",children:"2"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Friend signs up"}),n.jsxs("p",{className:"text-sm text-gray-500",children:["They get $",k.toFixed(2)," credit instantly when they use your code"]})]})]}),n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-[#e14171] font-bold",children:"3"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-medium text-gray-900",children:["You earn $",S.toFixed(2)]}),n.jsx("p",{className:"text-sm text-gray-500",children:"When they complete their first order, you get credit too!"})]})]})]})]})]})}function xT(){const m=sc(),h=yf(),{user:_,profile:S,loading:k}=ao(),{stats:P}=ox(),[T,c]=ee.useState(!1),O=_?P.creditBalance:0;if(k)return n.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:n.jsx(Ss,{className:"h-12 w-12 animate-spin text-[#e14171]"})});if(!_)return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm max-w-md w-full text-center",children:[n.jsx(Xd,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Sign In Required"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Please sign in to access your account and track your orders."}),n.jsx("button",{onClick:()=>c(!0),className:"w-full py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] transition-colors",children:"Sign In"})]})}),n.jsx(lx,{isOpen:T,onClose:()=>c(!1),initialMode:"signin"})]});const F=[{path:"/portal",label:"Active Orders",icon:_a},{path:"/portal/completed",label:"Completed Orders",icon:ni},{path:"/portal/addresses",label:"My Addresses",icon:qa},{path:"/portal/preferences",label:"Preferences",icon:gv},{path:"/portal/history",label:"Order History",icon:y_},{path:"/portal/referrals",label:"Referral Program",icon:mf}],re=ue=>m.pathname===ue,se=S?.full_name||_.email?.split("@")[0]||"User";return n.jsx("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:n.jsxs("div",{className:"grid lg:grid-cols-4 gap-8",children:[n.jsxs("div",{className:"lg:col-span-1",children:[n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm mb-6",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[n.jsx("div",{className:"w-14 h-14 bg-[#e14171] rounded-full flex items-center justify-center text-white text-xl font-bold",children:se.charAt(0).toUpperCase()}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-gray-900",children:se}),n.jsx("p",{className:"text-sm text-gray-500",children:_.email})]})]}),n.jsxs("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl p-4 mb-6",children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Credit Balance"}),n.jsxs("p",{className:"text-2xl font-bold text-[#e14171]",children:["$",O.toFixed(2)]})]}),n.jsx("nav",{className:"space-y-2",children:F.map(ue=>n.jsxs("button",{onClick:()=>h(ue.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-colors ${re(ue.path)?"bg-pink-50 text-[#e14171]":"text-gray-600 hover:bg-gray-50"}`,children:[n.jsx(ue.icon,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium",children:ue.label}),n.jsx(Dn,{className:"h-4 w-4 ml-auto"})]},ue.path))})]}),n.jsx(wr,{to:"/booking",className:"block w-full py-3 bg-[#e14171] text-white text-center rounded-xl font-medium hover:bg-[#c73562] transition-colors",children:"New Order"})]}),n.jsx("div",{className:"lg:col-span-3",children:n.jsxs(h_,{children:[n.jsx(Br,{path:"/",element:n.jsx(hT,{})}),n.jsx(Br,{path:"/completed",element:n.jsx(gT,{})}),n.jsx(Br,{path:"/addresses",element:n.jsx(mT,{})}),n.jsx(Br,{path:"/preferences",element:n.jsx(fT,{})}),n.jsx(Br,{path:"/history",element:n.jsx(pT,{})}),n.jsx(Br,{path:"/referrals",element:n.jsx(yT,{})})]})})]})})})}function rm(){const[m,h]=ee.useState(!0),[_,S]=ee.useState(null),[k,P]=ee.useState([]),[T,c]=ee.useState([]),[O,F]=ee.useState({total:0,orders:0,avgOrder:0,growth:0,newCustomers:0}),[re,se]=ee.useState([]),[ue,ae]=ee.useState([]),[Q,Y]=ee.useState([]),[G,pe]=ee.useState([]),[_e,Ne]=ee.useState([]),[Oe,Be]=ee.useState({total:0,active:0,todayPickups:0,todayDeliveries:0}),xt=ee.useCallback(async()=>{try{const{data:We,error:dt}=await vt.from("orders").select(`
          id,
          order_number,
          address,
          landmark,
          status,
          service_type,
          pickup_date,
          pickup_time_slot,
          delivery_date,
          delivery_time_slot,
          total_amount,
          created_at,
          users!inner(full_name)
        `).in("status",["pending","confirmed","scheduled","picked_up","cleaning","ready","out_for_delivery"]).order("created_at",{ascending:!1});if(dt){console.error("Error fetching order pins:",dt);const{data:Ze,error:Pe}=await vt.from("orders").select("*").in("status",["pending","confirmed","scheduled","picked_up","cleaning","ready","out_for_delivery"]).order("created_at",{ascending:!1});if(Pe)throw Pe;P(Ze?.map(le=>({...le,customer_name:"Customer"}))||[])}else P(We?.map(Ze=>({...Ze,customer_name:Ze.users?.full_name||"Customer"}))||[])}catch(We){console.error("Error fetching order pins:",We)}},[]),$e=ee.useCallback(async()=>{try{const We=new Date;We.setDate(We.getDate()-30);const{data:dt,error:Ze}=await vt.from("orders").select("landmark").gte("created_at",We.toISOString());if(Ze)throw Ze;const Pe={};dt?.forEach(nt=>{const lt=nt.landmark?.split(",")[0]?.trim()||"Unknown Area";Pe[lt]=(Pe[lt]||0)+1});const le=Object.values(Pe).reduce((nt,lt)=>nt+lt,0),Le=Object.entries(Pe).map(([nt,lt])=>({name:nt,orders:lt,percentage:le>0?Math.round(lt/le*100):0})).sort((nt,lt)=>lt.orders-nt.orders).slice(0,5);c(Le)}catch(We){console.error("Error fetching hot zones:",We)}},[]),de=ee.useCallback(async(We="today",dt)=>{try{const Ze=["delivered","completed","closed"],Pe=new Date;let le=new Date(Pe),Le=new Date(Pe),nt=new Date(Pe),lt=new Date(Pe);if(We==="custom"&&dt?.start&&dt?.end)le=new Date(dt.start),le.setHours(0,0,0,0),Le=new Date(dt.end),Le.setHours(23,59,59,999);else switch(We){case"today":le.setHours(0,0,0,0),Le.setHours(23,59,59,999);break;case"week":le.setDate(le.getDate()-7),le.setHours(0,0,0,0),Le.setHours(23,59,59,999);break;case"month":le.setMonth(le.getMonth()-1),le.setHours(0,0,0,0),Le.setHours(23,59,59,999);break;case"year":le.setFullYear(le.getFullYear()-1),le.setHours(0,0,0,0),Le.setHours(23,59,59,999);break}const Ot=Le.getTime()-le.getTime();lt=new Date(le),lt.setMilliseconds(lt.getMilliseconds()-1),nt=new Date(lt.getTime()-Ot);const Mt=Fs=>Number(Fs.total??Fs.total_amount??(Number(Fs.subtotal)||0)+(Number(Fs.delivery_fee)||0)-(Number(Fs.discount)||0))||0,mt=le.toISOString(),Dt=Le.toISOString(),ys=mt.slice(0,10),js=Dt.slice(0,10),ks=nt.toISOString(),Es=lt.toISOString(),Rr=ks.slice(0,10),us=Es.slice(0,10),{data:xs,error:Is}=await vt.from("orders").select("*").or(`and(delivery_date.gte.${ys},delivery_date.lte.${js}),and(delivery_date.is.null,created_at.gte.${mt},created_at.lte.${Dt})`).neq("status","cancelled");if(Is)throw Is;const{data:Os,error:ar}=await vt.from("orders").select("total_amount, total, subtotal, delivery_fee, discount").or(`and(delivery_date.gte.${Rr},delivery_date.lte.${us}),and(delivery_date.is.null,created_at.gte.${ks},created_at.lte.${Es})`).neq("status","cancelled");if(ar)throw ar;const{data:vi}=await vt.from("users").select("id").gte("created_at",le.toISOString()),wt=xs?.reduce((Fs,Ls)=>Fs+(Number(Ls.total_amount)||0),0)||0,qs=xs?.reduce((Fs,Ls)=>Fs+Mt(Ls),0)||0,yr=xs?.length||0,Ha=yr>0?qs/yr:0,Ms=Os?.reduce((Fs,Ls)=>Fs+(Number(Ls.total_amount)||0),0)||0,oi=Ms>0?(qs-Ms)/Ms*100:0;F({total:qs,orders:yr,avgOrder:Ha,growth:Math.round(oi*10)/10,newCustomers:vi?.length||0}),Y(xs||[]);const Fr={};xs?.forEach(Fs=>{const Ls=(Fs.service_type||"other").toString(),Fe=Ls==="dry-clean"||Ls==="dry_clean"?"dryclean":Ls;Fr[Fe]||(Fr[Fe]={amount:0,orders:0}),Fr[Fe].amount+=Mt(Fs),Fr[Fe].orders+=1});const Oi={laundry:"bg-[#e14171]",suit:"bg-gray-800",shoe:"bg-pink-400",dryclean:"bg-gray-600",other:"bg-gray-400"},Gi={laundry:"Laundry Services",suit:"Suit Cleaning",shoe:"Shoe Cleaning",dryclean:"Dry Cleaning",other:"Other"};se(Object.entries(Fr).map(([Fs,Ls])=>({service:Gi[Fs]||Fs,amount:Ls.amount,orders:Ls.orders,color:Oi[Fs]||"bg-gray-400"})))}catch(Ze){console.error("Error fetching revenue stats:",Ze)}},[]),Ae=ee.useCallback(async()=>{try{const{data:We,error:dt}=await vt.from("orders").select(`
          id,
          order_number,
          total_amount,
          status,
          service_type,
          created_at,
          users(full_name)
        `).order("created_at",{ascending:!1}).limit(10);if(dt){const{data:Ze,error:Pe}=await vt.from("orders").select("*").order("created_at",{ascending:!1}).limit(10);if(Pe)throw Pe;ae(Ze?.map(le=>({id:le.id,order_number:le.order_number,customer_name:"Customer",amount:le.total_amount||0,time:new Date(le.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:le.status,service_type:le.service_type}))||[])}else ae(We?.map(Ze=>({id:Ze.id,order_number:Ze.order_number,customer_name:Ze.users?.full_name||"Customer",amount:Ze.total_amount||0,time:new Date(Ze.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:Ze.status,service_type:Ze.service_type}))||[])}catch(We){console.error("Error fetching recent transactions:",We)}},[]),Ye=ee.useCallback(async We=>{try{let dt=vt.from("users").select(`
          id,
          full_name,
          email,
          phone,
          created_at,
          user_preferences(
            detergent_type,
            fabric_softener,
            water_temp,
            folding_style,
            drying_heat,
            default_packaging,
            shirts_hung,
            pants_creased
          )
        `).order("created_at",{ascending:!1});We&&(dt=dt.or(`full_name.ilike.%${We}%,email.ilike.%${We}%`));const{data:Ze,error:Pe}=await dt;if(Pe)throw Pe;const le=await Promise.all((Ze||[]).map(async Le=>{const{data:nt}=await vt.from("orders").select("id, total_amount, created_at, status").eq("user_id",Le.id).neq("status","cancelled"),lt=nt?.length||0,Ot=nt?.reduce((Rr,us)=>Rr+(us.total_amount||0),0)||0,Mt=nt?.[0]?.created_at,{data:mt}=await vt.from("customer_notes").select("note").eq("user_id",Le.id).limit(1).single(),{data:Dt}=await vt.from("reviews").select("rating").eq("user_id",Le.id),ys=Dt?.length?Dt.reduce((Rr,us)=>Rr+us.rating,0)/Dt.length:0,js=[],ks=Le.user_preferences?.[0],Es=Rr=>Rr?Rr.replace(/_/g," ").replace(/\b\w/g,us=>us.toUpperCase()):null;return ks&&(ks.detergent_type&&js.push(`${Es(ks.detergent_type)} detergent`),ks.fabric_softener&&js.push("Fabric softener"),ks.water_temp&&js.push(`${Es(ks.water_temp)} water`),ks.folding_style&&js.push(`${Es(ks.folding_style)} fold`),ks.drying_heat&&js.push(`${Es(ks.drying_heat)} dry`),ks.default_packaging&&js.push(`${Es(ks.default_packaging)} packaging`),ks.shirts_hung&&js.push("Shirts hung"),ks.pants_creased&&js.push("Pants creased")),{id:Le.id,user_id:Le.id,name:Le.full_name||"Unknown",email:Le.email||"",phone:Le.phone||"",orders_count:lt,total_spent:Ot,notes:mt?.note||"",preferences:js,last_order:Mt?Ce(new Date(Mt)):"Never",average_rating:Math.round(ys*10)/10}}));pe(le)}catch(dt){console.error("Error fetching customers:",dt)}},[]),_t=async(We,dt)=>{try{const{data:Ze}=await vt.from("customer_notes").select("id").eq("user_id",We).limit(1).single();if(Ze){const{error:Pe}=await vt.from("customer_notes").update({note:dt,updated_at:new Date().toISOString()}).eq("user_id",We);if(Pe)throw Pe}else{const{error:Pe}=await vt.from("customer_notes").insert({user_id:We,note:dt});if(Pe)throw Pe}return await Ye(),{success:!0}}catch(Ze){return console.error("Error updating customer note:",Ze),{success:!1,message:Ze.message}}},Et=ee.useCallback(async()=>{try{const{data:We,error:dt}=await vt.from("drivers").select("*").order("name");if(dt)throw dt;const Ze=new Date().toISOString().split("T")[0],Pe=await Promise.all((We||[]).map(async lt=>{const{data:Ot}=await vt.from("driver_trips").select("*").eq("driver_id",lt.id).gte("started_at",Ze),Mt=Ot?.filter(xs=>xs.trip_type==="pickup").length||0,mt=Ot?.filter(xs=>xs.trip_type==="delivery").length||0,Dt=Ot?.filter(xs=>xs.completed_at)||[],ys=Dt.filter(xs=>xs.trip_type==="pickup"),js=ys.length>0?ys.reduce((xs,Is)=>{const Os=new Date(Is.started_at).getTime(),ar=new Date(Is.completed_at).getTime();return xs+(ar-Os)/6e4},0)/ys.length:20,ks=30,Es=45,Rr=Dt.length>0?Dt.filter(xs=>{const Is=(new Date(xs.completed_at).getTime()-new Date(xs.started_at).getTime())/6e4;return xs.trip_type==="pickup"?Is<=ks:Is<=Es}):[],us=Dt.length>0?Math.round(Rr.length/Dt.length*100):lt.on_time_rate||95;return{id:lt.id,name:lt.name,phone:lt.phone||"",status:lt.status||"offline",zone_id:lt.zone_id||"",today_pickups:Mt,today_deliveries:mt,avg_pickup_time:Math.round(js),avg_delivery_time:Math.round(js*1.2),rating:lt.rating||4.5,on_time_rate:us}}));Ne(Pe);const le=Pe.filter(lt=>lt.status==="active").length,Le=Pe.reduce((lt,Ot)=>lt+Ot.today_pickups,0),nt=Pe.reduce((lt,Ot)=>lt+Ot.today_deliveries,0);Be({total:Pe.length,active:le,todayPickups:Le,todayDeliveries:nt})}catch(We){console.error("Error fetching drivers:",We)}},[]),zt=async We=>{try{const{error:dt}=await vt.from("drivers").insert({...We,status:"offline",rating:5,on_time_rate:100});if(dt)throw dt;return await Et(),{success:!0}}catch(dt){return console.error("Error adding driver:",dt),{success:!1,message:dt.message}}},ht=ee.useCallback(async(We,dt,Ze)=>{try{let Pe=vt.from("driver_trips").select(`
            *,
            orders:order_id (
              order_number,
              users:users!orders_user_id_fkey(full_name)
            )
          `).eq("driver_id",We).order("started_at",{ascending:!1}).limit(100);dt&&(Pe=Pe.gte("started_at",dt)),Ze&&(Pe=Pe.lte("started_at",Ze));const{data:le,error:Le}=await Pe;if(Le)throw Le;return(le||[]).map(nt=>{const lt=nt.started_at&&nt.completed_at?(new Date(nt.completed_at).getTime()-new Date(nt.started_at).getTime())/6e4:null;return{id:nt.id,order_id:nt.order_id,order_number:nt.orders?.order_number||null,customer_name:nt.orders?.users?.full_name||null,trip_type:nt.trip_type,started_at:nt.started_at,completed_at:nt.completed_at,duration_minutes:lt?Math.round(lt*10)/10:null}})}catch(Pe){return console.error("Error fetching driver trips:",Pe),[]}},[]),Qe=async(We,dt)=>{try{const{error:Ze}=await vt.from("drivers").update({status:dt}).eq("id",We);if(Ze)throw Ze;return await Et(),{success:!0}}catch(Ze){return console.error("Error updating driver status:",Ze),{success:!1,message:Ze.message}}},Ce=We=>{const Ze=new Date().getTime()-We.getTime(),Pe=Math.floor(Ze/(1e3*60*60*24));return Pe===0?"Today":Pe===1?"Yesterday":Pe<7?`${Pe} days ago`:Pe<30?`${Math.floor(Pe/7)} weeks ago`:Pe<365?`${Math.floor(Pe/30)} months ago`:`${Math.floor(Pe/365)} years ago`};return ee.useEffect(()=>{(async()=>{h(!0);try{await Promise.all([xt(),$e(),de("today"),Ae(),Ye(),Et()])}catch(dt){S(dt.message)}finally{h(!1)}})()},[xt,$e,de,Ae,Ye,Et]),{loading:m,error:_,orderPins:k,hotZones:T,fetchOrderPins:xt,fetchHotZones:$e,dailyStats:O,revenueOrders:Q,serviceBreakdown:re,recentTransactions:ue,fetchRevenueStats:de,fetchRecentTransactions:Ae,customers:G,fetchCustomers:Ye,updateCustomerNote:_t,drivers:_e,driverStats:Oe,fetchDrivers:Et,addDriver:zt,updateDriverStatus:Qe,fetchDriverTrips:ht}}function _T(){const[m,h]=ee.useState([]),[_,S]=ee.useState([]),[k,P]=ee.useState(!0),[T,c]=ee.useState(null),O=[{id:"1",name:"customer",display_name:"Customer",description:"Regular customer",level:0},{id:"2",name:"driver",display_name:"Driver",description:"Delivery driver",level:20},{id:"3",name:"staff",display_name:"Staff",description:"Staff member",level:40},{id:"4",name:"manager",display_name:"Manager",description:"Manager",level:60},{id:"5",name:"admin",display_name:"Admin",description:"Administrator",level:80},{id:"6",name:"super_admin",display_name:"Super Admin",description:"Full access",level:100}],F=async()=>{try{P(!0),c(null),console.log("Fetching users...");const{data:G,error:pe}=await vt.from("users").select("*").order("created_at",{ascending:!1});if(pe){console.error("Error fetching users:",pe),c(pe.message);return}console.log("Users fetched:",G),h(G||[])}catch(G){console.error("Exception fetching users:",G),c(G.message)}finally{P(!1)}},re=async()=>{try{const{data:G,error:pe}=await vt.from("roles").select("*").order("level",{ascending:!0});if(pe){console.log("Roles table error, using defaults:",pe),S(O);return}S(G&&G.length>0?G:O)}catch{console.log("Using default roles"),S(O)}};ee.useEffect(()=>{F(),re()},[]);const se=async G=>{try{console.log("Creating user with data:",G);const{data:{user:pe}}=await vt.auth.getUser(),_e=pe?.id||null,{data:Ne,error:Oe}=await vt.auth.signUp({email:G.email,password:G.password,options:{data:{full_name:G.fullName,role:G.role,phone:G.phone||null}}});if(Oe)return console.error("Auth error:",Oe),{success:!1,message:Oe.message};if(!Ne.user)return{success:!1,message:"Failed to create auth user"};console.log("Auth user created:",Ne.user.id),await new Promise(xt=>setTimeout(xt,500));const{error:Be}=await vt.from("users").update({full_name:G.fullName,phone:G.phone||null,role:G.role,created_by:_e,is_active:!0}).eq("id",Ne.user.id);if(Be){console.error("Update error:",Be);const{error:xt}=await vt.from("users").insert({id:Ne.user.id,email:G.email,full_name:G.fullName,phone:G.phone||null,role:G.role,created_by:_e,is_active:!0});if(xt)return console.error("Insert error:",xt),{success:!1,message:xt.message}}return console.log("User record updated successfully"),await F(),{success:!0,message:"User created successfully"}}catch(pe){return console.error("Exception creating user:",pe),{success:!1,message:pe.message}}},ue=async(G,pe)=>{try{console.log("Updating user:",G,pe);const{error:_e}=await vt.from("users").update(pe).eq("id",G);return _e?(console.error("Update error:",_e),{success:!1,message:_e.message}):(await F(),{success:!0,message:"User updated successfully"})}catch(_e){return console.error("Exception updating user:",_e),{success:!1,message:_e.message}}},ae=async(G,pe)=>ue(G,{role:pe}),Q=async(G,pe)=>ue(G,{is_active:pe}),Y=async G=>{try{const{error:pe}=await vt.from("users").update({is_active:!1}).eq("id",G);return pe?{success:!1,message:pe.message}:(await F(),{success:!0,message:"User deactivated successfully"})}catch(pe){return{success:!1,message:pe.message}}};return{users:m,roles:_.length>0?_:O,loading:k,error:T,fetchUsers:F,createUser:se,updateUser:ue,updateUserRole:ae,toggleUserActive:Q,deleteUser:Y}}function vT(){const{users:m,roles:h,loading:_,error:S,fetchUsers:k,createUser:P,updateUser:T,toggleUserActive:c}=_T(),[O,F]=ee.useState("users"),[re,se]=ee.useState(""),[ue,ae]=ee.useState(!1),[Q,Y]=ee.useState(!1),[G,pe]=ee.useState(null),[_e,Ne]=ee.useState(!1),[Oe,Be]=ee.useState(null),[xt,$e]=ee.useState(!1),[de,Ae]=ee.useState(""),[Ye,_t]=ee.useState(""),[Et,zt]=ee.useState(""),[ht,Qe]=ee.useState(""),[Ce,We]=ee.useState("customer"),[dt,Ze]=ee.useState(""),[Pe,le]=ee.useState(""),[Le,nt]=ee.useState(""),[lt,Ot]=ee.useState(""),Mt=(wt,qs)=>{Be({type:wt,message:qs}),setTimeout(()=>Be(null),5e3)},mt=m.filter(wt=>{const qs=re.toLowerCase();return(wt.full_name?.toLowerCase()||"").includes(qs)||(wt.email?.toLowerCase()||"").includes(qs)||(wt.phone?.toLowerCase()||"").includes(qs)||(wt.role?.toLowerCase()||"").includes(qs)}),Dt=m.length,ys=m.filter(wt=>wt.role==="admin"||wt.role==="super_admin").length,js=m.filter(wt=>wt.is_active).length,ks=m.filter(wt=>!wt.is_active).length,Es=()=>{Ae(""),_t(""),zt(""),Qe(""),We("customer"),Ne(!1)},Rr=wt=>{pe(wt),Ze(wt.full_name||""),le(wt.email||""),nt(wt.phone||""),Ot(wt.role||"customer"),Y(!0)},us=async()=>{if(!de.trim()||!Ye.trim()||!ht.trim()){Mt("error","Please fill in all required fields");return}$e(!0);const wt=await P({email:Ye.trim(),password:ht,fullName:de.trim(),phone:Et.trim(),role:Ce});$e(!1),wt.success?(Mt("success","User created successfully!"),ae(!1),Es()):Mt("error",wt.message)},xs=async()=>{if(!G)return;$e(!0);const wt=await T(G.id,{full_name:dt.trim(),email:Pe.trim(),phone:Le.trim()||void 0,role:lt});$e(!1),wt.success?(Mt("success","User updated successfully!"),Y(!1),pe(null)):Mt("error",wt.message)},Is=async wt=>{const qs=await c(wt.id,!wt.is_active);qs.success?Mt("success",`User ${wt.is_active?"deactivated":"activated"} successfully`):Mt("error",qs.message)},Os=wt=>{switch(wt){case"super_admin":return"bg-purple-100 text-purple-800 border-purple-300";case"admin":return"bg-red-100 text-red-800 border-red-300";case"manager":return"bg-blue-100 text-blue-800 border-blue-300";case"staff":return"bg-green-100 text-green-800 border-green-300";case"driver":return"bg-yellow-100 text-yellow-800 border-yellow-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},ar=wt=>wt.split("_").map(qs=>qs.charAt(0).toUpperCase()+qs.slice(1)).join(" "),vi=wt=>new Date(wt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return n.jsxs("div",{className:"space-y-6",children:[Oe&&n.jsx("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${Oe.type==="success"?"bg-green-500":"bg-red-500"} text-white`,children:Oe.message}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),n.jsx("p",{className:"text-gray-600",children:"Manage users, roles, and permissions"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[n.jsx(io,{className:"w-4 h-4"}),"Refresh"]}),n.jsxs("button",{onClick:()=>ae(!0),className:"flex items-center gap-2 px-4 py-2 bg-[#e14171] text-white rounded-lg hover:bg-[#c73562]",children:[n.jsx(j0,{className:"w-4 h-4"}),"Add User"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:n.jsx(nx,{className:"w-5 h-5 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Dt}),n.jsx("p",{className:"text-sm text-gray-500",children:"Total Users"})]})]})}),n.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:n.jsx(Jy,{className:"w-5 h-5 text-purple-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ys}),n.jsx("p",{className:"text-sm text-gray-500",children:"Admins"})]})]})}),n.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:n.jsx(Gu,{className:"w-5 h-5 text-green-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:js}),n.jsx("p",{className:"text-sm text-gray-500",children:"Active"})]})]})}),n.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:n.jsx(Ga,{className:"w-5 h-5 text-red-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ks}),n.jsx("p",{className:"text-sm text-gray-500",children:"Deactivated"})]})]})})]}),n.jsx("div",{className:"border-b border-gray-200",children:n.jsxs("nav",{className:"flex gap-4",children:[n.jsx("button",{onClick:()=>F("users"),className:`pb-3 px-1 border-b-2 font-medium text-sm ${O==="users"?"border-[#e14171] text-[#e14171]":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Users"}),n.jsx("button",{onClick:()=>F("roles"),className:`pb-3 px-1 border-b-2 font-medium text-sm ${O==="roles"?"border-[#e14171] text-[#e14171]":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Roles"})]})}),S&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:["Error: ",S]}),_&&n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#e14171]"})}),O==="users"&&!_&&n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[n.jsx("div",{className:"p-4 border-b border-gray-100",children:n.jsxs("div",{className:"relative",children:[n.jsx(x_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Search users by name, email, phone, or role...",value:re,onChange:wt=>se(wt.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]})}),n.jsx("div",{className:"divide-y divide-gray-100",children:mt.length===0?n.jsx("div",{className:"p-8 text-center text-gray-500",children:re?"No users found matching your search":"No users found"}):mt.map(wt=>n.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg ${wt.is_active?"bg-[#e14171]":"bg-gray-400"}`,children:wt.full_name?wt.full_name.charAt(0).toUpperCase():wt.email.charAt(0).toUpperCase()}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:wt.full_name||"No Name"}),n.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full border ${Os(wt.role)}`,children:ar(wt.role)}),!wt.is_active&&n.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"Deactivated"})]}),n.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(fg,{className:"w-3 h-3"}),wt.email]}),wt.phone&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(qy,{className:"w-3 h-3"}),wt.phone]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(dv,{className:"w-3 h-3"}),"Joined ",vi(wt.created_at)]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>Rr(wt),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",title:"Edit user",children:n.jsx(sm,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>Is(wt),className:`p-2 rounded-lg ${wt.is_active?"text-red-600 hover:bg-red-50":"text-green-600 hover:bg-green-50"}`,title:wt.is_active?"Deactivate user":"Activate user",children:wt.is_active?n.jsx(a_,{className:"w-4 h-4"}):n.jsx(Ky,{className:"w-4 h-4"})})]})]})},wt.id))})]}),O==="roles"&&!_&&n.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:h.map(wt=>n.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:`p-2 rounded-lg ${Os(wt.name)}`,children:n.jsx(Jy,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:wt.display_name}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Level ",wt.level]})]})]}),n.jsx("p",{className:"text-sm text-gray-600 mb-3",children:wt.description}),n.jsxs("div",{className:"text-sm text-gray-500",children:[m.filter(qs=>qs.role===wt.name).length," users"]})]},wt.id))}),ue&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[n.jsx("div",{className:"p-6 border-b border-gray-100",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add New User"}),n.jsx("button",{onClick:()=>{ae(!1),Es()},className:"p-2 hover:bg-gray-100 rounded-full",children:n.jsx(Ga,{className:"w-5 h-5"})})]})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Full Name ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Xd,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"text",value:de,onChange:wt=>Ae(wt.target.value),placeholder:"John Smith",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsxs("div",{className:"relative",children:[n.jsx(fg,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"email",value:Ye,onChange:wt=>_t(wt.target.value),placeholder:"john@example.com",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),n.jsxs("div",{className:"relative",children:[n.jsx(qy,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"tel",value:Et,onChange:wt=>zt(wt.target.value),placeholder:"+1 234 567 8900",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:_e?"text":"password",value:ht,onChange:wt=>Qe(wt.target.value),placeholder:"Minimum 6 characters",className:"w-full pl-4 pr-10 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"}),n.jsx("button",{type:"button",onClick:()=>Ne(!_e),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:_e?n.jsx(a_,{className:"w-5 h-5"}):n.jsx(Ky,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Role ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsx("select",{value:Ce,onChange:wt=>We(wt.target.value),className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent",children:h.filter(wt=>wt.name!=="super_admin").map(wt=>n.jsx("option",{value:wt.name,children:wt.display_name},wt.id))})]})]}),n.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3",children:[n.jsx("button",{onClick:()=>{ae(!1),Es()},className:"flex-1 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),n.jsx("button",{onClick:us,disabled:xt,className:"flex-1 px-4 py-2 bg-[#e14171] text-white rounded-lg hover:bg-[#c73562] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:xt?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(j0,{className:"w-4 h-4"}),"Create User"]})})]})]})}),Q&&G&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[n.jsx("div",{className:"p-6 border-b border-gray-100",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Edit User"}),n.jsx("button",{onClick:()=>{Y(!1),pe(null)},className:"p-2 hover:bg-gray-100 rounded-full",children:n.jsx(Ga,{className:"w-5 h-5"})})]})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),n.jsxs("div",{className:"relative",children:[n.jsx(Xd,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"text",value:dt,onChange:wt=>Ze(wt.target.value),placeholder:"John Smith",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),n.jsxs("div",{className:"relative",children:[n.jsx(fg,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"email",value:Pe,onChange:wt=>le(wt.target.value),placeholder:"john@example.com",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),n.jsxs("div",{className:"relative",children:[n.jsx(qy,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"tel",value:Le,onChange:wt=>nt(wt.target.value),placeholder:"+1 234 567 8900",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),n.jsx("select",{value:lt,onChange:wt=>Ot(wt.target.value),className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent",children:h.map(wt=>n.jsx("option",{value:wt.name,children:wt.display_name},wt.id))})]}),n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Account Status"}),n.jsx("p",{className:"text-sm text-gray-500",children:G.is_active?"Account is active":"Account is deactivated"})]}),n.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${G.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:G.is_active?"Active":"Inactive"})]}),n.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg space-y-2",children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-gray-500",children:"User ID:"}),n.jsx("span",{className:"text-gray-700 font-mono text-xs",children:G.id})]}),n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-gray-500",children:"Created:"}),n.jsx("span",{className:"text-gray-700",children:vi(G.created_at)})]}),G.created_by&&n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-gray-500",children:"Created by:"}),n.jsx("span",{className:"text-gray-700 font-mono text-xs",children:G.created_by})]})]})]}),n.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3",children:[n.jsx("button",{onClick:()=>{Y(!1),pe(null)},className:"flex-1 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),n.jsx("button",{onClick:xs,disabled:xt,className:"flex-1 px-4 py-2 bg-[#e14171] text-white rounded-lg hover:bg-[#c73562] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:xt?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):n.jsxs(n.Fragment,{children:[n.jsx(mv,{className:"w-4 h-4"}),"Save Changes"]})})]})]})})]})}function bT(){const{settings:m,loading:h,getSettingsByCategory:_,updateSetting:S,refetch:k,getNumberSetting:P,addSetting:T}=Cg(),[c,O]=ee.useState({}),[F,re]=ee.useState(null),[se,ue]=ee.useState(null);ee.useEffect(()=>{const $e={};m.forEach(de=>{$e[de.key]=de.value}),O($e)},[m]);const ae=($e,de)=>{ue({type:$e,message:de}),setTimeout(()=>ue(null),3e3)},Q=async $e=>{const de=c[$e.key];if(de===$e.value)return;re($e.key);const Ae=await S($e.key,de);re(null),Ae.success?ae("success",`${$e.label} updated successfully`):ae("error",Ae.message)},Y=($e,de)=>{O(Ae=>({...Ae,[$e]:de}))},G=($e,de)=>c[$e]!==de,pe=[{id:"pricing",label:"Pricing Settings",description:"Manage delivery fees, minimums, and charges",icon:Wd,color:"bg-green-100 text-green-600"},{id:"business",label:"Business Information",description:"Your business contact details",icon:gS,color:"bg-blue-100 text-blue-600"},{id:"orders",label:"Order Settings",description:"Booking and scheduling rules",icon:Nj,color:"bg-orange-100 text-orange-600"},{id:"membership",label:"Membership Settings",description:"Member discounts and benefits",icon:Zu,color:"bg-pink-100 text-[#e14171]"},{id:"referrals",label:"Referral & Credits",description:"Set how much referrers and new customers earn",icon:mf,color:"bg-rose-100 text-rose-600"},{id:"awards",label:"Referral Awards",description:"Set thresholds and free-order awards for top referrers",icon:Zu,color:"bg-indigo-100 text-indigo-600"}];ee.useEffect(()=>{if(h||m.length===0)return;const $e=[{key:"award_min_lifetime_earnings",value:"1000",label:"Award minimum lifetime earnings",description:"Total earned credits required to qualify for an award",type:"number",category:"awards",sort_order:0},{key:"award_free_order_count",value:"3",label:"Award free order count",description:"How many free orders the award grants",type:"number",category:"awards",sort_order:1},{key:"award_free_order_cap",value:"25",label:"Free order cap (per order)",description:"Maximum value covered per free award order",type:"number",category:"awards",sort_order:2},{key:"award_valid_months",value:"2",label:"Award validity (months)",description:"How long the award voucher stays valid",type:"number",category:"awards",sort_order:3}],de=new Set(m.map(Ae=>Ae.key));$e.forEach(async Ae=>{de.has(Ae.key)||await T(Ae)})},[h,m,T]);const _e=P("delivery_fee",5),Ne=P("free_delivery_threshold",50),Oe=P("referral_referrer_bonus",10),Be=P("referral_referee_bonus",10),xt=$e=>{const de=c[$e.key]??$e.value,Ae=G($e.key,$e.value),Ye=F===$e.key;return n.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:$e.label}),$e.description&&n.jsx("p",{className:"text-xs text-gray-500 mb-2",children:$e.description}),$e.type==="number"?n.jsxs("div",{className:"relative",children:[$e.key.includes("fee")||$e.key.includes("price")||$e.key.includes("threshold")||$e.key.includes("minimum")||$e.key.includes("hold")?n.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}):null,n.jsx("input",{type:"number",value:de,onChange:_t=>Y($e.key,_t.target.value),className:`w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#e14171] ${$e.key.includes("fee")||$e.key.includes("price")||$e.key.includes("threshold")||$e.key.includes("minimum")||$e.key.includes("hold")?"pl-8":""} ${Ae?"border-[#e14171] bg-pink-50":""}`}),$e.key.includes("discount")&&n.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"%"}),$e.key.includes("hours")&&n.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"hrs"}),$e.key.includes("days")&&n.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"days"})]}):$e.type==="boolean"?n.jsxs("select",{value:de,onChange:_t=>Y($e.key,_t.target.value),className:`w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#e14171] ${Ae?"border-[#e14171] bg-pink-50":""}`,children:[n.jsx("option",{value:"true",children:"Yes"}),n.jsx("option",{value:"false",children:"No"})]}):n.jsx("input",{type:"text",value:de,onChange:_t=>Y($e.key,_t.target.value),className:`w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#e14171] ${Ae?"border-[#e14171] bg-pink-50":""}`})]}),n.jsxs("button",{onClick:()=>Q($e),disabled:!Ae||Ye,className:`px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors ${Ae?"bg-[#e14171] text-white hover:bg-[#c73562]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[Ye?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(mv,{className:"h-4 w-4"}),"Save"]})]},$e.key)};return n.jsxs("div",{className:"space-y-6",children:[se&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg flex items-center gap-2 ${se.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[se.type==="success"?n.jsx(ni,{className:"h-5 w-5"}):n.jsx($c,{className:"h-5 w-5"}),se.message]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"App Settings"}),n.jsx("p",{className:"text-gray-500",children:"Configure delivery fees, minimums, and other settings"})]}),n.jsxs("button",{onClick:()=>k(),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg",children:[n.jsx(io,{className:"h-4 w-4"}),"Refresh"]})]}),n.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500 mb-1",children:"Delivery Fee"}),n.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",_e.toFixed(2)]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Used for free-delivery promos"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500 mb-1",children:"Free Delivery Threshold"}),n.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",Ne.toFixed(2)]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Orders above this skip delivery fee"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500 mb-1",children:"Referee Bonus"}),n.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",Be.toFixed(2)]}),n.jsx("p",{className:"text-xs text-gray-500",children:"New customer credit for using a code"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500 mb-1",children:"Referrer Bonus"}),n.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",Oe.toFixed(2)]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Paid when first order is delivered"})]})]}),h?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):m.length===0?n.jsxs("div",{className:"text-center py-16 text-gray-500",children:[n.jsx($c,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("p",{className:"text-lg font-medium",children:"No settings found"}),n.jsx("p",{className:"text-sm",children:"Run the SQL setup to create default settings"})]}):n.jsx("div",{className:"space-y-8",children:pe.map($e=>{const de=_($e.id);return de.length===0?null:n.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b bg-gray-50",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`p-3 rounded-xl ${$e.color}`,children:n.jsx($e.icon,{className:"h-6 w-6"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-bold text-gray-900",children:$e.label}),n.jsx("p",{className:"text-sm text-gray-500",children:$e.description})]})]})}),n.jsx("div",{className:"p-6 space-y-4",children:de.map(Ae=>xt(Ae))})]},$e.id)})}),n.jsx("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-2xl p-6",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"bg-[#e14171] p-3 rounded-xl",children:n.jsx(Wd,{className:"h-6 w-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Settings Information"}),n.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Changes to these settings will immediately affect how the site works:"}),n.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[n.jsxs("li",{children:[" ",n.jsx("strong",{children:"Delivery Fee"})," - Charged at checkout for each order"]}),n.jsxs("li",{children:[" ",n.jsx("strong",{children:"Free Delivery Threshold"})," - Orders above this amount get free delivery"]}),n.jsxs("li",{children:[" ",n.jsx("strong",{children:"Minimum Order"})," - Customers can't checkout below this amount"]}),n.jsxs("li",{children:[" ",n.jsx("strong",{children:"Member Discounts"})," - Applied to Bubble Pass subscribers"]})]})]})]})})]})}function wT(){const{user:m}=ao(),{fetchAllOrders:h,updateOrderStatus:_,assignDriver:S,togglePriority:k,updateInternalNotes:P,getOrderHistory:T}=Ag(),{drivers:c,fetchDrivers:O}=rm(),[F,re]=ee.useState([]),[se,ue]=ee.useState(!0),[ae,Q]=ee.useState(""),[Y,G]=ee.useState("all"),[pe,_e]=ee.useState("all"),[Ne,Oe]=ee.useState("all"),[Be,xt]=ee.useState(null),[$e,de]=ee.useState([]),[Ae,Ye]=ee.useState(!1),[_t,Et]=ee.useState(null),[zt,ht]=ee.useState(!1),[Qe,Ce]=ee.useState(["order_number","date","status","service","total","customer_name","customer_email","address"]),[We,dt]=ee.useState("filtered"),[Ze,Pe]=ee.useState(""),[le,Le]=ee.useState(""),nt=[{id:"order_number",label:"Order Number",category:"Order"},{id:"date",label:"Order Date",category:"Order"},{id:"status",label:"Status",category:"Order"},{id:"service",label:"Service Type",category:"Order"},{id:"items_count",label:"Items Count",category:"Order"},{id:"subtotal",label:"Subtotal",category:"Pricing"},{id:"delivery_fee",label:"Delivery Fee",category:"Pricing"},{id:"discount",label:"Discount",category:"Pricing"},{id:"total",label:"Total",category:"Pricing"},{id:"promo_code",label:"Promo Code",category:"Pricing"},{id:"customer_name",label:"Customer Name",category:"Customer"},{id:"customer_email",label:"Customer Email",category:"Customer"},{id:"customer_phone",label:"Customer Phone",category:"Customer"},{id:"address",label:"Pickup Address",category:"Delivery"},{id:"landmark",label:"Landmark",category:"Delivery"},{id:"pickup_date",label:"Pickup Date",category:"Delivery"},{id:"delivery_date",label:"Delivery Date",category:"Delivery"},{id:"driver_name",label:"Assigned Driver",category:"Operations"},{id:"is_priority",label:"Priority",category:"Operations"},{id:"internal_notes",label:"Internal Notes",category:"Operations"}],[lt,Ot]=ee.useState(null),[Mt,mt]=ee.useState([]),[Dt,ys]=ee.useState(null),[js,ks]=ee.useState(""),[Es,Rr]=ee.useState(null);ee.useEffect(()=>{us(),O()},[]);const us=async()=>{ue(!0);const U=await h();re(U),ue(!1)},xs=F.filter(U=>{const he=U.order_number?.toLowerCase().includes(ae.toLowerCase())||U.pickup_address?.toLowerCase().includes(ae.toLowerCase())||U.customer?.full_name?.toLowerCase().includes(ae.toLowerCase())||U.customer?.email?.toLowerCase().includes(ae.toLowerCase())||U.customer?.phone?.toLowerCase().includes(ae.toLowerCase()),ve=Y==="all"||U.status===Y,Ve=pe==="all"||U.service_type===pe;let He=!0;if(Ne!=="all"){const Ue=new Date(U.created_at),Re=new Date;if(Re.setHours(0,0,0,0),Ne==="today")He=Ue>=Re;else if(Ne==="week"){const ot=new Date(Re);ot.setDate(ot.getDate()-7),He=Ue>=ot}else if(Ne==="month"){const ot=new Date(Re);ot.setMonth(ot.getMonth()-1),He=Ue>=ot}}return he&&ve&&Ve&&He}),Is={total:F.length,pending:F.filter(U=>U.status==="pending").length,confirmed:F.filter(U=>U.status==="confirmed").length,inProgress:F.filter(U=>["confirmed","scheduled","picked_up","at_facility","cleaning","ready"].includes(U.status)).length,outForDelivery:F.filter(U=>U.status==="out_for_delivery").length,delivered:F.filter(U=>U.status==="delivered").length,cancelled:F.filter(U=>U.status==="cancelled").length,priority:F.filter(U=>U.is_priority).length,revenue:F.filter(U=>U.status!=="cancelled").reduce((U,he)=>U+(he.total||0),0)},Os={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",scheduled:"bg-purple-100 text-purple-800",picked_up:"bg-indigo-100 text-indigo-800",at_facility:"bg-cyan-100 text-cyan-800",cleaning:"bg-pink-100 text-pink-800",ready:"bg-teal-100 text-teal-800",out_for_delivery:"bg-orange-100 text-orange-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"},ar=["pending","confirmed","scheduled","picked_up","at_facility","cleaning","ready","out_for_delivery","delivered"],vi={laundry:"",suit:"",shoe:"","dry-clean":"",multiple:""},wt=async(U,he)=>{const Ve=F.find(Ue=>Ue.id===U)?.driver_id;if(he==="out_for_delivery"&&!Ve){Et({type:"error",message:"Please assign a driver before marking Out for Delivery."}),setTimeout(()=>Et(null),3e3);return}const He=await _(U,he);He.success?(Et({type:"success",message:`Order status updated to ${he}`}),us()):Et({type:"error",message:He.message}),setTimeout(()=>Et(null),3e3)},qs=async(U,he)=>{if(!m)return;(await S(U,he||null,m.id)).success?(Et({type:"success",message:"Driver assigned successfully"}),Rr(null),us()):Et({type:"error",message:"Failed to assign driver"}),setTimeout(()=>Et(null),3e3)},yr=async(U,he)=>{(await k(U,!he)).success&&(Et({type:"success",message:he?"Priority removed":"Marked as priority"}),us()),setTimeout(()=>Et(null),3e3)},Ha=async U=>{(await P(U,js)).success&&(Et({type:"success",message:"Notes saved"}),ys(null),us()),setTimeout(()=>Et(null),3e3)},Ms=async U=>{if(lt===U){Ot(null);return}const he=await T(U);mt(he),Ot(U)},oi=async U=>{for(const he of $e)await _(he,U);de([]),Ye(!1),Et({type:"success",message:`${$e.length} orders updated`}),us(),setTimeout(()=>Et(null),3e3)},Fr=()=>{let U=[];switch(We){case"all":U=F;break;case"filtered":U=xs;break;case"selected":U=F.filter(he=>$e.includes(he.id));break;case"date_range":U=F.filter(he=>{const ve=new Date(he.created_at),Ve=Ze?new Date(Ze):new Date(0),He=le?new Date(le+"T23:59:59"):new Date;return ve>=Ve&&ve<=He});break}return U},Oi=(U,he)=>{const ve=c.find(Ve=>Ve.id===U.driver_id);switch(he){case"order_number":return U.order_number||"";case"date":return new Date(U.created_at).toLocaleDateString();case"status":return U.status.replace(/_/g," ").toUpperCase();case"service":return U.service_type||"";case"items_count":return String(U.order_items?.length||0);case"subtotal":return String(U.subtotal||0);case"delivery_fee":return String(U.delivery_fee||0);case"discount":return String(U.discount||0);case"total":return String(U.total||0);case"promo_code":return U.promo_code||"";case"customer_name":return U.customer?.full_name||"";case"customer_email":return U.customer?.email||"";case"customer_phone":return U.customer?.phone||"";case"address":return U.pickup_address||"";case"landmark":return U.pickup_landmark||"";case"pickup_date":return U.pickup_date||"";case"delivery_date":return U.delivery_date||"";case"driver_name":return ve?.name||"";case"is_priority":return U.is_priority?"Yes":"No";case"internal_notes":return U.internal_notes||"";default:return""}},Gi=()=>{const U=Fr();if(U.length===0){Et({type:"error",message:"No orders to export with current selection"}),setTimeout(()=>Et(null),3e3);return}if(Qe.length===0){Et({type:"error",message:"Please select at least one column to export"}),setTimeout(()=>Et(null),3e3);return}const he=Qe.map(ot=>nt.find(Te=>Te.id===ot)?.label||ot),ve=U.map(ot=>Qe.map(rt=>{const Te=Oi(ot,rt);return Te.includes(",")||Te.includes('"')||Te.includes(`
`)?`"${Te.replace(/"/g,'""')}"`:Te})),Ve=[he.join(","),...ve.map(ot=>ot.join(","))].join(`
`),He=new Blob([Ve],{type:"text/csv"}),Ue=URL.createObjectURL(He),Re=document.createElement("a");Re.href=Ue,Re.download=`orders-${We}-${new Date().toISOString().split("T")[0]}.csv`,Re.click(),ht(!1),Et({type:"success",message:`Exported ${U.length} orders`}),setTimeout(()=>Et(null),3e3)},Fs=U=>{Ce(he=>he.includes(U)?he.filter(ve=>ve!==U):[...he,U])},Ls=()=>{Ce(nt.map(U=>U.id))},Fe=()=>{Ce([])},H=U=>{const he=nt.filter(Ve=>Ve.category===U).map(Ve=>Ve.id),ve=he.every(Ve=>Qe.includes(Ve));Ce(ve?Ve=>Ve.filter(He=>!he.includes(He)):Ve=>[...new Set([...Ve,...he])])},K=U=>new Date(U).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});return n.jsxs("div",{className:"space-y-6",children:[_t&&n.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${_t.type==="success"?"bg-green-500":"bg-red-500"} text-white`,children:_t.message}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:[n.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border",children:[n.jsxs("div",{className:"flex items-center gap-2 text-gray-500 mb-1",children:[n.jsx(_a,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:"Total Orders"})]}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Is.total})]}),n.jsxs("div",{className:"bg-yellow-50 p-4 rounded-xl shadow-sm border border-yellow-200",children:[n.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 mb-1",children:[n.jsx(hg,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:"Pending"})]}),n.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:Is.pending})]}),n.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl shadow-sm border border-blue-200",children:[n.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-1",children:[n.jsx(io,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:"In Progress"})]}),n.jsx("p",{className:"text-2xl font-bold text-blue-700",children:Is.inProgress})]}),n.jsxs("div",{className:"bg-orange-50 p-4 rounded-xl shadow-sm border border-orange-200",children:[n.jsxs("div",{className:"flex items-center gap-2 text-orange-600 mb-1",children:[n.jsx(Yd,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:"Out for Delivery"})]}),n.jsx("p",{className:"text-2xl font-bold text-orange-700",children:Is.outForDelivery})]}),n.jsxs("div",{className:"bg-green-50 p-4 rounded-xl shadow-sm border border-green-200",children:[n.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-1",children:[n.jsx(Wd,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:"Revenue"})]}),n.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["$",Is.revenue.toFixed(2)]})]})]}),n.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[n.jsxs("div",{className:"relative flex-1 max-w-md",children:[n.jsx(x_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Search by order #, address...",value:ae,onChange:U=>Q(U.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#e14171] focus:border-transparent"})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("select",{value:Y,onChange:U=>G(U.target.value),className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"all",children:"All Status"}),n.jsx("option",{value:"pending",children:"Pending"}),n.jsx("option",{value:"confirmed",children:"Confirmed"}),n.jsx("option",{value:"scheduled",children:"Scheduled"}),n.jsx("option",{value:"picked_up",children:"Picked Up"}),n.jsx("option",{value:"at_facility",children:"At Facility"}),n.jsx("option",{value:"cleaning",children:"Cleaning"}),n.jsx("option",{value:"ready",children:"Ready"}),n.jsx("option",{value:"out_for_delivery",children:"Out for Delivery"}),n.jsx("option",{value:"delivered",children:"Delivered"}),n.jsx("option",{value:"cancelled",children:"Cancelled"})]}),n.jsxs("select",{value:pe,onChange:U=>_e(U.target.value),className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"all",children:"All Services"}),n.jsx("option",{value:"laundry",children:"Laundry"}),n.jsx("option",{value:"suit",children:"Suit Cleaning"}),n.jsx("option",{value:"shoe",children:"Shoe Cleaning"}),n.jsx("option",{value:"dry-clean",children:"Dry Cleaning"}),n.jsx("option",{value:"multiple",children:"Multiple"})]}),n.jsxs("select",{value:Ne,onChange:U=>Oe(U.target.value),className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"all",children:"All Time"}),n.jsx("option",{value:"today",children:"Today"}),n.jsx("option",{value:"week",children:"This Week"}),n.jsx("option",{value:"month",children:"This Month"})]}),n.jsx("button",{onClick:us,className:"p-2 border rounded-lg hover:bg-gray-50",title:"Refresh",children:n.jsx(io,{className:"w-5 h-5 text-gray-600"})}),n.jsxs("button",{onClick:()=>ht(!0),className:"flex items-center gap-2 px-3 py-2 border rounded-lg hover:bg-gray-50",children:[n.jsx(i_,{className:"w-4 h-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Export"})]})]})]}),$e.length>0&&n.jsxs("div",{className:"mt-4 p-3 bg-[#e14171]/10 rounded-lg flex items-center justify-between",children:[n.jsxs("span",{className:"text-[#e14171] font-medium",children:[$e.length," order(s) selected"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{onChange:U=>{U.target.value&&oi(U.target.value)},className:"px-3 py-1 border rounded-lg text-sm",defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"Update Status..."}),ar.map(U=>n.jsx("option",{value:U,children:U.replace(/_/g," ").replace(/\b\w/g,he=>he.toUpperCase())},U))]}),n.jsx("button",{onClick:()=>de([]),className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Clear Selection"})]})]})]}),n.jsx("div",{className:"space-y-4",children:se?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(io,{className:"w-8 h-8 animate-spin text-[#e14171] mx-auto mb-4"}),n.jsx("p",{className:"text-gray-500",children:"Loading orders..."})]}):xs.length===0?n.jsxs("div",{className:"text-center py-12 bg-white rounded-xl",children:[n.jsx(_a,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-500",children:"No orders found"})]}):xs.map(U=>{const he=Be===U.id,ve=U.is_priority,Ve=U.driver_id,He=U.internal_notes,Ue=c.find(Re=>Re.id===Ve);return n.jsxs("div",{className:`bg-white rounded-xl shadow-sm border overflow-hidden ${ve?"ring-2 ring-red-400":""}`,children:[n.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50",onClick:()=>xt(he?null:U.id),children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("input",{type:"checkbox",checked:$e.includes(U.id),onChange:Re=>{Re.stopPropagation(),de(ot=>ot.includes(U.id)?ot.filter(rt=>rt!==U.id):[...ot,U.id])},className:"w-4 h-4 rounded border-gray-300 text-[#e14171] focus:ring-[#e14171]"}),ve&&n.jsx(w0,{className:"w-5 h-5 text-red-500 fill-red-500"}),n.jsx("span",{className:"text-2xl",children:vi[U.service_type]||""}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsx("span",{className:"font-semibold text-gray-900",children:U.order_number}),n.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${Os[U.status]}`,children:U.status.replace(/_/g," ").toUpperCase()}),U.customer?.full_name&&n.jsxs("span",{className:"text-sm text-gray-600",children:[" ",U.customer.full_name]})]}),n.jsx("p",{className:"text-sm text-gray-500 truncate",children:U.pickup_address}),n.jsxs("p",{className:"text-xs text-gray-400",children:[K(U.created_at)," ",U.customer?.email&&` ${U.customer.email}`]})]}),Ue&&n.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1 bg-blue-50 rounded-full",children:[n.jsx(Yd,{className:"w-4 h-4 text-blue-600"}),n.jsx("span",{className:"text-sm text-blue-700",children:Ue.name})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-gray-900",children:["$",U.total?.toFixed(2)]}),n.jsxs("p",{className:"text-xs text-gray-500",children:[U.order_items?.length||0," items"]})]}),he?n.jsx(TS,{className:"w-5 h-5 text-gray-400"}):n.jsx(vS,{className:"w-5 h-5 text-gray-400"})]})}),he&&n.jsxs("div",{className:"border-t bg-gray-50 p-4",children:[n.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[n.jsxs("button",{onClick:()=>yr(U.id,ve),className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium ${ve?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx(w0,{className:"w-4 h-4"}),ve?"Remove Priority":"Mark Priority"]}),n.jsxs("button",{onClick:()=>Rr(Es===U.id?null:U.id),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200",children:[n.jsx(Zj,{className:"w-4 h-4"}),Ue?"Reassign Driver":"Assign Driver"]}),n.jsxs("button",{onClick:()=>{ys(Dt===U.id?null:U.id),ks(He||"")},className:"flex items-center gap-1 px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded-lg text-sm font-medium hover:bg-yellow-200",children:[n.jsx(gf,{className:"w-4 h-4"}),"Notes"]}),n.jsxs("button",{onClick:()=>Ms(U.id),className:"flex items-center gap-1 px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200",children:[n.jsx(y_,{className:"w-4 h-4"}),"History"]}),n.jsxs("button",{onClick:()=>window.print(),className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200",children:[n.jsx(pv,{className:"w-4 h-4"}),"Print"]})]}),Es===U.id&&n.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[n.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Assign Driver"}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:[c.filter(Re=>Re.status==="active").map(Re=>n.jsxs("button",{onClick:()=>qs(U.id,Re.id),className:`p-2 rounded-lg text-left text-sm ${Ve===Re.id?"bg-blue-500 text-white":"bg-white hover:bg-blue-100"}`,children:[n.jsx("p",{className:"font-medium",children:Re.name}),n.jsxs("p",{className:"text-xs opacity-75",children:[Re.current_orders||0,"/",Re.max_orders||10," orders"]})]},Re.id)),Ve&&n.jsxs("button",{onClick:()=>qs(U.id,""),className:"p-2 rounded-lg text-left text-sm bg-red-50 hover:bg-red-100 text-red-700",children:[n.jsx("p",{className:"font-medium",children:"Unassign"}),n.jsx("p",{className:"text-xs",children:"Remove driver"})]})]})]}),Dt===U.id&&n.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 rounded-lg",children:[n.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Internal Notes (Staff Only)"}),n.jsx("textarea",{value:js,onChange:Re=>ks(Re.target.value),placeholder:"Add notes about this order...",className:"w-full p-2 border rounded-lg text-sm",rows:3}),n.jsxs("div",{className:"flex gap-2 mt-2",children:[n.jsx("button",{onClick:()=>Ha(U.id),className:"px-3 py-1 bg-yellow-500 text-white rounded-lg text-sm hover:bg-yellow-600",children:"Save Notes"}),n.jsx("button",{onClick:()=>ys(null),className:"px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300",children:"Cancel"})]})]}),He&&Dt!==U.id&&n.jsx("div",{className:"mb-4 p-3 bg-yellow-50 rounded-lg",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(gf,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-yellow-900",children:"Internal Notes"}),n.jsx("p",{className:"text-sm text-yellow-700",children:He})]})]})}),lt===U.id&&n.jsxs("div",{className:"mb-4 p-3 bg-purple-50 rounded-lg",children:[n.jsx("h4",{className:"font-medium text-purple-900 mb-3",children:"Order Timeline"}),n.jsx("div",{className:"space-y-3",children:Mt.length===0?n.jsx("p",{className:"text-sm text-purple-600",children:"No history available"}):Mt.map((Re,ot)=>n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:`w-3 h-3 rounded-full ${ot===Mt.length-1?"bg-purple-500":"bg-purple-300"}`}),ot<Mt.length-1&&n.jsx("div",{className:"w-0.5 h-full bg-purple-200"})]}),n.jsxs("div",{className:"flex-1 pb-3",children:[n.jsx("p",{className:"text-sm font-medium text-purple-900",children:Re.status.replace(/_/g," ").replace(/\b\w/g,rt=>rt.toUpperCase())}),Re.notes&&n.jsx("p",{className:"text-xs text-purple-600",children:Re.notes}),n.jsx("p",{className:"text-xs text-purple-400",children:K(Re.created_at)})]})]},Re.id))})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Update Status"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[ar.map((Re,ot)=>{const rt=ar.indexOf(U.status),Te=Re===U.status,Vt=ot<rt,as=ot===rt+1;return n.jsx("button",{onClick:()=>wt(U.id,Re),disabled:Te,className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Te?"bg-[#e14171] text-white cursor-default":Vt?"bg-green-100 text-green-700 hover:bg-green-200":as?"bg-blue-100 text-blue-700 hover:bg-blue-200 ring-2 ring-blue-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:Re.replace(/_/g," ").replace(/\b\w/g,Kt=>Kt.toUpperCase())},Re)}),n.jsx("button",{onClick:()=>wt(U.id,"cancelled"),disabled:U.status==="cancelled"||U.status==="delivered",className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-red-100 text-red-700 hover:bg-red-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel Order"})]})]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("h4",{className:"font-medium text-gray-700 flex items-center gap-2",children:[n.jsx(Xd,{className:"w-4 h-4"})," Customer Details"]}),n.jsxs("div",{className:"bg-white p-3 rounded-lg text-sm space-y-2",children:[n.jsxs("p",{className:"flex items-center gap-2",children:[n.jsx(Xd,{className:"w-4 h-4 text-gray-400"}),n.jsx("strong",{children:"Name:"})," ",U.customer?.full_name||"N/A"]}),n.jsxs("p",{className:"flex items-center gap-2",children:[n.jsx(fg,{className:"w-4 h-4 text-gray-400"}),n.jsx("strong",{children:"Email:"}),n.jsx("a",{href:`mailto:${U.customer?.email}`,className:"text-[#e14171] hover:underline",children:U.customer?.email||"N/A"})]}),n.jsxs("p",{className:"flex items-center gap-2",children:[n.jsx(qy,{className:"w-4 h-4 text-gray-400"}),n.jsx("strong",{children:"Phone:"}),U.customer?.phone?n.jsx("a",{href:`tel:${U.customer.phone}`,className:"text-[#e14171] hover:underline",children:U.customer.phone}):"N/A"]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("h4",{className:"font-medium text-gray-700 flex items-center gap-2",children:[n.jsx(qa,{className:"w-4 h-4"})," Delivery Details"]}),n.jsxs("div",{className:"bg-white p-3 rounded-lg text-sm space-y-2",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Address:"})," ",U.pickup_address]}),U.pickup_landmark&&n.jsxs("p",{children:[n.jsx("strong",{children:"Landmark:"})," ",U.pickup_landmark]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Pickup:"})," ",U.pickup_date]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Delivery:"})," ",U.delivery_date]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("h4",{className:"font-medium text-gray-700 flex items-center gap-2",children:[n.jsx(_a,{className:"w-4 h-4"})," Items"]}),n.jsxs("div",{className:"bg-white p-3 rounded-lg text-sm",children:[U.order_items?.map((Re,ot)=>n.jsxs("div",{className:"flex justify-between py-1 border-b last:border-0",children:[n.jsxs("span",{children:[Re.item_name," x",Re.quantity]}),n.jsxs("span",{className:"font-medium",children:["$",Re.total_price?.toFixed(2)]})]},ot)),n.jsxs("div",{className:"flex justify-between py-1 mt-2 border-t font-bold",children:[n.jsx("span",{children:"Total"}),n.jsxs("span",{children:["$",U.total?.toFixed(2)]})]})]})]})]})]})]},U.id)})}),n.jsxs("div",{className:"text-center text-sm text-gray-500",children:["Showing ",xs.length," of ",F.length," orders"]}),zt&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden",children:[n.jsx("div",{className:"bg-gradient-to-r from-[#e14171] to-pink-500 p-6 text-white",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-xl font-bold",children:"Export Orders"}),n.jsx("p",{className:"text-white/80 text-sm",children:"Select columns and records to export"})]}),n.jsx("button",{onClick:()=>ht(!1),className:"text-white/80 hover:text-white",children:""})]})}),n.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Select Records to Export"}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[n.jsxs("button",{onClick:()=>dt("filtered"),className:`p-3 rounded-lg border text-left ${We==="filtered"?"border-[#e14171] bg-pink-50 text-[#e14171]":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("p",{className:"font-medium",children:"Filtered"}),n.jsxs("p",{className:"text-xs text-gray-500",children:[xs.length," orders"]})]}),n.jsxs("button",{onClick:()=>dt("all"),className:`p-3 rounded-lg border text-left ${We==="all"?"border-[#e14171] bg-pink-50 text-[#e14171]":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("p",{className:"font-medium",children:"All Orders"}),n.jsxs("p",{className:"text-xs text-gray-500",children:[F.length," orders"]})]}),n.jsxs("button",{onClick:()=>dt("selected"),className:`p-3 rounded-lg border text-left ${We==="selected"?"border-[#e14171] bg-pink-50 text-[#e14171]":"border-gray-200 hover:border-gray-300"} ${$e.length===0?"opacity-50 cursor-not-allowed":""}`,disabled:$e.length===0,children:[n.jsx("p",{className:"font-medium",children:"Selected"}),n.jsxs("p",{className:"text-xs text-gray-500",children:[$e.length," orders"]})]}),n.jsxs("button",{onClick:()=>dt("date_range"),className:`p-3 rounded-lg border text-left ${We==="date_range"?"border-[#e14171] bg-pink-50 text-[#e14171]":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("p",{className:"font-medium",children:"Date Range"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Custom dates"})]})]}),We==="date_range"&&n.jsxs("div",{className:"mt-4 flex flex-wrap gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"From Date"}),n.jsx("input",{type:"date",value:Ze,onChange:U=>Pe(U.target.value),className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"To Date"}),n.jsx("input",{type:"date",value:le,onChange:U=>Le(U.target.value),className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-[#e14171]"})]})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h4",{className:"font-semibold text-gray-900",children:"Select Columns to Export"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:Ls,className:"text-sm text-[#e14171] hover:underline",children:"Select All"}),n.jsx("span",{className:"text-gray-300",children:"|"}),n.jsx("button",{onClick:Fe,className:"text-sm text-gray-500 hover:underline",children:"Clear All"})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:["Order","Pricing","Customer","Delivery","Operations"].map(U=>{const he=nt.filter(Ve=>Ve.category===U),ve=he.filter(Ve=>Qe.includes(Ve.id)).length;return n.jsxs("button",{onClick:()=>H(U),className:`px-3 py-1.5 rounded-full text-sm font-medium ${ve===he.length?"bg-[#e14171] text-white":ve>0?"bg-pink-100 text-[#e14171]":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[U," (",ve,"/",he.length,")"]},U)})}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:nt.map(U=>n.jsxs("label",{className:`flex items-center gap-2 p-2 rounded-lg cursor-pointer ${Qe.includes(U.id)?"bg-pink-50 border border-[#e14171]":"bg-gray-50 border border-transparent hover:bg-gray-100"}`,children:[n.jsx("input",{type:"checkbox",checked:Qe.includes(U.id),onChange:()=>Fs(U.id),className:"w-4 h-4 rounded border-gray-300 text-[#e14171] focus:ring-[#e14171]"}),n.jsx("span",{className:"text-sm",children:U.label})]},U.id))})]})]}),n.jsxs("div",{className:"border-t p-4 flex items-center justify-between bg-gray-50",children:[n.jsxs("p",{className:"text-sm text-gray-500",children:[Qe.length," columns selected  ",Fr().length," records"]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>ht(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),n.jsxs("button",{onClick:Gi,disabled:Qe.length===0,className:"flex items-center gap-2 px-6 py-2 bg-[#e14171] text-white rounded-lg hover:bg-[#c73562] disabled:opacity-50 disabled:cursor-not-allowed",children:[n.jsx(i_,{className:"w-4 h-4"}),"Export CSV"]})]})]})]})})]})}var Gy={exports:{}};var ST=Gy.exports,E0;function jT(){return E0||(E0=1,(function(m,h){(function(_,S){m.exports=S()})(ST,(function(){var _={},S={};function k(T,c,O){if(S[T]=O,T==="index"){var F="var sharedModule = {}; ("+S.shared+")(sharedModule); ("+S.worker+")(sharedModule);",re={};return S.shared(re),S.index(_,re),typeof window<"u"&&_.setWorkerUrl(window.URL.createObjectURL(new Blob([F],{type:"text/javascript"}))),_}}k("shared",["exports"],(function(T){function c(r,e,s,l){return new(s||(s=Promise))((function(d,g){function y(A){try{N(l.next(A))}catch(R){g(R)}}function w(A){try{N(l.throw(A))}catch(R){g(R)}}function N(A){var R;A.done?d(A.value):(R=A.value,R instanceof s?R:new s((function(I){I(R)}))).then(y,w)}N((l=l.apply(r,e||[])).next())}))}function O(r,e){this.x=r,this.y=e}function F(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var re,se;typeof SuppressedError=="function"&&SuppressedError,O.prototype={clone(){return new O(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,s=r.y-this.y;return e*e+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),s=Math.sin(r),l=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=l,this},_rotateAround(r,e){const s=Math.cos(r),l=Math.sin(r),d=e.y+l*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-l*(this.y-e.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:O},O.convert=function(r){if(r instanceof O)return r;if(Array.isArray(r))return new O(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new O(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};var ue=(function(){if(se)return re;function r(e,s,l,d){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=l,this.p2y=d}return se=1,re=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,d=0;d<8;d++){var g=this.sampleCurveX(l)-e;if(Math.abs(g)<s)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=g/y}var w=0,N=1;for(l=e,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-e)<s));d++)e>g?w=l:N=l,l=.5*(N-w)+w;return l},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},re})(),ae=F(ue);let Q,Y;function G(){return Q==null&&(Q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Q}function pe(){if(Y==null&&(Y=!1,G())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const d=4*l;e.fillStyle=`rgb(${d},${d+1},${d+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const s=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&s[l]!==l){Y=!0;break}}}return Y||!1}var _e=1e-6,Ne=typeof Float32Array<"u"?Float32Array:Array;function Oe(){var r=new Ne(9);return Ne!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Be(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function xt(){var r=new Ne(3);return Ne!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function $e(r){var e=r[0],s=r[1],l=r[2];return Math.sqrt(e*e+s*s+l*l)}function de(r,e,s){var l=new Ne(3);return l[0]=r,l[1]=e,l[2]=s,l}function Ae(r,e,s){return r[0]=e[0]+s[0],r[1]=e[1]+s[1],r[2]=e[2]+s[2],r}function Ye(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function _t(r,e,s){var l=e[0],d=e[1],g=e[2],y=s[0],w=s[1],N=s[2];return r[0]=d*N-g*w,r[1]=g*y-l*N,r[2]=l*w-d*y,r}var Et,zt=$e;function ht(r,e,s){var l=e[0],d=e[1],g=e[2],y=e[3];return r[0]=s[0]*l+s[4]*d+s[8]*g+s[12]*y,r[1]=s[1]*l+s[5]*d+s[9]*g+s[13]*y,r[2]=s[2]*l+s[6]*d+s[10]*g+s[14]*y,r[3]=s[3]*l+s[7]*d+s[11]*g+s[15]*y,r}function Qe(){var r=new Ne(4);return Ne!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Ce(r,e,s,l){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",g=Math.PI/360;e*=g,l*=g,s*=g;var y=Math.sin(e),w=Math.cos(e),N=Math.sin(s),A=Math.cos(s),R=Math.sin(l),I=Math.cos(l);switch(d){case"xyz":r[0]=y*A*I+w*N*R,r[1]=w*N*I-y*A*R,r[2]=w*A*R+y*N*I,r[3]=w*A*I-y*N*R;break;case"xzy":r[0]=y*A*I-w*N*R,r[1]=w*N*I-y*A*R,r[2]=w*A*R+y*N*I,r[3]=w*A*I+y*N*R;break;case"yxz":r[0]=y*A*I+w*N*R,r[1]=w*N*I-y*A*R,r[2]=w*A*R-y*N*I,r[3]=w*A*I+y*N*R;break;case"yzx":r[0]=y*A*I+w*N*R,r[1]=w*N*I+y*A*R,r[2]=w*A*R-y*N*I,r[3]=w*A*I-y*N*R;break;case"zxy":r[0]=y*A*I-w*N*R,r[1]=w*N*I+y*A*R,r[2]=w*A*R+y*N*I,r[3]=w*A*I-y*N*R;break;case"zyx":r[0]=y*A*I-w*N*R,r[1]=w*N*I+y*A*R,r[2]=w*A*R-y*N*I,r[3]=w*A*I+y*N*R;break;default:throw new Error("Unknown angle order "+d)}return r}function We(){var r=new Ne(2);return Ne!=Float32Array&&(r[0]=0,r[1]=0),r}function dt(r,e){var s=new Ne(2);return s[0]=r,s[1]=e,s}xt(),Et=new Ne(4),Ne!=Float32Array&&(Et[0]=0,Et[1]=0,Et[2]=0,Et[3]=0),xt(),de(1,0,0),de(0,1,0),Qe(),Qe(),Oe(),We();const Ze=8192;function Pe(r,e,s){return e*(Ze/(r.tileSize*Math.pow(2,s-r.tileID.overscaledZ)))}function le(r,e){return(r%e+e)%e}function Le(r,e,s){return r*(1-s)+e*s}function nt(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,s=e*r;return 4*(r<.5?s:3*(r-e)+s-.75)}function lt(r,e,s,l){const d=new ae(r,e,s,l);return g=>d.solve(g)}const Ot=lt(.25,.1,.25,1);function Mt(r,e,s){return Math.min(s,Math.max(e,r))}function mt(r,e,s){const l=s-e,d=((r-e)%l+l)%l+e;return d===e?s:d}function Dt(r,...e){for(const s of e)for(const l in s)r[l]=s[l];return r}let ys=1;function js(r,e,s){const l={};for(const d in r)l[d]=e.call(this,r[d],d,r);return l}function ks(r,e,s){const l={};for(const d in r)e.call(this,r[d],d,r)&&(l[d]=r[d]);return l}function Es(r){return Array.isArray(r)?r.map(Es):typeof r=="object"&&r?js(r,Es):r}const Rr={};function us(r){Rr[r]||(typeof console<"u"&&console.warn(r),Rr[r]=!0)}function xs(r,e,s){return(s.y-r.y)*(e.x-r.x)>(e.y-r.y)*(s.x-r.x)}function Is(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Os=null;function ar(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const vi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function wt(r,e,s,l,d){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(r,{timestamp:0});try{const y=g?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const w=y.startsWith("BGR"),N=new Uint8ClampedArray(l*d*4);if(yield g.copyTo(N,(function(A,R,I,B,$){const W=4*Math.max(-R,0),X=(Math.max(0,I)-I)*B*4+W,te=4*B,oe=Math.max(0,R),be=Math.max(0,I);return{rect:{x:oe,y:be,width:Math.min(A.width,R+B)-oe,height:Math.min(A.height,I+$)-be},layout:[{offset:X,stride:te}]}})(r,e,s,l,d)),w)for(let A=0;A<N.length;A+=4){const R=N[A];N[A]=N[A+2],N[A+2]=R}return N}finally{g.close()}}))}let qs,yr;function Ha(r,e,s,l){return r.addEventListener(e,s,l),{unsubscribe:()=>{r.removeEventListener(e,s,l)}}}function Ms(r){return r*Math.PI/180}function oi(r){return r/Math.PI*180}const Fr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Oi={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Gi="AbortError";class Fs extends Error{constructor(e=Gi){super(e instanceof Error?e.message:e),this.name=Gi,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Ls(r){return r.name===Gi}const Fe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function H(r){return Fe.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const K="global-dispatcher";class U extends Error{constructor(e,s,l,d){super(`AJAXError: ${s} (${e}): ${l}`),this.status=e,this.statusText=s,this.url=l,this.body=d}}const he=()=>Is(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ve=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const l=H(r.url);if(l)return l(r,e);if(Is(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:K},e)}if(!(/^file:/.test(s=r.url)||/^file:/.test(he())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,d){return c(this,void 0,void 0,(function*(){const g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:he(),signal:d.signal});let y,w;l.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{y=yield fetch(g)}catch(A){throw Ls(A)?A:new U(0,A.message,l.url,new Blob)}if(!y.ok){const A=yield y.blob();throw new U(y.status,y.statusText,l.url,A)}w=l.type==="arrayBuffer"||l.type==="image"?y.arrayBuffer():l.type==="json"?y.json():y.text();const N=yield w;return d.signal.throwIfAborted(),{data:N,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}}))})(r,e);if(Is(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:K},e)}var s;return(function(l,d){return new Promise(((g,y)=>{var w;const N=new XMLHttpRequest;N.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(N.responseType="arraybuffer");for(const A in l.headers)N.setRequestHeader(A,l.headers[A]);l.type==="json"&&(N.responseType="text",!((w=l.headers)===null||w===void 0)&&w.Accept||N.setRequestHeader("Accept","application/json")),N.withCredentials=l.credentials==="include",N.onerror=()=>{y(new Error(N.statusText))},N.onload=()=>{if(!d.signal.aborted)if((N.status>=200&&N.status<300||N.status===0)&&N.response!==null){let A=N.response;if(l.type==="json")try{A=JSON.parse(N.response)}catch(R){return void y(R)}g({data:A,cacheControl:N.getResponseHeader("Cache-Control"),expires:N.getResponseHeader("Expires")})}else{const A=new Blob([N.response],{type:N.getResponseHeader("Content-Type")});y(new U(N.status,N.statusText,l.url,A))}},d.signal.addEventListener("abort",(()=>{N.abort(),y(new Fs(d.signal.reason))})),N.send(l.body)}))})(r,e)};function Ve(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),s=window.location;return e.protocol===s.protocol&&e.host===s.host}function He(r,e,s){s[r]&&s[r].indexOf(e)!==-1||(s[r]=s[r]||[],s[r].push(e))}function Ue(r,e,s){if(s&&s[r]){const l=s[r].indexOf(e);l!==-1&&s[r].splice(l,1)}}class Re{constructor(e,s={}){Dt(this,s),this.type=e}}class ot extends Re{constructor(e,s={}){super("error",Dt({error:e},s))}}class rt{on(e,s){return this._listeners=this._listeners||{},He(e,s,this._listeners),{unsubscribe:()=>{this.off(e,s)}}}off(e,s){return Ue(e,s,this._listeners),Ue(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},He(e,s,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,s){typeof e=="string"&&(e=new Re(e,s||{}));const l=e.type;if(this.listens(l)){e.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of d)w.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of g)Ue(l,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(Dt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof ot&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Vt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function as(r,e){const s={};for(const l in r)l!=="ref"&&(s[l]=r[l]);return Vt.forEach((l=>{l in e&&(s[l]=e[l])})),s}function Kt(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let s=0;s<r.length;s++)if(!Kt(r[s],e[s]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const s in r)if(!Kt(r[s],e[s]))return!1;return!0}return r===e}function ss(r,e){r.push(e)}function Qt(r,e,s){ss(s,{command:"addSource",args:[r,e[r]]})}function ls(r,e,s){ss(e,{command:"removeSource",args:[r]}),s[r]=!0}function xr(r,e,s,l){ls(r,s,l),Qt(r,e,s)}function Sr(r,e,s){let l;for(l in r[s])if(Object.prototype.hasOwnProperty.call(r[s],l)&&l!=="data"&&!Kt(r[s][l],e[s][l]))return!1;for(l in e[s])if(Object.prototype.hasOwnProperty.call(e[s],l)&&l!=="data"&&!Kt(r[s][l],e[s][l]))return!1;return!0}function Gs(r,e,s,l,d,g){r=r||{},e=e||{};for(const y in r)Object.prototype.hasOwnProperty.call(r,y)&&(Kt(r[y],e[y])||s.push({command:g,args:[l,y,e[y],d]}));for(const y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(r,y)&&(Kt(r[y],e[y])||s.push({command:g,args:[l,y,e[y],d]}))}function vr(r){return r.id}function Rs(r,e){return r[e.id]=e,r}class Nt{constructor(e,s,l,d){this.message=(e?`${e}: `:"")+l,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ps(r,...e){for(const s of e)for(const l in s)r[l]=s[l];return r}class Ks extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class li{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[l,d]of s)this.bindings[l]=d}concat(e){return new li(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Hs={kind:"null"},Ct={kind:"number"},is={kind:"string"},es={kind:"boolean"},ra={kind:"color"},rc={kind:"projectionDefinition"},va={kind:"object"},ds={kind:"value"},no={kind:"collator"},ba={kind:"formatted"},Za={kind:"padding"},hi={kind:"colorArray"},xe={kind:"numberArray"},Pt={kind:"resolvedImage"},Ft={kind:"variableAnchorOffsetCollection"};function Gt(r,e){return{kind:"array",itemType:r,N:e}}function Ht(r){if(r.kind==="array"){const e=Ht(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Js=[Hs,Ct,is,es,ra,rc,ba,va,Gt(ds),Za,xe,hi,Pt,Ft];function fi(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!fi(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const s of Js)if(!fi(s,e))return null}}return`Expected ${Ht(r)} but found ${Ht(e)} instead.`}function ia(r,e){return e.some((s=>s.kind===r.kind))}function ei(r,e){return e.some((s=>s==="null"?r===null:s==="array"?Array.isArray(r):s==="object"?r&&!Array.isArray(r)&&typeof r=="object":s===typeof r))}function Er(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const mn=.96422,Rn=.82521,Wa=4/29,Zs=6/29,Kd=3*Zs*Zs,xf=Zs*Zs*Zs,cl=Math.PI/180,Jd=180/Math.PI;function Gc(r){return(r%=360)<0&&(r+=360),r}function _f([r,e,s,l]){let d,g;const y=Hc((.2225045*(r=Hi(r))+.7168786*(e=Hi(e))+.0606169*(s=Hi(s)))/1);r===e&&e===s?d=g=y:(d=Hc((.4360747*r+.3850649*e+.1430804*s)/mn),g=Hc((.0139322*r+.0971045*e+.7141733*s)/Rn));const w=116*y-16;return[w<0?0:w,500*(d-y),200*(y-g),l]}function Hi(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Hc(r){return r>xf?Math.pow(r,1/3):r/Kd+Wa}function Xu([r,e,s,l]){let d=(r+16)/116,g=isNaN(e)?d:d+e/500,y=isNaN(s)?d:d-s/200;return d=1*Mo(d),g=mn*Mo(g),y=Rn*Mo(y),[Zc(3.1338561*g-1.6168667*d-.4906146*y),Zc(-.9787684*g+1.9161415*d+.033454*y),Zc(.0719453*g-.2289914*d+1.4052427*y),l]}function Zc(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Mo(r){return r>Zs?r*r*r:Kd*(r-Wa)}const vf=Object.hasOwn||function(r,e){return Object.prototype.hasOwnProperty.call(r,e)};function ic(r,e){return vf(r,e)?r[e]:void 0}function oo(r){return parseInt(r.padEnd(2,r),16)/255}function bf(r,e){return ul(e?r/100:r,0,1)}function ul(r,e,s){return Math.min(Math.max(e,r),s)}function Ku(r){return!r.some(Number.isNaN)}const dl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Po(r,e,s){return r+s*(e-r)}function ac(r,e,s){return r.map(((l,d)=>Po(l,e[d],s)))}class _s{constructor(e,s,l,d=1,g=!0){this.r=e,this.g=s,this.b=l,this.a=d,g||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,s,l,d]))}static parse(e){if(e instanceof _s)return e;if(typeof e!="string")return;const s=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=ic(dl,l);if(d){const[y,w,N]=d;return[y/255,w/255,N/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const y=l.length<6?1:2;let w=1;return[oo(l.slice(w,w+=y)),oo(l.slice(w,w+=y)),oo(l.slice(w,w+=y)),oo(l.slice(w,w+y)||"ff")]}if(l.startsWith("rgb")){const y=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[w,N,A,R,I,B,$,W,X,te,oe,be]=y,ne=[R||" ",$||" ",te].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const me=[A,B,X].join(""),Ee=me==="%%%"?100:me===""?255:0;if(Ee){const Ie=[ul(+N/Ee,0,1),ul(+I/Ee,0,1),ul(+W/Ee,0,1),oe?bf(+oe,be):1];if(Ku(Ie))return Ie}}return}}const g=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,w,N,A,R,I,B,$,W]=g,X=[N||" ",R||" ",B].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const te=[+w,ul(+A,0,100),ul(+I,0,100),$?bf(+$,W):1];if(Ku(te))return(function([oe,be,ne,me]){function Ee(Ie){const Je=(Ie+oe/30)%12,pt=be*Math.min(ne,1-ne);return ne-pt*Math.max(-1,Math.min(Je-3,9-Je,1))}return oe=Gc(oe),be/=100,ne/=100,[Ee(0),Ee(8),Ee(4),me]})(te)}}})(e);return s?new _s(...s,!1):void 0}get rgb(){const{r:e,g:s,b:l,a:d}=this,g=d||1/0;return this.overwriteGetter("rgb",[e/g,s/g,l/g,d])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[s,l,d,g]=_f(e),y=Math.sqrt(l*l+d*d);return[Math.round(1e4*y)?Gc(Math.atan2(d,l)*Jd):NaN,y,s,g]})(this.rgb))}get lab(){return this.overwriteGetter("lab",_f(this.rgb))}overwriteGetter(e,s){return Object.defineProperty(this,e,{value:s}),s}toString(){const[e,s,l,d]=this.rgb;return`rgba(${[e,s,l].map((g=>Math.round(255*g))).join(",")},${d})`}static interpolate(e,s,l,d="rgb"){switch(d){case"rgb":{const[g,y,w,N]=ac(e.rgb,s.rgb,l);return new _s(g,y,w,N,!1)}case"hcl":{const[g,y,w,N]=e.hcl,[A,R,I,B]=s.hcl;let $,W;if(isNaN(g)||isNaN(A))isNaN(g)?isNaN(A)?$=NaN:($=A,w!==1&&w!==0||(W=R)):($=g,I!==1&&I!==0||(W=y));else{let ne=A-g;A>g&&ne>180?ne-=360:A<g&&g-A>180&&(ne+=360),$=g+l*ne}const[X,te,oe,be]=(function([ne,me,Ee,Ie]){return ne=isNaN(ne)?0:ne*cl,Xu([Ee,Math.cos(ne)*me,Math.sin(ne)*me,Ie])})([$,W??Po(y,R,l),Po(w,I,l),Po(N,B,l)]);return new _s(X,te,oe,be,!1)}case"lab":{const[g,y,w,N]=Xu(ac(e.lab,s.lab,l));return new _s(g,y,w,N,!1)}}}}_s.black=new _s(0,0,0,1),_s.white=new _s(1,1,1,1),_s.transparent=new _s(0,0,0,0),_s.red=new _s(1,0,0,1);class gn{constructor(e,s,l){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Qd=["bottom","center","top"];class Wc{constructor(e,s,l,d,g,y){this.text=e,this.image=s,this.scale=l,this.fontStack=d,this.textColor=g,this.verticalAlign=y}}class pi{constructor(e){this.sections=e}static fromString(e){return new pi([new Wc(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof pi?e:pi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class ti{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ti)return e;if(typeof e=="number")return new ti([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const s of e)if(typeof s!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ti(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,l){return new ti(ac(e.values,s.values,l))}}class Cr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Cr)return e;if(typeof e=="number")return new Cr([e]);if(Array.isArray(e)){for(const s of e)if(typeof s!="number")return;return new Cr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,l){return new Cr(ac(e.values,s.values,l))}}class ns{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ns)return e;if(typeof e=="string"){const l=_s.parse(e);return l?new ns([l]):void 0}if(!Array.isArray(e))return;const s=[];for(const l of e){if(typeof l!="string")return;const d=_s.parse(l);if(!d)return;s.push(d)}return new ns(s)}toString(){return JSON.stringify(this.values)}static interpolate(e,s,l,d="rgb"){const g=[];if(e.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let y=0;y<e.values.length;y++)g.push(_s.interpolate(e.values[y],s.values[y],l,d));return new ns(g)}}class ur extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ya=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ur{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ur)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let s=0;s<e.length;s+=2){const l=e[s],d=e[s+1];if(typeof l!="string"||!Ya.has(l)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Ur(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,l){const d=e.values,g=s.values;if(d.length!==g.length)throw new ur(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${s.toString()}`);const y=[];for(let w=0;w<d.length;w+=2){if(d[w]!==g[w])throw new ur(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${d[w]}, to[${w}]: ${g[w]}`);y.push(d[w]);const[N,A]=d[w+1],[R,I]=g[w+1];y.push([Po(N,R,l),Po(A,I,l)])}return new Ur(y)}}class Zi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Zi({name:e,available:!1}):null}}class mi{constructor(e,s,l){this.from=e,this.to=s,this.transition=l}static interpolate(e,s,l){return new mi(e,s,l)}static parse(e){return e instanceof mi?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new mi(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new mi(e.from,e.to,e.transition):typeof e=="string"?new mi(e,e,1):void 0}}function wa(r,e,s,l){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,e,s,l]:[r,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function In(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof mi||r instanceof _s||r instanceof gn||r instanceof pi||r instanceof ti||r instanceof Cr||r instanceof ns||r instanceof Ur||r instanceof Zi)return!0;if(Array.isArray(r)){for(const e of r)if(!In(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!In(r[e]))return!1;return!0}return!1}function Ar(r){if(r===null)return Hs;if(typeof r=="string")return is;if(typeof r=="boolean")return es;if(typeof r=="number")return Ct;if(r instanceof _s)return ra;if(r instanceof mi)return rc;if(r instanceof gn)return no;if(r instanceof pi)return ba;if(r instanceof ti)return Za;if(r instanceof Cr)return xe;if(r instanceof ns)return hi;if(r instanceof Ur)return Ft;if(r instanceof Zi)return Pt;if(Array.isArray(r)){const e=r.length;let s;for(const l of r){const d=Ar(l);if(s){if(s===d)continue;s=ds;break}s=d}return Gt(s||ds,e)}return va}function Do(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof _s||r instanceof mi||r instanceof pi||r instanceof ti||r instanceof Cr||r instanceof ns||r instanceof Ur||r instanceof Zi?r.toString():JSON.stringify(r)}class Sa{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!In(e[1]))return s.error("invalid value");const l=e[1];let d=Ar(l);const g=s.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new Sa(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const hl={string:is,number:Ct,boolean:es,object:va};class Wi{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let l,d=1;const g=e[0];if(g==="array"){let w,N;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in hl)||A==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=hl[A],d++}else w=ds;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);N=e[2],d++}l=Gt(w,N)}else{if(!hl[g])throw new Error(`Types doesn't contain name = ${g}`);l=hl[g]}const y=[];for(;d<e.length;d++){const w=s.parse(e[d],d,ds);if(!w)return null;y.push(w)}return new Wi(l,y)}evaluate(e){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(e);if(!fi(this.type,Ar(l)))return l;if(s===this.args.length-1)throw new ur(`Expected value to be of type ${Ht(this.type)}, but found ${Ht(Ar(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ci={"to-boolean":es,"to-color":ra,"to-number":Ct,"to-string":is};class Yi{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[0];if(!ci[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return s.error("Expected one argument.");const d=ci[l],g=[];for(let y=1;y<e.length;y++){const w=s.parse(e[y],y,ds);if(!w)return null;g.push(w)}return new Yi(d,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let s,l;for(const d of this.args){if(s=d.evaluate(e),l=null,s instanceof _s)return s;if(typeof s=="string"){const g=e.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:wa(s[0],s[1],s[2],s[3]),!l))return new _s(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ur(l||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const l of this.args){s=l.evaluate(e);const d=ti.parse(s);if(d)return d}throw new ur(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const l of this.args){s=l.evaluate(e);const d=Cr.parse(s);if(d)return d}throw new ur(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const l of this.args){s=l.evaluate(e);const d=ns.parse(s);if(d)return d}throw new ur(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const l of this.args){s=l.evaluate(e);const d=Ur.parse(s);if(d)return d}throw new ur(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const l of this.args){if(s=l.evaluate(e),s===null)return 0;const d=Number(s);if(!isNaN(d))return d}throw new ur(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return pi.fromString(Do(this.args[0].evaluate(e)));case"resolvedImage":return Zi.fromString(Do(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Do(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Yc=["Unknown","Point","LineString","Polygon"];class fl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache.get(e);return s||(s=_s.parse(e),this._parseColorCache.set(e,s)),s}}class pl{constructor(e,s,l=[],d,g=new li,y=[]){this.registry=e,this.path=l,this.key=l.map((w=>`[${w}]`)).join(""),this.scope=g,this.errors=y,this.expectedType=d,this._isConstant=s}parse(e,s,l,d,g={}){return s?this.concat(s,l,d)._parse(e,g):this._parse(e,g)}_parse(e,s){function l(d,g,y){return y==="assert"?new Wi(g,[d]):y==="coerce"?new Yi(g,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[d];if(g){let y=g.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,N=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||N.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(N.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(N.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(N.kind)||w.kind==="colorArray"&&["value","string","array"].includes(N.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(N.kind))y=l(y,w,s.typeAnnotation||"coerce");else if(this.checkSubtype(w,N))return null}else y=l(y,w,s.typeAnnotation||"assert")}if(!(y instanceof Sa)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const w=new fl;try{y=new Sa(y.type,y.evaluate(w))}catch(N){return this.error(N.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,l){const d=typeof e=="number"?this.path.concat(e):this.path,g=l?this.scope.concat(l):this.scope;return new pl(this.registry,this._isConstant,d,s||null,g,this.errors)}error(e,...s){const l=`${this.key}${s.map((d=>`[${d}]`)).join("")}`;this.errors.push(new Ks(l,e))}checkSubtype(e,s){const l=fi(e,s);return l&&this.error(l),l}}class nr{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let g=1;g<e.length-1;g+=2){const y=e[g];if(typeof y!="string")return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=s.parse(e[g+1],g+1);if(!w)return null;l.push([y,w])}const d=s.parse(e[e.length-1],e.length-1,s.expectedType,l);return d?new nr(l,d):null}outputDefined(){return this.result.outputDefined()}}class Ro{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const l=e[1];return s.scope.has(l)?new Ro(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class As{constructor(e,s,l){this.type=e,this.index=s,this.input=l}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Ct),d=s.parse(e[2],2,Gt(s.expectedType||ds));return l&&d?new As(d.type.itemType,l,d):null}evaluate(e){const s=this.index.evaluate(e),l=this.input.evaluate(e);if(s<0)throw new ur(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new ur(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new ur(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ms{constructor(e,s){this.type=es,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,ds),d=s.parse(e[2],2,ds);return l&&d?ia(l.type,[es,is,Ct,Hs,ds])?new ms(l,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(l.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!ei(s,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(Ar(s))} instead.`);if(!ei(l,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${Ht(Ar(l))} instead.`);return l.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ml{constructor(e,s,l){this.type=Ct,this.needle=e,this.haystack=s,this.fromIndex=l}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,ds),d=s.parse(e[2],2,ds);if(!l||!d)return null;if(!ia(l.type,[es,is,Ct,Hs,ds]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(l.type)} instead`);if(e.length===4){const g=s.parse(e[3],3,Ct);return g?new ml(l,d,g):null}return new ml(l,d)}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!ei(s,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(Ar(s))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(e)),ei(l,["string"])){const g=l.indexOf(s,d);return g===-1?-1:[...l.slice(0,g)].length}if(ei(l,["array"]))return l.indexOf(s,d);throw new ur(`Expected second argument to be of type array or string, but found ${Ht(Ar(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Bs{constructor(e,s,l,d,g,y){this.inputType=e,this.type=s,this.input=l,this.cases=d,this.outputs=g,this.otherwise=y}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let l,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const g={},y=[];for(let A=2;A<e.length-1;A+=2){let R=e[A];const I=e[A+1];Array.isArray(R)||(R=[R]);const B=s.concat(A);if(R.length===0)return B.error("Expected at least one branch label.");for(const W of R){if(typeof W!="number"&&typeof W!="string")return B.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return B.error("Numeric branch labels must be integer values.");if(l){if(B.checkSubtype(l,Ar(W)))return null}else l=Ar(W);if(g[String(W)]!==void 0)return B.error("Branch labels must be unique.");g[String(W)]=y.length}const $=s.parse(I,A,d);if(!$)return null;d=d||$.type,y.push($)}const w=s.parse(e[1],1,ds);if(!w)return null;const N=s.parse(e[e.length-1],e.length-1,d);return N?w.type.kind!=="value"&&s.concat(1).checkSubtype(l,w.type)?null:new Bs(l,d,w,g,y,N):null}evaluate(e){const s=this.input.evaluate(e);return(Ar(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Xc{constructor(e,s,l){this.type=e,this.branches=s,this.otherwise=l}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const w=s.parse(e[y],y,es);if(!w)return null;const N=s.parse(e[y+1],y+1,l);if(!N)return null;d.push([w,N]),l=l||N.type}const g=s.parse(e[e.length-1],e.length-1,l);if(!g)return null;if(!l)throw new Error("Can't infer output type");return new Xc(l,d,g)}evaluate(e){for(const[s,l]of this.branches)if(s.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,l]of this.branches)e(s),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,s])=>s.outputDefined()))&&this.otherwise.outputDefined()}}class Xa{constructor(e,s,l,d){this.type=e,this.input=s,this.beginIndex=l,this.endIndex=d}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,ds),d=s.parse(e[2],2,Ct);if(!l||!d)return null;if(!ia(l.type,[Gt(ds),is,ds]))return s.error(`Expected first argument to be of type array or string, but found ${Ht(l.type)} instead`);if(e.length===4){const g=s.parse(e[3],3,Ct);return g?new Xa(l.type,l,d,g):null}return new Xa(l.type,l,d)}evaluate(e){const s=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let d;if(this.endIndex&&(d=this.endIndex.evaluate(e)),ei(s,["string"]))return[...s].slice(l,d).join("");if(ei(s,["array"]))return s.slice(l,d);throw new ur(`Expected first argument to be of type array or string, but found ${Ht(Ar(s))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Io(r,e){const s=r.length-1;let l,d,g=0,y=s,w=0;for(;g<=y;)if(w=Math.floor((g+y)/2),l=r[w],d=r[w+1],l<=e){if(w===s||e<d)return w;g=w+1}else{if(!(l>e))throw new ur("Input is not a number.");y=w-1}return 0}class zo{constructor(e,s,l){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[d,g]of l)this.labels.push(d),this.outputs.push(g)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(e[1],1,Ct);if(!l)return null;const d=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let y=1;y<e.length;y+=2){const w=y===1?-1/0:e[y],N=e[y+1],A=y,R=y+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(d.length&&d[d.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const I=s.parse(N,R,g);if(!I)return null;g=g||I.type,d.push([w,I])}return new zo(g,l,d)}evaluate(e){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=s[0])return l[0].evaluate(e);const g=s.length;return d>=s[g-1]?l[g-1].evaluate(e):l[Io(s,d)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function wf(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Kc,eh,im=(function(){if(eh)return Kc;function r(e,s,l,d){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=l,this.p2y=d}return eh=1,Kc=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,d=0;d<8;d++){var g=this.sampleCurveX(l)-e;if(Math.abs(g)<s)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=g/y}var w=0,N=1;for(l=e,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-e)<s));d++)e>g?w=l:N=l,l=.5*(N-w)+w;return l},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},Kc})(),th=wf(im);class Xi{constructor(e,s,l,d,g){this.type=e,this.operator=s,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[y,w]of g)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,s,l,d){let g=0;if(e.name==="exponential")g=zn(s,e.base,l,d);else if(e.name==="linear")g=zn(s,1,l,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;g=new th(y[0],y[1],y[2],y[3]).solve(zn(s,1,l,d))}return g}static parse(e,s){let[l,d,g,...y]=e;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const A=d[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:A}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const A=d.slice(1);if(A.length!==4||A.some((R=>typeof R!="number"||R<0||R>1)))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Ct),!g)return null;const w=[];let N=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||s.expectedType==hi?s.expectedType&&s.expectedType.kind!=="value"&&(N=s.expectedType):N=ra;for(let A=0;A<y.length;A+=2){const R=y[A],I=y[A+1],B=A+3,$=A+4;if(typeof R!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(w.length&&w[w.length-1][0]>=R)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const W=s.parse(I,$,N);if(!W)return null;N=N||W.type,w.push([R,W])}return Er(N,Ct)||Er(N,rc)||Er(N,ra)||Er(N,Za)||Er(N,xe)||Er(N,hi)||Er(N,Ft)||Er(N,Gt(Ct))?new Xi(N,l,d,g,w):s.error(`Type ${Ht(N)} is not interpolatable.`)}evaluate(e){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=s[0])return l[0].evaluate(e);const g=s.length;if(d>=s[g-1])return l[g-1].evaluate(e);const y=Io(s,d),w=Xi.interpolationFactor(this.interpolation,d,s[y],s[y+1]),N=l[y].evaluate(e),A=l[y+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Po(N,A,w);case"color":return _s.interpolate(N,A,w);case"padding":return ti.interpolate(N,A,w);case"colorArray":return ns.interpolate(N,A,w);case"numberArray":return Cr.interpolate(N,A,w);case"variableAnchorOffsetCollection":return Ur.interpolate(N,A,w);case"array":return ac(N,A,w);case"projectionDefinition":return mi.interpolate(N,A,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return _s.interpolate(N,A,w,"hcl");case"colorArray":return ns.interpolate(N,A,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return _s.interpolate(N,A,w,"lab");case"colorArray":return ns.interpolate(N,A,w,"lab")}}}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function zn(r,e,s,l){const d=l-s,g=r-s;return d===0?0:e===1?g/d:(Math.pow(e,g)-1)/(Math.pow(e,d)-1)}const kr={color:_s.interpolate,number:Po,padding:ti.interpolate,numberArray:Cr.interpolate,colorArray:ns.interpolate,variableAnchorOffsetCollection:Ur.interpolate,array:ac};class gl{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let l=null;const d=s.expectedType;d&&d.kind!=="value"&&(l=d);const g=[];for(const w of e.slice(1)){const N=s.parse(w,1+g.length,l,void 0,{typeAnnotation:"omit"});if(!N)return null;l=l||N.type,g.push(N)}if(!l)throw new Error("No output type");const y=d&&g.some((w=>fi(d,w.type)));return new gl(y?ds:l,g)}evaluate(e){let s,l=null,d=0;for(const g of this.args)if(d++,l=g.evaluate(e),l&&l instanceof Zi&&!l.available&&(s||(s=l.name),l=null,d===this.args.length&&(l=s)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Jc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Qc(r,e,s,l){return l.compare(e,s)===0}function $r(r,e,s){const l=r!=="=="&&r!=="!=";return class wv{constructor(g,y,w){this.type=es,this.lhs=g,this.rhs=y,this.collator=w,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const w=g[0];let N=y.parse(g[1],1,ds);if(!N)return null;if(!Jc(w,N.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${Ht(N.type)}'.`);let A=y.parse(g[2],2,ds);if(!A)return null;if(!Jc(w,A.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${Ht(A.type)}'.`);if(N.type.kind!==A.type.kind&&N.type.kind!=="value"&&A.type.kind!=="value")return y.error(`Cannot compare types '${Ht(N.type)}' and '${Ht(A.type)}'.`);l&&(N.type.kind==="value"&&A.type.kind!=="value"?N=new Wi(A.type,[N]):N.type.kind!=="value"&&A.type.kind==="value"&&(A=new Wi(N.type,[A])));let R=null;if(g.length===4){if(N.type.kind!=="string"&&A.type.kind!=="string"&&N.type.kind!=="value"&&A.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(R=y.parse(g[3],3,no),!R)return null}return new wv(N,A,R)}evaluate(g){const y=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(l&&this.hasUntypedArgument){const N=Ar(y),A=Ar(w);if(N.kind!==A.kind||N.kind!=="string"&&N.kind!=="number")throw new ur(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${N.kind}, ${A.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const N=Ar(y),A=Ar(w);if(N.kind!=="string"||A.kind!=="string")return e(g,y,w)}return this.collator?s(g,y,w,this.collator.evaluate(g)):e(g,y,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Sf=$r("==",(function(r,e,s){return e===s}),Qc),Ju=$r("!=",(function(r,e,s){return e!==s}),(function(r,e,s,l){return!Qc(0,e,s,l)})),jf=$r("<",(function(r,e,s){return e<s}),(function(r,e,s,l){return l.compare(e,s)<0})),am=$r(">",(function(r,e,s){return e>s}),(function(r,e,s,l){return l.compare(e,s)>0})),nc=$r("<=",(function(r,e,s){return e<=s}),(function(r,e,s,l){return l.compare(e,s)<=0})),Qu=$r(">=",(function(r,e,s){return e>=s}),(function(r,e,s,l){return l.compare(e,s)>=0}));class oc{constructor(e,s,l){this.type=no,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");const d=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,es);if(!d)return null;const g=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,es);if(!g)return null;let y=null;return l.locale&&(y=s.parse(l.locale,1,is),!y)?null:new oc(d,g,y)}evaluate(e){return new gn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class sh{constructor(e,s,l,d,g){this.type=is,this.number=e,this.locale=s,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const l=s.parse(e[1],1,Ct);if(!l)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=s.parse(d.locale,1,is),!g))return null;let y=null;if(d.currency&&(y=s.parse(d.currency,1,is),!y))return null;let w=null;if(d["min-fraction-digits"]&&(w=s.parse(d["min-fraction-digits"],1,Ct),!w))return null;let N=null;return d["max-fraction-digits"]&&(N=s.parse(d["max-fraction-digits"],1,Ct),!N)?null:new sh(l,g,y,w,N)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class eu{constructor(e){this.type=ba,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");const d=[];let g=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(g&&typeof w=="object"&&!Array.isArray(w)){g=!1;let N=null;if(w["font-scale"]&&(N=s.parse(w["font-scale"],1,Ct),!N))return null;let A=null;if(w["text-font"]&&(A=s.parse(w["text-font"],1,Gt(is)),!A))return null;let R=null;if(w["text-color"]&&(R=s.parse(w["text-color"],1,ra),!R))return null;let I=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Qd.includes(w["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(I=s.parse(w["vertical-align"],1,is),!I)return null}const B=d[d.length-1];B.scale=N,B.font=A,B.textColor=R,B.verticalAlign=I}else{const N=s.parse(e[y],1,ds);if(!N)return null;const A=N.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:N,scale:null,font:null,textColor:null,verticalAlign:null})}}return new eu(d)}evaluate(e){return new pi(this.sections.map((s=>{const l=s.content.evaluate(e);return Ar(l)===Pt?new Wc("",l,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(e):null):new Wc(Do(l),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null,s.verticalAlign?s.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor),s.verticalAlign&&e(s.verticalAlign)}outputDefined(){return!1}}class lc{constructor(e){this.type=Pt,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const l=s.parse(e[1],1,is);return l?new lc(l):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),l=Zi.fromString(s);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(s)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class cc{constructor(e){this.type=Ct,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=s.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ht(l.type)} instead.`):new cc(l):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new ur(`Expected value to be of type string or array, but found ${Ht(Ar(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Wr=8192;function uc(r,e){const s=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(s*d*Wr),Math.round(l*d*Wr)]}function dc(r,e){const s=Math.pow(2,e.z);return[(d=(r[0]/Wr+e.x)/s,360*d-180),(l=(r[1]/Wr+e.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,d}function hc(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Oo(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Tf(r,e,s){const l=r[0]-e[0],d=r[1]-e[1],g=r[0]-s[0],y=r[1]-s[1];return l*y-g*d==0&&l*g<=0&&d*y<=0}function tu(r,e,s,l){return(d=[l[0]-s[0],l[1]-s[1]])[0]*(g=[e[0]-r[0],e[1]-r[1]])[1]-d[1]*g[0]!=0&&!(!td(r,e,s,l)||!td(s,l,r,e));var d,g}function Nf(r,e,s){for(const l of s)for(let d=0;d<l.length-1;++d)if(tu(r,e,l[d],l[d+1]))return!0;return!1}function yn(r,e,s=!1){let l=!1;for(const w of e)for(let N=0;N<w.length-1;N++){if(Tf(r,w[N],w[N+1]))return s;(g=w[N])[1]>(d=r)[1]!=(y=w[N+1])[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(l=!l)}var d,g,y;return l}function ed(r,e){for(const s of e)if(yn(r,s))return!0;return!1}function Ef(r,e){for(const s of r)if(!yn(s,e))return!1;for(let s=0;s<r.length-1;++s)if(Nf(r[s],r[s+1],e))return!1;return!0}function Cf(r,e){for(const s of e)if(Ef(r,s))return!0;return!1}function td(r,e,s,l){const d=l[0]-s[0],g=l[1]-s[1],y=(r[0]-s[0])*g-d*(r[1]-s[1]),w=(e[0]-s[0])*g-d*(e[1]-s[1]);return y>0&&w<0||y<0&&w>0}function sd(r,e,s){const l=[];for(let d=0;d<r.length;d++){const g=[];for(let y=0;y<r[d].length;y++){const w=uc(r[d][y],s);hc(e,w),g.push(w)}l.push(g)}return l}function yl(r,e,s){const l=[];for(let d=0;d<r.length;d++){const g=sd(r[d],e,s);l.push(g)}return l}function fc(r,e,s,l){if(r[0]<s[0]||r[0]>s[2]){const d=.5*l;let g=r[0]-s[0]>d?-l:s[0]-r[0]>d?l:0;g===0&&(g=r[0]-s[2]>d?-l:s[2]-r[0]>d?l:0),r[0]+=g}hc(e,r)}function Af(r,e,s,l){const d=Math.pow(2,l.z)*Wr,g=[l.x*Wr,l.y*Wr],y=[];for(const w of r)for(const N of w){const A=[N.x+g[0],N.y+g[1]];fc(A,e,s,d),y.push(A)}return y}function su(r,e,s,l){const d=Math.pow(2,l.z)*Wr,g=[l.x*Wr,l.y*Wr],y=[];for(const N of r){const A=[];for(const R of N){const I=[R.x+g[0],R.y+g[1]];hc(e,I),A.push(I)}y.push(A)}if(e[2]-e[0]<=d/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const N of y)for(const A of N)fc(A,e,s,d)}var w;return y}class Lo{constructor(e,s){this.type=es,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(In(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const d=[];for(const g of l.features){const{type:y,coordinates:w}=g.geometry;y==="Polygon"&&d.push(w),y==="MultiPolygon"&&d.push(...w)}if(d.length)return new Lo(l,{type:"MultiPolygon",coordinates:d})}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Lo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Lo(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(s,l){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(l.type==="Polygon"){const w=sd(l.coordinates,g,y),N=Af(s.geometry(),d,g,y);if(!Oo(d,g))return!1;for(const A of N)if(!yn(A,w))return!1}if(l.type==="MultiPolygon"){const w=yl(l.coordinates,g,y),N=Af(s.geometry(),d,g,y);if(!Oo(d,g))return!1;for(const A of N)if(!ed(A,w))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(s,l){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(l.type==="Polygon"){const w=sd(l.coordinates,g,y),N=su(s.geometry(),d,g,y);if(!Oo(d,g))return!1;for(const A of N)if(!Ef(A,w))return!1}if(l.type==="MultiPolygon"){const w=yl(l.coordinates,g,y),N=su(s.geometry(),d,g,y);if(!Oo(d,g))return!1;for(const A of N)if(!Cf(A,w))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let rh=class{constructor(r=[],e=(s,l)=>s<l?-1:s>l?1:0){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:s}=this,l=e[r];for(;r>0;){const d=r-1>>1,g=e[d];if(s(l,g)>=0)break;e[r]=g,r=d}e[r]=l}_down(r){const{data:e,compare:s}=this,l=this.length>>1,d=e[r];for(;r<l;){let g=1+(r<<1);const y=g+1;if(y<this.length&&s(e[y],e[g])<0&&(g=y),s(e[g],d)>=0)break;e[r]=e[g],r=g}e[r]=d}};function ru(r,e,s=0,l=r.length-1,d=ih){for(;l>s;){if(l-s>600){const N=l-s+1,A=e-s+1,R=Math.log(N),I=.5*Math.exp(2*R/3),B=.5*Math.sqrt(R*I*(N-I)/N)*(A-N/2<0?-1:1);ru(r,e,Math.max(s,Math.floor(e-A*I/N+B)),Math.min(l,Math.floor(e+(N-A)*I/N+B)),d)}const g=r[e];let y=s,w=l;for(Bo(r,s,e),d(r[l],g)>0&&Bo(r,s,l);y<w;){for(Bo(r,y,w),y++,w--;d(r[y],g)<0;)y++;for(;d(r[w],g)>0;)w--}d(r[s],g)===0?Bo(r,s,w):(w++,Bo(r,w,l)),w<=e&&(s=w+1),e<=w&&(l=w-1)}}function Bo(r,e,s){const l=r[e];r[e]=r[s],r[s]=l}function ih(r,e){return r<e?-1:r>e?1:0}function iu(r,e){if(r.length<=1)return[r];const s=[];let l,d;for(const g of r){const y=nm(g);y!==0&&(g.area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(l&&s.push(l),l=[g]):l.push(g))}if(l&&s.push(l),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(ru(s[g],e,1,s[g].length-1,kf),s[g]=s[g].slice(0,e));return s}function kf(r,e){return e.area-r.area}function nm(r){let e=0;for(let s,l,d=0,g=r.length,y=g-1;d<g;y=d++)s=r[d],l=r[y],e+=(l.x-s.x)*(s.y+l.y);return e}const Mf=1/298.257223563,au=Mf*(2-Mf),Pf=Math.PI/180;class ah{constructor(e){const s=6378.137*Pf*1e3,l=Math.cos(e*Pf),d=1/(1-au*(1-l*l)),g=Math.sqrt(d);this.kx=s*g*l,this.ky=s*g*d*(1-au)}distance(e,s){const l=this.wrap(e[0]-s[0])*this.kx,d=(e[1]-s[1])*this.ky;return Math.sqrt(l*l+d*d)}pointOnLine(e,s){let l,d,g,y,w=1/0;for(let N=0;N<e.length-1;N++){let A=e[N][0],R=e[N][1],I=this.wrap(e[N+1][0]-A)*this.kx,B=(e[N+1][1]-R)*this.ky,$=0;I===0&&B===0||($=(this.wrap(s[0]-A)*this.kx*I+(s[1]-R)*this.ky*B)/(I*I+B*B),$>1?(A=e[N+1][0],R=e[N+1][1]):$>0&&(A+=I/this.kx*$,R+=B/this.ky*$)),I=this.wrap(s[0]-A)*this.kx,B=(s[1]-R)*this.ky;const W=I*I+B*B;W<w&&(w=W,l=A,d=R,g=N,y=$)}return{point:[l,d],index:g,t:Math.max(0,Math.min(1,y))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function aa(r,e){return e[0]-r[0]}function Fo(r){return r[1]-r[0]+1}function Ka(r,e){return r[1]>=r[0]&&r[1]<e}function nu(r,e){if(r[0]>r[1])return[null,null];const s=Fo(r);if(e){if(s===2)return[r,null];const d=Math.floor(s/2);return[[r[0],r[0]+d],[r[0]+d,r[1]]]}if(s===1)return[r,null];const l=Math.floor(s/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}function rd(r,e){if(!Ka(e,r.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)hc(s,r[l]);return s}function id(r){const e=[1/0,1/0,-1/0,-1/0];for(const s of r)for(const l of s)hc(e,l);return e}function ou(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function ad(r,e,s){if(!ou(r)||!ou(e))return NaN;let l=0,d=0;return r[2]<e[0]&&(l=e[0]-r[2]),r[0]>e[2]&&(l=r[0]-e[2]),r[1]>e[3]&&(d=r[1]-e[3]),r[3]<e[1]&&(d=e[1]-r[3]),s.distance([0,0],[l,d])}function Ja(r,e,s){const l=s.pointOnLine(e,r);return s.distance(r,l.point)}function lu(r,e,s,l,d){const g=Math.min(Ja(r,[s,l],d),Ja(e,[s,l],d)),y=Math.min(Ja(s,[r,e],d),Ja(l,[r,e],d));return Math.min(g,y)}function cu(r,e,s,l,d){if(!Ka(e,r.length)||!Ka(l,s.length))return 1/0;let g=1/0;for(let y=e[0];y<e[1];++y){const w=r[y],N=r[y+1];for(let A=l[0];A<l[1];++A){const R=s[A],I=s[A+1];if(tu(w,N,R,I))return 0;g=Math.min(g,lu(w,N,R,I,d))}}return g}function nd(r,e,s,l,d){if(!Ka(e,r.length)||!Ka(l,s.length))return NaN;let g=1/0;for(let y=e[0];y<=e[1];++y)for(let w=l[0];w<=l[1];++w)if(g=Math.min(g,d.distance(r[y],s[w])),g===0)return g;return g}function Df(r,e,s){if(yn(r,e,!0))return 0;let l=1/0;for(const d of e){const g=d[0],y=d[d.length-1];if(g!==y&&(l=Math.min(l,Ja(r,[y,g],s)),l===0))return l;const w=s.pointOnLine(d,r);if(l=Math.min(l,s.distance(r,w.point)),l===0)return l}return l}function xl(r,e,s,l){if(!Ka(e,r.length))return NaN;for(let g=e[0];g<=e[1];++g)if(yn(r[g],s,!0))return 0;let d=1/0;for(let g=e[0];g<e[1];++g){const y=r[g],w=r[g+1];for(const N of s)for(let A=0,R=N.length,I=R-1;A<R;I=A++){const B=N[I],$=N[A];if(tu(y,w,B,$))return 0;d=Math.min(d,lu(y,w,B,$,l))}}return d}function _l(r,e){for(const s of r)for(const l of s)if(yn(l,e,!0))return!0;return!1}function nh(r,e,s,l=1/0){const d=id(r),g=id(e);if(l!==1/0&&ad(d,g,s)>=l)return l;if(Oo(d,g)){if(_l(r,e))return 0}else if(_l(e,r))return 0;let y=1/0;for(const w of r)for(let N=0,A=w.length,R=A-1;N<A;R=N++){const I=w[R],B=w[N];for(const $ of e)for(let W=0,X=$.length,te=X-1;W<X;te=W++){const oe=$[te],be=$[W];if(tu(I,B,oe,be))return 0;y=Math.min(y,lu(I,B,oe,be,s))}}return y}function Ws(r,e,s,l,d,g){if(!g)return;const y=ad(rd(l,g),d,s);y<e&&r.push([y,g,[0,0]])}function On(r,e,s,l,d,g,y){if(!g||!y)return;const w=ad(rd(l,g),rd(d,y),s);w<e&&r.push([w,g,y])}function uu(r,e,s,l,d=1/0){let g=Math.min(l.distance(r[0],s[0][0]),d);if(g===0)return g;const y=new rh([[0,[0,r.length-1],[0,0]]],aa),w=id(s);for(;y.length>0;){const N=y.pop();if(N[0]>=g)continue;const A=N[1],R=e?50:100;if(Fo(A)<=R){if(!Ka(A,r.length))return NaN;if(e){const I=xl(r,A,s,l);if(isNaN(I)||I===0)return I;g=Math.min(g,I)}else for(let I=A[0];I<=A[1];++I){const B=Df(r[I],s,l);if(g=Math.min(g,B),g===0)return 0}}else{const I=nu(A,e);Ws(y,g,l,r,w,I[0]),Ws(y,g,l,r,w,I[1])}}return g}function du(r,e,s,l,d,g=1/0){let y=Math.min(g,d.distance(r[0],s[0]));if(y===0)return y;const w=new rh([[0,[0,r.length-1],[0,s.length-1]]],aa);for(;w.length>0;){const N=w.pop();if(N[0]>=y)continue;const A=N[1],R=N[2],I=e?50:100,B=l?50:100;if(Fo(A)<=I&&Fo(R)<=B){if(!Ka(A,r.length)&&Ka(R,s.length))return NaN;let $;if(e&&l)$=cu(r,A,s,R,d),y=Math.min(y,$);else if(e&&!l){const W=r.slice(A[0],A[1]+1);for(let X=R[0];X<=R[1];++X)if($=Ja(s[X],W,d),y=Math.min(y,$),y===0)return y}else if(!e&&l){const W=s.slice(R[0],R[1]+1);for(let X=A[0];X<=A[1];++X)if($=Ja(r[X],W,d),y=Math.min(y,$),y===0)return y}else $=nd(r,A,s,R,d),y=Math.min(y,$)}else{const $=nu(A,e),W=nu(R,l);On(w,y,d,r,s,$[0],W[0]),On(w,y,d,r,s,$[0],W[1]),On(w,y,d,r,s,$[1],W[0]),On(w,y,d,r,s,$[1],W[1])}}return y}function od(r){return r.type==="MultiPolygon"?r.coordinates.map((e=>({type:"Polygon",coordinates:e}))):r.type==="MultiLineString"?r.coordinates.map((e=>({type:"LineString",coordinates:e}))):r.type==="MultiPoint"?r.coordinates.map((e=>({type:"Point",coordinates:e}))):[r]}class vl{constructor(e,s){this.type=Ct,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(In(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new vl(l,l.features.map((d=>od(d.geometry))).flat());if(l.type==="Feature")return new vl(l,od(l.geometry));if("type"in l&&"coordinates"in l)return new vl(l,od(l))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(s,l){const d=s.geometry(),g=d.flat().map((N=>dc([N.x,N.y],s.canonical)));if(d.length===0)return NaN;const y=new ah(g[0][1]);let w=1/0;for(const N of l){switch(N.type){case"Point":w=Math.min(w,du(g,!1,[N.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,du(g,!1,N.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,uu(g,!1,N.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="LineString")return(function(s,l){const d=s.geometry(),g=d.flat().map((N=>dc([N.x,N.y],s.canonical)));if(d.length===0)return NaN;const y=new ah(g[0][1]);let w=1/0;for(const N of l){switch(N.type){case"Point":w=Math.min(w,du(g,!0,[N.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,du(g,!0,N.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,uu(g,!0,N.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(s,l){const d=s.geometry();if(d.length===0||d[0].length===0)return NaN;const g=iu(d,0).map((N=>N.map((A=>A.map((R=>dc([R.x,R.y],s.canonical))))))),y=new ah(g[0][0][0][1]);let w=1/0;for(const N of l)for(const A of g){switch(N.type){case"Point":w=Math.min(w,uu([N.coordinates],!1,A,y,w));break;case"LineString":w=Math.min(w,uu(N.coordinates,!0,A,y,w));break;case"Polygon":w=Math.min(w,nh(A,N.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class hu{constructor(e){this.type=ds,this.key=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?s.error("Global state property must be defined."):typeof l!="string"?s.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new hu(l)}evaluate(e){var s;const l=(s=e.globals)===null||s===void 0?void 0:s.globalState;return l&&Object.keys(l).length!==0?ic(l,this.key):null}eachChild(){}outputDefined(){return!1}}const pc={"==":Sf,"!=":Ju,">":am,"<":jf,">=":Qu,"<=":nc,array:Wi,at:As,boolean:Wi,case:Xc,coalesce:gl,collator:oc,format:eu,image:lc,in:ms,"index-of":ml,interpolate:Xi,"interpolate-hcl":Xi,"interpolate-lab":Xi,length:cc,let:nr,literal:Sa,match:Bs,number:Wi,"number-format":sh,object:Wi,slice:Xa,step:zo,string:Wi,"to-boolean":Yi,"to-color":Yi,"to-number":Yi,"to-string":Yi,var:Ro,within:Lo,distance:vl,"global-state":hu};class ja{constructor(e,s,l,d){this.name=e,this.type=s,this._evaluate=l,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,s){const l=e[0],d=ja.definitions[l];if(!d)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=y.filter((([A])=>!Array.isArray(A)||A.length===e.length-1));let N=null;for(const[A,R]of w){N=new pl(s.registry,Ki,s.path,null,s.scope);const I=[];let B=!1;for(let $=1;$<e.length;$++){const W=e[$],X=Array.isArray(A)?A[$-1]:A.type,te=N.parse(W,1+I.length,X);if(!te){B=!0;break}I.push(te)}if(!B)if(Array.isArray(A)&&A.length!==I.length)N.error(`Expected ${A.length} arguments, but found ${I.length} instead.`);else{for(let $=0;$<I.length;$++){const W=Array.isArray(A)?A[$]:A.type,X=I[$];N.concat($+1).checkSubtype(W,X.type)}if(N.errors.length===0)return new ja(l,g,R,I)}}if(w.length===1)s.errors.push(...N.errors);else{const A=(w.length?w:y).map((([I])=>{return B=I,Array.isArray(B)?`(${B.map(Ht).join(", ")})`:`(${Ht(B.type)}...)`;var B})).join(" | "),R=[];for(let I=1;I<e.length;I++){const B=s.parse(e[I],1+R.length);if(!B)return null;R.push(Ht(B.type))}s.error(`Expected arguments of type ${A}, but found (${R.join(", ")}) instead.`)}return null}static register(e,s){ja.definitions=s;for(const l in s)e[l]=ja}}function oh(r,[e,s,l,d]){e=e.evaluate(r),s=s.evaluate(r),l=l.evaluate(r);const g=d?d.evaluate(r):1,y=wa(e,s,l,g);if(y)throw new ur(y);return new _s(e/255,s/255,l/255,g,!1)}function ld(r,e){return r in e}function Ta(r,e){const s=e[r];return s===void 0?null:s}function Ln(r){return{type:r}}function Ki(r){if(r instanceof Ro)return Ki(r.boundExpression);if(r instanceof ja&&r.name==="error"||r instanceof oc||r instanceof Lo||r instanceof vl||r instanceof hu)return!1;const e=r instanceof Yi||r instanceof Wi;let s=!0;return r.eachChild((l=>{s=e?s&&Ki(l):s&&l instanceof Sa})),!!s&&lo(r)&&wl(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function lo(r){if(r instanceof ja&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Lo||r instanceof vl)return!1;let e=!0;return r.eachChild((s=>{e&&!lo(s)&&(e=!1)})),e}function bl(r){if(r instanceof ja&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((s=>{e&&!bl(s)&&(e=!1)})),e}function wl(r,e){if(r instanceof ja&&e.indexOf(r.name)>=0)return!1;let s=!0;return r.eachChild((l=>{s&&!wl(l,e)&&(s=!1)})),s}function fu(r){return{result:"success",value:r}}function Uo(r){return{result:"error",value:r}}function Qa(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function lh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function mc(r){return!!r.expression&&r.expression.interpolated}function gs(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function cd(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Ar(r)===va}function Na(r){return r}function ud(r,e){const s=r.stops&&typeof r.stops[0][0]=="object",l=s||!(s||r.property!==void 0),d=r.type||(mc(e)?"exponential":"interval"),g=(function(R){switch(R.type){case"color":return _s.parse;case"padding":return ti.parse;case"numberArray":return Cr.parse;case"colorArray":return ns.parse;default:return null}})(e);if(g&&((r=Ps({},r)).stops&&(r.stops=r.stops.map((R=>[R[0],g(R[1])]))),r.default=g(r.default?r.default:e.default)),r.colorSpace&&(y=r.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var y;const w=(function(R){switch(R){case"exponential":return $o;case"interval":return dd;case"categorical":return Rf;case"identity":return ch;default:throw new Error(`Unknown function type "${R}"`)}})(d);let N,A;if(d==="categorical"){N=Object.create(null);for(const R of r.stops)N[R[0]]=R[1];A=typeof r.stops[0][0]}if(s){const R={},I=[];for(let W=0;W<r.stops.length;W++){const X=r.stops[W],te=X[0].zoom;R[te]===void 0&&(R[te]={zoom:te,type:r.type,property:r.property,default:r.default,stops:[]},I.push(te)),R[te].stops.push([X[0].value,X[1]])}const B=[];for(const W of I)B.push([R[W].zoom,ud(R[W],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Xi.interpolationFactor.bind(void 0,$),zoomStops:B.map((W=>W[0])),evaluate:({zoom:W},X)=>$o({stops:B,base:r.base},e,W).evaluate(W,X)}}if(l){const R=d==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Xi.interpolationFactor.bind(void 0,R),zoomStops:r.stops.map((I=>I[0])),evaluate:({zoom:I})=>w(r,e,I,N,A)}}return{kind:"source",evaluate(R,I){const B=I&&I.properties?I.properties[r.property]:void 0;return B===void 0?Ea(r.default,e.default):w(r,e,B,N,A)}}}function Ea(r,e,s){return r!==void 0?r:e!==void 0?e:s!==void 0?s:void 0}function Rf(r,e,s,l,d){return Ea(typeof s===d?l[s]:void 0,r.default,e.default)}function dd(r,e,s){if(gs(s)!=="number")return Ea(r.default,e.default);const l=r.stops.length;if(l===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[l-1][0])return r.stops[l-1][1];const d=Io(r.stops.map((g=>g[0])),s);return r.stops[d][1]}function $o(r,e,s){const l=r.base!==void 0?r.base:1;if(gs(s)!=="number")return Ea(r.default,e.default);const d=r.stops.length;if(d===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[d-1][0])return r.stops[d-1][1];const g=Io(r.stops.map((R=>R[0])),s),y=(function(R,I,B,$){const W=$-B,X=R-B;return W===0?0:I===1?X/W:(Math.pow(I,X)-1)/(Math.pow(I,W)-1)})(s,l,r.stops[g][0],r.stops[g+1][0]),w=r.stops[g][1],N=r.stops[g+1][1],A=kr[e.type]||Na;return typeof w.evaluate=="function"?{evaluate(...R){const I=w.evaluate.apply(void 0,R),B=N.evaluate.apply(void 0,R);if(I!==void 0&&B!==void 0)return A(I,B,y,r.colorSpace)}}:A(w,N,y,r.colorSpace)}function ch(r,e,s){switch(e.type){case"color":s=_s.parse(s);break;case"formatted":s=pi.fromString(s.toString());break;case"resolvedImage":s=Zi.fromString(s.toString());break;case"padding":s=ti.parse(s);break;case"colorArray":s=ns.parse(s);break;case"numberArray":s=Cr.parse(s);break;default:gs(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0)}return Ea(s,r.default,e.default)}ja.register(pc,{error:[{kind:"error"},[is],(r,[e])=>{throw new ur(e.evaluate(r))}],typeof:[is,[ds],(r,[e])=>Ht(Ar(e.evaluate(r)))],"to-rgba":[Gt(Ct,4),[ra],(r,[e])=>{const[s,l,d,g]=e.evaluate(r).rgb;return[255*s,255*l,255*d,g]}],rgb:[ra,[Ct,Ct,Ct],oh],rgba:[ra,[Ct,Ct,Ct,Ct],oh],has:{type:es,overloads:[[[is],(r,[e])=>ld(e.evaluate(r),r.properties())],[[is,va],(r,[e,s])=>ld(e.evaluate(r),s.evaluate(r))]]},get:{type:ds,overloads:[[[is],(r,[e])=>Ta(e.evaluate(r),r.properties())],[[is,va],(r,[e,s])=>Ta(e.evaluate(r),s.evaluate(r))]]},"feature-state":[ds,[is],(r,[e])=>Ta(e.evaluate(r),r.featureState||{})],properties:[va,[],r=>r.properties()],"geometry-type":[is,[],r=>r.geometryType()],id:[ds,[],r=>r.id()],zoom:[Ct,[],r=>r.globals.zoom],"heatmap-density":[Ct,[],r=>r.globals.heatmapDensity||0],elevation:[Ct,[],r=>r.globals.elevation||0],"line-progress":[Ct,[],r=>r.globals.lineProgress||0],accumulated:[ds,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ct,Ln(Ct),(r,e)=>{let s=0;for(const l of e)s+=l.evaluate(r);return s}],"*":[Ct,Ln(Ct),(r,e)=>{let s=1;for(const l of e)s*=l.evaluate(r);return s}],"-":{type:Ct,overloads:[[[Ct,Ct],(r,[e,s])=>e.evaluate(r)-s.evaluate(r)],[[Ct],(r,[e])=>-e.evaluate(r)]]},"/":[Ct,[Ct,Ct],(r,[e,s])=>e.evaluate(r)/s.evaluate(r)],"%":[Ct,[Ct,Ct],(r,[e,s])=>e.evaluate(r)%s.evaluate(r)],ln2:[Ct,[],()=>Math.LN2],pi:[Ct,[],()=>Math.PI],e:[Ct,[],()=>Math.E],"^":[Ct,[Ct,Ct],(r,[e,s])=>Math.pow(e.evaluate(r),s.evaluate(r))],sqrt:[Ct,[Ct],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Ct,[Ct],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Ct,[Ct],(r,[e])=>Math.log(e.evaluate(r))],log2:[Ct,[Ct],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Ct,[Ct],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Ct,[Ct],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Ct,[Ct],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Ct,[Ct],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Ct,[Ct],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Ct,[Ct],(r,[e])=>Math.atan(e.evaluate(r))],min:[Ct,Ln(Ct),(r,e)=>Math.min(...e.map((s=>s.evaluate(r))))],max:[Ct,Ln(Ct),(r,e)=>Math.max(...e.map((s=>s.evaluate(r))))],abs:[Ct,[Ct],(r,[e])=>Math.abs(e.evaluate(r))],round:[Ct,[Ct],(r,[e])=>{const s=e.evaluate(r);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ct,[Ct],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Ct,[Ct],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[es,[is,ds],(r,[e,s])=>r.properties()[e.value]===s.value],"filter-id-==":[es,[ds],(r,[e])=>r.id()===e.value],"filter-type-==":[es,[is],(r,[e])=>r.geometryType()===e.value],"filter-<":[es,[is,ds],(r,[e,s])=>{const l=r.properties()[e.value],d=s.value;return typeof l==typeof d&&l<d}],"filter-id-<":[es,[ds],(r,[e])=>{const s=r.id(),l=e.value;return typeof s==typeof l&&s<l}],"filter->":[es,[is,ds],(r,[e,s])=>{const l=r.properties()[e.value],d=s.value;return typeof l==typeof d&&l>d}],"filter-id->":[es,[ds],(r,[e])=>{const s=r.id(),l=e.value;return typeof s==typeof l&&s>l}],"filter-<=":[es,[is,ds],(r,[e,s])=>{const l=r.properties()[e.value],d=s.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[es,[ds],(r,[e])=>{const s=r.id(),l=e.value;return typeof s==typeof l&&s<=l}],"filter->=":[es,[is,ds],(r,[e,s])=>{const l=r.properties()[e.value],d=s.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[es,[ds],(r,[e])=>{const s=r.id(),l=e.value;return typeof s==typeof l&&s>=l}],"filter-has":[es,[ds],(r,[e])=>e.value in r.properties()],"filter-has-id":[es,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[es,[Gt(is)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[es,[Gt(ds)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[es,[is,Gt(ds)],(r,[e,s])=>s.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[es,[is,Gt(ds)],(r,[e,s])=>(function(l,d,g,y){for(;g<=y;){const w=g+y>>1;if(d[w]===l)return!0;d[w]>l?y=w-1:g=w+1}return!1})(r.properties()[e.value],s.value,0,s.value.length-1)],all:{type:es,overloads:[[[es,es],(r,[e,s])=>e.evaluate(r)&&s.evaluate(r)],[Ln(es),(r,e)=>{for(const s of e)if(!s.evaluate(r))return!1;return!0}]]},any:{type:es,overloads:[[[es,es],(r,[e,s])=>e.evaluate(r)||s.evaluate(r)],[Ln(es),(r,e)=>{for(const s of e)if(s.evaluate(r))return!0;return!1}]]},"!":[es,[es],(r,[e])=>!e.evaluate(r)],"is-supported-script":[es,[is],(r,[e])=>{const s=r.globals&&r.globals.isSupportedScript;return!s||s(e.evaluate(r))}],upcase:[is,[is],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[is,[is],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[is,Ln(ds),(r,e)=>e.map((s=>Do(s.evaluate(r)))).join("")],"resolved-locale":[is,[no],(r,[e])=>e.evaluate(r).resolvedLocale()]});class hd{constructor(e,s,l){this.expression=e,this._warningHistory={},this._evaluator=new fl,this._defaultValue=s?(function(d){if(d.type==="color"&&cd(d.default))return new _s(0,0,0,0);switch(d.type){case"color":return _s.parse(d.default)||null;case"padding":return ti.parse(d.default)||null;case"numberArray":return Cr.parse(d.default)||null;case"colorArray":return ns.parse(d.default)||null;case"variableAnchorOffsetCollection":return Ur.parse(d.default)||null;case"projectionDefinition":return mi.parse(d.default)||null;default:return d.default===void 0?null:d.default}})(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,s,l,d,g,y){return this._globalState&&(e=bi(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,s,l,d,g,y){this._globalState&&(e=bi(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map((N=>JSON.stringify(N))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Vo(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in pc}function gc(r,e,s){const l=new pl(pc,Ki,[],e?(function(g){const y={color:ra,string:is,number:Ct,enum:is,boolean:es,formatted:ba,padding:Za,numberArray:xe,colorArray:hi,projectionDefinition:rc,resolvedImage:Pt,variableAnchorOffsetCollection:Ft};return g.type==="array"?Gt(y[g.value]||ds,g.length):y[g.type]})(e):void 0),d=l.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?fu(new hd(d,e,s)):Uo(l.errors)}class Ji{constructor(e,s,l){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!bl(s.expression),this.globalStateRefs=gi(s.expression),this._globalState=l}evaluateWithoutErrorHandling(e,s,l,d,g,y){return this._globalState&&(e=bi(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,s,l,d,g,y)}evaluate(e,s,l,d,g,y){return this._globalState&&(e=bi(e,this._globalState)),this._styleExpression.evaluate(e,s,l,d,g,y)}}class qo{constructor(e,s,l,d,g){this.kind=e,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!bl(s.expression),this.globalStateRefs=gi(s.expression),this.interpolationType=d,this._globalState=g}evaluateWithoutErrorHandling(e,s,l,d,g,y){return this._globalState&&(e=bi(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,s,l,d,g,y)}evaluate(e,s,l,d,g,y){return this._globalState&&(e=bi(e,this._globalState)),this._styleExpression.evaluate(e,s,l,d,g,y)}interpolationFactor(e,s,l){return this.interpolationType?Xi.interpolationFactor(this.interpolationType,e,s,l):0}}function Go(r,e,s){const l=gc(r,e,s);if(l.result==="error")return l;const d=l.value.expression,g=lo(d);if(!g&&!Qa(e))return Uo([new Ks("","data expressions not supported")]);const y=wl(d,["zoom"]);if(!y&&!lh(e))return Uo([new Ks("","zoom expressions not supported")]);const w=Ho(d);return w||y?w instanceof Ks?Uo([w]):w instanceof Xi&&!mc(e)?Uo([new Ks("",'"interpolate" expressions cannot be used with this property')]):fu(w?new qo(g?"camera":"composite",l.value,w.labels,w instanceof Xi?w.interpolation:void 0,s):new Ji(g?"constant":"source",l.value,s)):Uo([new Ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Sl{constructor(e,s){this._parameters=e,this._specification=s,Ps(this,ud(this._parameters,this._specification))}static deserialize(e){return new Sl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ho(r){let e=null;if(r instanceof nr)e=Ho(r.result);else if(r instanceof gl){for(const s of r.args)if(e=Ho(s),e)break}else(r instanceof zo||r instanceof Xi)&&r.input instanceof ja&&r.input.name==="zoom"&&(e=r);return e instanceof Ks||r.eachChild((s=>{const l=Ho(s);l instanceof Ks?e=l:!e&&l?e=new Ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Ks("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function gi(r,e=new Set){return r instanceof hu&&e.add(r.key),r.eachChild((s=>{gi(s,e)})),e}function bi(r,e){const{zoom:s,heatmapDensity:l,elevation:d,lineProgress:g,isSupportedScript:y,accumulated:w}=r??{};return{zoom:s,heatmapDensity:l,elevation:d,lineProgress:g,isSupportedScript:y,accumulated:w,globalState:e}}function Bn(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Bn(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Fn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function na(r,e){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Bn(r)||(r=jl(r));const s=gc(r,Fn,e);if(s.result==="error")throw new Error(s.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,d,g)=>s.value.evaluate(l,d,{},g),needGeometry:uh(r),getGlobalStateRefs:()=>gi(s.value.expression)}}function co(r,e){return r<e?-1:r>e?1:0}function uh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(uh(r[e]))return!0;return!1}function jl(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?yc(r[1],r[2],"=="):e==="!="?dr(yc(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?yc(r[1],r[2],e):e==="any"?(s=r.slice(1),["any"].concat(s.map(jl))):e==="all"?["all"].concat(r.slice(1).map(jl)):e==="none"?["all"].concat(r.slice(1).map(jl).map(dr)):e==="in"?dh(r[1],r.slice(2)):e==="!in"?dr(dh(r[1],r.slice(2))):e==="has"?wi(r[1]):e!=="!has"||dr(wi(r[1]));var s}function yc(r,e,s){switch(r){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,r,e]}}function dh(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((s=>typeof s!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(co)]]:["filter-in-small",r,["literal",e]]}}function wi(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function dr(r){return["!",r]}function zs(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let d="[";for(const g of r)d+=`${zs(g)},`;return`${d}]`}const s=Object.keys(r).sort();let l="{";for(let d=0;d<s.length;d++)l+=`${JSON.stringify(s[d])}:${zs(r[s[d]])},`;return`${l}}`}function uo(r){let e="";for(const s of Vt)e+=`/${zs(r[s])}`;return e}function Ca(r){const e=r.value;return e?[new Nt(r.key,e,"constants have been deprecated as of v8")]:[]}function Ir(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function oa(r){if(Array.isArray(r))return r.map(oa);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const s in r)e[s]=oa(r[s]);return e}return Ir(r)}function la(r){const e=r.key,s=r.value,l=r.valueSpec||{},d=r.objectElementValidators||{},g=r.style,y=r.styleSpec,w=r.validateSpec;let N=[];const A=gs(s);if(A!=="object")return[new Nt(e,s,`object expected, ${A} found`)];for(const R in s){const I=R.split(".")[0],B=ic(l,I)||l["*"];let $;if(ic(d,I))$=d[I];else if(ic(l,I)){if(s[R]===void 0)continue;$=w}else if(d["*"])$=d["*"];else{if(!l["*"]){N.push(new Nt(e,s[R],`unknown property "${R}"`));continue}$=w}N=N.concat($({key:(e&&`${e}.`)+R,value:s[R],valueSpec:B,style:g,styleSpec:y,object:s,objectKey:R,validateSpec:w},s))}for(const R in l)d[R]||l[R].required&&l[R].default===void 0&&s[R]===void 0&&N.push(new Nt(e,s,`missing required property "${R}"`));return N}function pu(r){const e=r.value,s=r.valueSpec,l=r.style,d=r.styleSpec,g=r.key,y=r.arrayElementValidator||r.validateSpec;if(gs(e)!=="array")return[new Nt(g,e,`array expected, ${gs(e)} found`)];if(s.length&&e.length!==s.length)return[new Nt(g,e,`array length ${s.length} expected, length ${e.length} found`)];let w={type:s.value,values:s.values};d.$version<7&&(w.function=s.function),gs(s.value)==="object"&&(w=s.value);let N=[];for(let A=0;A<e.length;A++)N=N.concat(y({array:e,arrayIndex:A,value:e[A],valueSpec:w,validateSpec:r.validateSpec,style:l,styleSpec:d,key:`${g}[${A}]`}));return N}function Un(r){const e=r.key,s=r.value,l=r.valueSpec;let d=gs(s);return d==="number"&&s!=s&&(d="NaN"),d!=="number"?[new Nt(e,s,`number expected, ${d} found`)]:"minimum"in l&&s<l.minimum?[new Nt(e,s,`${s} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&s>l.maximum?[new Nt(e,s,`${s} is greater than the maximum value ${l.maximum}`)]:[]}function $n(r){const e=r.valueSpec,s=Ir(r.value.type);let l,d,g,y={};const w=s!=="categorical"&&r.value.property===void 0,N=!w,A=gs(r.value.stops)==="array"&&gs(r.value.stops[0])==="array"&&gs(r.value.stops[0][0])==="object",R=la({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function($){if(s==="identity")return[new Nt($.key,$.value,'identity function may not have a "stops" property')];let W=[];const X=$.value;return W=W.concat(pu({key:$.key,value:X,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:I})),gs(X)==="array"&&X.length===0&&W.push(new Nt($.key,X,"array must have at least one stop")),W},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return s==="identity"&&w&&R.push(new Nt(r.key,r.value,'missing required property "property"')),s==="identity"||r.value.stops||R.push(new Nt(r.key,r.value,'missing required property "stops"')),s==="exponential"&&r.valueSpec.expression&&!mc(r.valueSpec)&&R.push(new Nt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(N&&!Qa(r.valueSpec)?R.push(new Nt(r.key,r.value,"property functions not supported")):w&&!lh(r.valueSpec)&&R.push(new Nt(r.key,r.value,"zoom functions not supported"))),s!=="categorical"&&!A||r.value.property!==void 0||R.push(new Nt(r.key,r.value,'"property" property is required')),R;function I($){let W=[];const X=$.value,te=$.key;if(gs(X)!=="array")return[new Nt(te,X,`array expected, ${gs(X)} found`)];if(X.length!==2)return[new Nt(te,X,`array length 2 expected, length ${X.length} found`)];if(A){if(gs(X[0])!=="object")return[new Nt(te,X,`object expected, ${gs(X[0])} found`)];if(X[0].zoom===void 0)return[new Nt(te,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new Nt(te,X,"object stop key must have value")];if(g&&g>Ir(X[0].zoom))return[new Nt(te,X[0].zoom,"stop zoom values must appear in ascending order")];Ir(X[0].zoom)!==g&&(g=Ir(X[0].zoom),d=void 0,y={}),W=W.concat(la({key:`${te}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Un,value:B}}))}else W=W.concat(B({key:`${te}[0]`,value:X[0],validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},X));return Vo(oa(X[1]))?W.concat([new Nt(`${te}[1]`,X[1],"expressions are not allowed in function stops.")]):W.concat($.validateSpec({key:`${te}[1]`,value:X[1],valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function B($,W){const X=gs($.value),te=Ir($.value),oe=$.value!==null?$.value:W;if(l){if(X!==l)return[new Nt($.key,oe,`${X} stop domain type must match previous stop domain type ${l}`)]}else l=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new Nt($.key,oe,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&s!=="categorical"){let be=`number expected, ${X} found`;return Qa(e)&&s===void 0&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt($.key,oe,be)]}return s!=="categorical"||X!=="number"||isFinite(te)&&Math.floor(te)===te?s!=="categorical"&&X==="number"&&d!==void 0&&te<d?[new Nt($.key,oe,"stop domain values must appear in ascending order")]:(d=te,s==="categorical"&&te in y?[new Nt($.key,oe,"stop domain values must be unique")]:(y[te]=!0,[])):[new Nt($.key,oe,`integer expected, found ${te}`)]}}function Vn(r){const e=(r.expressionContext==="property"?Go:gc)(oa(r.value),r.valueSpec);if(e.result==="error")return e.value.map((l=>new Nt(`${r.key}${l.key}`,r.value,l.message)));const s=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!s.outputDefined())return[new Nt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!bl(s))return[new Nt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!bl(s))return[new Nt(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!wl(s,["zoom","feature-state"]))return[new Nt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!lo(s))return[new Nt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ho(r){const e=r.key,s=r.value,l=gs(s);return l!=="string"?[new Nt(e,s,`color expected, ${l} found`)]:_s.parse(String(s))?[]:[new Nt(e,s,`color expected, "${s}" found`)]}function fo(r){const e=r.key,s=r.value,l=r.valueSpec,d=[];return Array.isArray(l.values)?l.values.indexOf(Ir(s))===-1&&d.push(new Nt(e,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(l.values).indexOf(Ir(s))===-1&&d.push(new Nt(e,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function en(r){return Bn(oa(r.value))?Vn(Ps({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):qn(r)}function qn(r){const e=r.value,s=r.key;if(gs(e)!=="array")return[new Nt(s,e,`array expected, ${gs(e)} found`)];const l=r.styleSpec;let d,g=[];if(e.length<1)return[new Nt(s,e,"filter array must have at least 1 element")];switch(g=g.concat(fo({key:`${s}[0]`,value:e[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ir(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ir(e[1])==="$type"&&g.push(new Nt(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Nt(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=gs(e[1]),d!=="string"&&g.push(new Nt(`${s}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=gs(e[y]),Ir(e[1])==="$type"?g=g.concat(fo({key:`${s}[${y}]`,value:e[y],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&g.push(new Nt(`${s}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)g=g.concat(qn({key:`${s}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":d=gs(e[1]),e.length!==2?g.push(new Nt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&g.push(new Nt(`${s}[1]`,e[1],`string expected, ${d} found`))}return g}function po(r,e){const s=r.key,l=r.validateSpec,d=r.style,g=r.styleSpec,y=r.value,w=r.objectKey,N=g[`${e}_${r.layerType}`];if(!N)return[];const A=w.match(/^(.*)-transition$/);if(e==="paint"&&A&&N[A[1]]&&N[A[1]].transition)return l({key:s,value:y,valueSpec:g.transition,style:d,styleSpec:g});const R=r.valueSpec||N[w];if(!R)return[new Nt(s,y,`unknown property "${w}"`)];let I;if(gs(y)==="string"&&Qa(R)&&!R.tokens&&(I=/^{([^}]+)}$/.exec(y)))return[new Nt(s,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const B=[];return r.layerType==="symbol"&&w==="text-font"&&cd(oa(y))&&Ir(y.type)==="identity"&&B.push(new Nt(s,y,'"text-font" does not support identity functions')),B.concat(l({key:r.key,value:y,valueSpec:R,style:d,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:w}))}function Gn(r){return po(r,"paint")}function fd(r){return po(r,"layout")}function pd(r){let e=[];const s=r.value,l=r.key,d=r.style,g=r.styleSpec;if(gs(s)!=="object")return[new Nt(l,s,`object expected, ${gs(s)} found`)];s.type||s.ref||e.push(new Nt(l,s,'either "type" or "ref" is required'));let y=Ir(s.type);const w=Ir(s.ref);if(s.id){const N=Ir(s.id);for(let A=0;A<r.arrayIndex;A++){const R=d.layers[A];Ir(R.id)===N&&e.push(new Nt(l,s.id,`duplicate layer id "${s.id}", previously used at line ${R.id.__line__}`))}}if("ref"in s){let N;["type","source","source-layer","filter","layout"].forEach((A=>{A in s&&e.push(new Nt(l,s[A],`"${A}" is prohibited for ref layers`))})),d.layers.forEach((A=>{Ir(A.id)===w&&(N=A)})),N?N.ref?e.push(new Nt(l,s.ref,"ref cannot reference another ref layer")):y=Ir(N.type):e.push(new Nt(l,s.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(s.source){const N=d.sources&&d.sources[s.source],A=N&&Ir(N.type);N?A==="vector"&&y==="raster"?e.push(new Nt(l,s.source,`layer "${s.id}" requires a raster source`)):A!=="raster-dem"&&y==="hillshade"||A!=="raster-dem"&&y==="color-relief"?e.push(new Nt(l,s.source,`layer "${s.id}" requires a raster-dem source`)):A==="raster"&&y!=="raster"?e.push(new Nt(l,s.source,`layer "${s.id}" requires a vector source`)):A!=="vector"||s["source-layer"]?A==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?e.push(new Nt(l,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!s.paint||!s.paint["line-gradient"]||A==="geojson"&&N.lineMetrics||e.push(new Nt(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Nt(l,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Nt(l,s.source,`source "${s.source}" not found`))}else e.push(new Nt(l,s,'missing required property "source"'));return e=e.concat(la({key:l,value:s,valueSpec:g.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${l}.type`,value:s.type,valueSpec:g.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:s,objectKey:"type"}),filter:en,layout:N=>la({layer:s,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,validateSpec:N.validateSpec,objectElementValidators:{"*":A=>fd(Ps({layerType:y},A))}}),paint:N=>la({layer:s,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,validateSpec:N.validateSpec,objectElementValidators:{"*":A=>Gn(Ps({layerType:y},A))}})}})),e}function Aa(r){const e=r.value,s=r.key,l=gs(e);return l!=="string"?[new Nt(s,e,`string expected, ${l} found`)]:[]}const xc={promoteId:function({key:r,value:e}){if(gs(e)==="string")return Aa({key:r,value:e});{const s=[];for(const l in e)s.push(...Aa({key:`${r}.${l}`,value:e[l]}));return s}}};function mo(r){const e=r.value,s=r.key,l=r.styleSpec,d=r.style,g=r.validateSpec;if(!e.type)return[new Nt(s,e,'"type" is required')];const y=Ir(e.type);let w;switch(y){case"vector":case"raster":return w=la({key:s,value:e,valueSpec:l[`source_${y.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:xc,validateSpec:g}),w;case"raster-dem":return w=(function(N){var A;const R=(A=N.sourceName)!==null&&A!==void 0?A:"",I=N.value,B=N.styleSpec,$=B.source_raster_dem,W=N.style;let X=[];const te=gs(I);if(I===void 0)return X;if(te!=="object")return X.push(new Nt("source_raster_dem",I,`object expected, ${te} found`)),X;const oe=Ir(I.encoding)==="custom",be=["redFactor","greenFactor","blueFactor","baseShift"],ne=N.value.encoding?`"${N.value.encoding}"`:"Default";for(const me in I)!oe&&be.includes(me)?X.push(new Nt(me,I[me],`In "${R}": "${me}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):$[me]?X=X.concat(N.validateSpec({key:me,value:I[me],valueSpec:$[me],validateSpec:N.validateSpec,style:W,styleSpec:B})):X.push(new Nt(me,I[me],`unknown property "${me}"`));return X})({sourceName:s,value:e,style:r.style,styleSpec:l,validateSpec:g}),w;case"geojson":if(w=la({key:s,value:e,valueSpec:l.source_geojson,style:d,styleSpec:l,validateSpec:g,objectElementValidators:xc}),e.cluster)for(const N in e.clusterProperties){const[A,R]=e.clusterProperties[N],I=typeof A=="string"?[A,["accumulated"],["get",N]]:A;w.push(...Vn({key:`${s}.${N}.map`,value:R,expressionContext:"cluster-map"})),w.push(...Vn({key:`${s}.${N}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return w;case"video":return la({key:s,value:e,valueSpec:l.source_video,style:d,validateSpec:g,styleSpec:l});case"image":return la({key:s,value:e,valueSpec:l.source_image,style:d,validateSpec:g,styleSpec:l});case"canvas":return[new Nt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fo({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function si(r){const e=r.value,s=r.styleSpec,l=s.light,d=r.style;let g=[];const y=gs(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new Nt("light",e,`object expected, ${y} found`)]),g;for(const w in e){const N=w.match(/^(.*)-transition$/);g=g.concat(N&&l[N[1]]&&l[N[1]].transition?r.validateSpec({key:w,value:e[w],valueSpec:s.transition,validateSpec:r.validateSpec,style:d,styleSpec:s}):l[w]?r.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:r.validateSpec,style:d,styleSpec:s}):[new Nt(w,e[w],`unknown property "${w}"`)])}return g}function mu(r){const e=r.value,s=r.styleSpec,l=s.sky,d=r.style,g=gs(e);if(e===void 0)return[];if(g!=="object")return[new Nt("sky",e,`object expected, ${g} found`)];let y=[];for(const w in e)y=y.concat(l[w]?r.validateSpec({key:w,value:e[w],valueSpec:l[w],style:d,styleSpec:s}):[new Nt(w,e[w],`unknown property "${w}"`)]);return y}function md(r){const e=r.value,s=r.styleSpec,l=s.terrain,d=r.style;let g=[];const y=gs(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new Nt("terrain",e,`object expected, ${y} found`)]),g;for(const w in e)g=g.concat(l[w]?r.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:r.validateSpec,style:d,styleSpec:s}):[new Nt(w,e[w],`unknown property "${w}"`)]);return g}function hh(r){let e=[];const s=r.value,l=r.key;if(Array.isArray(s)){const d=[],g=[];for(const y in s)s[y].id&&d.includes(s[y].id)&&e.push(new Nt(l,s,`all the sprites' ids must be unique, but ${s[y].id} is duplicated`)),d.push(s[y].id),s[y].url&&g.includes(s[y].url)&&e.push(new Nt(l,s,`all the sprites' URLs must be unique, but ${s[y].url} is duplicated`)),g.push(s[y].url),e=e.concat(la({key:`${l}[${y}]`,value:s[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return Aa({key:l,value:s})}function If(r){return!!r&&r.constructor===Object}function fh(r){return If(r.value)?[]:[new Nt(r.key,r.value,`object expected, ${gs(r.value)} found`)]}const Yr={"*":()=>[],array:pu,boolean:function(r){const e=r.value,s=r.key,l=gs(e);return l!=="boolean"?[new Nt(s,e,`boolean expected, ${l} found`)]:[]},number:Un,color:ho,constants:Ca,enum:fo,filter:en,function:$n,layer:pd,object:la,source:mo,light:si,sky:mu,terrain:md,projection:function(r){const e=r.value,s=r.styleSpec,l=s.projection,d=r.style,g=gs(e);if(e===void 0)return[];if(g!=="object")return[new Nt("projection",e,`object expected, ${g} found`)];let y=[];for(const w in e)y=y.concat(l[w]?r.validateSpec({key:w,value:e[w],valueSpec:l[w],style:d,styleSpec:s}):[new Nt(w,e[w],`unknown property "${w}"`)]);return y},projectionDefinition:function(r){const e=r.key;let s=r.value;s=s instanceof String?s.valueOf():s;const l=gs(s);return l!=="array"||(function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"})(s)||(function(d){return!!["interpolate","step","literal"].includes(d[0])})(s)?["array","string"].includes(l)?[]:[new Nt(e,s,`projection expected, invalid type "${l}" found`)]:[new Nt(e,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:Aa,formatted:function(r){return Aa(r).length===0?[]:Vn(r)},resolvedImage:function(r){return Aa(r).length===0?[]:Vn(r)},padding:function(r){const e=r.key,s=r.value;if(gs(s)==="array"){if(s.length<1||s.length>4)return[new Nt(e,s,`padding requires 1 to 4 values; ${s.length} values found`)];const l={type:"number"};let d=[];for(let g=0;g<s.length;g++)d=d.concat(r.validateSpec({key:`${e}[${g}]`,value:s[g],validateSpec:r.validateSpec,valueSpec:l}));return d}return Un({key:e,value:s,valueSpec:{}})},numberArray:function(r){const e=r.key,s=r.value;if(gs(s)==="array"){const l={type:"number"};if(s.length<1)return[new Nt(e,s,"array length at least 1 expected, length 0 found")];let d=[];for(let g=0;g<s.length;g++)d=d.concat(r.validateSpec({key:`${e}[${g}]`,value:s[g],validateSpec:r.validateSpec,valueSpec:l}));return d}return Un({key:e,value:s,valueSpec:{}})},colorArray:function(r){const e=r.key,s=r.value;if(gs(s)==="array"){if(s.length<1)return[new Nt(e,s,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<s.length;d++)l=l.concat(ho({key:`${e}[${d}]`,value:s[d]}));return l}return ho({key:e,value:s})},variableAnchorOffsetCollection:function(r){const e=r.key,s=r.value,l=gs(s),d=r.styleSpec;if(l!=="array"||s.length<1||s.length%2!=0)return[new Nt(e,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<s.length;y+=2)g=g.concat(fo({key:`${e}[${y}]`,value:s[y],valueSpec:d.layout_symbol["text-anchor"]})),g=g.concat(pu({key:`${e}[${y+1}]`,value:s[y+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:d}));return g},sprite:hh,state:fh,fontFaces:function(r){const e=r.key,s=r.value,l=r.validateSpec,d=r.styleSpec,g=r.style;if(!If(s))return[new Nt(e,s,`object expected, ${gs(s)} found`)];const y=[];for(const w in s){const N=s[w],A=gs(N);if(A==="string")y.push(...Aa({key:`${e}.${w}`,value:N}));else if(A==="array"){const R={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[I,B]of N.entries())y.push(...la({key:`${e}.${w}[${I}]`,value:B,valueSpec:R,styleSpec:d,style:g,validateSpec:l}))}else y.push(new Nt(`${e}.${w}`,N,`string or array expected, ${A} found`))}return y}};function Hn(r){const e=r.value,s=r.valueSpec,l=r.styleSpec;return r.validateSpec=Hn,s.expression&&cd(Ir(e))?$n(r):s.expression&&Vo(oa(e))?Vn(r):s.type&&Yr[s.type]?Yr[s.type](r):la(Ps({},r,{valueSpec:s.type?l[s.type]:s}))}function _c(r){const e=r.value,s=r.key,l=Aa(r);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Nt(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Nt(s,e,'"glyphs" url must include a "{range}" token'))),l}function Li(r,e=Te){let s=[];return s=s.concat(Hn({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:Hn,objectElementValidators:{glyphs:_c,"*":()=>[]}})),r.constants&&(s=s.concat(Ca({key:"constants",value:r.constants}))),Tl(s)}function ka(r){return function(e){return r(Object.assign({},e,{validateSpec:Hn}))}}function Tl(r){return[].concat(r).sort(((e,s)=>e.line-s.line))}function Bi(r){return function(...e){return Tl(r.apply(this,e))}}Li.source=Bi(ka(mo)),Li.sprite=Bi(ka(hh)),Li.glyphs=Bi(ka(_c)),Li.light=Bi(ka(si)),Li.sky=Bi(ka(mu)),Li.terrain=Bi(ka(md)),Li.state=Bi(ka(fh)),Li.layer=Bi(ka(pd)),Li.filter=Bi(ka(en)),Li.paintProperty=Bi(ka(Gn)),Li.layoutProperty=Bi(ka(fd));const om={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class vc{constructor(e,s){this._globalState=s,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const s=gc(e,om,this._globalState);if(s.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(s.value.map((l=>`${l.key}: ${l.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=s.value,this._globalStateRefs=gi(s.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const gu=Te,yi=Li,xn=yi.light,gd=yi.sky,yd=yi.paintProperty,zf=yi.layoutProperty;function _n(r,e){let s=!1;if(e&&e.length)for(const l of e)r.fire(new ot(new Error(l.message))),s=!0;return s}class Zo{constructor(e,s,l){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(s=y[1])+2*(l=y[2]);for(let N=0;N<this.d*this.d;N++){const A=y[3+N],R=y[3+N+1];d.push(A===R?null:y.subarray(A,R))}const w=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*l;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=e,this.padding=l,this.scale=s/e,this.uid=0;const g=l/s*e;this.min=-g,this.max=e+g}insert(e,s,l,d,g){this._forEachCell(s,l,d,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,s,l,d,g,y){this.cells[g].push(y)}query(e,s,l,d,g){const y=this.min,w=this.max;if(e<=y&&s<=y&&w<=l&&w<=d&&!g)return Array.prototype.slice.call(this.keys);{const N=[];return this._forEachCell(e,s,l,d,this._queryCell,N,{},g),N}}_queryCell(e,s,l,d,g,y,w,N){const A=this.cells[g];if(A!==null){const R=this.keys,I=this.bboxes;for(let B=0;B<A.length;B++){const $=A[B];if(w[$]===void 0){const W=4*$;(N?N(I[W+0],I[W+1],I[W+2],I[W+3]):e<=I[W+2]&&s<=I[W+3]&&l>=I[W+0]&&d>=I[W+1])?(w[$]=!0,y.push(R[$])):w[$]=!1}}}}_forEachCell(e,s,l,d,g,y,w,N){const A=this._convertToCellCoord(e),R=this._convertToCellCoord(s),I=this._convertToCellCoord(l),B=this._convertToCellCoord(d);for(let $=A;$<=I;$++)for(let W=R;W<=B;W++){const X=this.d*W+$;if((!N||N(this._convertFromCellCoord($),this._convertFromCellCoord(W),this._convertFromCellCoord($+1),this._convertFromCellCoord(W+1)))&&g.call(this,e,s,l,d,X,y,w,N))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,s=3+this.cells.length+1+1;let l=0;for(let y=0;y<this.cells.length;y++)l+=this.cells[y].length;const d=new Int32Array(s+l+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let g=s;for(let y=0;y<e.length;y++){const w=e[y];d[3+y]=g,d.set(w,g),g+=w.length}return d[3+e.length]=g,d.set(this.keys,g),g+=this.keys.length,d[3+e.length+1]=g,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer}static serialize(e,s){const l=e.toArrayBuffer();return s&&s.push(l),{buffer:l}}static deserialize(e){return new Zo(e.buffer)}}const ca={};function Ut(r,e,s={}){if(ca[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),ca[r]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Ut("Object",Object),Ut("Set",Set),Ut("TransferableGridIndex",Zo),Ut("Color",_s),Ut("Error",Error),Ut("AJAXError",U),Ut("ResolvedImage",Zi),Ut("StylePropertyFunction",Sl),Ut("StyleExpression",hd,{omit:["_evaluator"]}),Ut("ZoomDependentExpression",qo),Ut("ZoomConstantExpression",Ji),Ut("CompoundExpression",ja,{omit:["_evaluate"]});for(const r in pc)pc[r]._classRegistryKey||Ut(`Expression_${r}`,pc[r]);function yu(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function xd(r){return r.$name||r.constructor._classRegistryKey}function tn(r){return!(function(e){if(e===null||typeof e!="object")return!1;const s=xd(e);return!(!s||s==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||yu(r)||ar(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function vn(r,e){if(tn(r))return(yu(r)||ar(r))&&e&&e.push(r),ArrayBuffer.isView(r)&&e&&e.push(r.buffer),r instanceof ImageData&&e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const g=[];for(const y of r)g.push(vn(y,e));return g}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const s=xd(r);if(!s)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!ca[s])throw new Error(`${s} is not registered.`);const{klass:l}=ca[s],d=l.serialize?l.serialize(r,e):{};if(l.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in r){if(!r.hasOwnProperty(g)||ca[s].omit.indexOf(g)>=0)continue;const y=r[g];d[g]=ca[s].shallow.indexOf(g)>=0?y:vn(y,e)}r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(d.$name=s),d}function bc(r){if(tn(r))return r;if(Array.isArray(r))return r.map(bc);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const e=xd(r)||"Object";if(!ca[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:s}=ca[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(r);const l=Object.create(s.prototype);for(const d of Object.keys(r)){if(d==="$name")continue;const g=r[d];l[d]=ca[e].shallow.indexOf(d)>=0?g:bc(g)}return l}class _d{constructor(){this.first=!0}update(e,s){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function Zn(r){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function Nl(r){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function xu(r){return/\s/u.test(String.fromCodePoint(r))}function Wn(r){for(const e of r)if(Nl(e.codePointAt(0)))return!0;return!1}function vd(r){for(const e of r)if(!ph(e.codePointAt(0)))return!1;return!0}function _u(r){const e=r.map((s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}})).filter((s=>s));return new RegExp(e.join("|"),"u")}const Yn=_u(["Arab","Dupl","Mong","Ougr","Syrc"]);function ph(r){return!Yn.test(String.fromCodePoint(r))}function Xn(r){return!(Nl(r)||(e=r,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const bd=_u(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function vu(r){return bd.test(String.fromCodePoint(r))}function Kn(r,e){return!(!e&&vu(r)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(r)))}function go(r){for(const e of r)if(vu(e.codePointAt(0)))return!0;return!1}const sn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(sn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,e){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const s=r.pluginURL,l=new Promise((g=>{this.loadScriptResolve=g}));e(s);const d=new Promise((g=>setTimeout((()=>g()),this.TIMEOUT)));if(yield Promise.race([l,d]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:s};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)}))}};class sr{constructor(e,s){this.isSupportedScript=mh,this.zoom=e,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new _d,this.transition=s.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _d,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}function mh(r){return(function(e,s){for(const l of e)if(!Kn(l.codePointAt(0),s))return!1;return!0})(r,sn.getRTLTextPluginStatus()==="loaded")}const yo="-transition";class Wo{constructor(e,s,l){this.property=e,this.value=s,this.expression=(function(d,g,y){if(cd(d))return new Sl(d,g);if(Vo(d)){const w=Go(d,g,y);if(w.result==="error")throw new Error(w.value.map((N=>`${N.key}: ${N.message}`)).join(", "));return w.value}{let w=d;return g.type==="color"&&typeof d=="string"?w=_s.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?g.type!=="numberArray"||typeof d!="number"&&!Array.isArray(d)?g.type!=="colorArray"||typeof d!="string"&&!Array.isArray(d)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?w=Ur.parse(d):g.type==="projectionDefinition"&&typeof d=="string"&&(w=mi.parse(d)):w=ns.parse(d):w=Cr.parse(d):w=ti.parse(d),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>w}}})(s===void 0?e.specification.default:s,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,s,l){return this.property.possiblyEvaluate(this,e,s,l)}}class bu{constructor(e,s){this.property=e,this.value=new Wo(e,void 0,s)}transitioned(e,s){return new El(this.property,this.value,s,Dt({},e.transition,this.transition),e.now)}untransitioned(){return new El(this.property,this.value,null,{},0)}}class wd{constructor(e,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=s}getValue(e){return Es(this._values[e].value.value)}setValue(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new bu(this._values[e].property,this._globalState)),this._values[e].value=new Wo(this._values[e].property,s===null?void 0:Es(s),this._globalState)}getTransition(e){return Es(this._values[e].transition)}setTransition(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new bu(this._values[e].property,this._globalState)),this._values[e].transition=Es(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(e[s]=l);const d=this.getTransition(s);d!==void 0&&(e[`${s}${yo}`]=d)}return e}transitioned(e,s){const l=new wu(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(e,s._values[d]);return l}untransitioned(){const e=new wu(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class El{constructor(e,s,l,d,g){this.property=e,this.value=s,this.begin=g+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(e,s,l){const d=e.now||0,g=this.value.possiblyEvaluate(e,s,l),y=this.prior;if(y){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return y.possiblyEvaluate(e,s,l);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,s,l),g,nt(w))}}return g}}class wu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,l){const d=new Cl(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(e,s,l);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class gh{constructor(e,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=s}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Es(this._values[e].value)}setValue(e,s){this._values[e]=new Wo(this._values[e].property,s===null?void 0:Es(s),this._globalState)}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(e[s]=l)}return e}possiblyEvaluate(e,s,l){const d=new Cl(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(e,s,l);return d}}class Ma{constructor(e,s,l){this.property=e,this.value=s,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,l,d){return this.property.evaluate(this.value,this.parameters,e,s,l,d)}}class Cl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class $t{constructor(e){this.specification=e}possiblyEvaluate(e,s){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(s)}interpolate(e,s,l){const d=kr[this.specification.type];return d?d(e,s,l):e}}class Wt{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,l,d){return new Ma(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},l,d)}:e.expression,s)}interpolate(e,s,l){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Ma(this,{kind:"constant",value:void 0},e.parameters);const d=kr[this.specification.type];if(d){const g=d(e.value.value,s.value.value,l);return new Ma(this,{kind:"constant",value:g},e.parameters)}return e}evaluate(e,s,l,d,g,y){return e.kind==="constant"?e.value:e.evaluate(s,l,d,g,y)}}class rn extends Wt{possiblyEvaluate(e,s,l,d){if(e.value===void 0)return new Ma(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const g=e.expression.evaluate(s,null,{},l,d),y=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,w=this._calculate(y,y,y,s);return new Ma(this,{kind:"constant",value:w},s)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new Ma(this,{kind:"constant",value:g},s)}return new Ma(this,e.expression,s)}evaluate(e,s,l,d,g,y){if(e.kind==="source"){const w=e.evaluate(s,l,d,g,y);return this._calculate(w,w,w,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},l,d),e.evaluate({zoom:Math.floor(s.zoom)},l,d),e.evaluate({zoom:Math.floor(s.zoom)+1},l,d),s):e.value}_calculate(e,s,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:l,to:s}}interpolate(e){return e}}class wc{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(s,null,{},l,d);return this._calculate(g,g,g,s)}return this._calculate(e.expression.evaluate(new sr(Math.floor(s.zoom-1),s)),e.expression.evaluate(new sr(Math.floor(s.zoom),s)),e.expression.evaluate(new sr(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:l,to:s}}interpolate(e){return e}}class Su{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,d){return!!e.expression.evaluate(s,null,{},l,d)}interpolate(){return!1}}class Xr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new Wo(l,void 0,void 0),g=this.defaultTransitionablePropertyValues[s]=new bu(l,void 0);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}}}Ut("DataDrivenProperty",Wt),Ut("DataConstantProperty",$t),Ut("CrossFadedDataDrivenProperty",rn),Ut("CrossFadedProperty",wc),Ut("ColorRampProperty",Su);class zr extends rt{constructor(e,s,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(d,g){return new vc(d,g)})(this.visibility,l),e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=na(e.filter,l)),s.layout&&(this._unevaluatedLayout=new gh(s.layout,l)),s.paint)){this._transitionablePaint=new wd(s.paint,l);for(const d in e.paint)this.setPaintProperty(d,e.paint[d],{validate:!1});for(const d in e.layout)this.setLayoutProperty(d,e.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cl(s.paint)}}setFilter(e){this.filter=e,this._featureFilter=na(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const s of this._visibilityExpression.getGlobalStateRefs())e.add(s);if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[s];for(const d of l.getGlobalStateRefs())e.add(d)}for(const s of this._featureFilter.getGlobalStateRefs())e.add(s);return e}getPaintAffectingGlobalStateRefs(){var e;const s=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const d=this._transitionablePaint._values[l].value;for(const g of d.getGlobalStateRefs()){const y=(e=s.get(g))!==null&&e!==void 0?e:[];y.push({name:l,value:d.value}),s.set(g,y)}}return s}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,s,l={}){if(s==null||!this._validate(zf,`layers.${this.id}.layout.${e}`,e,s,l))return e==="visibility"?(this.visibility=s,this._visibilityExpression.setValue(s),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,s)}getPaintProperty(e){return e.endsWith(yo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,l={}){if(s!=null&&this._validate(yd,`layers.${this.id}.paint.${e}`,e,s,l))return!1;if(e.endsWith(yo))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{const d=this._transitionablePaint._values[e],g=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),w=d.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const N=this._transitionablePaint._values[e].value;return N.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(e,w,N)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,s,l){return!1}isHidden(e=this.minzoom,s=!1){return!!(this.minzoom&&e<(s?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ks(e,((s,l)=>!(s===void 0||l==="layout"&&!Object.keys(s).length||l==="paint"&&!Object.keys(s).length)))}_validate(e,s,l,d,g={}){return(!g||g.validate!==!1)&&_n(this,e.call(yi,{key:s,layerType:this.type,objectKey:l,value:d,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Ma&&Qa(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}let Vr;var ju={get paint(){return Vr=Vr||new Xr({"raster-opacity":new $t(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(Te.paint_raster["raster-saturation"]),"raster-contrast":new $t(Te.paint_raster["raster-contrast"]),"raster-resampling":new $t(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(Te.paint_raster["raster-fade-duration"])})}};class xo extends zr{constructor(e,s){super(e,ju,s)}}const Cs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qs{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ts{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mr(r,e=1){let s=0,l=0;return{members:r.map((d=>{const g=Cs[d.type].BYTES_PER_ELEMENT,y=s=an(s,Math.max(e,g)),w=d.components||1;return l=Math.max(l,g),s+=g*w,{name:d.name,type:d.type,components:w,offset:y}})),size:an(s,Math.max(l,e)),alignment:e}}function an(r,e){return Math.ceil(r/e)*e}class bn extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const d=2*e;return this.int16[d+0]=s,this.int16[d+1]=l,e}}bn.prototype.bytesPerElement=4,Ut("StructArrayLayout2i4",bn);class Al extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,l)}emplace(e,s,l,d){const g=3*e;return this.int16[g+0]=s,this.int16[g+1]=l,this.int16[g+2]=d,e}}Al.prototype.bytesPerElement=6,Ut("StructArrayLayout3i6",Al);class kl extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,l,d)}emplace(e,s,l,d,g){const y=4*e;return this.int16[y+0]=s,this.int16[y+1]=l,this.int16[y+2]=d,this.int16[y+3]=g,e}}kl.prototype.bytesPerElement=8,Ut("StructArrayLayout4i8",kl);class _o extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,d,g,y)}emplace(e,s,l,d,g,y,w){const N=6*e;return this.int16[N+0]=s,this.int16[N+1]=l,this.int16[N+2]=d,this.int16[N+3]=g,this.int16[N+4]=y,this.int16[N+5]=w,e}}_o.prototype.bytesPerElement=12,Ut("StructArrayLayout2i4i12",_o);class yh extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,d,g,y)}emplace(e,s,l,d,g,y,w){const N=4*e,A=8*e;return this.int16[N+0]=s,this.int16[N+1]=l,this.uint8[A+4]=d,this.uint8[A+5]=g,this.uint8[A+6]=y,this.uint8[A+7]=w,e}}yh.prototype.bytesPerElement=8,Ut("StructArrayLayout2i4ub8",yh);class jr extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const d=2*e;return this.float32[d+0]=s,this.float32[d+1]=l,e}}jr.prototype.bytesPerElement=8,Ut("StructArrayLayout2f8",jr);class wn extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y,w,N,A,R){const I=this.length;return this.resize(I+1),this.emplace(I,e,s,l,d,g,y,w,N,A,R)}emplace(e,s,l,d,g,y,w,N,A,R,I){const B=10*e;return this.uint16[B+0]=s,this.uint16[B+1]=l,this.uint16[B+2]=d,this.uint16[B+3]=g,this.uint16[B+4]=y,this.uint16[B+5]=w,this.uint16[B+6]=N,this.uint16[B+7]=A,this.uint16[B+8]=R,this.uint16[B+9]=I,e}}wn.prototype.bytesPerElement=20,Ut("StructArrayLayout10ui20",wn);class Sc extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y,w,N){const A=this.length;return this.resize(A+1),this.emplace(A,e,s,l,d,g,y,w,N)}emplace(e,s,l,d,g,y,w,N,A){const R=8*e;return this.uint16[R+0]=s,this.uint16[R+1]=l,this.uint16[R+2]=d,this.uint16[R+3]=g,this.uint16[R+4]=y,this.uint16[R+5]=w,this.uint16[R+6]=N,this.uint16[R+7]=A,e}}Sc.prototype.bytesPerElement=16,Ut("StructArrayLayout8ui16",Sc);class jc extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y,w,N,A,R,I,B){const $=this.length;return this.resize($+1),this.emplace($,e,s,l,d,g,y,w,N,A,R,I,B)}emplace(e,s,l,d,g,y,w,N,A,R,I,B,$){const W=12*e;return this.int16[W+0]=s,this.int16[W+1]=l,this.int16[W+2]=d,this.int16[W+3]=g,this.uint16[W+4]=y,this.uint16[W+5]=w,this.uint16[W+6]=N,this.uint16[W+7]=A,this.int16[W+8]=R,this.int16[W+9]=I,this.int16[W+10]=B,this.int16[W+11]=$,e}}jc.prototype.bytesPerElement=24,Ut("StructArrayLayout4i4ui4i24",jc);class Tu extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,l)}emplace(e,s,l,d){const g=3*e;return this.float32[g+0]=s,this.float32[g+1]=l,this.float32[g+2]=d,e}}Tu.prototype.bytesPerElement=12,Ut("StructArrayLayout3f12",Tu);class Nu extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}Nu.prototype.bytesPerElement=4,Ut("StructArrayLayout1ul4",Nu);class Eu extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y,w,N,A){const R=this.length;return this.resize(R+1),this.emplace(R,e,s,l,d,g,y,w,N,A)}emplace(e,s,l,d,g,y,w,N,A,R){const I=10*e,B=5*e;return this.int16[I+0]=s,this.int16[I+1]=l,this.int16[I+2]=d,this.int16[I+3]=g,this.int16[I+4]=y,this.int16[I+5]=w,this.uint32[B+3]=N,this.uint16[I+8]=A,this.uint16[I+9]=R,e}}Eu.prototype.bytesPerElement=20,Ut("StructArrayLayout6i1ul2ui20",Eu);class Yo extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,d,g,y)}emplace(e,s,l,d,g,y,w){const N=6*e;return this.int16[N+0]=s,this.int16[N+1]=l,this.int16[N+2]=d,this.int16[N+3]=g,this.int16[N+4]=y,this.int16[N+5]=w,e}}Yo.prototype.bytesPerElement=12,Ut("StructArrayLayout2i2i2i12",Yo);class vo extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,l,d,g)}emplace(e,s,l,d,g,y){const w=4*e,N=8*e;return this.float32[w+0]=s,this.float32[w+1]=l,this.float32[w+2]=d,this.int16[N+6]=g,this.int16[N+7]=y,e}}vo.prototype.bytesPerElement=16,Ut("StructArrayLayout2f1f2i16",vo);class Di extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,d,g,y)}emplace(e,s,l,d,g,y,w){const N=16*e,A=4*e,R=8*e;return this.uint8[N+0]=s,this.uint8[N+1]=l,this.float32[A+1]=d,this.float32[A+2]=g,this.int16[R+6]=y,this.int16[R+7]=w,e}}Di.prototype.bytesPerElement=16,Ut("StructArrayLayout2ub2f2i16",Di);class Pr extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,l)}emplace(e,s,l,d){const g=3*e;return this.uint16[g+0]=s,this.uint16[g+1]=l,this.uint16[g+2]=d,e}}Pr.prototype.bytesPerElement=6,Ut("StructArrayLayout3ui6",Pr);class Jn extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y,w,N,A,R,I,B,$,W,X,te,oe){const be=this.length;return this.resize(be+1),this.emplace(be,e,s,l,d,g,y,w,N,A,R,I,B,$,W,X,te,oe)}emplace(e,s,l,d,g,y,w,N,A,R,I,B,$,W,X,te,oe,be){const ne=24*e,me=12*e,Ee=48*e;return this.int16[ne+0]=s,this.int16[ne+1]=l,this.uint16[ne+2]=d,this.uint16[ne+3]=g,this.uint32[me+2]=y,this.uint32[me+3]=w,this.uint32[me+4]=N,this.uint16[ne+10]=A,this.uint16[ne+11]=R,this.uint16[ne+12]=I,this.float32[me+7]=B,this.float32[me+8]=$,this.uint8[Ee+36]=W,this.uint8[Ee+37]=X,this.uint8[Ee+38]=te,this.uint32[me+10]=oe,this.int16[ne+22]=be,e}}Jn.prototype.bytesPerElement=48,Ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Jn);class Ml extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,d,g,y,w,N,A,R,I,B,$,W,X,te,oe,be,ne,me,Ee,Ie,Je,pt,gt,Tt,Lt,kt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,e,s,l,d,g,y,w,N,A,R,I,B,$,W,X,te,oe,be,ne,me,Ee,Ie,Je,pt,gt,Tt,Lt,kt)}emplace(e,s,l,d,g,y,w,N,A,R,I,B,$,W,X,te,oe,be,ne,me,Ee,Ie,Je,pt,gt,Tt,Lt,kt,yt){const ut=32*e,qt=16*e;return this.int16[ut+0]=s,this.int16[ut+1]=l,this.int16[ut+2]=d,this.int16[ut+3]=g,this.int16[ut+4]=y,this.int16[ut+5]=w,this.int16[ut+6]=N,this.int16[ut+7]=A,this.uint16[ut+8]=R,this.uint16[ut+9]=I,this.uint16[ut+10]=B,this.uint16[ut+11]=$,this.uint16[ut+12]=W,this.uint16[ut+13]=X,this.uint16[ut+14]=te,this.uint16[ut+15]=oe,this.uint16[ut+16]=be,this.uint16[ut+17]=ne,this.uint16[ut+18]=me,this.uint16[ut+19]=Ee,this.uint16[ut+20]=Ie,this.uint16[ut+21]=Je,this.uint16[ut+22]=pt,this.uint32[qt+12]=gt,this.float32[qt+13]=Tt,this.float32[qt+14]=Lt,this.uint16[ut+30]=kt,this.uint16[ut+31]=yt,e}}Ml.prototype.bytesPerElement=64,Ut("StructArrayLayout8i15ui1ul2f2ui64",Ml);class Pl extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}Pl.prototype.bytesPerElement=4,Ut("StructArrayLayout1f4",Pl);class Tc extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,l)}emplace(e,s,l,d){const g=3*e;return this.uint16[6*e+0]=s,this.float32[g+1]=l,this.float32[g+2]=d,e}}Tc.prototype.bytesPerElement=12,Ut("StructArrayLayout1ui2f12",Tc);class Sn extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,l)}emplace(e,s,l,d){const g=4*e;return this.uint32[2*e+0]=s,this.uint16[g+2]=l,this.uint16[g+3]=d,e}}Sn.prototype.bytesPerElement=8,Ut("StructArrayLayout1ul2ui8",Sn);class x extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const d=2*e;return this.uint16[d+0]=s,this.uint16[d+1]=l,e}}x.prototype.bytesPerElement=4,Ut("StructArrayLayout2ui4",x);class t extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}t.prototype.bytesPerElement=2,Ut("StructArrayLayout1ui2",t);class a extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,l,d)}emplace(e,s,l,d,g){const y=4*e;return this.float32[y+0]=s,this.float32[y+1]=l,this.float32[y+2]=d,this.float32[y+3]=g,e}}a.prototype.bytesPerElement=16,Ut("StructArrayLayout4f16",a);class u extends Qs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new O(this.anchorPointX,this.anchorPointY)}}u.prototype.size=20;class p extends Eu{get(e){return new u(this,e)}}Ut("CollisionBoxArray",p);class b extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}b.prototype.size=48;class j extends Jn{get(e){return new b(this,e)}}Ut("PlacedSymbolArray",j);class E extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}E.prototype.size=64;class M extends Ml{get(e){return new E(this,e)}}Ut("SymbolInstanceArray",M);class z extends Pl{getoffsetX(e){return this.float32[1*e+0]}}Ut("GlyphOffsetArray",z);class L extends Al{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ut("SymbolLineVertexArray",L);class q extends Qs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}q.prototype.size=12;class V extends Tc{get(e){return new q(this,e)}}Ut("TextAnchorOffsetArray",V);class J extends Qs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}J.prototype.size=8;class ie extends Sn{get(e){return new J(this,e)}}Ut("FeatureIndexArray",ie);class fe extends bn{}class ye extends bn{}class ge extends bn{}class Se extends _o{}class Me extends yh{}class we extends jr{}class ke extends wn{}class De extends Sc{}class je extends jc{}class qe extends Tu{}class st extends Nu{}class Ke extends Yo{}class et extends Di{}class tt extends Pr{}class Rt extends x{}const It=Mr([{name:"a_pos",components:2,type:"Int16"}],4),{members:St}=It;class Bt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,s,l,d){const g=this.segments[this.segments.length-1];return e>Bt.MAX_VERTEX_ARRAY_LENGTH&&us(`Max vertices per segment is ${Bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Bt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+e>Bt.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d?this.createNewSegment(s,l,d):g}createNewSegment(e,s,l){const d={vertexOffset:e.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(d.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(e,s,l){return this.prepareSegment(0,e,s,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,l,d){return new Bt([{vertexOffset:e,primitiveOffset:s,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}function fs(r,e){return 256*(r=Mt(Math.floor(r),0,255))+Mt(Math.floor(e),0,255)}Bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut("SegmentVector",Bt);const er=Mr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),_r=Mr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var hr,Tr,or,Or={exports:{}},Nr={exports:{}},Si={exports:{}},qr=(function(){if(or)return Or.exports;or=1;var r=(hr||(hr=1,Nr.exports=function(s,l){var d,g,y,w,N,A,R,I;for(g=s.length-(d=3&s.length),y=l,N=3432918353,A=461845907,I=0;I<g;)R=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24,++I,y=27492+(65535&(w=5*(65535&(y=(y^=R=(65535&(R=(R=(65535&R)*N+(((R>>>16)*N&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(R=0,d){case 3:R^=(255&s.charCodeAt(I+2))<<16;case 2:R^=(255&s.charCodeAt(I+1))<<8;case 1:y^=R=(65535&(R=(R=(65535&(R^=255&s.charCodeAt(I)))*N+(((R>>>16)*N&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295}return y^=s.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Nr.exports),e=(Tr||(Tr=1,Si.exports=function(s,l){for(var d,g=s.length,y=l^g,w=0;g>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(d>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++w;switch(g){case 3:y^=(255&s.charCodeAt(w+2))<<16;case 2:y^=(255&s.charCodeAt(w+1))<<8;case 1:y=1540483477*(65535&(y^=255&s.charCodeAt(w)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Si.exports);return Or.exports=r,Or.exports.murmur3=r,Or.exports.murmur2=e,Or.exports})(),Gr=F(qr);class ji{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,l,d){this.ids.push(Qn(e)),this.positions.push(s,l,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Qn(e);let l=0,d=this.ids.length-1;for(;l<d;){const y=l+d>>1;this.ids[y]>=s?d=y:l=y+1}const g=[];for(;this.ids[l]===s;)g.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return g}static serialize(e,s){const l=new Float64Array(e.ids),d=new Uint32Array(e.positions);return eo(l,d,0,l.length-1),s&&s.push(l.buffer,d.buffer),{ids:l,positions:d}}static deserialize(e){const s=new ji;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function Qn(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Gr(String(r))}function eo(r,e,s,l){for(;s<l;){const d=r[s+l>>1];let g=s-1,y=l+1;for(;;){do g++;while(r[g]<d);do y--;while(r[y]>d);if(g>=y)break;jn(r,g,y),jn(e,3*g,3*y),jn(e,3*g+1,3*y+1),jn(e,3*g+2,3*y+2)}y-s<l-y?(eo(r,e,s,y),s=y+1):(eo(r,e,y+1,l),l=y)}}function jn(r,e,s){const l=r[e];r[e]=r[s],r[s]=l}Ut("FeaturePositionMap",ji);class ua{constructor(e,s){this.gl=e.gl,this.location=s}}class Dl extends ua{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Nc extends ua{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Tn extends ua{constructor(e,s){super(e,s),this.current=_s.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const da=new Float32Array(16);function Pa(r){return[fs(255*r.r,255*r.g),fs(255*r.b,255*r.a)]}class nn{constructor(e,s,l){this.value=e,this.uniformNames=s.map((d=>`u_${d}`)),this.type=l}setUniform(e,s,l){e.set(l.constantOr(this.value))}getBinding(e,s,l){return this.type==="color"?new Tn(e,s):new Dl(e,s)}}class on{constructor(e,s){this.uniformNames=s.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,s){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,s.y,s.height,s.width]}setUniform(e,s,l,d){let g=null;d==="u_pattern_to"?g=this.patternTo:d==="u_pattern_from"?g=this.patternFrom:d==="u_dasharray_to"?g=this.dashTo:d==="u_dasharray_from"?g=this.dashFrom:d==="u_pixel_ratio_to"?g=this.pixelRatioTo:d==="u_pixel_ratio_from"&&(g=this.pixelRatioFrom),g!==null&&e.set(g)}getBinding(e,s,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Nc(e,s):new Dl(e,s)}}class rr{constructor(e,s,l,d){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map((g=>({name:`a_${g}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(e,s,l){const d=this.paintVertexArray.length,g=this.expression.evaluate(new sr(0,l),s,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(d,e,g)}updatePaintArray(e,s,l,d,g){const y=this.expression.evaluate(new sr(0,g),l,d);this._setPaintValue(e,s,y)}_setPaintValue(e,s,l){if(this.type==="color"){const d=Pa(l);for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=e;d<s;d++)this.paintVertexArray.emplace(d,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fr{constructor(e,s,l,d,g,y){this.expression=e,this.uniformNames=s.map((w=>`u_${w}_t`)),this.type=l,this.useIntegerZoom=d,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map((w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new y}populatePaintArray(e,s,l){const d=this.expression.evaluate(new sr(this.zoom,l),s,{},l.canonical,[],l.formattedSection),g=this.expression.evaluate(new sr(this.zoom+1,l),s,{},l.canonical,[],l.formattedSection),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,d,g)}updatePaintArray(e,s,l,d,g){const y=this.expression.evaluate(new sr(this.zoom,g),l,d),w=this.expression.evaluate(new sr(this.zoom+1,g),l,d);this._setPaintValue(e,s,y,w)}_setPaintValue(e,s,l,d){if(this.type==="color"){const g=Pa(l),y=Pa(d);for(let w=e;w<s;w++)this.paintVertexArray.emplace(w,g[0],g[1],y[0],y[1])}else{for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=Mt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,s,l){return new Dl(e,s)}}class ri{constructor(e,s,l,d,g,y){this.expression=e,this.type=s,this.useIntegerZoom=l,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,s,l){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,this.getPositionIds(s),l)}updatePaintArray(e,s,l,d,g){this._setPaintValues(e,s,this.getPositionIds(l),g)}_setPaintValues(e,s,l,d){const g=this.getPositions(d);if(!g||!l)return;const y=g[l.min],w=g[l.mid],N=g[l.max];if(y&&w&&N)for(let A=e;A<s;A++)this.emplace(this.zoomInPaintVertexArray,A,w,y),this.emplace(this.zoomOutPaintVertexArray,A,w,N)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const s=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,s,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,s,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ui extends ri{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return er.members}emplace(e,s,l,d){e.emplace(s,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],d.tlbr[0],d.tlbr[1],d.tlbr[2],d.tlbr[3],l.pixelRatio,d.pixelRatio)}}class Sd extends ri{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return _r.members}emplace(e,s,l,d){e.emplace(s,0,l.y,l.height,l.width,0,d.y,d.height,d.width)}}class jd{constructor(e,s,l){this.binders={},this._buffers=[];const d=[];for(const g in e.paint._values){if(!l(g))continue;const y=e.paint.get(g);if(!(y instanceof Ma&&Qa(y.property.specification)))continue;const w=Of(g,e.type),N=y.value,A=y.property.specification.type,R=y.property.useIntegerZoom,I=y.property.specification["property-type"],B=I==="cross-faded"||I==="cross-faded-data-driven";if(N.kind==="constant")this.binders[g]=B?new on(N.value,w):new nn(N.value,w,A),d.push(`/u_${g}`);else if(N.kind==="source"||B){const $=Ko(g,A,"source");this.binders[g]=B?g==="line-dasharray"?new Sd(N,A,R,s,$,e.id):new ui(N,A,R,s,$,e.id):new rr(N,w,A,$),d.push(`/a_${g}`)}else{const $=Ko(g,A,"composite");this.binders[g]=new fr(N,w,A,R,s,$),d.push(`/z_${g}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof rr||s instanceof fr?s.maxValue:0}populatePaintArrays(e,s,l){for(const d in this.binders){const g=this.binders[d];(g instanceof rr||g instanceof fr||g instanceof ri)&&g.populatePaintArray(e,s,l)}}setConstantPatternPositions(e,s){for(const l in this.binders){const d=this.binders[l];d instanceof on&&d.setConstantPatternPositions(e,s)}}setConstantDashPositions(e,s){for(const l in this.binders){const d=this.binders[l];d instanceof on&&d.setConstantDashPositions(e,s)}}updatePaintArrays(e,s,l,d,g){let y=!1;for(const w in e){const N=s.getPositions(w);for(const A of N){const R=l.feature(A.index);for(const I in this.binders){const B=this.binders[I];if((B instanceof rr||B instanceof fr||B instanceof ri)&&B.expression.isStateDependent===!0){const $=d.paint.get(I);B.expression=$.value,B.updatePaintArray(A.start,A.end,R,e[w],g),y=!0}}}}return y}defines(){const e=[];for(const s in this.binders){const l=this.binders[s];(l instanceof nn||l instanceof on)&&e.push(...l.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof rr||l instanceof fr)for(let d=0;d<l.paintVertexAttributes.length;d++)e.push(l.paintVertexAttributes[d].name);else if(l instanceof ri){const d=l.getVertexAttributes();for(const g of d)e.push(g.name)}}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof nn||l instanceof on||l instanceof fr)for(const d of l.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const l=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof nn||g instanceof on||g instanceof fr){for(const y of g.uniformNames)if(s[y]){const w=g.getBinding(e,s[y],y);l.push({name:y,property:d,binding:w})}}}return l}setUniforms(e,s,l,d){for(const{name:g,property:y,binding:w}of s)this.binders[y].setUniform(w,d,l.get(y),g)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(e&&l instanceof ri){const d=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof rr||l instanceof fr)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const s in this.binders){const l=this.binders[s];(l instanceof rr||l instanceof fr||l instanceof ri)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof rr||s instanceof fr||s instanceof ri)&&s.destroy()}}}class Xo{constructor(e,s,l=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new jd(d,s,l);this.needsUpload=!1,this._featureMap=new ji,this._bufferOffset=0}populatePaintArrays(e,s,l,d){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,s,d);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,l,d){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,s,g,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Of(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Ko(r,e,s){const l={color:{source:jr,composite:a},number:{source:Pl,composite:jr}},d=(function(g){return{"line-pattern":{source:ke,composite:ke},"fill-pattern":{source:ke,composite:ke},"fill-extrusion-pattern":{source:ke,composite:ke},"line-dasharray":{source:De,composite:De}}[g]})(r);return d&&d[s]||l[e][s]}Ut("ConstantBinder",nn),Ut("CrossFadedConstantBinder",on),Ut("SourceExpressionBinder",rr),Ut("CrossFadedPatternBinder",ui),Ut("CrossFadedDasharrayBinder",Sd),Ut("CompositeExpressionBinder",fr),Ut("ProgramConfiguration",jd,{omit:["_buffers"]}),Ut("ProgramConfigurationSet",Xo);const Td=Math.pow(2,14)-1,bo=-Td-1;function wo(r){const e=Ze/r.extent,s=r.loadGeometry();for(let l=0;l<s.length;l++){const d=s[l];for(let g=0;g<d.length;g++){const y=d[g],w=Math.round(y.x*e),N=Math.round(y.y*e);y.x=Mt(w,bo,Td),y.y=Mt(N,bo,Td),(w<y.x||w>y.x+1||N<y.y||N>y.y+1)&&us("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Nn(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?wo(r):[]}}const Nd=-32768;function Cu(r,e,s,l,d){r.emplaceBack(Nd+8*e+l,Nd+8*s+d)}class Au{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ye,this.indexArray=new tt,this.segments=new Bt,this.programConfigurations=new Xo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(e,s,l){const d=this.layers[0],g=[];let y=null,w=!1,N=d.type==="heatmap";if(d.type==="circle"){const R=d;y=R.layout.get("circle-sort-key"),w=!y.isConstant(),N=N||R.paint.get("circle-pitch-alignment")==="map"}const A=N?s.subdivisionGranularity.circle:1;for(const{feature:R,id:I,index:B,sourceLayerIndex:$}of e){const W=this.layers[0]._featureFilter.needGeometry,X=Nn(R,W);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),X,l))continue;const te=w?y.evaluate(X,{},l):void 0,oe={id:I,properties:R.properties,type:R.type,sourceLayerIndex:$,index:B,geometry:W?X.geometry:wo(R),patterns:{},sortKey:te};g.push(oe)}w&&g.sort(((R,I)=>R.sortKey-I.sortKey));for(const R of g){const{geometry:I,index:B,sourceLayerIndex:$}=R,W=e[B].feature;this.addFeature(R,I,B,l,A),s.featureIndex.insert(W,I,B,$,this.index)}}update(e,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,St),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,d,g=1){let y;switch(g){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const w=y.length;for(const N of s)for(const A of N){const R=A.x,I=A.y;if(R<0||R>=Ze||I<0||I>=Ze)continue;const B=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,e.sortKey),$=B.vertexLength;for(let W=0;W<w;W++)for(let X=0;X<w;X++)Cu(this.layoutVertexArray,R,I,y[X],y[W]);for(let W=0;W<w-1;W++)for(let X=0;X<w-1;X++){const te=$+W*w+X,oe=$+(W+1)*w+X;this.indexArray.emplaceBack(te,oe+1,te+1),this.indexArray.emplaceBack(te,oe,oe+1)}B.vertexLength+=w*w,B.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:d})}}function ku(r,e){for(let s=0;s<r.length;s++)if(Jo(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(Jo(r,e[s]))return!0;return!!Ri(r,e)}function Lf(r,e,s){return!!Jo(r,e)||!!Ff(e,r,s)}function Bf(r,e){if(r.length===1)return cm(e,r[0]);for(let s=0;s<e.length;s++){const l=e[s];for(let d=0;d<l.length;d++)if(Jo(r,l[d]))return!0}for(let s=0;s<r.length;s++)if(cm(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(Ri(r,e[s]))return!0;return!1}function Ti(r,e,s){if(r.length>1){if(Ri(r,e))return!0;for(let l=0;l<e.length;l++)if(Ff(e[l],r,s))return!0}for(let l=0;l<r.length;l++)if(Ff(r[l],e,s))return!0;return!1}function Ri(r,e){if(r.length===0||e.length===0)return!1;for(let s=0;s<r.length-1;s++){const l=r[s],d=r[s+1];for(let g=0;g<e.length-1;g++)if(kg(l,d,e[g],e[g+1]))return!0}return!1}function kg(r,e,s,l){return xs(r,s,l)!==xs(e,s,l)&&xs(r,e,s)!==xs(r,e,l)}function Ff(r,e,s){const l=s*s;if(e.length===1)return r.distSqr(e[0])<l;for(let d=1;d<e.length;d++)if(lm(r,e[d-1],e[d])<l)return!0;return!1}function lm(r,e,s){const l=e.distSqr(s);if(l===0)return r.distSqr(e);const d=((r.x-e.x)*(s.x-e.x)+(r.y-e.y)*(s.y-e.y))/l;return r.distSqr(d<0?e:d>1?s:s.sub(e)._mult(d)._add(e))}function cm(r,e){let s,l,d,g=!1;for(let y=0;y<r.length;y++){s=r[y];for(let w=0,N=s.length-1;w<s.length;N=w++)l=s[w],d=s[N],l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(g=!g)}return g}function Jo(r,e){let s=!1;for(let l=0,d=r.length-1;l<r.length;d=l++){const g=r[l],y=r[d];g.y>e.y!=y.y>e.y&&e.x<(y.x-g.x)*(e.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function Mg(r,e,s){const l=s[0],d=s[2];if(r.x<l.x&&e.x<l.x||r.x>d.x&&e.x>d.x||r.y<l.y&&e.y<l.y||r.y>d.y&&e.y>d.y)return!1;const g=xs(r,e,s[0]);return g!==xs(r,e,s[1])||g!==xs(r,e,s[2])||g!==xs(r,e,s[3])}function Rl(r,e,s){const l=e.paint.get(r).value;return l.kind==="constant"?l.value:s.programConfigurations.get(e.id).getMaxValue(r)}function xh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Uf(r,e,s,l,d){if(!e[0]&&!e[1])return r;const g=O.convert(e)._mult(d);s==="viewport"&&g._rotate(-l);const y=[];for(let w=0;w<r.length;w++)y.push(r[w].sub(g));return y}function $f(r){const e=[];for(let s=0;s<r.length;s++){const l=r[s],d=e.at(-1);(s===0||d&&!l.equals(d))&&e.push(l)}return e}function um({queryGeometry:r,size:e},s){return Lf(r,s,e)}function Pg({queryGeometry:r,size:e,transform:s,unwrappedTileID:l,getElevation:d},g){return Lf(r,g,e*(s.projectTileCoordinates(g.x,g.y,l,d).signedDistanceFromCamera/s.cameraToCenterDistance))}function Dg({queryGeometry:r,size:e,transform:s,unwrappedTileID:l,getElevation:d},g){const y=s.projectTileCoordinates(g.x,g.y,l,d).signedDistanceFromCamera,w=e*(s.cameraToCenterDistance/y);return Lf(r,_h(g,s,l,d),w)}function Rg({queryGeometry:r,size:e,transform:s,unwrappedTileID:l,getElevation:d},g){return Lf(r,_h(g,s,l,d),e)}function Vf({queryGeometry:r,size:e,transform:s,unwrappedTileID:l,getElevation:d,pitchAlignment:g="map",pitchScale:y="map"},w){const N=g==="map"?y==="map"?um:Pg:y==="map"?Dg:Rg,A={queryGeometry:r,size:e,transform:s,unwrappedTileID:l,getElevation:d};for(const R of w)for(const I of R)if(N(A,I))return!0;return!1}function _h(r,e,s,l){const d=e.projectTileCoordinates(r.x,r.y,s,l).point;return new O((.5*d.x+.5)*e.width,(.5*-d.y+.5)*e.height)}let qf,dm;Ut("CircleBucket",Au,{omit:["layers"]});var hm={get paint(){return dm=dm||new Xr({"circle-radius":new Wt(Te.paint_circle["circle-radius"]),"circle-color":new Wt(Te.paint_circle["circle-color"]),"circle-blur":new Wt(Te.paint_circle["circle-blur"]),"circle-opacity":new Wt(Te.paint_circle["circle-opacity"]),"circle-translate":new $t(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return qf=qf||new Xr({"circle-sort-key":new Wt(Te.layout_circle["circle-sort-key"])})}};class Gf extends zr{constructor(e,s){super(e,hm,s)}createBucket(e){return new Au(e)}queryRadius(e){const s=e;return Rl("circle-radius",this,s)+Rl("circle-stroke-width",this,s)+xh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:l,geometry:d,transform:g,pixelsToTileUnits:y,unwrappedTileID:w,getElevation:N}){const A=Uf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,y),R=this.paint.get("circle-radius").evaluate(s,l)+this.paint.get("circle-stroke-width").evaluate(s,l),I=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let $,W;return B==="map"?($=A,W=R*y):($=(function(X,te,oe,be){return X.map((ne=>_h(ne,te,oe,be)))})(A,g,w,N),W=R),Vf({queryGeometry:$,size:W,transform:g,unwrappedTileID:w,getElevation:N,pitchAlignment:B,pitchScale:I},d)}}class Hf extends Au{}let fm;Ut("HeatmapBucket",Hf,{omit:["layers"]});var pm={get paint(){return fm=fm||new Xr({"heatmap-radius":new Wt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Su(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(Te.paint_heatmap["heatmap-opacity"])})}};function Zf(r,{width:e,height:s},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*s*l)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*s*l}`)}else d=new Uint8Array(e*s*l);return r.width=e,r.height=s,r.data=d,r}function Qo(r,{width:e,height:s},l){if(e===r.width&&s===r.height)return;const d=Zf({},{width:e,height:s},l);vh(r,d,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,s)},l),r.width=e,r.height=s,r.data=d.data}function vh(r,e,s,l,d,g){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||s.x>r.width-d.width||s.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||l.x>e.width-d.width||l.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,w=e.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let N=0;N<d.height;N++){const A=((s.y+N)*r.width+s.x)*g,R=((l.y+N)*e.width+l.x)*g;for(let I=0;I<d.width*g;I++)w[R+I]=y[A+I]}return e}class bh{constructor(e,s){Zf(this,e,1,s)}resize(e){Qo(this,e,1)}clone(){return new bh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,d,g){vh(e,s,l,d,g,1)}}class ha{constructor(e,s){Zf(this,e,4,s)}resize(e){Qo(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,d,g){vh(e,s,l,d,g,4)}setPixel(e,s,l){const d=4*(e*this.width+s);this.data[d+0]=Math.round(255*l.r/l.a),this.data[d+1]=Math.round(255*l.g/l.a),this.data[d+2]=Math.round(255*l.b/l.a),this.data[d+3]=Math.round(255*l.a)}}function el(r){const e={},s=r.resolution||256,l=r.clips?r.clips.length:1,d=r.image||new ha({width:s,height:l});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const g=(y,w,N)=>{e[r.evaluationKey]=N;const A=r.expression.evaluate(e);d.setPixel(y/4/s,w/4,A)};if(r.clips)for(let y=0,w=0;y<l;++y,w+=4*s)for(let N=0,A=0;N<s;N++,A+=4){const R=N/(s-1),{start:I,end:B}=r.clips[y];g(w,A,I*(1-R)+B*R)}else for(let y=0,w=0;y<s;y++,w+=4)g(0,w,y/(s-1));return d}Ut("AlphaImage",bh),Ut("RGBAImage",ha);const wh="big-fb";class Ig extends zr{createBucket(e){return new Hf(e)}constructor(e,s){super(e,pm,s),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=el({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(wh)&&this.heatmapFbos.delete(wh)}queryRadius(e){return Rl("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:l,geometry:d,transform:g,pixelsToTileUnits:y,unwrappedTileID:w,getElevation:N}){return Vf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(s,l)*y,transform:g,unwrappedTileID:w,getElevation:N},d)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Sh;var jh={get paint(){return Sh=Sh||new Xr({"hillshade-illumination-direction":new $t(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new $t(Te.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new $t(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new $t(Te.paint_hillshade["hillshade-method"])})}};class Hr extends zr{constructor(e,s){super(e,jh,s),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values;const g=Math.max(e.length,s.length,l.length,d.length);e=e.concat(Array(g-e.length).fill(e.at(-1))),s=s.concat(Array(g-s.length).fill(s.at(-1))),l=l.concat(Array(g-l.length).fill(l.at(-1))),d=d.concat(Array(g-d.length).fill(d.at(-1)));const y=s.map(Ms);return{directionRadians:e.map(Ms),altitudeRadians:y,shadowColor:d,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let zg;var ux={get paint(){return zg=zg||new Xr({"color-relief-opacity":new $t(Te["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Su(Te["paint_color-relief"]["color-relief-color"])})}};class Wf{constructor(e,s,l,d){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,d)}update(e,s,l){const{width:d,height:g}=e,y=!(this.size&&this.size[0]===d&&this.size[1]===g||l),{context:w}=this,{gl:N}=w;if(this.useMipmap=!!(s&&s.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!s||s.premultiply!==!1)),y)this.size=[d,g],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ar(e)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,e):N.texImage2D(N.TEXTURE_2D,0,this.format,d,g,0,this.format,N.UNSIGNED_BYTE,e.data);else{const{x:A,y:R}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ar(e)?N.texSubImage2D(N.TEXTURE_2D,0,A,R,N.RGBA,N.UNSIGNED_BYTE,e):N.texSubImage2D(N.TEXTURE_2D,0,A,R,d,g,N.RGBA,N.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,s,l){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),l!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=g.LINEAR),e!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ed{constructor(e,s,l,d=1,g=1,y=1,w=0){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void us(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const N=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=g,this.blueFactor=y,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<N;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(N,A)]=this.data[this._idx(N-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,N)]=this.data[this._idx(A,N-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(N,-1)]=this.data[this._idx(N-1,0)],this.data[this._idx(-1,N)]=this.data[this._idx(0,N-1)],this.data[this._idx(N,N)]=this.data[this._idx(N-1,N-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<N;A++)for(let R=0;R<N;R++){const I=this.get(A,R);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(e,s){const l=new Uint8Array(this.data.buffer),d=4*this._idx(e,s);return this.unpack(l[d],l[d+1],l[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${s}, dim: ${this.dim}`);return(s+1)*this.stride+(e+1)}unpack(e,s,l){return e*this.redFactor+s*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return Il(e,this.getUnpackVector())}getPixels(){return new ha({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,g=s*this.dim+this.dim,y=l*this.dim,w=l*this.dim+this.dim;switch(s){case-1:d=g-1;break;case 1:g=d+1}switch(l){case-1:y=w-1;break;case 1:w=y+1}const N=-s*this.dim,A=-l*this.dim;for(let R=y;R<w;R++)for(let I=d;I<g;I++)this.data[this._idx(I,R)]=e.data[this._idx(I+N,R+A)]}}function Il(r,e){const s=e[0],l=e[1],d=e[2],g=e[3],y=Math.min(s,l,d),w=Math.round((r+g)/y);return{r:Math.floor(w*y/s)%256,g:Math.floor(w*y/l)%256,b:Math.floor(w*y/d)%256}}Ut("DEMData",Ed);class Og extends zr{constructor(e,s){super(e,ux,s)}_createColorRamp(e){const s={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Ji&&l._styleExpression.expression instanceof Xi){this.colorRampExpression=l;const y=l._styleExpression.expression;s.elevationStops=y.labels,s.colorStops=[];for(const w of s.elevationStops)s.colorStops.push(y.evaluate({globals:{elevation:w}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[_s.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=e)return s;const d={elevationStops:[],colorStops:[]},g=(s.elevationStops.length-1)/(e-1);for(let y=0;y<s.elevationStops.length-.5;y+=g)d.elevationStops.push(s.elevationStops[Math.round(y)]),d.colorStops.push(s.colorStops[Math.round(y)]);return us(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${s.elevationStops.length}`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,s,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const d=this._createColorRamp(s),g=new ha({width:d.colorStops.length,height:1}),y=new ha({width:d.colorStops.length,height:1});for(let w=0;w<d.elevationStops.length;w++){const N=Il(d.elevationStops[w],l);y.setPixel(0,w,new _s(N.r/255,N.g/255,N.b/255,1)),g.setPixel(0,w,d.colorStops[w])}return this.colorRampTextures={elevationTexture:new Wf(e,y,e.gl.RGBA),colorTexture:new Wf(e,g,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Lg=Mr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Th}=Lg;function En(r,e,s){const l=s.patternDependencies;let d=!1;for(const g of e){const y=g.paint.get(`${r}-pattern`);y.isConstant()||(d=!0);const w=y.constantOr(null);w&&(d=!0,l[w.to]=!0,l[w.from]=!0)}return d}function Yf(r,e,s,l,d){const{zoom:g}=l,y=d.patternDependencies;for(const w of e){const N=w.paint.get(`${r}-pattern`).value;if(N.kind!=="constant"){let A=N.evaluate({zoom:g-1},s,{},d.availableImages),R=N.evaluate({zoom:g},s,{},d.availableImages),I=N.evaluate({zoom:g+1},s,{},d.availableImages);A=A&&A.name?A.name:A,R=R&&R.name?R.name:R,I=I&&I.name?I.name:I,y[A]=!0,y[R]=!0,y[I]=!0,s.patterns[w.id]={min:A,mid:R,max:I}}}return s}function Xf(r,e,s,l,d){let g;if(d===(function(y,w,N,A){let R=0;for(let I=w,B=N-A;I<N;I+=A)R+=(y[B]-y[I])*(y[I+1]+y[B+1]),B=I;return R})(r,e,s,l)>0)for(let y=e;y<s;y+=l)g=Da(y/l|0,r[y],r[y+1],g);else for(let y=s-l;y>=e;y-=l)g=Da(y/l|0,r[y],r[y+1],g);return g&&ln(g,g.next)&&(Ra(g),g=g.next),g}function Ec(r,e){if(!r)return r;e||(e=r);let s,l=r;do if(s=!1,l.steiner||!ln(l,l.next)&&Ys(l.prev,l,l.next)!==0)l=l.next;else{if(Ra(l),l=e=l.prev,l===l.next)break;s=!0}while(s||l!==e);return e}function Mu(r,e,s,l,d,g,y){if(!r)return;!y&&g&&(function(N,A,R,I){let B=N;do B.z===0&&(B.z=Ei(B.x,B.y,A,R,I)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==N);B.prevZ.nextZ=null,B.prevZ=null,(function($){let W,X=1;do{let te,oe=$;$=null;let be=null;for(W=0;oe;){W++;let ne=oe,me=0;for(let Ie=0;Ie<X&&(me++,ne=ne.nextZ,ne);Ie++);let Ee=X;for(;me>0||Ee>0&&ne;)me!==0&&(Ee===0||!ne||oe.z<=ne.z)?(te=oe,oe=oe.nextZ,me--):(te=ne,ne=ne.nextZ,Ee--),be?be.nextZ=te:$=te,te.prevZ=be,be=te;oe=ne}be.nextZ=null,X*=2}while(W>1)})(B)})(r,l,d,g);let w=r;for(;r.prev!==r.next;){const N=r.prev,A=r.next;if(g?Kf(r,l,d,g):mm(r))e.push(N.i,r.i,A.i),Ra(r),r=A.next,w=A.next;else if((r=A)===w){y?y===1?Mu(r=Bg(Ec(r),e),e,s,l,d,g,2):y===2&&zl(r,e,s,l,d,g):Mu(Ec(r),e,s,l,d,g,1);break}}}function mm(r){const e=r.prev,s=r,l=r.next;if(Ys(e,s,l)>=0)return!1;const d=e.x,g=s.x,y=l.x,w=e.y,N=s.y,A=l.y,R=Math.min(d,g,y),I=Math.min(w,N,A),B=Math.max(d,g,y),$=Math.max(w,N,A);let W=l.next;for(;W!==e;){if(W.x>=R&&W.x<=B&&W.y>=I&&W.y<=$&&Cd(d,w,g,N,y,A,W.x,W.y)&&Ys(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function Kf(r,e,s,l){const d=r.prev,g=r,y=r.next;if(Ys(d,g,y)>=0)return!1;const w=d.x,N=g.x,A=y.x,R=d.y,I=g.y,B=y.y,$=Math.min(w,N,A),W=Math.min(R,I,B),X=Math.max(w,N,A),te=Math.max(R,I,B),oe=Ei($,W,e,s,l),be=Ei(X,te,e,s,l);let ne=r.prevZ,me=r.nextZ;for(;ne&&ne.z>=oe&&me&&me.z<=be;){if(ne.x>=$&&ne.x<=X&&ne.y>=W&&ne.y<=te&&ne!==d&&ne!==y&&Cd(w,R,N,I,A,B,ne.x,ne.y)&&Ys(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,me.x>=$&&me.x<=X&&me.y>=W&&me.y<=te&&me!==d&&me!==y&&Cd(w,R,N,I,A,B,me.x,me.y)&&Ys(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ne&&ne.z>=oe;){if(ne.x>=$&&ne.x<=X&&ne.y>=W&&ne.y<=te&&ne!==d&&ne!==y&&Cd(w,R,N,I,A,B,ne.x,ne.y)&&Ys(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;me&&me.z<=be;){if(me.x>=$&&me.x<=X&&me.y>=W&&me.y<=te&&me!==d&&me!==y&&Cd(w,R,N,I,A,B,me.x,me.y)&&Ys(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function Bg(r,e){let s=r;do{const l=s.prev,d=s.next.next;!ln(l,d)&&xm(l,s,s.next,d)&&Ch(l,d)&&Ch(d,l)&&(e.push(l.i,s.i,d.i),Ra(s),Ra(s.next),s=r=d),s=s.next}while(s!==r);return Ec(s)}function zl(r,e,s,l,d,g){let y=r;do{let w=y.next.next;for(;w!==y.prev;){if(y.i!==w.i&&Kr(y,w)){let N=Ah(y,w);return y=Ec(y,y.next),N=Ec(N,N.next),Mu(y,e,s,l,d,g,0),void Mu(N,e,s,l,d,g,0)}w=w.next}y=y.next}while(y!==r)}function Ni(r,e){let s=r.x-e.x;return s===0&&(s=r.y-e.y,s===0)&&(s=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),s}function gm(r,e){const s=(function(d,g){let y=g;const w=d.x,N=d.y;let A,R=-1/0;if(ln(d,y))return y;do{if(ln(d,y.next))return y.next;if(N<=y.y&&N>=y.next.y&&y.next.y!==y.y){const X=y.x+(N-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(X<=w&&X>R&&(R=X,A=y.x<y.next.x?y:y.next,X===w))return A}y=y.next}while(y!==g);if(!A)return null;const I=A,B=A.x,$=A.y;let W=1/0;y=A;do{if(w>=y.x&&y.x>=B&&w!==y.x&&ym(N<$?w:R,N,B,$,N<$?R:w,N,y.x,y.y)){const X=Math.abs(N-y.y)/(w-y.x);Ch(y,d)&&(X<W||X===W&&(y.x>A.x||y.x===A.x&&Fg(A,y)))&&(A=y,W=X)}y=y.next}while(y!==I);return A})(r,e);if(!s)return e;const l=Ah(s,r);return Ec(l,l.next),Ec(s,s.next)}function Fg(r,e){return Ys(r.prev,r,e.prev)<0&&Ys(e.next,r,r.next)<0}function Ei(r,e,s,l,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-s)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dx(r){let e=r,s=r;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==r);return s}function ym(r,e,s,l,d,g,y,w){return(d-y)*(e-w)>=(r-y)*(g-w)&&(r-y)*(l-w)>=(s-y)*(e-w)&&(s-y)*(g-w)>=(d-y)*(l-w)}function Cd(r,e,s,l,d,g,y,w){return!(r===y&&e===w)&&ym(r,e,s,l,d,g,y,w)}function Kr(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(s,l){let d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==l.i&&d.next.i!==l.i&&xm(d,d.next,s,l))return!0;d=d.next}while(d!==s);return!1})(r,e)&&(Ch(r,e)&&Ch(e,r)&&(function(s,l){let d=s,g=!1;const y=(s.x+l.x)/2,w=(s.y+l.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&y<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==s);return g})(r,e)&&(Ys(r.prev,r,e.prev)||Ys(r,e.prev,e))||ln(r,e)&&Ys(r.prev,r,r.next)>0&&Ys(e.prev,e,e.next)>0)}function Ys(r,e,s){return(e.y-r.y)*(s.x-e.x)-(e.x-r.x)*(s.y-e.y)}function ln(r,e){return r.x===e.x&&r.y===e.y}function xm(r,e,s,l){const d=Eh(Ys(r,e,s)),g=Eh(Ys(r,e,l)),y=Eh(Ys(s,l,r)),w=Eh(Ys(s,l,e));return d!==g&&y!==w||!(d!==0||!Nh(r,s,e))||!(g!==0||!Nh(r,l,e))||!(y!==0||!Nh(s,r,l))||!(w!==0||!Nh(s,e,l))}function Nh(r,e,s){return e.x<=Math.max(r.x,s.x)&&e.x>=Math.min(r.x,s.x)&&e.y<=Math.max(r.y,s.y)&&e.y>=Math.min(r.y,s.y)}function Eh(r){return r>0?1:r<0?-1:0}function Ch(r,e){return Ys(r.prev,r,r.next)<0?Ys(r,e,r.next)>=0&&Ys(r,r.prev,e)>=0:Ys(r,e,r.prev)<0||Ys(r,r.next,e)<0}function Ah(r,e){const s=Jf(r.i,r.x,r.y),l=Jf(e.i,e.x,e.y),d=r.next,g=e.prev;return r.next=e,e.prev=r,s.next=d,d.prev=s,l.next=s,s.prev=l,g.next=l,l.prev=g,l}function Da(r,e,s,l){const d=Jf(r,e,s);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function Ra(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Jf(r,e,s){return{i:r,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ii{constructor(e,s){if(s>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=s}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class kh{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}kh.noSubdivision=new kh({fill:new Ii(0,0),line:new Ii(0,0),tile:new Ii(0,0),stencil:new Ii(0,0),circle:1}),Ut("SubdivisionGranularityExpression",Ii),Ut("SubdivisionGranularitySetting",kh);const cn=-32768,So=32767;class Ol{constructor(e,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Ze/e,this._canonical=s}_getKey(e,s){return(e+=32768)<<16|s+32768}_vertexToIndex(e,s){if(e<-32768||s<-32768||e>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),d=0|Math.round(s),g=this._getKey(l,d);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const y=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,y),this._vertexBuffer.push(l,d),y}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(d,g){const y=[];for(let w=0;w<g.length;w+=3){const N=g[w],A=g[w+1],R=g[w+2],I=d[2*N],B=d[2*N+1];(d[2*A]-I)*(d[2*R+1]-B)-(d[2*A+1]-B)*(d[2*R]-I)>0?(y.push(N),y.push(R),y.push(A)):(y.push(N),y.push(A),y.push(R))}return y})(this._vertexBuffer,e);const s=[],l=e.length;for(let d=0;d<l;d+=3){const g=[e[d+0],e[d+1],e[d+2]],y=[this._vertexBuffer[2*e[d+0]+0],this._vertexBuffer[2*e[d+0]+1],this._vertexBuffer[2*e[d+1]+0],this._vertexBuffer[2*e[d+1]+1],this._vertexBuffer[2*e[d+2]+0],this._vertexBuffer[2*e[d+2]+1]];let w=1/0,N=1/0,A=-1/0,R=-1/0;for(let X=0;X<3;X++){const te=y[2*X],oe=y[2*X+1];w=Math.min(w,te),A=Math.max(A,te),N=Math.min(N,oe),R=Math.max(R,oe)}if(w===A||N===R)continue;const I=Math.floor(w/this._granularityCellSize),B=Math.ceil(A/this._granularityCellSize),$=Math.floor(N/this._granularityCellSize),W=Math.ceil(R/this._granularityCellSize);if(I!==B||$!==W)for(let X=$;X<W;X++){const te=this._scanlineGenerateVertexRingForCellRow(X,y,g);jo(this._vertexBuffer,te,s)}else s.push(...g)}return s}_scanlineGenerateVertexRingForCellRow(e,s,l){const d=e*this._granularityCellSize,g=d+this._granularityCellSize,y=[];for(let w=0;w<3;w++){const N=s[2*w],A=s[2*w+1],R=s[2*(w+1)%6],I=s[(2*(w+1)+1)%6],B=s[2*(w+2)%6],$=s[(2*(w+2)+1)%6],W=R-N,X=I-A,te=W===0,oe=X===0,be=(d-A)/X,ne=(g-A)/X,me=Math.min(be,ne),Ee=Math.max(be,ne);if(!oe&&(me>=1||Ee<=0)||oe&&(A<d||A>g)){I>=d&&I<=g&&y.push(l[(w+1)%3]);continue}!oe&&me>0&&y.push(this._vertexToIndex(N+W*me,A+X*me));const Ie=N+W*Math.max(me,0),Je=N+W*Math.min(Ee,1);te||this._generateIntraEdgeVertices(y,N,A,R,I,Ie,Je),!oe&&Ee<1&&y.push(this._vertexToIndex(N+W*Ee,A+X*Ee)),(oe||I>=d&&I<=g)&&y.push(l[(w+1)%3]),!oe&&(I<=d||I>=g)&&this._generateInterEdgeVertices(y,N,A,R,I,B,$,Je,d,g)}return y}_generateIntraEdgeVertices(e,s,l,d,g,y,w){const N=d-s,A=g-l,R=A===0,I=R?Math.min(s,d):Math.min(y,w),B=R?Math.max(s,d):Math.max(y,w),$=Math.floor(I/this._granularityCellSize)+1,W=Math.ceil(B/this._granularityCellSize)-1;if(R?s<d:y<w)for(let X=$;X<=W;X++){const te=X*this._granularityCellSize;e.push(this._vertexToIndex(te,l+A*(te-s)/N))}else for(let X=W;X>=$;X--){const te=X*this._granularityCellSize;e.push(this._vertexToIndex(te,l+A*(te-s)/N))}}_generateInterEdgeVertices(e,s,l,d,g,y,w,N,A,R){const I=g-l,B=y-d,$=w-g,W=(A-g)/$,X=(R-g)/$,te=Math.min(W,X),oe=Math.max(W,X),be=d+B*te;let ne=Math.floor(Math.min(be,N)/this._granularityCellSize)+1,me=Math.ceil(Math.max(be,N)/this._granularityCellSize)-1,Ee=N<be;const Ie=$===0;if(Ie&&(w===A||w===R))return;if(Ie||te>=1||oe<=0){const pt=l-w,gt=y+(s-y)*Math.min((A-w)/pt,(R-w)/pt);ne=Math.floor(Math.min(gt,N)/this._granularityCellSize)+1,me=Math.ceil(Math.max(gt,N)/this._granularityCellSize)-1,Ee=N<gt}const Je=I>0?R:A;if(Ee)for(let pt=ne;pt<=me;pt++)e.push(this._vertexToIndex(pt*this._granularityCellSize,Je));else for(let pt=me;pt>=ne;pt--)e.push(this._vertexToIndex(pt*this._granularityCellSize,Je))}_generateOutline(e){const s=[];for(const l of e){const d=Ll(l,this._granularity,!0),g=this._pointArrayToIndices(d),y=[];for(let w=1;w<g.length;w++)y.push(g[w-1]),y.push(g[w]);s.push(y)}return s}_handlePoles(e){let s=!1,l=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(s||l)&&this._fillPoles(e,s,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let s=0;s<e.length;s+=2){const l=e[s+1];l===cn&&(e[s+1]=-32767),l===So&&(e[s+1]=32766)}}_generatePoleQuad(e,s,l,d,g,y){d>g!=(y===cn)?(e.push(s),e.push(l),e.push(this._vertexToIndex(d,y)),e.push(l),e.push(this._vertexToIndex(g,y)),e.push(this._vertexToIndex(d,y))):(e.push(l),e.push(s),e.push(this._vertexToIndex(d,y)),e.push(this._vertexToIndex(g,y)),e.push(l),e.push(this._vertexToIndex(d,y)))}_fillPoles(e,s,l){const d=this._vertexBuffer,g=Ze,y=e.length;for(let w=2;w<y;w+=3){const N=e[w-2],A=e[w-1],R=e[w],I=d[2*N],B=d[2*N+1],$=d[2*A],W=d[2*A+1],X=d[2*R],te=d[2*R+1];s&&(B===0&&W===0&&this._generatePoleQuad(e,N,A,I,$,cn),W===0&&te===0&&this._generatePoleQuad(e,A,R,$,X,cn),te===0&&B===0&&this._generatePoleQuad(e,R,N,X,I,cn)),l&&(B===g&&W===g&&this._generatePoleQuad(e,N,A,I,$,So),W===g&&te===g&&this._generatePoleQuad(e,A,R,$,X,So),te===g&&B===g&&this._generatePoleQuad(e,R,N,X,I,So))}}_initializeVertices(e){for(let s=0;s<e.length;s+=2)this._vertexToIndex(e[s],e[s+1])}subdividePolygonInternal(e,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:d}=(function(w){const N=[],A=[];for(const R of w)if(R.length!==0){R!==w[0]&&N.push(A.length/2);for(let I=0;I<R.length;I++)A.push(R[I].x),A.push(R[I].y)}return{flattened:A,holeIndices:N}})(e);let g;this._initializeVertices(l);try{const w=(function(A,R,I=2){const B=R&&R.length,$=B?R[0]*I:A.length;let W=Xf(A,0,$,I,!0);const X=[];if(!W||W.next===W.prev)return X;let te,oe,be;if(B&&(W=(function(ne,me,Ee,Ie){const Je=[];for(let pt=0,gt=me.length;pt<gt;pt++){const Tt=Xf(ne,me[pt]*Ie,pt<gt-1?me[pt+1]*Ie:ne.length,Ie,!1);Tt===Tt.next&&(Tt.steiner=!0),Je.push(dx(Tt))}Je.sort(Ni);for(let pt=0;pt<Je.length;pt++)Ee=gm(Je[pt],Ee);return Ee})(A,R,W,I)),A.length>80*I){te=A[0],oe=A[1];let ne=te,me=oe;for(let Ee=I;Ee<$;Ee+=I){const Ie=A[Ee],Je=A[Ee+1];Ie<te&&(te=Ie),Je<oe&&(oe=Je),Ie>ne&&(ne=Ie),Je>me&&(me=Je)}be=Math.max(ne-te,me-oe),be=be!==0?32767/be:0}return Mu(W,X,I,te,oe,be,0),X})(l,d),N=this._convertIndices(l,w);g=this._subdivideTrianglesScanline(N)}catch(w){console.error(w)}let y=[];return s&&(y=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:y}}_convertIndices(e,s){const l=[];for(let d=0;d<s.length;d++)l.push(this._vertexToIndex(e[2*s[d]],e[2*s[d]+1]));return l}_pointArrayToIndices(e){const s=[];for(let l=0;l<e.length;l++){const d=e[l];s.push(this._vertexToIndex(d.x,d.y))}return s}}function Qf(r,e,s,l=!0){return new Ol(s,e).subdividePolygonInternal(r,l)}function Ll(r,e,s=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const l=r[0],d=r[r.length-1],g=s&&(l.x!==d.x||l.y!==d.y);if(e<2)return g?[...r,r[0]]:[...r];const y=Math.floor(Ze/e),w=[];w.push(new O(r[0].x,r[0].y));const N=r.length,A=g?N:N-1;for(let R=0;R<A;R++){const I=r[R],B=R<N-1?r[R+1]:r[0],$=I.x,W=I.y,X=B.x,te=B.y,oe=$!==X,be=W!==te;if(!oe&&!be)continue;const ne=X-$,me=te-W,Ee=Math.abs(ne),Ie=Math.abs(me);let Je=$,pt=W;for(;;){const Tt=ne>0?(Math.floor(Je/y)+1)*y:(Math.ceil(Je/y)-1)*y,Lt=me>0?(Math.floor(pt/y)+1)*y:(Math.ceil(pt/y)-1)*y,kt=Math.abs(Je-Tt),yt=Math.abs(pt-Lt),ut=Math.abs(Je-X),qt=Math.abs(pt-te),Zt=oe?kt/Ee:Number.POSITIVE_INFINITY,ts=be?yt/Ie:Number.POSITIVE_INFINITY;if((ut<=kt||!oe)&&(qt<=yt||!be))break;if(Zt<ts&&oe||!be){Je=Tt,pt+=me*Zt;const Xt=new O(Je,Math.round(pt));w[w.length-1].x===Xt.x&&w[w.length-1].y===Xt.y||w.push(Xt)}else{Je+=ne*ts,pt=Lt;const Xt=new O(Math.round(Je),pt);w[w.length-1].x===Xt.x&&w[w.length-1].y===Xt.y||w.push(Xt)}}const gt=new O(X,te);w[w.length-1].x===gt.x&&w[w.length-1].y===gt.y||w.push(gt)}return w}function jo(r,e,s){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,d=r[2*e[0]];for(let N=1;N<e.length;N++){const A=r[2*e[N]];A<d&&(d=A,l=N)}const g=e.length;let y=l,w=(y+1)%g;for(;;){const N=y-1>=0?y-1:g-1,A=(w+1)%g,R=r[2*e[N]],I=r[2*e[A]],B=r[2*e[y]],$=r[2*e[y]+1],W=r[2*e[w]+1];let X=!1;if(R<I)X=!0;else if(R>I)X=!1;else{const te=W-$,oe=-(r[2*e[w]]-B),be=$<W?1:-1;((R-B)*te+(r[2*e[N]+1]-$)*oe)*be>((I-B)*te+(r[2*e[A]+1]-$)*oe)*be&&(X=!0)}if(X){const te=e[N],oe=e[y],be=e[w];te!==oe&&te!==be&&oe!==be&&s.push(be,oe,te),y--,y<0&&(y=g-1)}else{const te=e[A],oe=e[y],be=e[w];te!==oe&&te!==be&&oe!==be&&s.push(be,oe,te),w++,w>=g&&(w=0)}if(N===A)break}}function _m(r,e,s,l,d,g,y,w,N){const A=d.length/2,R=y&&w&&N;if(A<Bt.MAX_VERTEX_ARRAY_LENGTH){const I=e.prepareSegment(A,s,l),B=I.vertexLength;for(let X=0;X<g.length;X+=3)l.emplaceBack(B+g[X],B+g[X+1],B+g[X+2]);let $,W;I.vertexLength+=A,I.primitiveLength+=g.length/3,R&&(W=y.prepareSegment(A,s,w),$=W.vertexLength,W.vertexLength+=A);for(let X=0;X<d.length;X+=2)r(d[X],d[X+1]);if(R)for(let X=0;X<N.length;X++){const te=N[X];for(let oe=1;oe<te.length;oe+=2)w.emplaceBack($+te[oe-1],$+te[oe]);W.primitiveLength+=te.length/2}}else(function(I,B,$,W,X,te){const oe=[];for(let Ie=0;Ie<W.length/2;Ie++)oe.push(-1);const be={count:0};let ne=0,me=I.getOrCreateLatestSegment(B,$),Ee=me.vertexLength;for(let Ie=2;Ie<X.length;Ie+=3){const Je=X[Ie-2],pt=X[Ie-1],gt=X[Ie];let Tt=oe[Je]<ne,Lt=oe[pt]<ne,kt=oe[gt]<ne;me.vertexLength+((Tt?1:0)+(Lt?1:0)+(kt?1:0))>Bt.MAX_VERTEX_ARRAY_LENGTH&&(me=I.createNewSegment(B,$),ne=be.count,Tt=!0,Lt=!0,kt=!0,Ee=0);const yt=tl(oe,W,te,be,Je,Tt,me),ut=tl(oe,W,te,be,pt,Lt,me),qt=tl(oe,W,te,be,gt,kt,me);$.emplaceBack(Ee+yt-ne,Ee+ut-ne,Ee+qt-ne),me.primitiveLength++}})(e,s,l,d,g,r),R&&(function(I,B,$,W,X,te){const oe=[];for(let Ie=0;Ie<W.length/2;Ie++)oe.push(-1);const be={count:0};let ne=0,me=I.getOrCreateLatestSegment(B,$),Ee=me.vertexLength;for(let Ie=0;Ie<X.length;Ie++){const Je=X[Ie];for(let pt=1;pt<X[Ie].length;pt+=2){const gt=Je[pt-1],Tt=Je[pt];let Lt=oe[gt]<ne,kt=oe[Tt]<ne;me.vertexLength+((Lt?1:0)+(kt?1:0))>Bt.MAX_VERTEX_ARRAY_LENGTH&&(me=I.createNewSegment(B,$),ne=be.count,Lt=!0,kt=!0,Ee=0);const yt=tl(oe,W,te,be,gt,Lt,me),ut=tl(oe,W,te,be,Tt,kt,me);$.emplaceBack(Ee+yt-ne,Ee+ut-ne),me.primitiveLength++}}})(y,s,w,d,N,r),e.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function tl(r,e,s,l,d,g,y){if(g){const w=l.count;return s(e[2*d],e[2*d+1]),r[d]=l.count,l.count++,y.vertexLength++,w}return r[d]}class Pu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ge,this.indexArray=new tt,this.indexArray2=new Rt,this.programConfigurations=new Xo(e.layers,e.zoom),this.segments=new Bt,this.segments2=new Bt,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(e,s,l){this.hasDependencies=En("fill",this.layers,s);const d=this.layers[0].layout.get("fill-sort-key"),g=!d.isConstant(),y=[];for(const{feature:w,id:N,index:A,sourceLayerIndex:R}of e){const I=this.layers[0]._featureFilter.needGeometry,B=Nn(w,I);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),B,l))continue;const $=g?d.evaluate(B,{},l,s.availableImages):void 0,W={id:N,properties:w.properties,type:w.type,sourceLayerIndex:R,index:A,geometry:I?B.geometry:wo(w),patterns:{},sortKey:$};y.push(W)}g&&y.sort(((w,N)=>w.sortKey-N.sortKey));for(const w of y){const{geometry:N,index:A,sourceLayerIndex:R}=w;if(this.hasDependencies){const I=Yf("fill",this.layers,w,{zoom:this.zoom},s);this.patternFeatures.push(I)}else this.addFeature(w,N,A,l,{},s.subdivisionGranularity);s.featureIndex.insert(e[A].feature,N,A,R,this.index)}}update(e,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,s,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Th),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,l,d,g,y){for(const w of iu(s,500)){const N=Qf(w,d,y.fill.getGranularityForZoomLevel(d.z)),A=this.layoutVertexArray;_m(((R,I)=>{A.emplaceBack(R,I)}),this.segments,this.layoutVertexArray,this.indexArray,N.verticesFlattened,N.indicesTriangles,this.segments2,this.indexArray2,N.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:g,canonical:d})}}let Ad,Du;Ut("FillBucket",Pu,{omit:["layers","patternFeatures"]});var Ug={get paint(){return Du=Du||new Xr({"fill-antialias":new $t(Te.paint_fill["fill-antialias"]),"fill-opacity":new Wt(Te.paint_fill["fill-opacity"]),"fill-color":new Wt(Te.paint_fill["fill-color"]),"fill-outline-color":new Wt(Te.paint_fill["fill-outline-color"]),"fill-translate":new $t(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new rn(Te.paint_fill["fill-pattern"])})},get layout(){return Ad=Ad||new Xr({"fill-sort-key":new Wt(Te.layout_fill["fill-sort-key"])})}};class $g extends zr{constructor(e,s){super(e,Ug,s)}recalculate(e,s){super.recalculate(e,s);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Pu(e)}queryRadius(){return xh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:s,transform:l,pixelsToTileUnits:d}){return Bf(Uf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,d),s)}isTileClipped(){return!0}}const Mh=Mr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Vg=Mr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ep}=Mh;class kd{constructor(e,s,l,d,g){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=g,e.readFields(hx,this,s)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const s=e.readVarint()+e.pos,l=[];let d,g=1,y=0,w=0,N=0;for(;e.pos<s;){if(y<=0){const A=e.readVarint();g=7&A,y=A>>3}if(y--,g===1||g===2)w+=e.readSVarint(),N+=e.readSVarint(),g===1&&(d&&l.push(d),d=[]),d&&d.push(new O(w,N));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&l.push(d),l}bbox(){const e=this._pbf;e.pos=this._geometry;const s=e.readVarint()+e.pos;let l=1,d=0,g=0,y=0,w=1/0,N=-1/0,A=1/0,R=-1/0;for(;e.pos<s;){if(d<=0){const I=e.readVarint();l=7&I,d=I>>3}if(d--,l===1||l===2)g+=e.readSVarint(),y+=e.readSVarint(),g<w&&(w=g),g>N&&(N=g),y<A&&(A=y),y>R&&(R=y);else if(l!==7)throw new Error(`unknown command ${l}`)}return[w,A,N,R]}toGeoJSON(e,s,l){const d=this.extent*Math.pow(2,l),g=this.extent*e,y=this.extent*s,w=this.loadGeometry();function N(B){return[360*(B.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+y)/d)*Math.PI))-90]}function A(B){return B.map(N)}let R;if(this.type===1){const B=[];for(const W of w)B.push(W[0]);const $=A(B);R=B.length===1?{type:"Point",coordinates:$[0]}:{type:"MultiPoint",coordinates:$}}else if(this.type===2){const B=w.map(A);R=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=qg(w),$=[];for(const W of B)$.push(W.map(A));R=$.length===1?{type:"Polygon",coordinates:$[0]}:{type:"MultiPolygon",coordinates:$}}}const I={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function hx(r,e,s){r===1?e.id=s.readVarint():r===2?(function(l,d){const g=l.readVarint()+l.pos;for(;l.pos<g;){const y=d._keys[l.readVarint()],w=d._values[l.readVarint()];d.properties[y]=w}})(s,e):r===3?e.type=s.readVarint():r===4&&(e._geometry=s.pos)}function qg(r){const e=r.length;if(e<=1)return[r];const s=[];let l,d;for(let g=0;g<e;g++){const y=pr(r[g]);y!==0&&(d===void 0&&(d=y<0),d===y<0?(l&&s.push(l),l=[r[g]]):l&&l.push(r[g]))}return l&&s.push(l),s}function pr(r){let e=0;for(let s,l,d=0,g=r.length,y=g-1;d<g;y=d++)s=r[d],l=r[y],e+=(l.x-s.x)*(s.y+l.y);return e}kd.types=["Unknown","Point","LineString","Polygon"];class Dr{constructor(e,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Us,this,s),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const s=this._pbf.readVarint()+this._pbf.pos;return new kd(this._pbf,s,this.extent,this._keys,this._values)}}function Us(r,e,s){r===15?e.version=s.readVarint():r===1?e.name=s.readString():r===5?e.extent=s.readVarint():r===2?e._features.push(s.pos):r===3?e._keys.push(s.readString()):r===4&&e._values.push((function(l){let d=null;const g=l.readVarint()+l.pos;for(;l.pos<g;){const y=l.readVarint()>>3;d=y===1?l.readString():y===2?l.readFloat():y===3?l.readDouble():y===4?l.readVarint64():y===5?l.readVarint():y===6?l.readSVarint():y===7?l.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(s))}class $s{constructor(e,s){this.layers=e.readFields(br,{},s)}}function br(r,e,s){if(r===3){const l=new Dr(s,s.readVarint()+s.pos);l.length&&(e[l.name]=l)}}const Ia=Math.pow(2,13);function to(r,e,s,l,d,g,y,w){r.emplaceBack(e,s,2*Math.floor(l*Ia)+y,d*Ia*2,g*Ia*2,Math.round(w))}class Cc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Se,this.centroidVertexArray=new fe,this.indexArray=new tt,this.programConfigurations=new Xo(e.layers,e.zoom),this.segments=new Bt,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(e,s,l){this.features=[],this.hasDependencies=En("fill-extrusion",this.layers,s);for(const{feature:d,id:g,index:y,sourceLayerIndex:w}of e){const N=this.layers[0]._featureFilter.needGeometry,A=Nn(d,N);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),A,l))continue;const R={id:g,sourceLayerIndex:w,index:y,geometry:N?A.geometry:wo(d),properties:d.properties,type:d.type,patterns:{}};this.hasDependencies?this.features.push(Yf("fill-extrusion",this.layers,R,{zoom:this.zoom},s)):this.addFeature(R,R.geometry,y,l,{},s.subdivisionGranularity),s.featureIndex.insert(d,R.geometry,y,w,this.index,!0)}}addFeatures(e,s,l){for(const d of this.features){const{geometry:g}=d;this.addFeature(d,g,d.index,s,l,e.subdivisionGranularity)}}update(e,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ep),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Vg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,s,l,d,g,y){for(const w of iu(s,500)){const N={x:0,y:0,sampleCount:0},A=this.layoutVertexArray.length;this.processPolygon(N,d,e,w,y);const R=this.layoutVertexArray.length-A,I=Math.floor(N.x/N.sampleCount),B=Math.floor(N.y/N.sampleCount);for(let $=0;$<R;$++)this.centroidVertexArray.emplaceBack(I,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:g,canonical:d})}processPolygon(e,s,l,d,g){if(d.length<1||ii(d[0]))return;for(const I of d)I.length!==0&&vm(e,I);const y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=g.fill.getGranularityForZoomLevel(s.z),N=kd.types[l.type]==="Polygon";for(const I of d){if(I.length===0||ii(I))continue;const B=Ll(I,w,N);this._generateSideFaces(B,y)}if(!N)return;const A=Qf(d,s,w,!1),R=this.layoutVertexArray;_m(((I,B)=>{to(R,I,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles)}_generateSideFaces(e,s){let l=0;for(let d=1;d<e.length;d++){const g=e[d],y=e[d-1];if(Bl(g,y))continue;s.segment.vertexLength+4>Bt.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=g.sub(y)._perp()._unit(),N=y.dist(g);l+N>32768&&(l=0),to(this.layoutVertexArray,g.x,g.y,w.x,w.y,0,0,l),to(this.layoutVertexArray,g.x,g.y,w.x,w.y,0,1,l),l+=N,to(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,0,l),to(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,1,l);const A=s.segment.vertexLength;this.indexArray.emplaceBack(A,A+2,A+1),this.indexArray.emplaceBack(A+1,A+2,A+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function vm(r,e){for(let s=0;s<e.length;s++){const l=e[s];s===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(r.x+=l.x,r.y+=l.y,r.sampleCount++)}}function Bl(r,e){return r.x===e.x&&(r.x<0||r.x>Ze)||r.y===e.y&&(r.y<0||r.y>Ze)}function ii(r){return r.every((e=>e.x<0))||r.every((e=>e.x>Ze))||r.every((e=>e.y<0))||r.every((e=>e.y>Ze))}let Fl;Ut("FillExtrusionBucket",Cc,{omit:["layers","features"]});var Ru={get paint(){return Fl=Fl||new Xr({"fill-extrusion-opacity":new $t(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rn(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class bm extends zr{constructor(e,s){super(e,Ru,s)}createBucket(e){return new Cc(e)}queryRadius(){return xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:l,geometry:d,transform:g,pixelsToTileUnits:y,pixelPosMatrix:w}){const N=Uf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,y),A=this.paint.get("fill-extrusion-height").evaluate(s,l),R=this.paint.get("fill-extrusion-base").evaluate(s,l),I=(function($,W){const X=[];for(const te of $){const oe=[te.x,te.y,0,1];ht(oe,oe,W),X.push(new O(oe[0]/oe[3],oe[1]/oe[3]))}return X})(N,w),B=(function($,W,X,te){const oe=[],be=[],ne=te[8]*W,me=te[9]*W,Ee=te[10]*W,Ie=te[11]*W,Je=te[8]*X,pt=te[9]*X,gt=te[10]*X,Tt=te[11]*X;for(const Lt of $){const kt=[],yt=[];for(const ut of Lt){const qt=ut.x,Zt=ut.y,ts=te[0]*qt+te[4]*Zt+te[12],Xt=te[1]*qt+te[5]*Zt+te[13],Ns=te[2]*qt+te[6]*Zt+te[14],Zr=te[3]*qt+te[7]*Zt+te[15],ki=Ns+Ee,ga=Zr+Ie,nl=ts+Je,fn=Xt+pt,ea=Ns+gt,ya=Zr+Tt,di=new O((ts+ne)/ga,(Xt+me)/ga);di.z=ki/ga,kt.push(di);const ta=new O(nl/ya,fn/ya);ta.z=ea/ya,yt.push(ta)}oe.push(kt),be.push(yt)}return[oe,be]})(d,R,A,w);return(function($,W,X){let te=1/0;Bf(X,W)&&(te=Iu(X,W[0]));for(let oe=0;oe<W.length;oe++){const be=W[oe],ne=$[oe];for(let me=0;me<be.length-1;me++){const Ee=be[me],Ie=[Ee,be[me+1],ne[me+1],ne[me],Ee];ku(X,Ie)&&(te=Math.min(te,Iu(X,Ie)))}}return te!==1/0&&te})(B[0],B[1],I)}}function Qi(r,e){return r.x*e.x+r.y*e.y}function Iu(r,e){if(r.length===1){let s=0;const l=e[s++];let d;for(;!d||l.equals(d);)if(d=e[s++],!d)return 1/0;for(;s<e.length;s++){const g=e[s],y=r[0],w=d.sub(l),N=g.sub(l),A=y.sub(l),R=Qi(w,w),I=Qi(w,N),B=Qi(N,N),$=Qi(A,w),W=Qi(A,N),X=R*B-I*I,te=(B*$-I*W)/X,oe=(R*W-I*$)/X,be=l.z*(1-te-oe)+d.z*te+g.z*oe;if(isFinite(be))return be}return 1/0}{let s=1/0;for(const l of e)s=Math.min(s,l.z);return s}}const Ph=Mr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:un}=Ph,wm=Mr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tp}=wm,Gg=Math.cos(Math.PI/180*37.5),Dh=Math.pow(2,14)/.5;class Md{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((s=>{this.gradients[s.id]={}})),this.layoutVertexArray=new Me,this.layoutVertexArray2=new we,this.indexArray=new tt,this.programConfigurations=new Xo(e.layers,e.zoom),this.segments=new Bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(e,s,l){this.hasDependencies=En("line",this.layers,s)||this.hasLineDasharray(this.layers);const d=this.layers[0].layout.get("line-sort-key"),g=!d.isConstant(),y=[];for(const{feature:w,id:N,index:A,sourceLayerIndex:R}of e){const I=this.layers[0]._featureFilter.needGeometry,B=Nn(w,I);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),B,l))continue;const $=g?d.evaluate(B,{},l):void 0,W={id:N,properties:w.properties,type:w.type,sourceLayerIndex:R,index:A,geometry:I?B.geometry:wo(w),patterns:{},dashes:{},sortKey:$};y.push(W)}g&&y.sort(((w,N)=>w.sortKey-N.sortKey));for(const w of y){const{geometry:N,index:A,sourceLayerIndex:R}=w;this.hasDependencies?(En("line",this.layers,s)?Yf("line",this.layers,w,{zoom:this.zoom},s):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,w,this.zoom,s),this.patternFeatures.push(w)):this.addFeature(w,N,A,l,{},{},s.subdivisionGranularity),s.featureIndex.insert(e[A].feature,N,A,R,this.index)}}update(e,s,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,{imagePositions:l,dashPositions:d})}addFeatures(e,s,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,s,l,d,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,tp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,un),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,l,d,g,y,w){const N=this.layers[0].layout,A=N.get("line-join").evaluate(e,{}),R=N.get("line-cap"),I=N.get("line-miter-limit"),B=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const $ of s)this.addLine($,e,A,R,I,B,d,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:g,dashPositions:y,canonical:d})}addLine(e,s,l,d,g,y,w,N){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ll(e,w?N.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<e.length-1;ne++)this.totalDistance+=e[ne].dist(e[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=kd.types[s.type]==="Polygon";let R=e.length;for(;R>=2&&e[R-1].equals(e[R-2]);)R--;let I=0;for(;I<R-1&&e[I].equals(e[I+1]);)I++;if(R<(A?3:2))return;l==="bevel"&&(g=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let W,X,te,oe,be;this.e1=this.e2=-1,A&&(W=e[R-2],be=e[I].sub(W)._unit()._perp());for(let ne=I;ne<R;ne++){if(te=ne===R-1?A?e[I+1]:void 0:e[ne+1],te&&e[ne].equals(te))continue;be&&(oe=be),W&&(X=W),W=e[ne],be=te?te.sub(W)._unit()._perp():oe,oe=oe||be;let me=oe.add(be);me.x===0&&me.y===0||me._unit();const Ee=oe.x*be.x+oe.y*be.y,Ie=me.x*be.x+me.y*be.y,Je=Ie!==0?1/Ie:1/0,pt=2*Math.sqrt(2-2*Ie),gt=Ie<Gg&&X&&te,Tt=oe.x*be.y-oe.y*be.x>0;if(gt&&ne>I){const yt=W.dist(X);if(yt>2*B){const ut=W.sub(W.sub(X)._mult(B/yt)._round());this.updateDistance(X,ut),this.addCurrentVertex(ut,oe,0,0,$),X=ut}}const Lt=X&&te;let kt=Lt?l:A?"butt":d;if(Lt&&kt==="round"&&(Je<y?kt="miter":Je<=2&&(kt="fakeround")),kt==="miter"&&Je>g&&(kt="bevel"),kt==="bevel"&&(Je>2&&(kt="flipbevel"),Je<g&&(kt="miter")),X&&this.updateDistance(X,W),kt==="miter")me._mult(Je),this.addCurrentVertex(W,me,0,0,$);else if(kt==="flipbevel"){if(Je>100)me=be.mult(-1);else{const yt=Je*oe.add(be).mag()/oe.sub(be).mag();me._perp()._mult(yt*(Tt?-1:1))}this.addCurrentVertex(W,me,0,0,$),this.addCurrentVertex(W,me.mult(-1),0,0,$)}else if(kt==="bevel"||kt==="fakeround"){const yt=-Math.sqrt(Je*Je-1),ut=Tt?yt:0,qt=Tt?0:yt;if(X&&this.addCurrentVertex(W,oe,ut,qt,$),kt==="fakeround"){const Zt=Math.round(180*pt/Math.PI/20);for(let ts=1;ts<Zt;ts++){let Xt=ts/Zt;if(Xt!==.5){const Zr=Xt-.5;Xt+=Xt*Zr*(Xt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Zr*Zr+(.848013+Ee*(.215638*Ee-1.06021)))}const Ns=be.sub(oe)._mult(Xt)._add(oe)._unit()._mult(Tt?-1:1);this.addHalfVertex(W,Ns.x,Ns.y,!1,Tt,0,$)}}te&&this.addCurrentVertex(W,be,-ut,-qt,$)}else if(kt==="butt")this.addCurrentVertex(W,me,0,0,$);else if(kt==="square"){const yt=X?1:-1;this.addCurrentVertex(W,me,yt,yt,$)}else kt==="round"&&(X&&(this.addCurrentVertex(W,oe,0,0,$),this.addCurrentVertex(W,oe,1,1,$,!0)),te&&(this.addCurrentVertex(W,be,-1,-1,$,!0),this.addCurrentVertex(W,be,0,0,$)));if(gt&&ne<R-1){const yt=W.dist(te);if(yt>2*B){const ut=W.add(te.sub(W)._mult(B/yt)._round());this.updateDistance(W,ut),this.addCurrentVertex(ut,be,0,0,$),W=ut}}}}addCurrentVertex(e,s,l,d,g,y=!1){const w=s.y*d-s.x,N=-s.y-s.x*d;this.addHalfVertex(e,s.x+s.y*l,s.y-s.x*l,y,!1,l,g),this.addHalfVertex(e,w,N,y,!0,-d,g),this.distance>Dh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,s,l,d,g,y))}addHalfVertex({x:e,y:s},l,d,g,y,w,N){const A=.5*(this.lineClips?this.scaledDistance*(Dh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),N.primitiveLength++),y?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}hasLineDasharray(e){for(const s of e){const l=s.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,s,l,d){for(const g of e){const y=g.paint.get("line-dasharray");if(!y||y.value.kind==="constant")continue;const w=g.layout.get("line-cap")==="round",N={dasharray:y.value.evaluate({zoom:l-1},s,{}),round:w},A={dasharray:y.value.evaluate({zoom:l},s,{}),round:w},R={dasharray:y.value.evaluate({zoom:l+1},s,{}),round:w},I=`${N.dasharray.join(",")},${N.round}`,B=`${A.dasharray.join(",")},${A.round}`,$=`${R.dasharray.join(",")},${R.round}`;d.dashDependencies[I]=N,d.dashDependencies[B]=A,d.dashDependencies[$]=R,s.dashes[g.id]={min:I,mid:B,max:$}}}}let Ul,Ci;Ut("LineBucket",Md,{omit:["layers","patternFeatures"]});var $l={get paint(){return Ci=Ci||new Xr({"line-opacity":new Wt(Te.paint_line["line-opacity"]),"line-color":new Wt(Te.paint_line["line-color"]),"line-translate":new $t(Te.paint_line["line-translate"]),"line-translate-anchor":new $t(Te.paint_line["line-translate-anchor"]),"line-width":new Wt(Te.paint_line["line-width"]),"line-gap-width":new Wt(Te.paint_line["line-gap-width"]),"line-offset":new Wt(Te.paint_line["line-offset"]),"line-blur":new Wt(Te.paint_line["line-blur"]),"line-dasharray":new rn(Te.paint_line["line-dasharray"]),"line-pattern":new rn(Te.paint_line["line-pattern"]),"line-gradient":new Su(Te.paint_line["line-gradient"])})},get layout(){return Ul=Ul||new Xr({"line-cap":new $t(Te.layout_line["line-cap"]),"line-join":new Wt(Te.layout_line["line-join"]),"line-miter-limit":new $t(Te.layout_line["line-miter-limit"]),"line-round-limit":new $t(Te.layout_line["line-round-limit"]),"line-sort-key":new Wt(Te.layout_line["line-sort-key"])})}};class Pd extends Wt{possiblyEvaluate(e,s){return s=new sr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(e,s)}evaluate(e,s,l,d){return s=Dt({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,l,d)}}let so;class Sm extends zr{constructor(e,s){super(e,$l,s),this.gradientVersion=0,so||(so=new Pd($l.paint.properties["line-width"].specification),so.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(s)&&s._styleExpression.expression instanceof zo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,s){super.recalculate(e,s),this.paint._values["line-floorwidth"]=so.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Md(e)}queryRadius(e){const s=e,l=sp(Rl("line-width",this,s),Rl("line-gap-width",this,s)),d=Rl("line-offset",this,s);return l/2+Math.abs(d)+xh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:l,geometry:d,transform:g,pixelsToTileUnits:y}){const w=Uf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,y),N=y/2*sp(this.paint.get("line-width").evaluate(s,l),this.paint.get("line-gap-width").evaluate(s,l)),A=this.paint.get("line-offset").evaluate(s,l);return A&&(d=(function(R,I){const B=[];for(let $=0;$<R.length;$++){const W=$f(R[$]),X=[];for(let te=0;te<W.length;te++){const oe=W[te],be=W[te-1],ne=W[te+1],me=te===0?new O(0,0):oe.sub(be)._unit()._perp(),Ee=te===W.length-1?new O(0,0):ne.sub(oe)._unit()._perp(),Ie=me._add(Ee)._unit(),Je=Ie.x*Ee.x+Ie.y*Ee.y;Je!==0&&Ie._mult(1/Je),X.push(Ie._mult(I)._add(oe))}B.push(X)}return B})(d,A*y)),(function(R,I,B){for(let $=0;$<I.length;$++){const W=I[$];if(R.length>=3){for(let X=0;X<W.length;X++)if(Jo(R,W[X]))return!0}if(Ti(R,W,B))return!0}return!1})(w,d,N)}isTileClipped(){return!0}}function sp(r,e){return e>0?e+2*r:r}const Hg=Mr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Rh=Mr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const jm=Mr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Mr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const dn=Mr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zg=Mr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function hn(r,e,s){return r.sections.forEach((l=>{l.text=(function(d,g,y){const w=g.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),sn.applyArabicShaping&&(d=sn.applyArabicShaping(d)),d})(l.text,e,s)})),r}Mr([{name:"triangle",components:3,type:"Uint16"}]),Mr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Mr([{type:"Float32",name:"offsetX"}]),Mr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Mr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var xi=24;const Dd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},fx={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ac={40:!0};function Ih(r,e,s,l,d,g){if("fontStack"in e){const y=s[e.fontStack],w=y&&y[r];return w?w.metrics.advance*e.scale+d:0}{const y=l[e.imageName];return y?y.displaySize[0]*e.scale*xi/g+d:0}}function rp(r,e,s,l){const d=Math.pow(r-e,2);return l?r<e?d/2:2*d:d+Math.abs(s)*s}function Rd(r,e,s){let l=0;return r===10&&(l-=1e4),s&&(l+=150),r!==40&&r!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Tm(r,e,s,l,d,g){let y=null,w=rp(e,s,d,g);for(const N of l){const A=rp(e-N.x,s,d,g)+N.badness;A<=w&&(y=N,w=A)}return{index:r,x:e,priorBreak:y,badness:w}}function Nm(r){return r?Nm(r.priorBreak).concat(r.index):[]}class zu{constructor(e="",s=[],l=[]){this.text=e,this.sections=s,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,s){const l=new zu;for(let d=0;d<e.sections.length;d++){const g=e.sections[d];g.image?l.addImageSection(g):l.addTextSection(g,s)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let s="",l={premature:!0,value:void 0};const d=e[Symbol.iterator]();let g=d.next();const y=e[Symbol.iterator]();y.next();let w=y.next();for(;!g.done;)s+=!w.done&&Xn(w.value.codePointAt(0))&&!Dd[w.value]||!l.premature&&Xn(l.value.codePointAt(0))&&!Dd[l.value]||!Dd[g.value]?g.value:Dd[g.value],l={value:g.value,premature:!1},g=d.next(),w=y.next();return s})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),s=e?e[0].length:0,l=this.text.match(/\S\s*$/),d=l?l[0].length-1:0;this.text=this.text.substring(s,this.text.length-d),this.sectionIndex=this.sectionIndex.slice(s,this.sectionIndex.length-d)}substring(e,s){const l=[...this.text].slice(e,s).join(""),d=this.sectionIndex.slice(e,s);return new zu(l,this.sections,d)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,s)=>Math.max(e,this.sections[s].scale)),0)}getMaxImageSize(e){let s=0,l=0;for(let d=0;d<this.length();d++){const g=this.getSection(d);if("imageName"in g){const y=e[g.imageName];if(!y)continue;const w=y.displaySize;s=Math.max(s,w[0]),l=Math.max(l,w[1])}}return{maxImageWidth:s,maxImageHeight:l}}addTextSection(e,s){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||s});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void us("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:s}),this.sectionIndex.push(this.sections.length-1)):us("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,s,l,d,g){const y=[],w=this.determineAverageLineWidth(e,s,l,d,g),N=this.hasZeroWidthSpaces();let A=0,R=0;const I=this.text[Symbol.iterator]();let B=I.next();const $=this.text[Symbol.iterator]();$.next();let W=$.next();const X=this.text[Symbol.iterator]();X.next(),X.next();let te=X.next();for(;!B.done;){const oe=this.getSection(R),be=B.value.codePointAt(0);if(xu(be)||(A+=Ih(be,oe,l,d,e,g)),!W.done){const ne=Zn(be),me=W.value.codePointAt(0);(fx[be]||ne||"imageName"in oe||!te.done&&Ac[me])&&y.push(Tm(R+1,A,w,y,Rd(be,me,ne&&N),!1))}R++,B=I.next(),W=$.next(),te=X.next()}return Nm(Tm(this.length(),A,w,y,0,!0))}determineAverageLineWidth(e,s,l,d,g){let y=0,w=0;for(const N of this.text){const A=this.getSection(w);y+=Ih(N.codePointAt(0),A,l,d,e,g),w++}return y/Math.max(1,Math.ceil(y/s))}}const ip=4294967296,zh=1/ip,ap=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class np{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,s,l=this.length){for(;this.pos<l;){const d=this.readVarint(),g=d>>3,y=this.pos;this.type=7&d,e(g,s,this),this.pos===y&&this.skip(d)}return s}readMessage(e,s){return this.readFields(e,s,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*ip;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*ip;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const s=this.buf;let l,d;return d=s[this.pos++],l=127&d,d<128?l:(d=s[this.pos++],l|=(127&d)<<7,d<128?l:(d=s[this.pos++],l|=(127&d)<<14,d<128?l:(d=s[this.pos++],l|=(127&d)<<21,d<128?l:(d=s[this.pos],l|=(15&d)<<28,(function(g,y,w){const N=w.buf;let A,R;if(R=N[w.pos++],A=(112&R)>>4,R<128||(R=N[w.pos++],A|=(127&R)<<3,R<128)||(R=N[w.pos++],A|=(127&R)<<10,R<128)||(R=N[w.pos++],A|=(127&R)<<17,R<128)||(R=N[w.pos++],A|=(127&R)<<24,R<128)||(R=N[w.pos++],A|=(1&R)<<31,R<128))return Id(g,A,y);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,s=this.pos;return this.pos=e,e-s>=12&&ap?ap.decode(this.buf.subarray(s,e)):(function(l,d,g){let y="",w=d;for(;w<g;){const N=l[w];let A,R,I,B=null,$=N>239?4:N>223?3:N>191?2:1;if(w+$>g)break;$===1?N<128&&(B=N):$===2?(A=l[w+1],(192&A)==128&&(B=(31&N)<<6|63&A,B<=127&&(B=null))):$===3?(A=l[w+1],R=l[w+2],(192&A)==128&&(192&R)==128&&(B=(15&N)<<12|(63&A)<<6|63&R,(B<=2047||B>=55296&&B<=57343)&&(B=null))):$===4&&(A=l[w+1],R=l[w+2],I=l[w+3],(192&A)==128&&(192&R)==128&&(192&I)==128&&(B=(15&N)<<18|(63&A)<<12|(63&R)<<6|63&I,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,$=1):B>65535&&(B-=65536,y+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),y+=String.fromCharCode(B),w+=$}return y})(this.buf,s,e)}readBytes(){const e=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,e);return this.pos=e,s}readPackedVarint(e=[],s){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(s));return e}readPackedSVarint(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const s=7&e;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(e,s){this.writeVarint(e<<3|s)}realloc(e){let s=this.length||16;for(;s<this.pos+e;)s*=2;if(s!==this.length){const l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*zh),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*zh),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(s,l){let d,g;if(s>=0?(d=s%4294967296|0,g=s/4294967296|0):(d=~(-s%4294967296),g=~(-s/4294967296),4294967295^d?d=d+1|0:(d=0,g=g+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(y,w,N){N.buf[N.pos++]=127&y|128,y>>>=7,N.buf[N.pos++]=127&y|128,y>>>=7,N.buf[N.pos++]=127&y|128,y>>>=7,N.buf[N.pos++]=127&y|128,N.buf[N.pos]=127&(y>>>=7)})(d,0,l),(function(y,w){const N=(7&y)<<4;w.buf[w.pos++]|=N|((y>>>=3)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y)))))})(g,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const s=this.pos;this.pos=(function(d,g,y){for(let w,N,A=0;A<g.length;A++){if(w=g.charCodeAt(A),w>55295&&w<57344){if(!N){w>56319||A+1===g.length?(d[y++]=239,d[y++]=191,d[y++]=189):N=w;continue}if(w<56320){d[y++]=239,d[y++]=191,d[y++]=189,N=w;continue}w=N-55296<<10|w-56320|65536,N=null}else N&&(d[y++]=239,d[y++]=191,d[y++]=189,N=null);w<128?d[y++]=w:(w<2048?d[y++]=w>>6|192:(w<65536?d[y++]=w>>12|224:(d[y++]=w>>18|240,d[y++]=w>>12&63|128),d[y++]=w>>6&63|128),d[y++]=63&w|128)}return y})(this.buf,e,this.pos);const l=this.pos-s;l>=128&&Wg(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const s=e.length;this.writeVarint(s),this.realloc(s);for(let l=0;l<s;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,s){this.pos++;const l=this.pos;e(s,this);const d=this.pos-l;d>=128&&Wg(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d}writeMessage(e,s,l){this.writeTag(e,2),this.writeRawMessage(s,l)}writePackedVarint(e,s){s.length&&this.writeMessage(e,Yg,s)}writePackedSVarint(e,s){s.length&&this.writeMessage(e,Xg,s)}writePackedBoolean(e,s){s.length&&this.writeMessage(e,Kg,s)}writePackedFloat(e,s){s.length&&this.writeMessage(e,zd,s)}writePackedDouble(e,s){s.length&&this.writeMessage(e,op,s)}writePackedFixed32(e,s){s.length&&this.writeMessage(e,Jg,s)}writePackedSFixed32(e,s){s.length&&this.writeMessage(e,Qg,s)}writePackedFixed64(e,s){s.length&&this.writeMessage(e,ey,s)}writePackedSFixed64(e,s){s.length&&this.writeMessage(e,ty,s)}writeBytesField(e,s){this.writeTag(e,2),this.writeBytes(s)}writeFixed32Field(e,s){this.writeTag(e,5),this.writeFixed32(s)}writeSFixed32Field(e,s){this.writeTag(e,5),this.writeSFixed32(s)}writeFixed64Field(e,s){this.writeTag(e,1),this.writeFixed64(s)}writeSFixed64Field(e,s){this.writeTag(e,1),this.writeSFixed64(s)}writeVarintField(e,s){this.writeTag(e,0),this.writeVarint(s)}writeSVarintField(e,s){this.writeTag(e,0),this.writeSVarint(s)}writeStringField(e,s){this.writeTag(e,2),this.writeString(s)}writeFloatField(e,s){this.writeTag(e,5),this.writeFloat(s)}writeDoubleField(e,s){this.writeTag(e,1),this.writeDouble(s)}writeBooleanField(e,s){this.writeVarintField(e,+s)}}function Id(r,e,s){return s?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Wg(r,e,s){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(l);for(let d=s.pos-1;d>=r;d--)s.buf[d+l]=s.buf[d]}function Yg(r,e){for(let s=0;s<r.length;s++)e.writeVarint(r[s])}function Xg(r,e){for(let s=0;s<r.length;s++)e.writeSVarint(r[s])}function zd(r,e){for(let s=0;s<r.length;s++)e.writeFloat(r[s])}function op(r,e){for(let s=0;s<r.length;s++)e.writeDouble(r[s])}function Kg(r,e){for(let s=0;s<r.length;s++)e.writeBoolean(r[s])}function Jg(r,e){for(let s=0;s<r.length;s++)e.writeFixed32(r[s])}function Qg(r,e){for(let s=0;s<r.length;s++)e.writeSFixed32(r[s])}function ey(r,e){for(let s=0;s<r.length;s++)e.writeFixed64(r[s])}function ty(r,e){for(let s=0;s<r.length;s++)e.writeSFixed64(r[s])}function sy(r,e,s){r===1&&s.readMessage(lp,e)}function lp(r,e,s){if(r===3){const{id:l,bitmap:d,width:g,height:y,left:w,top:N,advance:A}=s.readMessage(ry,{});e.push({id:l,bitmap:new bh({width:g+6,height:y+6},d),metrics:{width:g,height:y,left:w,top:N,advance:A}})}}function ry(r,e,s){r===1?e.id=s.readVarint():r===2?e.bitmap=s.readBytes():r===3?e.width=s.readVarint():r===4?e.height=s.readVarint():r===5?e.left=s.readSVarint():r===6?e.top=s.readSVarint():r===7&&(e.advance=s.readVarint())}function Em(r){let e=0,s=0;for(const y of r)e+=y.w*y.h,s=Math.max(s,y.w);r.sort(((y,w)=>w.h-y.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let d=0,g=0;for(const y of r)for(let w=l.length-1;w>=0;w--){const N=l[w];if(!(y.w>N.w||y.h>N.h)){if(y.x=N.x,y.y=N.y,g=Math.max(g,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===N.w&&y.h===N.h){const A=l.pop();A&&w<l.length&&(l[w]=A)}else y.h===N.h?(N.x+=y.w,N.w-=y.w):y.w===N.w?(N.y+=y.h,N.h-=y.h):(l.push({x:N.x+y.w,y:N.y,w:N.w-y.w,h:y.h}),N.y+=y.h,N.h-=y.h);break}}return{w:d,h:g,fill:e/(d*g)||0}}class mr{constructor(e,{pixelRatio:s,version:l,stretchX:d,stretchY:g,content:y,textFitWidth:w,textFitHeight:N}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=d,this.stretchY=g,this.content=y,this.version=l,this.textFitWidth=w,this.textFitHeight=N}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class cp{constructor(e,s){const l={},d={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,l,g),this.addImages(s,d,g);const{w:y,h:w}=Em(g),N=new ha({width:y||1,height:w||1});for(const A in e){const R=e[A],I=l[A].paddedRect;ha.copy(R.data,N,{x:0,y:0},{x:I.x+1,y:I.y+1},R.data)}for(const A in s){const R=s[A],I=d[A].paddedRect,B=I.x+1,$=I.y+1,W=R.data.width,X=R.data.height;ha.copy(R.data,N,{x:0,y:0},{x:B,y:$},R.data),ha.copy(R.data,N,{x:0,y:X-1},{x:B,y:$-1},{width:W,height:1}),ha.copy(R.data,N,{x:0,y:0},{x:B,y:$+X},{width:W,height:1}),ha.copy(R.data,N,{x:W-1,y:0},{x:B-1,y:$},{width:1,height:X}),ha.copy(R.data,N,{x:0,y:0},{x:B+W,y:$},{width:1,height:X})}this.image=N,this.iconPositions=l,this.patternPositions=d}addImages(e,s,l){for(const d in e){const g=e[d],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};l.push(y),s[d]=new mr(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),s)}patchUpdatedImage(e,s,l){if(!e||!s||e.version===s.version)return;e.version=s.version;const[d,g]=e.tl;l.update(s.data,void 0,{x:d,y:g})}}var kc;function Oh(r,e,s,l,d,g,y,w,N,A,R,I,B,$,W){const X=zu.fromFeature(r,d);let te;I===T.az.vertical&&X.verticalizePunctuation();let oe=X.determineLineBreaks(A,g,e,l,$);const{processBidirectionalText:be,processStyledBidirectionalText:ne}=sn;if(be&&X.sections.length===1){te=[],oe=oe.map((Je=>X.toCodeUnitIndex(Je)));const Ie=be(X.toString(),oe);for(const Je of Ie){const pt=[...Je].map((()=>0));te.push(new zu(Je,X.sections,pt))}}else if(ne){te=[],oe=oe.map((gt=>X.toCodeUnitIndex(gt)));let Ie=0;const Je=[];for(const gt of X.text)Je.push(...Array(gt.length).fill(X.sectionIndex[Ie])),Ie++;const pt=ne(X.text,Je,oe);for(const gt of pt){const Tt=[];let Lt="";for(const kt of gt[0])Tt.push(gt[1][Lt.length]),Lt+=kt;te.push(new zu(gt[0],X.sections,Tt))}}else te=(function(Ie,Je){const pt=[];let gt=0;for(const Tt of Je)pt.push(Ie.substring(gt,Tt)),gt=Tt;return gt<Ie.length()&&pt.push(Ie.substring(gt,Ie.length())),pt})(X,oe);const me=[],Ee={positionedLines:me,text:X.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:I,iconsInText:!1,verticalizable:!1};return(function(Ie,Je,pt,gt,Tt,Lt,kt,yt,ut,qt,Zt,ts){let Xt=0,Ns=0,Zr=0,ki=0;const ga=yt==="right"?1:yt==="left"?0:.5,nl=xi/ts;let fn=0;for(const di of Tt){di.trim();const ta=di.getMaxScale(),Ba={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[fn]=Ba;const Fa=Ba.positionedGlyphs;let kn=0;if(!di.length()){Ns+=Lt,++fn;continue}const xa=px(gt,di,nl);let Mn=0;for(const $i of di.text){const Jr=di.getSection(Mn),Mi=$i.codePointAt(0),ai=up(ut,Zt,Mi),Vi={glyph:Mi,imageName:null,x:Xt,y:Ns+-17,vertical:ai,scale:1,fontStack:"",sectionIndex:di.getSectionIndex(Mn),metrics:null,rect:null};let $u;if("fontStack"in Jr){if($u=Od(Jr,Mi,ai,xa,Je,pt),!$u)continue;Vi.fontStack=Jr.fontStack}else{if(Ie.iconsInText=!0,Jr.scale*=nl,$u=Am(Jr,ai,ta,xa,gt),!$u)continue;kn=Math.max(kn,$u.imageOffset),Vi.imageName=Jr.imageName}const{rect:Xl,metrics:rg,baselineOffset:Gd}=$u;Vi.y+=Gd,Vi.scale=Jr.scale,Vi.metrics=rg,Vi.rect=Xl,Fa.push(Vi),ai?(Ie.verticalizable=!0,Xt+=("imageName"in Jr?rg.advance:xi)*Jr.scale+qt):Xt+=rg.advance*Jr.scale+qt,Mn++}Fa.length!==0&&(Zr=Math.max(Xt-qt,Zr),dp(Fa,0,Fa.length-1,ga)),Xt=0,Ba.lineOffset=Math.max(kn,(ta-1)*xi);const ol=Lt*ta+kn;Ns+=ol,ki=Math.max(ol,ki),++fn}const{horizontalAlign:ea,verticalAlign:ya}=Cm(kt);(function(di,ta,Ba,Fa,kn,xa,Mn,ol,$i){const Jr=(ta-Ba)*kn;let Mi=0;Mi=xa!==Mn?-ol*Fa- -17:-Fa*$i*Mn+.5*Mn;for(const ai of di)for(const Vi of ai.positionedGlyphs)Vi.x+=Jr,Vi.y+=Mi})(Ie.positionedLines,ga,ea,ya,Zr,ki,Lt,Ns,Tt.length),Ie.top+=-ya*Ns,Ie.bottom=Ie.top+Ns,Ie.left+=-ea*Zr,Ie.right=Ie.left+Zr})(Ee,e,s,l,te,y,w,N,I,A,B,W),!(function(Ie){for(const Je of Ie)if(Je.positionedGlyphs.length!==0)return!1;return!0})(me)&&Ee}function Cm(r){let e=.5,s=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function px(r,e,s){const l=e.getMaxScale()*xi,{maxImageWidth:d,maxImageHeight:g}=e.getMaxImageSize(r),y=Math.max(l,g*s);return{verticalLineContentWidth:Math.max(l,d*s),horizontalLineContentHeight:y}}function iy(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function up(r,e,s){return!(r===T.az.horizontal||!e&&!Nl(s)||e&&(xu(s)||(l=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function Od(r,e,s,l,d,g){const y=g[r.fontStack],w=(function(A,R,I,B){if(A&&A.rect)return A;const $=R[I.fontStack],W=$&&$[B];return W?{rect:null,metrics:W.metrics}:null})(y&&y[e],d,r,e);if(w===null)return null;let N;if(s)N=l.verticalLineContentWidth-r.scale*xi;else{const A=iy(r.verticalAlign);N=(l.horizontalLineContentHeight-r.scale*xi)*A}return{rect:w.rect,metrics:w.metrics,baselineOffset:N}}function Am(r,e,s,l,d){const g=d[r.imageName];if(!g)return null;const y=g.paddedRect,w=g.displaySize,N={width:w[0],height:w[1],left:1,top:-3,advance:e?w[1]:w[0]};let A;if(e)A=l.verticalLineContentWidth-w[1]*r.scale;else{const R=iy(r.verticalAlign);A=(l.horizontalLineContentHeight-w[1]*r.scale)*R}return{rect:y,metrics:N,baselineOffset:A,imageOffset:(e?w[0]:w[1])*r.scale-xi*s}}function dp(r,e,s,l){if(l===0)return;const d=r[s],g=(r[s].x+d.metrics.advance*d.scale)*l;for(let y=e;y<=s;y++)r[y].x-=g}function km(r,e,s){const{horizontalAlign:l,verticalAlign:d}=Cm(s),g=e[0]-r.displaySize[0]*l,y=e[1]-r.displaySize[1]*d;return{image:r,top:y,bottom:y+r.displaySize[1],left:g,right:g+r.displaySize[0]}}function Vl(r){var e,s;let l=r.left,d=r.top,g=r.right-l,y=r.bottom-d;const w=(e=r.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",N=(s=r.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",A=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(N==="proportional"){if(w==="stretchOnly"&&g/y<A||w==="proportional"){const R=Math.ceil(y*A);l*=R/g,g=R}}else if(w==="proportional"&&N==="stretchOnly"&&A!==0&&g/y>A){const R=Math.ceil(g/A);d*=R/y,y=R}return{x1:l,y1:d,x2:l+g,y2:d+y}}function To(r,e,s,l,d,g){const y=r.image;let w;if(y.content){const te=y.content,oe=y.pixelRatio||1;w=[te[0]/oe,te[1]/oe,y.displaySize[0]-te[2]/oe,y.displaySize[1]-te[3]/oe]}const N=e.left*g,A=e.right*g;let R,I,B,$;s==="width"||s==="both"?($=d[0]+N-l[3],I=d[0]+A+l[1]):($=d[0]+(N+A-y.displaySize[0])/2,I=$+y.displaySize[0]);const W=e.top*g,X=e.bottom*g;return s==="height"||s==="both"?(R=d[1]+W-l[0],B=d[1]+X+l[2]):(R=d[1]+(W+X-y.displaySize[1])/2,B=R+y.displaySize[1]),{image:y,top:R,right:I,bottom:B,left:$,collisionPadding:w}}Ut("ImagePosition",mr),Ut("ImageAtlas",cp),T.az=void 0,(kc=T.az||(T.az={}))[kc.none=0]="none",kc[kc.horizontal=1]="horizontal",kc[kc.vertical=2]="vertical",kc[kc.horizontalOnly=3]="horizontalOnly";const Cn=128,Mc=32640;function Mm(r,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new sr(r+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:d}=s;let g=0;for(;g<l.length&&l[g]<=r;)g++;g=Math.max(0,g-1);let y=g;for(;y<l.length&&l[y]<r+1;)y++;y=Math.min(l.length-1,y);const w=l[g],N=l[y];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:N,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:N,minSize:s.evaluate(new sr(w)),maxSize:s.evaluate(new sr(N)),interpolationType:d}}}function hp(r,e,s){let l="never";const d=r.get(e);return d?l=d:r.get(s)&&(l="always"),l}const ay=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lh(r,e,s,l,d,g,y,w,N,A,R,I,B){const $=w?Math.min(Mc,Math.round(w[0])):0,W=w?Math.min(Mc,Math.round(w[1])):0;r.emplaceBack(e,s,Math.round(32*l),Math.round(32*d),g,y,($<<1)+(N?1:0),W,16*A,16*R,256*I,256*B)}function Pm(r,e,s){r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s)}function Dm(r){for(const e of r.sections)if(go(e.text))return!0;return!1}class fp{constructor(e){this.layoutVertexArray=new je,this.indexArray=new tt,this.programConfigurations=e,this.segments=new Bt,this.dynamicLayoutVertexArray=new qe,this.opacityVertexArray=new st,this.hasVisibleVertices=!1,this.placedSymbolArray=new j}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Rh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ay,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ut("SymbolBuffers",fp);class pp{constructor(e,s,l){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Bt,this.collisionVertexArray=new et}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ut("CollisionBuffers",pp);class Ld{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((y=>y.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Mm(this.zoom,s["text-size"]),this.iconSizeData=Mm(this.zoom,s["icon-size"]);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),g=l.get("symbol-z-order");this.canOverlap=hp(l,"text-overlap","text-allow-overlap")!=="never"||hp(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((y=>T.az[y]))),this.stateDependentLayerIds=this.layers.filter((y=>y.isStateDependent())).map((y=>y.id)),this.sourceID=e.sourceID}createArrays(){this.text=new fp(new Xo(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new fp(new Xo(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new z,this.lineVertexArray=new L,this.symbolInstances=new M,this.textAnchorOffsets=new V}calculateGlyphDependencies(e,s,l,d,g){for(const y of e)if(s[y.codePointAt(0)]=!0,(l||d)&&g){const w=Dd[y];w&&(s[w.codePointAt(0)]=!0)}}populate(e,s,l){const d=this.layers[0],g=d.layout,y=g.get("text-font"),w=g.get("text-field"),N=g.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof pi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),R=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,I=g.get("symbol-sort-key");if(this.features=[],!A&&!R)return;const B=s.iconDependencies,$=s.glyphDependencies,W=s.availableImages,X=new sr(this.zoom);for(const{feature:te,id:oe,index:be,sourceLayerIndex:ne}of e){const me=d._featureFilter.needGeometry,Ee=Nn(te,me);if(!d._featureFilter.filter(X,Ee,l))continue;let Ie,Je;if(me||(Ee.geometry=wo(te)),A){const gt=d.getValueAndResolveTokens("text-field",Ee,l,W),Tt=pi.factory(gt),Lt=this.hasRTLText=this.hasRTLText||Dm(Tt);(!Lt||sn.getRTLTextPluginStatus()==="unavailable"||Lt&&sn.isParsed())&&(Ie=hn(Tt,d,Ee))}if(R){const gt=d.getValueAndResolveTokens("icon-image",Ee,l,W);Je=gt instanceof Zi?gt:Zi.fromString(gt)}if(!Ie&&!Je)continue;const pt=this.sortFeaturesByKey?I.evaluate(Ee,{},l):void 0;if(this.features.push({id:oe,text:Ie,icon:Je,index:be,sourceLayerIndex:ne,geometry:Ee.geometry,properties:te.properties,type:kd.types[te.type],sortKey:pt}),Je&&(B[Je.name]=!0),Ie){const gt=y.evaluate(Ee,{},l).join(","),Tt=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.az.vertical)>=0;for(const Lt of Ie.sections)if(Lt.image)B[Lt.image.name]=!0;else{const kt=Wn(Ie.toString()),yt=Lt.fontStack||gt,ut=$[yt]=$[yt]||{};this.calculateGlyphDependencies(Lt.text,ut,Tt,this.allowVerticalPlacement,kt)}}}g.get("symbol-placement")==="line"&&(this.features=(function(te){const oe={},be={},ne=[];let me=0;function Ee(gt){ne.push(te[gt]),me++}function Ie(gt,Tt,Lt){const kt=be[gt];return delete be[gt],be[Tt]=kt,ne[kt].geometry[0].pop(),ne[kt].geometry[0]=ne[kt].geometry[0].concat(Lt[0]),kt}function Je(gt,Tt,Lt){const kt=oe[Tt];return delete oe[Tt],oe[gt]=kt,ne[kt].geometry[0].shift(),ne[kt].geometry[0]=Lt[0].concat(ne[kt].geometry[0]),kt}function pt(gt,Tt,Lt){const kt=Lt?Tt[0][Tt[0].length-1]:Tt[0][0];return`${gt}:${kt.x}:${kt.y}`}for(let gt=0;gt<te.length;gt++){const Tt=te[gt],Lt=Tt.geometry,kt=Tt.text?Tt.text.toString():null;if(!kt){Ee(gt);continue}const yt=pt(kt,Lt),ut=pt(kt,Lt,!0);if(yt in be&&ut in oe&&be[yt]!==oe[ut]){const qt=Je(yt,ut,Lt),Zt=Ie(yt,ut,ne[qt].geometry);delete oe[yt],delete be[ut],be[pt(kt,ne[Zt].geometry,!0)]=Zt,ne[qt].geometry=null}else yt in be?Ie(yt,ut,Lt):ut in oe?Je(yt,ut,Lt):(Ee(gt),oe[yt]=me-1,be[ut]=me-1)}return ne.filter((gt=>gt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((te,oe)=>te.sortKey-oe.sortKey))}update(e,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const l=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(s[e.segment+1]),g=e.dist(s[e.segment]);const y={};for(let w=e.segment+1;w<s.length;w++)y[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:d},w<s.length-1&&(d+=s[w+1].dist(s[w]));for(let w=e.segment||0;w>=0;w--)y[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const N=y[w];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,s,l,d,g,y,w,N,A,R,I,B){const $=e.indexArray,W=e.layoutVertexArray,X=e.segments.prepareSegment(4*s.length,W,$,this.canOverlap?y.sortKey:void 0),te=this.glyphOffsetArray.length,oe=X.vertexLength,be=this.allowVerticalPlacement&&w===T.az.vertical?Math.PI/2:0,ne=y.text&&y.text.sections;for(let me=0;me<s.length;me++){const{tl:Ee,tr:Ie,bl:Je,br:pt,tex:gt,pixelOffsetTL:Tt,pixelOffsetBR:Lt,minFontScaleX:kt,minFontScaleY:yt,glyphOffset:ut,isSDF:qt,sectionIndex:Zt}=s[me],ts=X.vertexLength,Xt=ut[1];Lh(W,N.x,N.y,Ee.x,Xt+Ee.y,gt.x,gt.y,l,qt,Tt.x,Tt.y,kt,yt),Lh(W,N.x,N.y,Ie.x,Xt+Ie.y,gt.x+gt.w,gt.y,l,qt,Lt.x,Tt.y,kt,yt),Lh(W,N.x,N.y,Je.x,Xt+Je.y,gt.x,gt.y+gt.h,l,qt,Tt.x,Lt.y,kt,yt),Lh(W,N.x,N.y,pt.x,Xt+pt.y,gt.x+gt.w,gt.y+gt.h,l,qt,Lt.x,Lt.y,kt,yt),Pm(e.dynamicLayoutVertexArray,N,be),$.emplaceBack(ts,ts+2,ts+1),$.emplaceBack(ts+1,ts+2,ts+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),me!==s.length-1&&Zt===s[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,y,y.index,{imagePositions:{},canonical:B,formattedSection:ne&&ne[Zt]})}e.placedSymbolArray.emplaceBack(N.x,N.y,te,this.glyphOffsetArray.length-te,oe,A,R,N.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],w,0,!1,0,I)}_addCollisionDebugVertex(e,s,l,d,g,y){return s.emplaceBack(0,0),e.emplaceBack(l.x,l.y,d,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,s,l,d,g,y,w){const N=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),A=N.vertexLength,R=g.layoutVertexArray,I=g.collisionVertexArray,B=w.anchorX,$=w.anchorY;this._addCollisionDebugVertex(R,I,y,B,$,new O(e,s)),this._addCollisionDebugVertex(R,I,y,B,$,new O(l,s)),this._addCollisionDebugVertex(R,I,y,B,$,new O(l,d)),this._addCollisionDebugVertex(R,I,y,B,$,new O(e,d)),N.vertexLength+=4;const W=g.indexArray;W.emplaceBack(A,A+1),W.emplaceBack(A+1,A+2),W.emplaceBack(A+2,A+3),W.emplaceBack(A+3,A),N.primitiveLength+=4}addDebugCollisionBoxes(e,s,l,d){for(let g=e;g<s;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pp(Ke,dn.members,Rt),this.iconCollisionBox=new pp(Ke,dn.members,Rt);for(let e=0;e<this.symbolInstances.length;e++){const s=this.symbolInstances.get(e);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(e,s,l,d,g,y,w,N,A){const R={};for(let I=s;I<l;I++){const B=e.get(I);R.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.textFeatureIndex=B.featureIndex;break}for(let I=d;I<g;I++){const B=e.get(I);R.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalTextFeatureIndex=B.featureIndex;break}for(let I=y;I<w;I++){const B=e.get(I);R.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.iconFeatureIndex=B.featureIndex;break}for(let I=N;I<A;I++){const B=e.get(I);R.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalIconFeatureIndex=B.featureIndex;break}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const l=e.placedSymbolArray.get(s),d=l.vertexStartIndex+4*l.numGlyphs;for(let g=l.vertexStartIndex;g<d;g+=4)e.indexArray.emplaceBack(g,g+2,g+1),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),l=Math.cos(e),d=[],g=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const N=this.symbolInstances.get(w);d.push(0|Math.round(s*N.anchorX+l*N.anchorY)),g.push(N.featureIndex)}return y.sort(((w,N)=>d[w]-d[N]||g[N]-g[w])),y}addToSortKeyRanges(e,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((d,g,y)=>{d>=0&&y.indexOf(d)===g&&this.addIndicesForPlacedSymbol(this.text,d)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mp,gp;Ut("SymbolBucket",Ld,{omit:["layers","collisionBoxArray","features","compareText"]}),Ld.MAX_GLYPHS=65535,Ld.addDynamicAttributes=Pm;var Rm={get paint(){return gp=gp||new Xr({"icon-opacity":new Wt(Te.paint_symbol["icon-opacity"]),"icon-color":new Wt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Wt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wt(Te.paint_symbol["text-opacity"]),"text-color":new Wt(Te.paint_symbol["text-color"],{runtimeType:ra,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Wt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Wt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Wt(Te.paint_symbol["text-halo-blur"]),"text-translate":new $t(Te.paint_symbol["text-translate"]),"text-translate-anchor":new $t(Te.paint_symbol["text-translate-anchor"])})},get layout(){return mp=mp||new Xr({"symbol-placement":new $t(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $t(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $t(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wt(Te.layout_symbol["icon-size"]),"icon-text-fit":new $t(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wt(Te.layout_symbol["icon-image"]),"icon-rotate":new Wt(Te.layout_symbol["icon-rotate"]),"icon-padding":new Wt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Wt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Wt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Wt(Te.layout_symbol["text-field"]),"text-font":new Wt(Te.layout_symbol["text-font"]),"text-size":new Wt(Te.layout_symbol["text-size"]),"text-max-width":new Wt(Te.layout_symbol["text-max-width"]),"text-line-height":new $t(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Wt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Wt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Wt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wt(Te.layout_symbol["text-anchor"]),"text-max-angle":new $t(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Wt(Te.layout_symbol["text-rotate"]),"text-padding":new $t(Te.layout_symbol["text-padding"]),"text-keep-upright":new $t(Te.layout_symbol["text-keep-upright"]),"text-transform":new Wt(Te.layout_symbol["text-transform"]),"text-offset":new Wt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new $t(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new $t(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new $t(Te.layout_symbol["text-ignore-placement"]),"text-optional":new $t(Te.layout_symbol["text-optional"])})}};class ny{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Hs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut("FormatSectionOverride",ny,{omit:["defaultValue"]});class Pc extends zr{constructor(e,s){super(e,Rm,s)}recalculate(e,s){if(super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const g of l)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,s,l,d){const g=this.layout.get(e).evaluate(s,{},l,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Vo(y.value)||!g?g:(function(w,N){return N.replace(/{([^{}]+)}/g,((A,R)=>w&&R in w?String(w[R]):""))})(s.properties,g)}createBucket(e){return new Ld(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Rm.paint.overridableProperties){if(!Pc.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),l=new ny(s),d=new hd(l,s.property.specification);let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new Ji("source",d):new qo("composite",d,s.value.zoomStops),this.paint._values[e]=new Ma(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&Pc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const l=e.get("text-field"),d=Rm.paint.properties[s];let g=!1;const y=w=>{for(const N of w)if(d.overrides&&d.overrides.hasOverride(N))return void(g=!0)};if(l.value.kind==="constant"&&l.value.value instanceof pi)y(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const w=A=>{g||(A instanceof Sa&&Ar(A.value)===ba?y(A.value.sections):A instanceof eu?y(A.sections):A.eachChild(w))},N=l.value;N._styleExpression&&w(N._styleExpression.expression)}return g}}let oy;var ly={get paint(){return oy=oy||new Xr({"background-color":new $t(Te.paint_background["background-color"]),"background-pattern":new wc(Te.paint_background["background-pattern"]),"background-opacity":new $t(Te.paint_background["background-opacity"])})}};class Vs extends zr{constructor(e,s){super(e,ly,s)}}class Im extends zr{constructor(e,s){super(e,{},s),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const zm={once:!0},xp=63710088e-1;class sl{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new sl(mt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,l=this.lat*s,d=e.lat*s,g=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((e.lng-this.lng)*s);return xp*Math.acos(Math.min(g,1))}static convert(e){if(e instanceof sl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new sl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new sl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Bd=2*Math.PI*xp;function Bh(r){return Bd*Math.cos(r*Math.PI/180)}function cy(r){return(180+r)/360}function Om(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function uy(r,e){return r/Bh(e)}function dy(r){return 360*r-180}function Fh(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Lm(r,e){return r*Bh(Fh(e))}class lr{constructor(e,s,l=0){this.x=+e,this.y=+s,this.z=+l}static fromLngLat(e,s=0){const l=sl.convert(e);return new lr(cy(l.lng),Om(l.lat),uy(s,l.lat))}toLngLat(){return new sl(dy(this.x),Fh(this.y))}toAltitude(){return Lm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bd*(e=Fh(this.y),1/Math.cos(e*Math.PI/180));var e}}function _p(r,e,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class zi{constructor(e,s,l){if(!(function(d,g,y){return!(d<0||d>25||y<0||y>=Math.pow(2,d)||g<0||g>=Math.pow(2,d))})(e,s,l))throw new Error(`x=${s}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=s,this.y=l,this.key=Fd(0,e,e,s,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s,l){const d=(y=this.y,w=this.z,N=_p(256*(g=this.x),256*(y=Math.pow(2,w)-y-1),w),A=_p(256*(g+1),256*(y+1),w),N[0]+","+N[1]+","+A[0]+","+A[1]);var g,y,w,N,A;const R=(function(I,B,$){let W,X="";for(let te=I;te>0;te--)W=1<<te-1,X+=(B&W?1:0)+($&W?2:0);return X})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const s=this.z-e.z;return s>0&&e.x===this.x>>s&&e.y===this.y>>s}getTilePoint(e){const s=Math.pow(2,this.z);return new O((e.x*s-this.x)*Ze,(e.y*s-this.y)*Ze)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hy{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Fd(e,s.z,s.z,s.x,s.y)}}class za{constructor(e,s,l,d,g){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=s,this.canonical=new zi(l,+d,+g),this.key=Fd(s,e,l,d,g)}clone(){return new za(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?new za(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new za(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,s){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Fd(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y):Fd(this.wrap*+s,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const s=this.canonical.z-e.canonical.z;return!(s<0)&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new za(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new za(s,this.wrap,s,l,d),new za(s,this.wrap,s,l+1,d),new za(s,this.wrap,s,l,d+1),new za(s,this.wrap,s,l+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new za(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new za(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new lr(e.x-this.wrap,e.y))}normalizeCoordinates(e,s,l=8192){if(e>=0&&e<l&&s>=0&&s<l)return{tileID:this,x:e,y:s};const d=Math.floor(e/l),g=Math.floor(s/l),y=e-d*l,w=s-g*l,N=this.canonical.z,A=1<<N,R=this.canonical.y+g;if(R<0||R>=A)return null;let I=this.canonical.x+d,B=this.wrap;return I<0?(B-=Math.ceil(-I/A),I=(I%A+A)%A):I>=A&&(B+=Math.floor(I/A),I%=A),{tileID:new za(this.overscaledZ,B,N,I,R),x:y,y:w}}}function Fd(r,e,s,l,d){(r*=2)<0&&(r=-1*r-1);const g=1<<s;return(g*g*r+g*d+l).toString(36)+s.toString(36)+e.toString(36)}function Uh(r,e){return e?r.properties[e]:r.id}function Bm(r,e){const s={id:r.id};if(e.removeAllProperties&&(delete r.removeProperties,delete r.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const d=r.addOrUpdateProperties.findIndex((g=>g.key===l));d>-1&&r.addOrUpdateProperties.splice(d,1)}return(r.removeAllProperties||e.removeAllProperties)&&(s.removeAllProperties=!0),(r.removeProperties||e.removeProperties)&&(s.removeProperties=[...r.removeProperties||[],...e.removeProperties||[]]),(r.addOrUpdateProperties||e.addOrUpdateProperties)&&(s.addOrUpdateProperties=[...r.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(r.newGeometry||e.newGeometry)&&(s.newGeometry=e.newGeometry||r.newGeometry),s}function $h(r){var e,s;if(!r)return{};const l={};return l.removeAll=r.removeAll,l.remove=new Set(r.remove||[]),l.add=new Map((e=r.add)===null||e===void 0?void 0:e.map((d=>[d.id,d]))),l.update=new Map((s=r.update)===null||s===void 0?void 0:s.map((d=>[d.id,d]))),l}Ut("CanonicalTileID",zi),Ut("OverscaledTileID",za,{omit:["terrainRttPosMatrix32f"]});class Dc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const s=new Dc;return s.extend(e(new O(this.minX,this.minY))),s.extend(e(new O(this.maxX,this.minY))),s.extend(e(new O(this.minX,this.maxY))),s.extend(e(new O(this.maxX,this.maxY))),s}static fromPoints(e){const s=new Dc;for(const l of e)s.extend(l);return s}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Fm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const l=e[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class vp{constructor(e,s,l,d,g){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=d,this._z=s,this.properties=e.properties,this.id=g}projectPoint(e,s,l,d){return[360*(e.x+s)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/d)*Math.PI))-90]}projectLine(e,s,l,d){return e.map((g=>this.projectPoint(g,s,l,d)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,s=e.extent*Math.pow(2,this._z),l=e.extent*this._x,d=e.extent*this._y,g=e.loadGeometry();switch(e.type){case 1:{const y=[];for(const N of g)y.push(N[0]);const w=this.projectLine(y,l,d,s);this._geometry=y.length===1?{type:"Point",coordinates:w[0]}:{type:"MultiPoint",coordinates:w};break}case 2:{const y=g.map((w=>this.projectLine(w,l,d,s)));this._geometry=y.length===1?{type:"LineString",coordinates:y[0]}:{type:"MultiLineString",coordinates:y};break}case 3:{const y=qg(g),w=[];for(const N of y)w.push(N.map((A=>this.projectLine(A,l,d,s))));this._geometry=w.length===1?{type:"Polygon",coordinates:w[0]}:{type:"MultiPolygon",coordinates:w};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&s!=="_x"&&s!=="_y"&&s!=="_z"&&(e[s]=this[s]);return e}}class Rc{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,s,l){this._name=e,this.dataBuffer=s,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class bp extends Rc{}class wp extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Um extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class $m extends Rc{delta;constructor(e,s,l,d){super(e,s,d),this.delta=l}}class Vm extends $m{constructor(e,s,l,d){super(e,Int32Array.of(s),l,d)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class qm extends Rc{constructor(e,s,l){super(e,Int32Array.of(s),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Ic{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,s,l,d,g=4096){this._name=e,this._geometryVector=s,this._idVector=l,this._propertyVectors=d,this._extent=g}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((s=>[s.name,s])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let s=0;for(;s<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(s)):this.idVector.getValue(s));const d=e?.next().value,g={};for(const y of this.propertyVectors){if(!y)continue;const w=y.name,N=y.getValue(s);N!==null&&(g[w]=N)}s++,yield{id:l,geometry:d,properties:g}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],s=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let d;this.idVector&&(d=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const g={coordinates:s[l],type:this.geometryVector.geometryType(l)},y={};for(const w of this.propertyVectors){if(!w)continue;const N=w.name,A=w.getValue(l);A!==null&&(y[N]=A)}e.push({id:d,geometry:g,properties:y})}return e}containsMaxSaveIntegerValues(e){return e instanceof wp||e instanceof qm&&e instanceof Vm||e instanceof Um}}class fy{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var ir,rl,Fi,No,zc,fa,Lr,Ai,An,Oa;function Ui(r,e,s){const l=new Int32Array(s);let d=0,g=e.get();for(let y=0;y<l.length;y++){let w=r[g++],N=127&w;w<128||(w=r[g++],N|=(127&w)<<7,w<128||(w=r[g++],N|=(127&w)<<14,w<128||(w=r[g++],N|=(127&w)<<21,w<128||(w=r[g++],N|=(15&w)<<28)))),l[d++]=N}return e.set(g),l}function Sp(r,e,s){const l=new BigInt64Array(s);for(let d=0;d<l.length;d++)l[d]=py(r,e);return l}function py(r,e){let s=0n,l=0,d=e.get();for(;d<r.length;){const g=r[d++];if(s|=BigInt(127&g)<<BigInt(l),!(128&g))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(d),s}function Vh(r,e){let s,l;return l=r[e.get()],e.increment(),s=127&l,l<128?s:(l=r[e.get()],e.increment(),s|=(127&l)<<7,l<128?s:(l=r[e.get()],e.increment(),s|=(127&l)<<14,l<128?s:(l=r[e.get()],e.increment(),s|=(127&l)<<21,l<128?s:(l=r[e.get()],s|=(15&l)<<28,(function(d,g,y){let w,N;if(N=g[y.get()],y.increment(),w=(112&N)>>4,N<128||(N=g[y.get()],y.increment(),w|=(127&N)<<3,N<128)||(N=g[y.get()],y.increment(),w|=(127&N)<<10,N<128)||(N=g[y.get()],y.increment(),w|=(127&N)<<17,N<128)||(N=g[y.get()],y.increment(),w|=(127&N)<<24,N<128)||(N=g[y.get()],y.increment(),w|=(1&N)<<31,N<128))return 4294967296*w+(d>>>0);throw new Error("Expected varint not more than 10 bytes")})(s,r,e)))))}function Xs(r){return r>>>1^-(1&r)}function La(r){return r>>1n^-(1n&r)}function ql(r){return r%2==1?(r+1)/-2:r/2}function il(r,e,s){if(s===void 0){s=0;for(let g=0;g<e;g++)s+=r[g]}const l=new Int32Array(s);let d=0;for(let g=0;g<e;g++){const y=r[g];l.fill(r[g+e],d,d+y),d+=y}return l}function my(r,e,s){if(s===void 0){s=0;for(let g=0;g<e;g++)s+=Number(r[g])}const l=new BigInt64Array(s);let d=0;for(let g=0;g<e;g++){const y=Number(r[g]);l.fill(r[g+e],d,d+y),d+=y}return l}function gy(r,e,s){const l=new Float64Array(s);let d=0;for(let g=0;g<e;g++){const y=r[g];l.fill(r[g+e],d,d+y),d+=y}return l}function Ou(r){const e=r.length/4*4;let s=1;if(e>=4)for(let l=r[0];s<e-4;s+=4)l=r[s]+=l,l=r[s+1]+=l,l=r[s+2]+=l,l=r[s+3]+=l;for(;s!=r.length;)r[s]+=r[s-1],++s}(function(r){r.NONE="NONE",r.DELTA="DELTA",r.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",r.RLE="RLE",r.MORTON="MORTON",r.PDE="PDE"})(ir||(ir={})),(function(r){r.NONE="NONE",r.FAST_PFOR="FAST_PFOR",r.VARINT="VARINT",r.ALP="ALP"})(rl||(rl={})),(function(r){r.PRESENT="PRESENT",r.DATA="DATA",r.OFFSET="OFFSET",r.LENGTH="LENGTH"})(Fi||(Fi={}));class jp{_dictionaryType;_offsetType;_lengthType;constructor(e,s,l){this._dictionaryType=e,this._offsetType=s,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function pa(r,e){const s=(function(l,d){const g=l[d.get()],y=Object.values(Fi)[g>>4];let w=null;switch(y){case Fi.DATA:w=new jp(Object.values(No)[15&g]);break;case Fi.OFFSET:w=new jp(null,Object.values(zc)[15&g]);break;case Fi.LENGTH:w=new jp(null,null,Object.values(fa)[15&g])}d.increment();const N=l[d.get()],A=Object.values(ir)[N>>5],R=Object.values(ir)[N>>2&7],I=Object.values(rl)[3&N];d.increment();const B=Ui(l,d,2),$=B[0];return{physicalStreamType:y,logicalStreamType:w,logicalLevelTechnique1:A,logicalLevelTechnique2:R,physicalLevelTechnique:I,numValues:$,byteLength:B[1],decompressedCount:$}})(r,e);return s.logicalLevelTechnique1===ir.MORTON?(function(l,d,g){const y=Ui(d,g,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:y[0],coordinateShift:y[1]}})(s,r,e):ir.RLE!==s.logicalLevelTechnique1&&ir.RLE!==s.logicalLevelTechnique2||rl.NONE===s.physicalLevelTechnique?s:(function(l,d,g){const y=Ui(d,g,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:y[1],runs:y[0],numRleValues:y[1]}})(s,r,e)}(function(r){r.NONE="NONE",r.SINGLE="SINGLE",r.SHARED="SHARED",r.VERTEX="VERTEX",r.MORTON="MORTON",r.FSST="FSST"})(No||(No={})),(function(r){r.VERTEX="VERTEX",r.INDEX="INDEX",r.STRING="STRING",r.KEY="KEY"})(zc||(zc={})),(function(r){r.VAR_BINARY="VAR_BINARY",r.GEOMETRIES="GEOMETRIES",r.PARTS="PARTS",r.RINGS="RINGS",r.TRIANGLES="TRIANGLES",r.SYMBOL="SYMBOL",r.DICTIONARY="DICTIONARY"})(fa||(fa={})),(function(r){r[r.FLAT=0]="FLAT",r[r.CONST=1]="CONST",r[r.SEQUENCE=2]="SEQUENCE",r[r.DICTIONARY=3]="DICTIONARY",r[r.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Lr||(Lr={}));class Eo{values;_size;constructor(e,s){this.values=e,this._size=s}get(e){const s=Math.floor(e/8);return(this.values[s]>>e%8&1)==1}set(e,s){const l=Math.floor(e/8);this.values[l]=this.values[l]|(s?1:0)<<e%8}getInt(e){const s=Math.floor(e/8);return this.values[s]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Tp(r,e,s){if(!e)return r;const l=e.size(),d=new r.constructor(l);let g=0;for(let y=0;y<l;y++)d[y]=e.get(y)?r[g++]:s;return d}function ma(r,e,s,l,d,g){return(function(y,w,N,A,R){switch(w.logicalLevelTechnique1){case ir.DELTA:if(w.logicalLevelTechnique2===ir.RLE){const I=w;if(!R)return(function(B,$,W){const X=new Int32Array(W);let te=0,oe=0;for(let be=0;be<$;be++){const ne=B[be],me=Xs(B[be+$]);for(let Ee=0;Ee<ne;Ee++)oe+=me,X[te++]=oe}return X})(y,I.runs,I.numRleValues);y=il(y,I.runs,I.numRleValues)}(function(I){I[0]=Xs(I[0]);const B=I.length/4*4;let $=1;if(B>=4)for(;$<B-4;$+=4){const W=I[$+1],X=I[$+2],te=I[$+3];I[$]=Xs(I[$])+I[$-1],I[$+1]=Xs(W)+I[$],I[$+2]=Xs(X)+I[$+1],I[$+3]=Xs(te)+I[$+2]}for(;$!=I.length;++$)I[$]=Xs(I[$])+I[$-1]})(y);break;case ir.RLE:y=(function(I,B,$){return $?(function(W,X,te){if(te===void 0){te=0;for(let ne=0;ne<X;ne++)te+=W[ne]}const oe=new Int32Array(te);let be=0;for(let ne=0;ne<X;ne++){const me=W[ne];let Ee=W[ne+X];Ee=Xs(Ee),oe.fill(Ee,be,be+me),be+=me}return oe})(I,B.runs,B.numRleValues):il(I,B.runs,B.numRleValues)})(y,w,N);break;case ir.MORTON:Ou(y);break;case ir.COMPONENTWISE_DELTA:(function(I){if(I.length<2)return;I[0]=Xs(I[0]),I[1]=Xs(I[1]);const B=I.length/4*4;let $=2;if(B>=4)for(;$<B-4;$+=4){const W=I[$+1],X=I[$+2],te=I[$+3];I[$]=Xs(I[$])+I[$-2],I[$+1]=Xs(W)+I[$-1],I[$+2]=Xs(X)+I[$],I[$+3]=Xs(te)+I[$+1]}for(;$!=I.length;$+=2)I[$]=Xs(I[$])+I[$-2],I[$+1]=Xs(I[$+1])+I[$-1]})(y);break;case ir.NONE:N&&(function(I){for(let B=0;B<I.length;B++)I[B]=Xs(I[B])})(y);break;default:throw new Error(`The specified Logical level technique is not supported: ${w.logicalLevelTechnique1}`)}return R?Tp(y,R,0):y})(Np(r,e,s),s,l,0,g)}function Oc(r,e,s){return(function(l,d){if(d.logicalLevelTechnique1===ir.DELTA&&d.logicalLevelTechnique2===ir.NONE)return(function(g){const y=new Int32Array(g.length+1);y[0]=0,y[1]=Xs(g[0]);let w=y[1];for(let N=2;N!=y.length;++N)w+=Xs(g[N-1]),y[N]=y[N-1]+w;return new Uint32Array(y)})(l);if(d.logicalLevelTechnique1===ir.RLE&&d.logicalLevelTechnique2===ir.NONE)return(function(g,y,w){const N=new Int32Array(w+1);N[0]=0;let A=1,R=N[0];for(let I=0;I<y;I++){const B=g[I],$=g[I+y];for(let W=A;W<A+B;W++)N[W]=$+R,R=N[W];A+=B}return new Uint32Array(N)})(l,d.runs,d.numRleValues);if(d.logicalLevelTechnique1===ir.NONE&&d.logicalLevelTechnique2===ir.NONE){(function(y){let w=0;for(let N=0;N<y.length;N++)y[N]+=w,w=y[N]})(l);const g=new Uint32Array(d.numValues+1);return g[0]=0,g.set(l,1),g}if(d.logicalLevelTechnique1===ir.DELTA&&d.logicalLevelTechnique2===ir.RLE){const g=(function(y,w,N){const A=new Int32Array(N+1);A[0]=0;let R=1,I=A[0];for(let B=0;B<w;B++){const $=y[B];let W=y[B+w];W=Xs(W);for(let X=R;X<R+$;X++)A[X]=W+I,I=A[X];R+=$}return new Uint32Array(A)})(l,d.runs,d.numRleValues);return Ou(g),g}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Np(r,e,s),s)}function Np(r,e,s){const l=s.physicalLevelTechnique;if(l===rl.FAST_PFOR)return(function(){throw new Error("FastPFor is not implemented yet.")})();if(l===rl.VARINT)return Ui(r,e,s.numValues);if(l===rl.NONE){const d=e.get();e.add(s.byteLength);const g=r.subarray(d,e.get());return new Int32Array(g)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Gm(r,e,s,l){const d=Np(r,e,s);if(d.length===1){const g=d[0];return l?Xs(g):g}return l?(function(g){return Xs(g[1])})(d):(function(g){return g[1]})(d)}function Hm(r,e,s){return(function(l){if(l.length==2){const d=Xs(l[1]);return[d,d]}return[Xs(l[2]),Xs(l[3])]})(Np(r,e,s))}function Lu(r,e,s){return(function(l){if(l.length==2){const d=La(l[1]);return[d,d]}return[La(l[2]),La(l[3])]})(Sp(r,e,s.numValues))}function Ud(r,e,s,l,d){return(function(g,y,w,N){switch(y.logicalLevelTechnique1){case ir.DELTA:if(y.logicalLevelTechnique2===ir.RLE){const A=y;if(!N)return(function(R,I,B){const $=new BigInt64Array(B);let W=0,X=0n;for(let te=0;te<I;te++){const oe=Number(R[te]),be=La(R[te+I]);for(let ne=0;ne<oe;ne++)X+=be,$[W++]=X}return $})(g,A.runs,A.numRleValues);g=my(g,A.runs,A.numRleValues)}(function(A){A[0]=La(A[0]);const R=A.length/4*4;let I=1;if(R>=4)for(;I<R-4;I+=4){const B=A[I+1],$=A[I+2],W=A[I+3];A[I]=La(A[I])+A[I-1],A[I+1]=La(B)+A[I],A[I+2]=La($)+A[I+1],A[I+3]=La(W)+A[I+2]}for(;I!=A.length;++I)A[I]=La(A[I])+A[I-1]})(g);break;case ir.RLE:g=(function(A,R,I){return I?(function(B,$,W){if(W===void 0){W=0;for(let oe=0;oe<$;oe++)W+=Number(B[oe])}const X=new BigInt64Array(W);let te=0;for(let oe=0;oe<$;oe++){const be=Number(B[oe]);let ne=B[oe+$];ne=La(ne),X.fill(ne,te,te+be),te+=be}return X})(A,R.runs,R.numRleValues):my(A,R.runs,R.numRleValues)})(g,y,w);break;case ir.NONE:w&&(function(A){for(let R=0;R<A.length;R++)A[R]=La(A[R])})(g);break;default:throw new Error(`The specified Logical level technique is not supported: ${y.logicalLevelTechnique1}`)}return N?Tp(g,N,0n):g})(Sp(r,e,s.numValues),s,l,d)}function Zm(r,e,s,l){const d=Sp(r,e,s.numValues);if(d.length===1){const g=d[0];return l?La(g):g}return l?(function(g){return La(g[1])})(d):(function(g){return g[1]})(d)}function Ep(r,e,s,l){const d=r.logicalLevelTechnique1;if(d===ir.RLE)return r.runs===1?Lr.CONST:Lr.FLAT;if(d!==ir.DELTA||r.logicalLevelTechnique2!==ir.RLE)return r.numValues===1?Lr.CONST:Lr.FLAT;const g=e instanceof Eo?e.size():e;if(r.numRleValues!==g)return Lr.FLAT;if(r.runs===1)return Lr.SEQUENCE;if(r.runs!==2)return r.numValues===1?Lr.CONST:Lr.FLAT;const y=l.get();let w;if(r.physicalLevelTechnique===rl.VARINT)w=Ui(s,l,4);else{const N=l.get();w=new Int32Array(s.buffer,s.byteOffset+N,4)}return l.set(y),w[2]===2&&w[3]===2?Lr.SEQUENCE:r.numValues===1?Lr.CONST:Lr.FLAT}class Bu extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class $d extends $m{constructor(e,s,l,d){super(e,BigInt64Array.of(s),l,d)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Fu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,s,l){this._geometryOffsets=e,this._partOffsets=s,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Vd(r,e,s){return{x:Cp(r,e)-s,y:Cp(r>>1,e)-s}}function Cp(r,e){let s=0;for(let l=0;l<e;l++)s|=(r&1<<2*l)>>l;return s}(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON",r[r.MULTIPOINT=3]="MULTIPOINT",r[r.MULTILINESTRING=4]="MULTILINESTRING",r[r.MULTIPOLYGON=5]="MULTIPOLYGON"})(Ai||(Ai={})),(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON"})(An||(An={})),(function(r){r[r.MORTON=0]="MORTON",r[r.VEC_2=1]="VEC_2",r[r.VEC_3=2]="VEC_3"})(Oa||(Oa={}));class Wm{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((s=>[s]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,s){return[e].concat(s)}createMultiPolygon(e){return e.flat()}}function qh(r){const e=new Array(r.numGeometries);let s=1,l=1,d=1,g=0;const y=new Wm;let w=0,N=0;const A=r.mortonSettings,R=r.topologyVector,I=R.geometryOffsets,B=R.partOffsets,$=R.ringOffsets,W=r.vertexOffsets,X=r.containsPolygonGeometry(),te=r.vertexBuffer;for(let oe=0;oe<r.numGeometries;oe++){const be=r.geometryType(oe);if(be===Ai.POINT){if(W&&W.length!==0)if(r.vertexBufferType===Oa.VEC_2){const ne=2*W[N++],me=new O(te[ne],te[ne+1]);e[g++]=y.createPoint(me)}else{const ne=Vd(te[W[N++]],A.numBits,A.coordinateShift),me=new O(ne.x,ne.y);e[g++]=y.createPoint(me)}else{const ne=new O(te[w++],te[w++]);e[g++]=y.createPoint(ne)}I&&d++,B&&s++,$&&l++}else if(be===Ai.MULTIPOINT){const ne=I[d]-I[d-1];d++;const me=new Array(ne);if(W&&W.length!==0){for(let Ee=0;Ee<ne;Ee++){const Ie=2*W[N++];me[Ee]=new O(te[Ie],te[Ie+1])}e[g++]=y.createMultiPoint(me)}else{for(let Ee=0;Ee<ne;Ee++){const Ie=te[w++],Je=te[w++];me[Ee]=new O(Ie,Je)}e[g++]=y.createMultiPoint(me)}}else if(be===Ai.LINESTRING){let ne,me=0;X?(me=$[l]-$[l-1],l++):me=B[s]-B[s-1],s++,W&&W.length!==0?(ne=r.vertexBufferType===Oa.VEC_2?Ym(te,W,N,me,!1):Zh(te,W,N,me,!1,A),N+=me):(ne=kp(te,w,me,!1),w+=2*me),e[g++]=y.createLineString(ne),I&&d++}else if(be===Ai.POLYGON){const ne=B[s]-B[s-1];s++;const me=new Array(ne-1);let Ee=$[l]-$[l-1];if(l++,W&&W.length!==0){const Ie=r.vertexBufferType===Oa.VEC_2?Hh(te,W,N,Ee):Ap(te,W,N,Ee,0,A);N+=Ee;for(let Je=0;Je<me.length;Je++)Ee=$[l]-$[l-1],l++,me[Je]=r.vertexBufferType===Oa.VEC_2?Hh(te,W,N,Ee):Ap(te,W,N,Ee,0,A),N+=Ee;e[g++]=y.createPolygon(Ie,me)}else{const Ie=Gh(te,w,Ee);w+=2*Ee;for(let Je=0;Je<me.length;Je++)Ee=$[l]-$[l-1],l++,me[Je]=Gh(te,w,Ee),w+=2*Ee;e[g++]=y.createPolygon(Ie,me)}I&&d++}else if(be===Ai.MULTILINESTRING){const ne=I[d]-I[d-1];d++;const me=new Array(ne);if(W&&W.length!==0){for(let Ee=0;Ee<ne;Ee++){let Ie=0;X?(Ie=$[l]-$[l-1],l++):Ie=B[s]-B[s-1],s++;const Je=r.vertexBufferType===Oa.VEC_2?Ym(te,W,N,Ie,!1):Zh(te,W,N,Ie,!1,A);me[Ee]=Je,N+=Ie}e[g++]=y.createMultiLineString(me)}else{for(let Ee=0;Ee<ne;Ee++){let Ie=0;X?(Ie=$[l]-$[l-1],l++):Ie=B[s]-B[s-1],s++,me[Ee]=kp(te,w,Ie,!1),w+=2*Ie}e[g++]=y.createMultiLineString(me)}}else{if(be!==Ai.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ne=I[d]-I[d-1];d++;const me=new Array(ne);let Ee=0;if(W&&W.length!==0){for(let Ie=0;Ie<ne;Ie++){const Je=B[s]-B[s-1];s++;const pt=new Array(Je-1);Ee=$[l]-$[l-1],l++;const gt=r.vertexBufferType===Oa.VEC_2?Hh(te,W,N,Ee):Ap(te,W,N,Ee,0,A);N+=Ee;for(let Tt=0;Tt<pt.length;Tt++)Ee=$[l]-$[l-1],l++,pt[Tt]=r.vertexBufferType===Oa.VEC_2?Hh(te,W,N,Ee):Ap(te,W,N,Ee,0,A),N+=Ee;me[Ie]=y.createPolygon(gt,pt)}e[g++]=y.createMultiPolygon(me)}else{for(let Ie=0;Ie<ne;Ie++){const Je=B[s]-B[s-1];s++;const pt=new Array(Je-1);Ee=$[l]-$[l-1],l++;const gt=Gh(te,w,Ee);w+=2*Ee;for(let Tt=0;Tt<pt.length;Tt++){const Lt=$[l]-$[l-1];l++,pt[Tt]=Gh(te,w,Lt),w+=2*Lt}me[Ie]=y.createPolygon(gt,pt)}e[g++]=y.createMultiPolygon(me)}}}}return e}function Gh(r,e,s){return kp(r,e,s,!0)}function Hh(r,e,s,l){return Ym(r,e,s,l,!0)}function Ap(r,e,s,l,d,g){return Zh(r,e,s,l,!0,g)}function kp(r,e,s,l){const d=new Array(l?s+1:s);for(let g=0;g<2*s;g+=2)d[g/2]=new O(r[e+g],r[e+g+1]);return l&&(d[d.length-1]=d[0]),d}function Ym(r,e,s,l,d){const g=new Array(d?l+1:l);for(let y=0;y<2*l;y+=2){const w=2*e[s+y/2];g[y/2]=new O(r[w],r[w+1])}return d&&(g[g.length-1]=g[0]),g}function Zh(r,e,s,l,d,g){const y=new Array(d?l+1:l);for(let w=0;w<l;w++){const N=Vd(r[e[s+w]],g.numBits,g.coordinateShift);y[w]=new O(N.x,N.y)}return d&&(y[y.length-1]=y[0]),y}class yy{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,s,l,d,g){this._vertexBufferType=e,this._topologyVector=s,this._vertexOffsets=l,this._vertexBuffer=d,this._mortonSettings=g}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=qh(this);let s=0;for(;s<this.numGeometries;)yield{coordinates:e[s],type:this.geometryType(s)},s++}getSimpleEncodedVertex(e){const s=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[s],this.vertexBuffer[s+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=Vd(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const s=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[s],this.vertexBuffer[s+1]]}getGeometries(){return qh(this)}get mortonSettings(){return this._mortonSettings}}class Wh extends yy{_numGeometries;_geometryType;constructor(e,s,l,d,g,y,w){super(l,d,g,y,w),this._numGeometries=e,this._geometryType=s}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Ai.POLYGON||this._geometryType===Ai.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Yh extends yy{_geometryTypes;constructor(e,s,l,d,g,y){super(e,l,d,g,y),this._geometryTypes=s}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Ai.POLYGON||this.geometryType(e)===Ai.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Xh{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,s,l,d){this._triangleOffsets=e,this._indexBuffer=s,this._vertexBuffer=l,this._topologyVector=d}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),s=this._topologyVector,l=s.partOffsets,d=s.ringOffsets,g=s.geometryOffsets;let y=0,w=1,N=1,A=1;for(let R=0;R<this.numGeometries;R++)switch(this.geometryType(R)){case Ai.POLYGON:{const I=l[w]-l[w-1];w++;const B=[];for(let $=0;$<I;$++){const W=d[N]-d[N-1];N++;const X=[];for(let te=0;te<W;te++){const oe=this._vertexBuffer[y++],be=this._vertexBuffer[y++];X.push(new O(oe,be))}X.length>0&&X.push(X[0]),B.push(X)}e[R]=B,g&&A++}break;case Ai.MULTIPOLYGON:{const I=g[A]-g[A-1];A++;const B=[];for(let $=0;$<I;$++){const W=l[w]-l[w-1];w++;for(let X=0;X<W;X++){const te=d[N]-d[N-1];N++;const oe=[];for(let be=0;be<te;be++){const ne=this._vertexBuffer[y++],me=this._vertexBuffer[y++];oe.push(new O(ne,me))}oe.length>0&&oe.push(oe[0]),B.push(oe)}}e[R]=B}}return e}[Symbol.iterator](){return null}}function xy(r,e,s,l,d,g){return new Kh(r,e,s,l,d,g)}class Kh extends Xh{_numGeometries;_geometryType;constructor(e,s,l,d,g,y){super(l,d,g,y),this._numGeometries=e,this._geometryType=s}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function _y(r,e,s,l,d){return new vy(r,e,s,l,d)}class vy extends Xh{_geometryTypes;constructor(e,s,l,d,g){super(s,l,d,g),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function by(r,e,s,l,d){const g=pa(r,s);let y=null,w=null,N=null,A=null;if(Ep(g,l,r,s)===Lr.CONST){const be=Gm(r,s,g,!1);let ne=null,me=null,Ee=null,Ie=null;for(let Je=0;Je<e-1;Je++){const pt=pa(r,s);switch(pt.physicalStreamType){case Fi.LENGTH:switch(pt.logicalStreamType.lengthType){case fa.GEOMETRIES:ne=Oc(r,s,pt);break;case fa.PARTS:me=Oc(r,s,pt);break;case fa.RINGS:Ee=Oc(r,s,pt);break;case fa.TRIANGLES:Ie=Oc(r,s,pt)}break;case Fi.OFFSET:switch(pt.logicalStreamType.offsetType){case zc.VERTEX:y=ma(r,s,pt,!1);break;case zc.INDEX:A=ma(r,s,pt,!1)}break;case Fi.DATA:No.VERTEX===pt.logicalStreamType.dictionaryType?w=ma(r,s,pt,!0):(N={numBits:pt.numBits,coordinateShift:pt.coordinateShift},w=ma(r,s,pt,!1))}}return A!==null?ne!=null||me!=null?xy(l,be,Ie,A,w,new Fu(ne,me,Ee)):xy(l,be,Ie,A,w):N===null?(function(Je,pt,gt,Tt,Lt){return new Wh(Je,pt,Oa.VEC_2,gt,Tt,Lt)})(l,be,new Fu(ne,me,Ee),y,w):(function(Je,pt,gt,Tt,Lt,kt){return new Wh(Je,pt,Oa.MORTON,gt,Tt,Lt,kt)})(l,be,new Fu(ne,me,Ee),y,w,N)}const R=ma(r,s,g,!1);let I=null,B=null,$=null,W=null;for(let be=0;be<e-1;be++){const ne=pa(r,s);switch(ne.physicalStreamType){case Fi.LENGTH:switch(ne.logicalStreamType.lengthType){case fa.GEOMETRIES:I=ma(r,s,ne,!1);break;case fa.PARTS:B=ma(r,s,ne,!1);break;case fa.RINGS:$=ma(r,s,ne,!1);break;case fa.TRIANGLES:W=Oc(r,s,ne)}break;case Fi.OFFSET:switch(ne.logicalStreamType.offsetType){case zc.VERTEX:y=ma(r,s,ne,!1);break;case zc.INDEX:A=ma(r,s,ne,!1)}break;case Fi.DATA:No.VERTEX===ne.logicalStreamType.dictionaryType?w=ma(r,s,ne,!0):(N={numBits:ne.numBits,coordinateShift:ne.coordinateShift},w=ma(r,s,ne,!1))}}let X=null,te=null,oe=null;return I!==null?(X=Mp(R,I,2),B!==null&&$!==null?(te=Xm(R,X,B,!1),oe=(function(be,ne,me,Ee){const Ie=new Uint32Array(me[me.length-1]+1);let Je=0;Ie[0]=Je;let pt=1,gt=1,Tt=0;for(let Lt=0;Lt<be.length;Lt++){const kt=be[Lt],yt=ne[Lt+1]-ne[Lt];if(kt!==0&&kt!==3)for(let ut=0;ut<yt;ut++){const qt=me[pt]-me[pt-1];pt++;for(let Zt=0;Zt<qt;Zt++)Je=Ie[gt++]=Je+Ee[Tt++]}else for(let ut=0;ut<yt;ut++)Ie[gt++]=++Je,pt++}return Ie})(R,X,te,$)):B!==null&&(te=(function(be,ne,me){const Ee=new Uint32Array(ne[ne.length-1]+1);let Ie=0;Ee[0]=Ie;let Je=1,pt=0;for(let gt=0;gt<be.length;gt++){const Tt=be[gt],Lt=ne[gt+1]-ne[gt];if(Tt===4||Tt===1)for(let kt=0;kt<Lt;kt++)Ie=Ee[Je++]=Ie+me[pt++];else for(let kt=0;kt<Lt;kt++)Ee[Je++]=++Ie}return Ee})(R,X,B))):B!==null&&$!==null?(te=Mp(R,B,1),oe=Xm(R,te,$,!0)):B!==null&&(te=Mp(R,B,0)),A!==null&&te===null?_y(R,W,A,w):A!==null?_y(R,W,A,w,new Fu(X,te,oe)):N===null?(function(be,ne,me,Ee){return new Yh(Oa.VEC_2,be,ne,me,Ee)})(R,new Fu(X,te,oe),y,w):(function(be,ne,me,Ee,Ie){return new Yh(Oa.MORTON,be,ne,me,Ee,Ie)})(R,new Fu(X,te,oe),y,w,N)}function Mp(r,e,s){const l=new Uint32Array(r.length+1);let d=0;l[0]=d;let g=0;for(let y=0;y<r.length;y++)d=l[y+1]=d+(r[y]>s?e[g++]:1);return l}function Xm(r,e,s,l){const d=new Uint32Array(e[e.length-1]+1);let g=0;d[0]=g;let y=1,w=0;for(let N=0;N<r.length;N++){const A=r[N],R=e[N+1]-e[N];if(A===5||A===2||l&&(A===4||A===1))for(let I=0;I<R;I++)g=d[y++]=g+s[w++];else for(let I=0;I<R;I++)d[y++]=++g}return d}class Km extends Rc{dataVector;constructor(e,s,l){super(e,s.getBuffer(),l),this.dataVector=s}getValueFromBuffer(e){return this.dataVector.get(e)}}class wy extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Jm extends Rc{constructor(e,s,l){super(e,BigInt64Array.of(s),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Lc(r,e,s,l,d){const g=(function(y,w,N,A){const R=new Uint8Array(w);let I=0;const B=A.get()+N;for(;I<w&&!(A.get()>=B);){const $=y[A.increment()];if($<=127){const W=$+3,X=y[A.increment()],te=Math.min(I+W,w);R.fill(X,I,te),I=te}else{const W=256-$;for(let X=0;X<W&&I<w;X++)R[I++]=y[A.increment()]}}return A.set(B),R})(r,Math.ceil(e/8),s,l);return d?(function(y,w,N){if(!N)return y;const A=N.size(),R=new Eo(y,w),I=new Eo(new Uint8Array(Math.ceil(A/8)),A);let B=0;for(let $=0;$<A;$++){const W=!!N.get($)&&R.get(B++);I.set($,W)}return I.getBuffer()})(g,e,d):g}const mx=new TextDecoder;function Qm(r,e,s){return s-e>=12?mx.decode(r.subarray(e,s)):(function(l,d,g){let y="",w=d;for(;w<g;){const N=l[w];let A,R,I,B=null,$=N>239?4:N>223?3:N>191?2:1;if(w+$>g)break;$===1?N<128&&(B=N):$===2?(A=l[w+1],(192&A)==128&&(B=(31&N)<<6|63&A,B<=127&&(B=null))):$===3?(A=l[w+1],R=l[w+2],(192&A)==128&&(192&R)==128&&(B=(15&N)<<12|(63&A)<<6|63&R,(B<=2047||B>=55296&&B<=57343)&&(B=null))):$===4&&(A=l[w+1],R=l[w+2],I=l[w+3],(192&A)==128&&(192&R)==128&&(192&I)==128&&(B=(15&N)<<18|(63&A)<<12|(63&R)<<6|63&I,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,$=1):B>65535&&(B-=65536,y+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),y+=String.fromCharCode(B),w+=$}return y})(r,e,s)}class Jh extends Rc{offsetBuffer;constructor(e,s,l,d){super(e,l,d),this.offsetBuffer=s}}class Pp extends Jh{textEncoder;constructor(e,s,l,d){super(e,s,l,d??s.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Qm(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Gl extends Jh{indexBuffer;textEncoder;constructor(e,s,l,d,g){super(e,l,d,g??s.length),this.indexBuffer=s,this.indexBuffer=s,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const s=this.indexBuffer[e];return Qm(this.dataBuffer,this.offsetBuffer[s],this.offsetBuffer[s+1])}}class Dp extends Jh{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,s,l,d,g,y,w){super(e,l,d,w),this.indexBuffer=s,this.symbolOffsetBuffer=g,this.symbolTableBuffer=y,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(l,d,g){const y=[],w=new Array(d.length).fill(0);for(let N=1;N<d.length;N++)w[N]=w[N-1]+d[N-1];for(let N=0;N<g.length;N++)if(g[N]===255)y.push(g[++N]);else{const A=d[g[N]],R=w[g[N]];for(let I=0;I<A;I++)y.push(l[R+I])}return new Uint8Array(y)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const s=this.indexBuffer[e];return Qm(this.decodedDictionary,this.offsetBuffer[s],this.offsetBuffer[s+1])}offsetToLengthBuffer(e){const s=new Uint32Array(e.length-1);let l=e[0];for(let d=1;d<e.length;d++){const g=e[d];s[d-1]=g-l,l=g}return s}}function Sy(r,e,s,l,d,g){return s.type==="scalarType"?(function(y,w,N,A,R,I){let B=null,$=0;if(y===0)return null;if(I.nullable){const X=pa(w,N);$=X.numValues;const te=N.get(),oe=Lc(w,$,X.byteLength,N);N.set(te+X.byteLength),B=new Eo(oe,X.numValues)}const W=B??A;switch(R.physicalType){case 4:case 3:return(function(X,te,oe,be,ne){const me=pa(X,te),Ee=Ep(me,ne,X,te),Ie=be.physicalType===3;if(Ee===Lr.FLAT){const Je=ma(X,te,me,Ie,0,Uu(ne)?ne:void 0);return new wp(oe.name,Je,ne)}if(Ee===Lr.SEQUENCE){const Je=Hm(X,te,me);return new Vm(oe.name,Je[0],Je[1],me.numRleValues)}{const Je=Gm(X,te,me,Ie);return new qm(oe.name,Je,ne)}})(w,N,I,R,W);case 9:return(function(X,te,oe,be,ne){let me=null,Ee=null,Ie=null,Je=null,pt=null,gt=null,Tt=null,Lt=null;for(let kt=0;kt<be;kt++){const yt=pa(te,oe);if(yt.byteLength!==0)switch(yt.physicalStreamType){case Fi.PRESENT:{const ut=Lc(te,yt.numValues,yt.byteLength,oe);gt=new Eo(ut,yt.numValues);break}case Fi.OFFSET:Ee=ma(te,oe,yt,!1,0,ne!=null||gt!=null?ne??gt:void 0);break;case Fi.LENGTH:{const ut=Oc(te,oe,yt);fa.DICTIONARY===yt.logicalStreamType.lengthType?me=ut:fa.SYMBOL===yt.logicalStreamType.lengthType?Je=ut:Tt=ut;break}case Fi.DATA:{const ut=te.subarray(oe.get(),oe.get()+yt.byteLength);oe.add(yt.byteLength);const qt=yt.logicalStreamType.dictionaryType;No.FSST===qt?pt=ut:No.SINGLE===qt||No.SHARED===qt?Ie=ut:No.NONE===qt&&(Lt=ut);break}}}return(function(kt,yt,ut,qt,Zt,ts,Xt){return yt?new Dp(kt,ut,qt,Zt,ts,yt,Xt):null})(X,pt,Ee,me,Ie,Je,ne??gt)??(function(kt,yt,ut,qt,Zt){return yt?Zt?new Gl(kt,ut,qt,yt,Zt):new Gl(kt,ut,qt,yt):null})(X,Ie,Ee,me,ne??gt)??(function(kt,yt,ut,qt,Zt){if(!yt||!ut)return null;if(qt)return Zt?new Gl(kt,qt,yt,ut,Zt):new Gl(kt,qt,yt,ut);if(Zt&&Zt.size()!==yt.length-1){const ts=new Int32Array(Zt.size());let Xt=0;for(let Ns=0;Ns<Zt.size();Ns++)ts[Ns]=Zt.get(Ns)?Xt++:0;return new Gl(kt,ts,yt,ut,Zt)}return Zt?new Pp(kt,yt,ut,Zt):new Pp(kt,yt,ut)})(X,Tt,Lt,Ee,ne??gt)})(I.name,w,N,I.nullable?y-1:y,B);case 0:return(function(X,te,oe,be,ne){const me=pa(X,te),Ee=me.numValues,Ie=te.get(),Je=Uu(ne)?ne:void 0,pt=Lc(X,Ee,me.byteLength,te,Je);te.set(Ie+me.byteLength);const gt=new Eo(pt,Ee);return new Km(oe.name,gt,ne)})(w,N,I,0,W);case 6:case 5:return(function(X,te,oe,be,ne){const me=pa(X,te),Ee=Ep(me,be,X,te),Ie=ne.physicalType===5;if(Ee===Lr.FLAT){const Je=Ud(X,te,me,Ie,Uu(be)?be:void 0);return new Bu(oe.name,Je,be)}if(Ee===Lr.SEQUENCE){const Je=Lu(X,te,me);return new $d(oe.name,Je[0],Je[1],me.numRleValues)}{const Je=Zm(X,te,me,Ie);return new Jm(oe.name,Je,be)}})(w,N,I,W,R);case 7:return(function(X,te,oe,be){const ne=pa(X,te),me=Uu(be)?be:void 0,Ee=(function(Ie,Je,pt,gt){const Tt=Je.get(),Lt=Tt+pt*Float32Array.BYTES_PER_ELEMENT,kt=new Uint8Array(Ie.subarray(Tt,Lt)).buffer,yt=new Float32Array(kt);return Je.set(Lt),gt?Tp(yt,gt,0):yt})(X,te,ne.numValues,me);return new wy(oe.name,Ee,be)})(w,N,I,W);case 8:return(function(X,te,oe,be){const ne=pa(X,te),me=Uu(be)?be:void 0,Ee=(function(Ie,Je,pt,gt){const Tt=Je.get(),Lt=Tt+pt*Float64Array.BYTES_PER_ELEMENT,kt=new Uint8Array(Ie.subarray(Tt,Lt)).buffer,yt=new Float64Array(kt);return Je.set(Lt),gt?Tp(yt,gt,0):yt})(X,te,ne.numValues,me);return new Um(oe.name,Ee,be)})(w,N,I,W);default:throw new Error(`The specified data type for the field is currently not supported: ${R}`)}})(l,r,e,d,s.scalarType,s):l===0?null:(function(y,w,N,A){let R=null,I=null,B=null,$=null,W=!1;for(;!W;){const be=pa(y,w);switch(be.physicalStreamType){case Fi.LENGTH:fa.DICTIONARY===be.logicalStreamType.lengthType?R=Oc(y,w,be):B=Oc(y,w,be);break;case Fi.DATA:No.SINGLE===be.logicalStreamType.dictionaryType||No.SHARED===be.logicalStreamType.dictionaryType?(I=y.subarray(w.get(),w.get()+be.byteLength),W=!0):$=y.subarray(w.get(),w.get()+be.byteLength),w.add(be.byteLength)}}const X=N.complexType.children,te=[];let oe=0;for(const be of X){const ne=Ui(y,w,1)[0];if(ne==0)continue;const me=be.name?`${N.name}${be.name}`:N.name;if(ne!==2||be.type!=="scalarField"||be.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Ee=pa(y,w),Ie=Lc(y,Ee.numValues,Ee.byteLength,w),Je=pa(y,w),pt=ma(y,w,Je,!1,0,Je.decompressedCount!==A?new Eo(Ie,Ee.numValues):void 0);te[oe++]=$?new Dp(me,pt,R,I,B,$,new Eo(Ie,Ee.numValues)):new Gl(me,pt,R,I,new Eo(Ie,Ee.numValues))}return te})(r,e,s,d)}function Uu(r){return r instanceof Eo}function Hl(r){switch(r){case 0:case 1:case 2:case 3:{const e={};e.nullable=!!(1&r),e.columnScope=0;const s={};return s.physicalType=r>1?6:4,s.type="physicalType",e.scalarType=s,e.type="scalarType",e}case 4:{const e={nullable:!1,columnScope:0},s={type:"physicalType",physicalType:0};return e.type="complexType",e.complexType=s,e}case 30:{const e={nullable:!1,columnScope:0},s={type:"physicalType",physicalType:1};return e.type="complexType",e.complexType=s,e}default:return(function(e){let s=null;switch(e){case 10:case 11:s=0;break;case 12:case 13:s=1;break;case 14:case 15:s=2;break;case 16:case 17:s=3;break;case 18:case 19:s=4;break;case 20:case 21:s=5;break;case 22:case 23:s=6;break;case 24:case 25:s=7;break;case 26:case 27:s=8;break;case 28:case 29:s=9;break;default:return null}const l={};l.nullable=!!(1&e),l.columnScope=0;const d={type:"physicalType"};return d.physicalType=s,l.type="scalarType",l.scalarType=d,l})(r)}}function Zl(r){return r>=10}function Wl(r){return r===30}function Qh(r){if(r.name==="id")return!1;if(r.type==="scalarType"){const e=r.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(r.type==="complexType"){const e=r.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",r),!1}const ef=new TextDecoder;function al(r,e){const s=Ui(r,e,1)[0];if(s===0)return"";const l=e.get(),d=r.subarray(l,l+s);return e.add(s),ef.decode(d)}function jy(r,e){const s=Ui(r,e,1)[0]>>>0;if(s<10||s>30)throw new Error(`Unsupported field type code ${s}. Supported: 10-29(scalars), 30(STRUCT)`);const l=Hl(s);if(Zl(s)&&(l.name=al(r,e)),Wl(s)){const d=Ui(r,e,1)[0]>>>0;l.complexType.children=new Array(d);for(let g=0;g<d;g++)l.complexType.children[g]=jy(r,e)}return(function(d){return{name:d.name,nullable:d.nullable,scalarField:d.scalarType,complexField:d.complexType,type:d.type==="scalarType"?"scalarField":"complexField"}})(l)}function Ty(r,e){const s=Ui(r,e,1)[0]>>>0,l=Hl(s);if(!l)throw new Error(`Unsupported column type code ${s}. Supported: 0-3(ID), 4(GEOMETRY), 10-29(scalars), 30(STRUCT)`);if(Zl(s)?l.name=al(r,e):s>=0&&s<=3?l.name="id":s===4&&(l.name="geometry"),Wl(s)){const d=Ui(r,e,1)[0]>>>0,g=l.complexType;g.children=new Array(d);for(let y=0;y<d;y++)g.children[y]=jy(r,e)}return l}function tf(r,e){const s={featureTables:[]},l={};l.name=al(r,e);const d=Ui(r,e,1)[0]>>>0,g=Ui(r,e,1)[0]>>>0;l.columns=new Array(g);for(let y=0;y<g;y++)l.columns[y]=Ty(r,e);return s.featureTables.push(l),[s,d]}function gx(r,e,s,l,d,g,y=!1){const w=e.scalarType.physicalType,N=Ep(d,g,r,s);if(w===4)switch(N){case Lr.FLAT:{const A=ma(r,s,d,!1);return new wp(l,A,g)}case Lr.SEQUENCE:{const A=Hm(r,s,d);return new Vm(l,A[0],A[1],d.numRleValues)}case Lr.CONST:{const A=Gm(r,s,d,!1);return new qm(l,A,g)}}else switch(N){case Lr.FLAT:{if(y){const R=(function(I,B,$){const W=(function(X,te,oe){const be=new Float64Array(oe);for(let ne=0;ne<oe;ne++)be[ne]=Vh(X,te);return be})(I,B,$.numValues);return(function(X,te){switch(te.logicalLevelTechnique1){case ir.DELTA:return te.logicalLevelTechnique2===ir.RLE&&(X=gy(X,te.runs,te.numRleValues)),(function(oe){oe[0]=ql(oe[0]);const be=oe.length/4*4;let ne=1;if(be>=4)for(;ne<be-4;ne+=4){const me=oe[ne+1],Ee=oe[ne+2],Ie=oe[ne+3];oe[ne]=ql(oe[ne])+oe[ne-1],oe[ne+1]=ql(me)+oe[ne],oe[ne+2]=ql(Ee)+oe[ne+1],oe[ne+3]=ql(Ie)+oe[ne+2]}for(;ne!=oe.length;++ne)oe[ne]=ql(oe[ne])+oe[ne-1]})(X),X;case ir.RLE:return(function(oe,be){return gy(oe,be.runs,be.numRleValues)})(X,te);case ir.NONE:return X;default:throw new Error(`The specified Logical level technique is not supported: ${te.logicalLevelTechnique1}`)}})(W,$)})(r,s,d);return new Um(l,R,g)}const A=Ud(r,s,d,!1);return new Bu(l,A,g)}case Lr.SEQUENCE:{const A=Lu(r,s,d);return new $d(l,A[0],A[1],d.numRleValues)}case Lr.CONST:{const A=Zm(r,s,d,!1);return new Jm(l,A,g)}}throw new Error("Vector type not supported for id column.")}class Ny{constructor(e,s){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case Ai.POINT:case Ai.MULTIPOINT:this.type=1;break;case Ai.LINESTRING:case Ai.MULTILINESTRING:this.type=2;break;case Ai.POLYGON:case Ai.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=s,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const s of this._featureData.geometry.coordinates){const l=[];for(const d of s)l.push(new O(d.x,d.y));e.push(l)}return e}}class Rp{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Ny(this.features[e],this.extent)}}class eg{constructor(e){this.layers={};const s=(function(l,d,g=!0){const y=new fy(0),w=[];for(;y.get()<l.length;){const N=Ui(l,y,1)[0]>>>0,A=y.get()+N;if(A>l.length)throw new Error(`Block overruns tile: ${A} > ${l.length}`);if(Ui(l,y,1)[0]>>>0!=1){y.set(A);continue}const R=tf(l,y),I=R[1],B=R[0].featureTables[0];let $=null,W=null;const X=[];let te=0;for(const be of B.columns){const ne=be.name;if(ne==="id"){let me=null;if(be.nullable){const Ie=pa(l,y),Je=y.get(),pt=Lc(l,Ie.numValues,Ie.byteLength,y);y.set(Je+Ie.byteLength),me=new Eo(pt,Ie.numValues)}const Ee=pa(l,y);te=Ee.decompressedCount,$=gx(l,be,y,ne,Ee,me??te,g)}else if(ne==="geometry"){const me=Ui(l,y,1)[0];if(te===0){const Ee=y.get();te=pa(l,y).decompressedCount,y.set(Ee)}W=by(l,me,y,te)}else{const me=Qh(be)?Ui(l,y,1)[0]:1;if(me===0)continue;const Ee=Sy(l,y,be,me,te);if(Ee)if(Array.isArray(Ee))for(const Ie of Ee)X.push(Ie);else X.push(Ee)}}const oe=new Ic(B.name,W,$,X,I);w.push(oe),y.set(A)}return w})(new Uint8Array(e));this.layers=s.reduce(((l,d)=>Object.assign(Object.assign({},l),{[d.name]:new Rp(d)})),{})}}class yx{constructor(e,s){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=s,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],s=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of s){const d=[];for(const g of l)d.push(new O(g[0],g[1]));e.push(d)}return e}}const Bc="_geojsonTileLayer";function Ip(r,e){e.writeVarintField(15,r.version||1),e.writeStringField(1,r.name||""),e.writeVarintField(5,r.extent||4096);const s={keys:[],values:[],keycache:{},valuecache:{}};for(let g=0;g<r.length;g++)s.feature=r.feature(g),e.writeMessage(2,Ey,s);const l=s.keys;for(const g of l)e.writeStringField(3,g);const d=s.values;for(const g of d)e.writeMessage(4,Cy,g)}function Ey(r,e){if(!r.feature)return;const s=r.feature;s.id!==void 0&&e.writeVarintField(1,s.id),e.writeMessage(2,qd,r),e.writeVarintField(3,s.type),e.writeMessage(4,Lp,s)}function qd(r,e){for(const s in r.feature?.properties){let l=r.feature.properties[s],d=r.keycache[s];if(l==null)continue;d===void 0&&(r.keys.push(s),d=r.keys.length-1,r.keycache[s]=d),e.writeVarint(d),typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"&&(l=JSON.stringify(l));const g=typeof l+":"+l;let y=r.valuecache[g];y===void 0&&(r.values.push(l),y=r.values.length-1,r.valuecache[g]=y),e.writeVarint(y)}}function zp(r,e){return(e<<3)+(7&r)}function Op(r){return r<<1^r>>31}function Lp(r,e){const s=r.loadGeometry(),l=r.type;let d=0,g=0;for(const y of s){let w=1;l===1&&(w=y.length),e.writeVarint(zp(1,w));const N=l===3?y.length-1:y.length;for(let A=0;A<N;A++){A===1&&l!==1&&e.writeVarint(zp(2,N-1));const R=y[A].x-d,I=y[A].y-g;e.writeVarint(Op(R)),e.writeVarint(Op(I)),d+=R,g+=I}r.type===3&&e.writeVarint(zp(7,1))}}function Cy(r,e){const s=typeof r;s==="string"?e.writeStringField(1,r):s==="boolean"?e.writeBooleanField(7,r):s==="number"&&(r%1!=0?e.writeDoubleField(3,r):r<0?e.writeSVarintField(6,r):e.writeVarintField(5,r))}class Ay{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Zo(Ze,16,0),this.grid3D=new Zo(Ze,16,0),this.featureIndexArray=new ie,this.promoteId=s}insert(e,s,l,d,g,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,g);const N=y?this.grid3D:this.grid;for(let A=0;A<s.length;A++){const R=s[A],I=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const $=R[B];I[0]=Math.min(I[0],$.x),I[1]=Math.min(I[1],$.y),I[2]=Math.max(I[2],$.x),I[3]=Math.max(I[3],$.y)}I[0]<Ze&&I[1]<Ze&&I[2]>=0&&I[3]>=0&&N.insert(w,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new $s(new np(this.rawTileData)).layers:new eg(this.rawTileData).layers,this.sourceLayerCoder=new Fm(this.vtLayers?Object.keys(this.vtLayers).sort():[Bc])),this.vtLayers}query(e,s,l,d){this.loadVTLayers();const g=e.params,y=Ze/e.tileSize/e.scale,w=na(g.filter,g.globalState),N=e.queryGeometry,A=e.queryPadding*y,R=Dc.fromPoints(N),I=this.grid.query(R.minX-A,R.minY-A,R.maxX+A,R.maxY+A),B=Dc.fromPoints(e.cameraQueryGeometry).expandBy(A),$=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((te,oe,be,ne)=>(function(me,Ee,Ie,Je,pt){for(const Tt of me)if(Ee<=Tt.x&&Ie<=Tt.y&&Je>=Tt.x&&pt>=Tt.y)return!0;const gt=[new O(Ee,Ie),new O(Ee,pt),new O(Je,pt),new O(Je,Ie)];if(me.length>2){for(const Tt of gt)if(Jo(me,Tt))return!0}for(let Tt=0;Tt<me.length-1;Tt++)if(Mg(me[Tt],me[Tt+1],gt))return!0;return!1})(e.cameraQueryGeometry,te-A,oe-A,be+A,ne+A)));for(const te of $)I.push(te);I.sort(i);const W={};let X;for(let te=0;te<I.length;te++){const oe=I[te];if(oe===X)continue;X=oe;const be=this.featureIndexArray.get(oe);let ne=null;this.loadMatchingFeature(W,be.bucketIndex,be.sourceLayerIndex,be.featureIndex,w,g.layers,g.availableImages,s,l,d,((me,Ee,Ie)=>(ne||(ne=wo(me)),Ee.queryIntersectsFeature({queryGeometry:N,feature:me,featureState:Ie,geometry:ne,zoom:this.z,transform:e.transform,pixelsToTileUnits:y,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return W}loadMatchingFeature(e,s,l,d,g,y,w,N,A,R,I){const B=this.bucketLayerIDs[s];if(y&&!B.some((te=>y.has(te))))return;const $=this.sourceLayerCoder.decode(l),W=this.vtLayers[$].feature(d);if(g.needGeometry){const te=Nn(W,!0);if(!g.filter(new sr(this.tileID.overscaledZ),te,this.tileID.canonical))return}else if(!g.filter(new sr(this.tileID.overscaledZ),W))return;const X=this.getId(W,$);for(let te=0;te<B.length;te++){const oe=B[te];if(y&&!y.has(oe))continue;const be=N[oe];if(!be)continue;let ne={};X&&R&&(ne=R.getState(be.sourceLayer||Bc,X));const me=Dt({},A[oe]);me.paint=sf(me.paint,be.paint,W,ne,w),me.layout=sf(me.layout,be.layout,W,ne,w);const Ee=!I||I(W,be,ne);if(!Ee)continue;const Ie=new vp(W,this.z,this.x,this.y,X);Ie.layer=me;let Je=e[oe];Je===void 0&&(Je=e[oe]=[]),Je.push({featureIndex:d,feature:Ie,intersectionZ:Ee})}}lookupSymbolFeatures(e,s,l,d,g,y,w,N){const A={};this.loadVTLayers();const R=na(g.filterSpec,g.globalState);for(const I of e)this.loadMatchingFeature(A,l,d,I,R,y,w,N,s);return A}hasLayer(e){for(const s of this.bucketLayerIDs)for(const l of s)if(e===l)return!0;return!1}getId(e,s){var l;let d=e.id;return this.promoteId&&(d=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(d=Number(e.properties.cluster_id))),d}}function sf(r,e,s,l,d){return js(r,((g,y)=>{const w=e instanceof Cl?e.get(y):null;return w&&w.evaluate?w.evaluate(s,l,d):w}))}function i(r,e){return e-r}function o(r,e,s,l,d){const g=[];for(let y=0;y<r.length;y++){const w=r[y];let N;for(let A=0;A<w.length-1;A++){let R=w[A],I=w[A+1];R.x<e&&I.x<e||(R.x<e?R=new O(e,R.y+(e-R.x)/(I.x-R.x)*(I.y-R.y))._round():I.x<e&&(I=new O(e,R.y+(e-R.x)/(I.x-R.x)*(I.y-R.y))._round()),R.y<s&&I.y<s||(R.y<s?R=new O(R.x+(s-R.y)/(I.y-R.y)*(I.x-R.x),s)._round():I.y<s&&(I=new O(R.x+(s-R.y)/(I.y-R.y)*(I.x-R.x),s)._round()),R.x>=l&&I.x>=l||(R.x>=l?R=new O(l,R.y+(l-R.x)/(I.x-R.x)*(I.y-R.y))._round():I.x>=l&&(I=new O(l,R.y+(l-R.x)/(I.x-R.x)*(I.y-R.y))._round()),R.y>=d&&I.y>=d||(R.y>=d?R=new O(R.x+(d-R.y)/(I.y-R.y)*(I.x-R.x),d)._round():I.y>=d&&(I=new O(R.x+(d-R.y)/(I.y-R.y)*(I.x-R.x),d)._round()),N&&R.equals(N[N.length-1])||(N=[R],g.push(N)),N.push(I)))))}}return g}function f(r,e,s,l,d){switch(e){case 1:return(function(g,y,w,N){const A=[];for(const R of g)for(const I of R){const B=N===0?I.x:I.y;B>=y&&B<=w&&A.push([I])}return A})(r,s,l,d);case 2:return C(r,s,l,d,!1);case 3:return C(r,s,l,d,!0)}return[]}function v(r,e,s,l,d){const g=l===0?D:Z;let y=[];const w=[];for(let R=0;R<r.length-1;R++){const I=r[R],B=r[R+1],$=l===0?I.x:I.y,W=l===0?B.x:B.y;let X=!1;$<e?W>e&&y.push(g(I,B,e)):$>s?W<s&&y.push(g(I,B,s)):y.push(I),W<e&&$>=e&&(y.push(g(I,B,e)),X=!0),W>s&&$<=s&&(y.push(g(I,B,s)),X=!0),!d&&X&&(w.push(y),y=[])}const N=r.length-1,A=l===0?r[N].x:r[N].y;return A>=e&&A<=s&&y.push(r[N]),d&&y.length>0&&!y[0].equals(y[y.length-1])&&y.push(new O(y[0].x,y[0].y)),y.length>0&&w.push(y),w}function C(r,e,s,l,d){const g=[];for(const y of r){const w=v(y,e,s,l,d);w.length>0&&g.push(...w)}return g}function D(r,e,s){return new O(s,r.y+(s-r.x)/(e.x-r.x)*(e.y-r.y))}function Z(r,e,s){return new O(r.x+(s-r.y)/(e.y-r.y)*(e.x-r.x),s)}Ut("FeatureIndex",Ay,{omit:["rawTileData","sourceLayerCoder"]});class ce extends O{constructor(e,s,l,d){super(e,s),this.angle=l,d!==void 0&&(this.segment=d)}clone(){return new ce(this.x,this.y,this.angle,this.segment)}}function ze(r,e,s,l,d){if(e.segment===void 0||s===0)return!0;let g=e,y=e.segment+1,w=0;for(;w>-s/2;){if(y--,y<0)return!1;w-=r[y].dist(g),g=r[y]}w+=r[y].dist(r[y+1]),y++;const N=[];let A=0;for(;w<s/2;){const R=r[y],I=r[y+1];if(!I)return!1;let B=r[y-1].angleTo(R)-R.angleTo(I);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:w,angleDelta:B}),A+=B;w-N[0].distance>l;)A-=N.shift().angleDelta;if(A>d)return!1;y++,w+=R.dist(I)}return!0}function at(r){let e=0;for(let s=0;s<r.length-1;s++)e+=r[s].dist(r[s+1]);return e}function bt(r,e,s){return r?.6*e*s:0}function At(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function ct(r,e,s,l,d,g){const y=bt(s,d,g),w=At(s,l)*g;let N=0;const A=at(r)/2;for(let R=0;R<r.length-1;R++){const I=r[R],B=r[R+1],$=I.dist(B);if(N+$>A){const W=(A-N)/$,X=kr.number(I.x,B.x,W),te=kr.number(I.y,B.y,W),oe=new ce(X,te,B.angleTo(I),R);return oe._round(),!y||ze(r,oe,w,y,e)?oe:void 0}N+=$}}function ft(r,e,s,l,d,g,y,w,N){const A=bt(l,g,y),R=At(l,d),I=R*y,B=r[0].x===0||r[0].x===N||r[0].y===0||r[0].y===N;return e-I<e/4&&(e=I+e/4),Jt(r,B?e/2*w%e:(R/2+2*g)*y*w%e,e,A,s,I,B,!1,N)}function Jt(r,e,s,l,d,g,y,w,N){const A=g/2,R=at(r);let I=0,B=e-s,$=[];for(let W=0;W<r.length-1;W++){const X=r[W],te=r[W+1],oe=X.dist(te),be=te.angleTo(X);for(;B+s<I+oe;){B+=s;const ne=(B-I)/oe,me=kr.number(X.x,te.x,ne),Ee=kr.number(X.y,te.y,ne);if(me>=0&&me<N&&Ee>=0&&Ee<N&&B-A>=0&&B+A<=R){const Ie=new ce(me,Ee,be,W);Ie._round(),l&&!ze(r,Ie,g,l,d)||$.push(Ie)}}I+=oe}return w||$.length||y||($=Jt(r,I/2,s,l,d,g,y,!0,N)),$}function ps(r,e,s,l){const d=[],g=r.image,y=g.pixelRatio,w=g.paddedRect.w-2,N=g.paddedRect.h-2;let A={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const R=g.stretchX||[[0,w]],I=g.stretchY||[[0,N]],B=(ut,qt)=>ut+qt[1]-qt[0],$=R.reduce(B,0),W=I.reduce(B,0),X=w-$,te=N-W;let oe=0,be=$,ne=0,me=W,Ee=0,Ie=X,Je=0,pt=te;if(g.content&&l){const ut=g.content,qt=ut[2]-ut[0],Zt=ut[3]-ut[1];(g.textFitWidth||g.textFitHeight)&&(A=Vl(r)),oe=gr(R,0,ut[0]),ne=gr(I,0,ut[1]),be=gr(R,ut[0],ut[2]),me=gr(I,ut[1],ut[3]),Ee=ut[0]-oe,Je=ut[1]-ne,Ie=qt-be,pt=Zt-me}const gt=A.x1,Tt=A.y1,Lt=A.x2-gt,kt=A.y2-Tt,yt=(ut,qt,Zt,ts)=>{const Xt=Ge(ut.stretch-oe,be,Lt,gt),Ns=it(ut.fixed-Ee,Ie,ut.stretch,$),Zr=Ge(qt.stretch-ne,me,kt,Tt),ki=it(qt.fixed-Je,pt,qt.stretch,W),ga=Ge(Zt.stretch-oe,be,Lt,gt),nl=it(Zt.fixed-Ee,Ie,Zt.stretch,$),fn=Ge(ts.stretch-ne,me,kt,Tt),ea=it(ts.fixed-Je,pt,ts.stretch,W),ya=new O(Xt,Zr),di=new O(ga,Zr),ta=new O(ga,fn),Ba=new O(Xt,fn),Fa=new O(Ns/y,ki/y),kn=new O(nl/y,ea/y),xa=e*Math.PI/180;if(xa){const $i=Math.sin(xa),Jr=Math.cos(xa),Mi=[Jr,-$i,$i,Jr];ya._matMult(Mi),di._matMult(Mi),Ba._matMult(Mi),ta._matMult(Mi)}const Mn=ut.stretch+ut.fixed,ol=qt.stretch+qt.fixed;return{tl:ya,tr:di,bl:Ba,br:ta,tex:{x:g.paddedRect.x+1+Mn,y:g.paddedRect.y+1+ol,w:Zt.stretch+Zt.fixed-Mn,h:ts.stretch+ts.fixed-ol},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:kn,minFontScaleX:Ie/y/Lt,minFontScaleY:pt/y/kt,isSDF:s}};if(l&&(g.stretchX||g.stretchY)){const ut=Xe(R,X,$),qt=Xe(I,te,W);for(let Zt=0;Zt<ut.length-1;Zt++){const ts=ut[Zt],Xt=ut[Zt+1];for(let Ns=0;Ns<qt.length-1;Ns++)d.push(yt(ts,qt[Ns],Xt,qt[Ns+1]))}}else d.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:N+1}));return d}function gr(r,e,s){let l=0;for(const d of r)l+=Math.max(e,Math.min(s,d[1]))-Math.max(e,Math.min(s,d[0]));return l}function Xe(r,e,s){const l=[{fixed:-1,stretch:0}];for(const[d,g]of r){const y=l[l.length-1];l.push({fixed:d-y.stretch,stretch:y.stretch}),l.push({fixed:d-y.stretch,stretch:y.stretch+(g-d)})}return l.push({fixed:e+1,stretch:s}),l}function Ge(r,e,s,l){return r/e*s+l}function it(r,e,s,l){return r-e*s/l}Ut("Anchor",ce);class jt{constructor(e,s,l,d,g,y,w,N,A,R){var I;if(this.boxStartIndex=e.length,A){let B=y.top,$=y.bottom;const W=y.collisionPadding;W&&(B-=W[1],$+=W[3]);let X=$-B;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const B=!((I=y.image)===null||I===void 0)&&I.content&&(y.image.textFitWidth||y.image.textFitHeight)?Vl(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};B.y1=B.y1*w-N[0],B.y2=B.y2*w+N[2],B.x1=B.x1*w-N[3],B.x2=B.x2*w+N[1];const $=y.collisionPadding;if($&&(B.x1-=$[0]*w,B.y1-=$[1]*w,B.x2+=$[2]*w,B.y2+=$[3]*w),R){const W=new O(B.x1,B.y1),X=new O(B.x2,B.y1),te=new O(B.x1,B.y2),oe=new O(B.x2,B.y2),be=R*Math.PI/180;W._rotate(be),X._rotate(be),te._rotate(be),oe._rotate(be),B.x1=Math.min(W.x,X.x,te.x,oe.x),B.x2=Math.max(W.x,X.x,te.x,oe.x),B.y1=Math.min(W.y,X.y,te.y,oe.y),B.y2=Math.max(W.y,X.y,te.y,oe.y)}e.emplaceBack(s.x,s.y,B.x1,B.y1,B.x2,B.y2,l,d,g)}this.boxEndIndex=e.length}}class cs{constructor(e=[],s=(l,d)=>l<d?-1:l>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:l}=this,d=s[e];for(;e>0;){const g=e-1>>1,y=s[g];if(l(d,y)>=0)break;s[e]=y,e=g}s[e]=d}_down(e){const{data:s,compare:l}=this,d=this.length>>1,g=s[e];for(;e<d;){let y=1+(e<<1);const w=y+1;if(w<this.length&&l(s[w],s[y])<0&&(y=w),l(s[y],g)>=0)break;s[e]=s[y],e=y}s[e]=g}}function cr(r,e=1,s=!1){const l=Dc.fromPoints(r[0]),d=Math.min(l.width(),l.height());let g=d/2;const y=new cs([],rs),{minX:w,minY:N,maxX:A,maxY:R}=l;if(d===0)return new O(w,N);for(let $=w;$<A;$+=d)for(let W=N;W<R;W+=d)y.push(new ws($+g,W+g,g,r));let I=(function($){let W=0,X=0,te=0;const oe=$[0];for(let be=0,ne=oe.length,me=ne-1;be<ne;me=be++){const Ee=oe[be],Ie=oe[me],Je=Ee.x*Ie.y-Ie.x*Ee.y;X+=(Ee.x+Ie.x)*Je,te+=(Ee.y+Ie.y)*Je,W+=3*Je}return new ws(X/W,te/W,0,$)})(r),B=y.length;for(;y.length;){const $=y.pop();($.d>I.d||!I.d)&&(I=$,s&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,B)),$.max-I.d<=e||(g=$.h/2,y.push(new ws($.p.x-g,$.p.y-g,g,r)),y.push(new ws($.p.x+g,$.p.y-g,g,r)),y.push(new ws($.p.x-g,$.p.y+g,g,r)),y.push(new ws($.p.x+g,$.p.y+g,g,r)),B+=4)}return s&&(console.log(`num probes: ${B}`),console.log(`best distance: ${I.d}`)),I.p}function rs(r,e){return e.max-r.max}function ws(r,e,s,l){this.p=new O(r,e),this.h=s,this.d=(function(d,g){let y=!1,w=1/0;for(let N=0;N<g.length;N++){const A=g[N];for(let R=0,I=A.length,B=I-1;R<I;B=R++){const $=A[R],W=A[B];$.y>d.y!=W.y>d.y&&d.x<(W.x-$.x)*(d.y-$.y)/(W.y-$.y)+$.x&&(y=!y),w=Math.min(w,lm(d,$,W))}}return(y?1:-1)*Math.sqrt(w)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var hs;T.aP=void 0,(hs=T.aP||(T.aP={}))[hs.center=1]="center",hs[hs.left=2]="left",hs[hs.right=3]="right",hs[hs.top=4]="top",hs[hs.bottom=5]="bottom",hs[hs["top-left"]=6]="top-left",hs[hs["top-right"]=7]="top-right",hs[hs["bottom-left"]=8]="bottom-left",hs[hs["bottom-right"]=9]="bottom-right";const tr=Number.POSITIVE_INFINITY;function Yl(r,e){return e[1]!==tr?(function(s,l,d){let g=0,y=0;switch(l=Math.abs(l),d=Math.abs(d),s){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(s){case"top-right":case"bottom-right":case"right":g=-l;break;case"top-left":case"bottom-left":case"left":g=l}return[g,y]})(r,e[0],e[1]):(function(s,l){let d=0,g=0;l<0&&(l=0);const y=l/Math.SQRT2;switch(s){case"top-right":case"top-left":g=y-7;break;case"bottom-right":case"bottom-left":g=7-y;break;case"bottom":g=7-l;break;case"top":g=l-7}switch(s){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=l;break;case"right":d=-l}return[d,g]})(r,e[0])}function ky(r,e,s){var l;const d=r.layout,g=(l=d.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},s);if(g){const w=g.values,N=[];for(let A=0;A<w.length;A+=2){const R=N[A]=w[A],I=w[A+1].map((B=>B*xi));R.startsWith("top")?I[1]-=7:R.startsWith("bottom")&&(I[1]+=7),N[A+1]=I}return new Ur(N)}const y=d.get("text-variable-anchor");if(y){let w;w=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(e,{},s)*xi,tr]:d.get("text-offset").evaluate(e,{},s).map((A=>A*xi));const N=[];for(const A of y)N.push(A,Yl(A,w));return new Ur(N)}return null}function xx(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sv(r,e,s,l,d,g,y,w,N,A,R,I){let B=g.textMaxSize.evaluate(e,{});B===void 0&&(B=y);const $=r.layers[0].layout,W=$.get("icon-offset").evaluate(e,{},R),X=b_(s.horizontal),te=y/24,oe=r.tilePixelRatio*te,be=r.tilePixelRatio*B/24,ne=r.tilePixelRatio*w,me=r.tilePixelRatio*$.get("symbol-spacing"),Ee=$.get("text-padding")*r.tilePixelRatio,Ie=(function(Zt,ts,Xt,Ns=1){const Zr=Zt.get("icon-padding").evaluate(ts,{},Xt),ki=Zr&&Zr.values;return[ki[0]*Ns,ki[1]*Ns,ki[2]*Ns,ki[3]*Ns]})($,e,R,r.tilePixelRatio),Je=$.get("text-max-angle")/180*Math.PI,pt=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",gt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Tt=$.get("symbol-placement"),Lt=me/2,kt=$.get("icon-text-fit");let yt;l&&kt!=="none"&&(r.allowVerticalPlacement&&s.vertical&&(yt=To(l,s.vertical,kt,$.get("icon-text-fit-padding"),W,te)),X&&(l=To(l,X,kt,$.get("icon-text-fit-padding"),W,te)));const ut=R?I.line.getGranularityForZoomLevel(R.z):1,qt=(Zt,ts)=>{ts.x<0||ts.x>=Ze||ts.y<0||ts.y>=Ze||(function(Xt,Ns,Zr,ki,ga,nl,fn,ea,ya,di,ta,Ba,Fa,kn,xa,Mn,ol,$i,Jr,Mi,ai,Vi,$u,Xl,rg){const Gd=Xt.addToLineVertexArray(Ns,Zr);let rf,Bp,Fp,Up,T_=0,N_=0,E_=0,C_=0,Nx=-1,Ex=-1;const Vu={};let A_=Gr("");if(Xt.allowVerticalPlacement&&ki.vertical){const Ua=ea.layout.get("text-rotate").evaluate(ai,{},Xl)+90;Fp=new jt(ya,Ns,di,ta,Ba,ki.vertical,Fa,kn,xa,Ua),fn&&(Up=new jt(ya,Ns,di,ta,Ba,fn,ol,$i,xa,Ua))}if(ga){const Ua=ea.layout.get("icon-rotate").evaluate(ai,{}),Co=ea.layout.get("icon-text-fit")!=="none",af=ps(ga,Ua,$u,Co),Jl=fn?ps(fn,Ua,$u,Co):void 0;Bp=new jt(ya,Ns,di,ta,Ba,ga,ol,$i,!1,Ua),T_=4*af.length;const nf=Xt.iconSizeData;let Fc=null;nf.kind==="source"?(Fc=[Cn*ea.layout.get("icon-size").evaluate(ai,{})],Fc[0]>Mc&&us(`${Xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):nf.kind==="composite"&&(Fc=[Cn*Vi.compositeIconSizes[0].evaluate(ai,{},Xl),Cn*Vi.compositeIconSizes[1].evaluate(ai,{},Xl)],(Fc[0]>Mc||Fc[1]>Mc)&&us(`${Xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Xt.addSymbols(Xt.icon,af,Fc,Mi,Jr,ai,T.az.none,Ns,Gd.lineStartIndex,Gd.lineLength,-1,Xl),Nx=Xt.icon.placedSymbolArray.length-1,Jl&&(N_=4*Jl.length,Xt.addSymbols(Xt.icon,Jl,Fc,Mi,Jr,ai,T.az.vertical,Ns,Gd.lineStartIndex,Gd.lineLength,-1,Xl),Ex=Xt.icon.placedSymbolArray.length-1)}const k_=Object.keys(ki.horizontal);for(const Ua of k_){const Co=ki.horizontal[Ua];if(!rf){A_=Gr(Co.text);const Jl=ea.layout.get("text-rotate").evaluate(ai,{},Xl);rf=new jt(ya,Ns,di,ta,Ba,Co,Fa,kn,xa,Jl)}const af=Co.positionedLines.length===1;if(E_+=v_(Xt,Ns,Co,nl,ea,xa,ai,Mn,Gd,ki.vertical?T.az.horizontal:T.az.horizontalOnly,af?k_:[Ua],Vu,Nx,Vi,Xl),af)break}ki.vertical&&(C_+=v_(Xt,Ns,ki.vertical,nl,ea,xa,ai,Mn,Gd,T.az.vertical,["vertical"],Vu,Ex,Vi,Xl));const Nv=rf?rf.boxStartIndex:Xt.collisionBoxArray.length,Ev=rf?rf.boxEndIndex:Xt.collisionBoxArray.length,Cv=Fp?Fp.boxStartIndex:Xt.collisionBoxArray.length,Av=Fp?Fp.boxEndIndex:Xt.collisionBoxArray.length,kv=Bp?Bp.boxStartIndex:Xt.collisionBoxArray.length,Mv=Bp?Bp.boxEndIndex:Xt.collisionBoxArray.length,Pv=Up?Up.boxStartIndex:Xt.collisionBoxArray.length,Dv=Up?Up.boxEndIndex:Xt.collisionBoxArray.length;let Kl=-1;const Py=(Ua,Co)=>Ua&&Ua.circleDiameter?Math.max(Ua.circleDiameter,Co):Co;Kl=Py(rf,Kl),Kl=Py(Fp,Kl),Kl=Py(Bp,Kl),Kl=Py(Up,Kl);const M_=Kl>-1?1:0;M_&&(Kl*=rg/xi),Xt.glyphOffsetArray.length>=Ld.MAX_GLYPHS&&us("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ai.sortKey!==void 0&&Xt.addToSortKeyRanges(Xt.symbolInstances.length,ai.sortKey);const Rv=ky(ea,ai,Xl),[Iv,zv]=(function(Ua,Co){const af=Ua.length,Jl=Co?.values;if(Jl?.length>0)for(let nf=0;nf<Jl.length;nf+=2){const Fc=Jl[nf+1];Ua.emplaceBack(T.aP[Jl[nf]],Fc[0],Fc[1])}return[af,Ua.length]})(Xt.textAnchorOffsets,Rv);Xt.symbolInstances.emplaceBack(Ns.x,Ns.y,Vu.right>=0?Vu.right:-1,Vu.center>=0?Vu.center:-1,Vu.left>=0?Vu.left:-1,Vu.vertical||-1,Nx,Ex,A_,Nv,Ev,Cv,Av,kv,Mv,Pv,Dv,di,E_,C_,T_,N_,M_,0,Fa,Kl,Iv,zv)})(r,ts,Zt,s,l,d,yt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,oe,[Ee,Ee,Ee,Ee],pt,N,ne,Ie,gt,W,e,g,A,R,y)};if(Tt==="line")for(const Zt of o(e.geometry,0,0,Ze,Ze)){const ts=Ll(Zt,ut),Xt=ft(ts,me,Je,s.vertical||X,l,24,be,r.overscaling,Ze);for(const Ns of Xt)X&&jv(r,X.text,Lt,Ns)||qt(ts,Ns)}else if(Tt==="line-center"){for(const Zt of e.geometry)if(Zt.length>1){const ts=Ll(Zt,ut),Xt=ct(ts,Je,s.vertical||X,l,24,be);Xt&&qt(ts,Xt)}}else if(e.type==="Polygon")for(const Zt of iu(e.geometry,0)){const ts=cr(Zt,16);qt(Ll(Zt[0],ut,!0),new ce(ts.x,ts.y,0))}else if(e.type==="LineString")for(const Zt of e.geometry){const ts=Ll(Zt,ut);qt(ts,new ce(ts[0].x,ts[0].y,0))}else if(e.type==="Point")for(const Zt of e.geometry)for(const ts of Zt)qt([ts],new ce(ts.x,ts.y,0))}function v_(r,e,s,l,d,g,y,w,N,A,R,I,B,$,W){const X=(function(be,ne,me,Ee,Ie,Je,pt,gt){const Tt=Ee.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,Lt=[];for(const kt of ne.positionedLines)for(const yt of kt.positionedGlyphs){if(!yt.rect)continue;const ut=yt.rect||{};let qt=4,Zt=!0,ts=1,Xt=0;const Ns=(Ie||gt)&&yt.vertical,Zr=yt.metrics.advance*yt.scale/2;if(gt&&ne.verticalizable&&(Xt=kt.lineOffset/2-(yt.imageName?-(xi-yt.metrics.width*yt.scale)/2:(yt.scale-1)*xi)),yt.imageName){const $i=pt[yt.imageName];Zt=$i.sdf,ts=$i.pixelRatio,qt=1/ts}const ki=Ie?[yt.x+Zr,yt.y]:[0,0];let ga=Ie?[0,0]:[yt.x+Zr+me[0],yt.y+me[1]-Xt],nl=[0,0];Ns&&(nl=ga,ga=[0,0]);const fn=yt.metrics.isDoubleResolution?2:1,ea=(yt.metrics.left-qt)*yt.scale-Zr+ga[0],ya=(-yt.metrics.top-qt)*yt.scale+ga[1],di=ea+ut.w/fn*yt.scale/ts,ta=ya+ut.h/fn*yt.scale/ts,Ba=new O(ea,ya),Fa=new O(di,ya),kn=new O(ea,ta),xa=new O(di,ta);if(Ns){const $i=new O(-Zr,Zr- -17),Jr=-Math.PI/2,Mi=12-Zr,ai=new O(22-Mi,-(yt.imageName?Mi:0)),Vi=new O(...nl);Ba._rotateAround(Jr,$i)._add(ai)._add(Vi),Fa._rotateAround(Jr,$i)._add(ai)._add(Vi),kn._rotateAround(Jr,$i)._add(ai)._add(Vi),xa._rotateAround(Jr,$i)._add(ai)._add(Vi)}if(Tt){const $i=Math.sin(Tt),Jr=Math.cos(Tt),Mi=[Jr,-$i,$i,Jr];Ba._matMult(Mi),Fa._matMult(Mi),kn._matMult(Mi),xa._matMult(Mi)}const Mn=new O(0,0),ol=new O(0,0);Lt.push({tl:Ba,tr:Fa,bl:kn,br:xa,tex:ut,writingMode:ne.writingMode,glyphOffset:ki,sectionIndex:yt.sectionIndex,isSDF:Zt,pixelOffsetTL:Mn,pixelOffsetBR:ol,minFontScaleX:0,minFontScaleY:0})}return Lt})(0,s,w,d,g,y,l,r.allowVerticalPlacement),te=r.textSizeData;let oe=null;te.kind==="source"?(oe=[Cn*d.layout.get("text-size").evaluate(y,{})],oe[0]>Mc&&us(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):te.kind==="composite"&&(oe=[Cn*$.compositeTextSizes[0].evaluate(y,{},W),Cn*$.compositeTextSizes[1].evaluate(y,{},W)],(oe[0]>Mc||oe[1]>Mc)&&us(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,X,oe,w,g,y,A,e,N.lineStartIndex,N.lineLength,B,W);for(const be of R)I[be]=r.text.placedSymbolArray.length-1;return 4*X.length}function b_(r){for(const e in r)return r[e];return null}function jv(r,e,s,l){const d=r.compareText;if(e in d){const g=d[e];for(let y=g.length-1;y>=0;y--)if(l.dist(g[y])<s)return!0}else d[e]=[];return d[e].push(l),!1}const w_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _x{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,l]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=l>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=w_[15&l];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new _x(w,y,g,e)}constructor(e,s=64,l=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=w_.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,N=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${l}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+N,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+N),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+N,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=s,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return vx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:w}=this,N=[0,g.length-1,0],A=[];for(;N.length;){const R=N.pop()||0,I=N.pop()||0,B=N.pop()||0;if(I-B<=w){for(let te=B;te<=I;te++){const oe=y[2*te],be=y[2*te+1];oe>=e&&oe<=l&&be>=s&&be<=d&&A.push(g[te])}continue}const $=B+I>>1,W=y[2*$],X=y[2*$+1];W>=e&&W<=l&&X>=s&&X<=d&&A.push(g[$]),(R===0?e<=W:s<=X)&&(N.push(B),N.push($-1),N.push(1-R)),(R===0?l>=W:d>=X)&&(N.push($+1),N.push(I),N.push(1-R))}return A}within(e,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:y}=this,w=[0,d.length-1,0],N=[],A=l*l;for(;w.length;){const R=w.pop()||0,I=w.pop()||0,B=w.pop()||0;if(I-B<=y){for(let te=B;te<=I;te++)j_(g[2*te],g[2*te+1],e,s)<=A&&N.push(d[te]);continue}const $=B+I>>1,W=g[2*$],X=g[2*$+1];j_(W,X,e,s)<=A&&N.push(d[$]),(R===0?e-l<=W:s-l<=X)&&(w.push(B),w.push($-1),w.push(1-R)),(R===0?e+l>=W:s+l>=X)&&(w.push($+1),w.push(I),w.push(1-R))}return N}}function vx(r,e,s,l,d,g){if(d-l<=s)return;const y=l+d>>1;S_(r,e,y,l,d,g),vx(r,e,s,l,y-1,1-g),vx(r,e,s,y+1,d,1-g)}function S_(r,e,s,l,d,g){for(;d>l;){if(d-l>600){const A=d-l+1,R=s-l+1,I=Math.log(A),B=.5*Math.exp(2*I/3),$=.5*Math.sqrt(I*B*(A-B)/A)*(R-A/2<0?-1:1);S_(r,e,s,Math.max(l,Math.floor(s-R*B/A+$)),Math.min(d,Math.floor(s+(A-R)*B/A+$)),g)}const y=e[2*s+g];let w=l,N=d;for(tg(r,e,l,s),e[2*d+g]>y&&tg(r,e,l,d);w<N;){for(tg(r,e,w,N),w++,N--;e[2*w+g]<y;)w++;for(;e[2*N+g]>y;)N--}e[2*l+g]===y?tg(r,e,l,N):(N++,tg(r,e,N,d)),N<=s&&(l=N+1),s<=N&&(d=N-1)}}function tg(r,e,s,l){bx(r,s,l),bx(e,2*s,2*l),bx(e,2*s+1,2*l+1)}function bx(r,e,s){const l=r[e];r[e]=r[s],r[s]=l}function j_(r,e,s,l){const d=r-s,g=e-l;return d*d+g*g}var wx;T.cI=void 0,(wx=T.cI||(T.cI={})).create="create",wx.load="load",wx.fullLoad="fullLoad";let My=null,sg=[];const Sx=1e3/60,jx="loadTime",Tx="fullLoadTime",Tv={mark(r){performance.mark(r)},recordStartOfFrameAt(r){My!=null&&sg.push(r-My),My=r},resetRuntimeMetrics(){My=null,sg=[]},clearInitializationMetrics(){performance.clearMeasures(jx),performance.clearMeasures(Tx);for(const r in T.cI)performance.clearMarks(T.cI[r])},remove(){this.resetRuntimeMetrics(),this.clearInitializationMetrics()},getPerformanceMetrics(){performance.measure(jx,T.cI.create,T.cI.load),performance.measure(Tx,T.cI.create,T.cI.fullLoad);const r=performance.getEntriesByName(jx)[0].duration,e=performance.getEntriesByName(Tx)[0].duration,s=sg.length;return{loadTimeMs:r,fullLoadTimeMs:e,averageFramesPerSecond:1/(sg.reduce(((l,d)=>l+d),0)/s/1e3),virtualDroppedFramesCount:sg.filter((l=>l>Sx)).reduce(((l,d)=>l+(d-Sx)/Sx),0),totalFramesCount:s}}};T.$=G,T.A=Ne,T.B=_n,T.C=yi,T.D=$t,T.E=rt,T.F=function([r,e,s]){return e+=90,e*=Math.PI/180,s*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(s),y:r*Math.sin(e)*Math.sin(s),z:r*Math.cos(s)}},T.G=kr,T.H=sr,T.I=mr,T.J=gd,T.K=function(r){if(Os==null){const e=r.navigator?r.navigator.userAgent:null;Os=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Os},T.L=class{constructor(r,e){this.target=r,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yp((()=>this.process())),this.subscription=Ha(this.target,"message",(s=>this.receive(s)),!1),this.globalScope=Is(self)?r:window}registerMessageHandler(r,e){this.messageHandlers[r]=e}unregisterMessageHandler(r){delete this.messageHandlers[r]}sendAsync(r,e){return new Promise(((s,l)=>{const d=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=e?Ha(e.signal,"abort",(()=>{g?.unsubscribe(),delete this.resolveRejects[d];const N={id:d,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(N)}),zm):null;this.resolveRejects[d]={resolve:N=>{g?.unsubscribe(),s(N)},reject:N=>{g?.unsubscribe(),l(N)}};const y=[],w=Object.assign(Object.assign({},r),{id:d,sourceMapId:this.mapId,origin:location.origin,data:vn(r.data,y)});this.target.postMessage(w,{transfer:y})}))}receive(r){const e=r.data,s=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[s];const l=this.abortControllers[s];return delete this.abortControllers[s],void(l&&l.abort())}if(Is(self)||e.mustQueue)return this.tasks[s]=e,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,e)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){return c(this,void 0,void 0,(function*(){if(e.type==="<response>"){const d=this.resolveRejects[r];return delete this.resolveRejects[r],d?void(e.error?d.reject(bc(e.error)):d.resolve(bc(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=bc(e.data),l=new AbortController;this.abortControllers[r]=l;try{const d=yield this.messageHandlers[e.type](e.sourceMapId,s,l);this.completeTask(r,null,d)}catch(d){this.completeTask(r,d)}}))}completeTask(r,e,s){const l=[];delete this.abortControllers[r];const d={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?vn(e):null,data:vn(s,l)};this.target.postMessage(d,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.M=K,T.N=function(){var r=new Ne(16);return Ne!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},T.O=function(r,e,s){var l,d,g,y,w,N,A,R,I,B,$,W,X=s[0],te=s[1],oe=s[2];return e===r?(r[12]=e[0]*X+e[4]*te+e[8]*oe+e[12],r[13]=e[1]*X+e[5]*te+e[9]*oe+e[13],r[14]=e[2]*X+e[6]*te+e[10]*oe+e[14],r[15]=e[3]*X+e[7]*te+e[11]*oe+e[15]):(d=e[1],g=e[2],y=e[3],w=e[4],N=e[5],A=e[6],R=e[7],I=e[8],B=e[9],$=e[10],W=e[11],r[0]=l=e[0],r[1]=d,r[2]=g,r[3]=y,r[4]=w,r[5]=N,r[6]=A,r[7]=R,r[8]=I,r[9]=B,r[10]=$,r[11]=W,r[12]=l*X+w*te+I*oe+e[12],r[13]=d*X+N*te+B*oe+e[13],r[14]=g*X+A*te+$*oe+e[14],r[15]=y*X+R*te+W*oe+e[15]),r},T.P=O,T.Q=function(r,e,s){var l=s[0],d=s[1],g=s[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*g,r[9]=e[9]*g,r[10]=e[10]*g,r[11]=e[11]*g,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},T.R=ha,T.S=function(r,e,s){var l=e[0],d=e[1],g=e[2],y=e[3],w=e[4],N=e[5],A=e[6],R=e[7],I=e[8],B=e[9],$=e[10],W=e[11],X=e[12],te=e[13],oe=e[14],be=e[15],ne=s[0],me=s[1],Ee=s[2],Ie=s[3];return r[0]=ne*l+me*w+Ee*I+Ie*X,r[1]=ne*d+me*N+Ee*B+Ie*te,r[2]=ne*g+me*A+Ee*$+Ie*oe,r[3]=ne*y+me*R+Ee*W+Ie*be,r[4]=(ne=s[4])*l+(me=s[5])*w+(Ee=s[6])*I+(Ie=s[7])*X,r[5]=ne*d+me*N+Ee*B+Ie*te,r[6]=ne*g+me*A+Ee*$+Ie*oe,r[7]=ne*y+me*R+Ee*W+Ie*be,r[8]=(ne=s[8])*l+(me=s[9])*w+(Ee=s[10])*I+(Ie=s[11])*X,r[9]=ne*d+me*N+Ee*B+Ie*te,r[10]=ne*g+me*A+Ee*$+Ie*oe,r[11]=ne*y+me*R+Ee*W+Ie*be,r[12]=(ne=s[12])*l+(me=s[13])*w+(Ee=s[14])*I+(Ie=s[15])*X,r[13]=ne*d+me*N+Ee*B+Ie*te,r[14]=ne*g+me*A+Ee*$+Ie*oe,r[15]=ne*y+me*R+Ee*W+Ie*be,r},T.T=Wf,T.U=function(r,e){const s={};for(let l=0;l<e.length;l++){const d=e[l];d in r&&(s[d]=r[d])}return s},T.V=sl,T.W=mt,T.X=Om,T.Y=cy,T.Z=Ls,T._=c,T.a=Fs,T.a$=Ye,T.a0=pe,T.a1=wt,T.a2=za,T.a3=dy,T.a4=Fh,T.a5=Ze,T.a6=function(r,e,s){if(!r)return e||{};if(!e)return r||{};const l=$h(r),d=$h(e);(function(y,w){w.removeAll&&(y.add.clear(),y.update.clear(),y.remove.clear(),w.remove.clear());for(const N of w.remove)y.add.delete(N),y.update.delete(N);for(const[N,A]of w.update){const R=y.update.get(N);R&&(w.update.set(N,Bm(R,A)),y.update.delete(N))}})(l,d);const g={};if((l.removeAll||d.removeAll)&&(g.removeAll=!0),g.remove=new Set([...l.remove,...d.remove]),g.add=new Map([...l.add,...d.add]),g.update=new Map([...l.update,...d.update]),g.remove.size&&g.add.size)for(const y of g.add.keys())g.remove.delete(y);return(function(y){const w={};return y.removeAll&&(w.removeAll=y.removeAll),y.remove&&(w.remove=Array.from(y.remove)),y.add&&(w.add=Array.from(y.add.values())),y.update&&(w.update=Array.from(y.update.values())),w})(g)},T.a7=function(r,e){const s=new Map;if(r==null||r.type==null)return s;if(r.type==="Feature"){const l=Uh(r,e);return l==null?void 0:(s.set(l,r),s)}if(r.type==="FeatureCollection"){const l=new Set;for(const d of r.features){const g=Uh(d,e);if(g==null||l.has(g))return;l.add(g),s.set(g,d)}return s}},T.a8=function(r,e,s){var l,d;const g=[];if(e.removeAll)r.clear();else if(e.remove)for(const y of e.remove){const w=r.get(y);w&&(g.push(w.geometry),r.delete(y))}if(e.add)for(const y of e.add){const w=Uh(y,s);if(w==null)continue;const N=r.get(w);N&&g.push(N.geometry),g.push(y.geometry),r.set(w,y)}if(e.update)for(const y of e.update){const w=r.get(y.id);if(!w)continue;const N=!!y.newGeometry,A=y.removeAllProperties||((l=y.removeProperties)===null||l===void 0?void 0:l.length)>0||((d=y.addOrUpdateProperties)===null||d===void 0?void 0:d.length)>0;if(!N&&!A)continue;g.push(w.geometry);const R=Object.assign({},w);if(r.set(y.id,R),N&&(g.push(y.newGeometry),R.geometry=y.newGeometry),A){if(R.properties=y.removeAllProperties?{}:Object.assign({},R.properties||{}),y.removeProperties)for(const I of y.removeProperties)delete R.properties[I];if(y.addOrUpdateProperties)for(const{key:I,value:B}of y.addOrUpdateProperties)R.properties[I]=B}}return g},T.a9=lr,T.aA=function(r,{uSize:e,uSizeT:s},{lowerSize:l,upperSize:d}){return r.kind==="source"?l/Cn:r.kind==="composite"?kr.number(l/Cn,d/Cn,s):e},T.aB=function(r,e){var s=e[0],l=e[1],d=e[2],g=e[3],y=e[4],w=e[5],N=e[6],A=e[7],R=e[8],I=e[9],B=e[10],$=e[11],W=e[12],X=e[13],te=e[14],oe=e[15],be=s*w-l*y,ne=s*N-d*y,me=s*A-g*y,Ee=l*N-d*w,Ie=l*A-g*w,Je=d*A-g*N,pt=R*X-I*W,gt=R*te-B*W,Tt=R*oe-$*W,Lt=I*te-B*X,kt=I*oe-$*X,yt=B*oe-$*te,ut=be*yt-ne*kt+me*Lt+Ee*Tt-Ie*gt+Je*pt;return ut?(r[0]=(w*yt-N*kt+A*Lt)*(ut=1/ut),r[1]=(d*kt-l*yt-g*Lt)*ut,r[2]=(X*Je-te*Ie+oe*Ee)*ut,r[3]=(B*Ie-I*Je-$*Ee)*ut,r[4]=(N*Tt-y*yt-A*gt)*ut,r[5]=(s*yt-d*Tt+g*gt)*ut,r[6]=(te*me-W*Je-oe*ne)*ut,r[7]=(R*Je-B*me+$*ne)*ut,r[8]=(y*kt-w*Tt+A*pt)*ut,r[9]=(l*Tt-s*kt-g*pt)*ut,r[10]=(W*Ie-X*me+oe*be)*ut,r[11]=(I*me-R*Ie-$*be)*ut,r[12]=(w*gt-y*Lt-N*pt)*ut,r[13]=(s*Lt-l*gt+d*pt)*ut,r[14]=(X*ne-W*Ee-te*be)*ut,r[15]=(R*Ee-I*ne+B*be)*ut,r):null},T.aC=We,T.aD=function(r){var e=r[0],s=r[1];return Math.sqrt(e*e+s*s)},T.aE=function(r){return r[0]=0,r[1]=0,r},T.aF=function(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r},T.aG=Pm,T.aH=ht,T.aI=function(r,e,s,l){const d=e.y-r.y,g=e.x-r.x,y=l.y-s.y,w=l.x-s.x,N=y*g-w*d;if(N===0)return null;const A=(w*(r.y-s.y)-y*(r.x-s.x))/N;return new O(r.x+A*g,r.y+A*d)},T.aJ=o,T.aK=ku,T.aL=function(r){let e=1/0,s=1/0,l=-1/0,d=-1/0;for(const g of r)e=Math.min(e,g.x),s=Math.min(s,g.y),l=Math.max(l,g.x),d=Math.max(d,g.y);return[e,s,l,d]},T.aM=xi,T.aN=Pe,T.aO=function(r,e,s,l,d=!1){if(!s[0]&&!s[1])return[0,0];const g=d?l==="map"?-r.bearingInRadians:0:l==="viewport"?r.bearingInRadians:0;if(g){const y=Math.sin(g),w=Math.cos(g);s=[s[0]*w-s[1]*y,s[0]*y+s[1]*w]}return[d?s[0]:Pe(e,s[0],r.zoom),d?s[1]:Pe(e,s[1],r.zoom)]},T.aQ=hp,T.aR=xx,T.aS=Cm,T.aT=_x,T.aU=Mr,T.aV=kh,T.aW=fe,T.aX=Bt,T.aY=tt,T.aZ=oi,T.a_=Lm,T.aa=Dc,T.ab=25,T.ac=zi,T.ad=r=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((s=>{e.onloadstart=()=>{s(e)};for(const l of r){const d=window.document.createElement("source");Ve(l)||(e.crossOrigin="Anonymous"),d.src=l,e.appendChild(d)}}))},T.ae=Nt,T.af=function(){return ys++},T.ag=p,T.ah=Ld,T.ai=Bc,T.aj=na,T.ak=Nn,T.al=vp,T.am=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((s,l,d,g)=>{const y=d||g;return e[l]=!y||y.toLowerCase(),""})),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e},T.an=Mt,T.ao=85.051129,T.ap=Ms,T.aq=function(r){return Math.pow(2,r)},T.ar=Be,T.as=uy,T.at=function(r){return Math.log(r)/Math.LN2},T.au=function(r){var e=r[0],s=r[1];return e*e+s*s},T.av=function(r){if(!r.length)return new Set;const e=Math.max(...r.map((N=>N.canonical.z)));let s=1/0,l=-1/0,d=1/0,g=-1/0;const y=[];for(const N of r){const{x:A,y:R,z:I}=N.canonical,B=Math.pow(2,e-I),$=A*B,W=R*B;y.push({id:N,x:$,y:W}),$<s&&(s=$),$>l&&(l=$),W<d&&(d=W),W>g&&(g=W)}const w=new Set;for(const N of y)N.x!==s&&N.x!==l&&N.y!==d&&N.y!==g||w.add(N.id);return w},T.aw=function(r,e){const s=Math.abs(2*r.wrap)-+(r.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||l-s||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x},T.ax=class{constructor(r,e){this.max=r,this.onRemove=e,this.reset()}reset(){for(const r in this.data)for(const e of this.data[r])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(r,e,s){const l=r.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:e,timeout:void 0};if(s!==void 0&&(d.timeout=setTimeout((()=>{this.remove(r,d)}),s)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const e=this.data[r].shift();return e.timeout&&clearTimeout(e.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),e.value}getByKey(r){const e=this.data[r];return e?e[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,e){if(!this.has(r))return this;const s=r.wrapped().key,l=e===void 0?0:this.data[s].indexOf(e),d=this.data[s][l];return this.data[s].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(r){const e=[];for(const s in this.data)for(const l of this.data[s])r(l.value)||e.push(l);for(const s of e)this.remove(s.value.tileID,s)}},T.ay=function(r,e){let s=0,l=0;if(r.kind==="constant")l=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:d,minZoom:g,maxZoom:y}=r,w=d?Mt(Xi.interpolationFactor(d,e,g,y),0,1):0;r.kind==="camera"?l=kr.number(r.minSize,r.maxSize,w):s=w}return{uSizeT:s,uSize:l}},T.b=ar,T.b$=Tn,T.b0=Ae,T.b1=function(r){var e=new Ne(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},T.b2=function(r,e,s){return r[0]=e[0]-s[0],r[1]=e[1]-s[1],r[2]=e[2]-s[2],r},T.b3=function(r,e){var s=e[0],l=e[1],d=e[2],g=s*s+l*l+d*d;return g>0&&(g=1/Math.sqrt(g)),r[0]=e[0]*g,r[1]=e[1]*g,r[2]=e[2]*g,r},T.b4=_t,T.b5=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},T.b6=function(r,e,s){return r[0]=e[0]*s[0],r[1]=e[1]*s[1],r[2]=e[2]*s[2],r[3]=e[3]*s[3],r},T.b7=$e,T.b8=function(r,e,s){const l=e[0]*s[0]+e[1]*s[1]+e[2]*s[2];return l===0?null:(-(r[0]*s[0]+r[1]*s[1]+r[2]*s[2])-s[3])/l},T.b9=zt,T.bA=function(){return new Float64Array(3)},T.bB=Ce,T.bC=function(r,e,s){var l=s[0],d=s[1],g=s[2],y=s[3],w=e[0],N=e[1],A=e[2],R=d*A-g*N,I=g*w-l*A,B=l*N-d*w;return r[0]=w+y*(R+=R)+d*(B+=B)-g*(I+=I),r[1]=N+y*I+g*R-l*B,r[2]=A+y*B+l*I-d*R,r},T.bD=function(r,e,s){const l=(d=[r[0],r[1],r[2],e[0],e[1],e[2],s[0],s[1],s[2]])[0]*((R=d[8])*(y=d[4])-(w=d[5])*(A=d[7]))+d[1]*(-R*(g=d[3])+w*(N=d[6]))+d[2]*(A*g-y*N);var d,g,y,w,N,A,R;if(l===0)return null;const I=_t([],[e[0],e[1],e[2]],[s[0],s[1],s[2]]),B=_t([],[s[0],s[1],s[2]],[r[0],r[1],r[2]]),$=_t([],[r[0],r[1],r[2]],[e[0],e[1],e[2]]),W=Ye([],I,-r[3]);return Ae(W,W,Ye([],B,-e[3])),Ae(W,W,Ye([],$,-s[3])),Ye(W,W,1/l),W},T.bE=xp,T.bF=function(){return new Float64Array(4)},T.bG=function(r,e,s,l){var d=[],g=[];return d[0]=e[0]-s[0],d[1]=e[1]-s[1],d[2]=e[2]-s[2],g[0]=d[0]*Math.cos(l)-d[1]*Math.sin(l),g[1]=d[0]*Math.sin(l)+d[1]*Math.cos(l),g[2]=d[2],r[0]=g[0]+s[0],r[1]=g[1]+s[1],r[2]=g[2]+s[2],r},T.bH=function(r,e,s,l){var d=[],g=[];return d[0]=e[0]-s[0],d[1]=e[1]-s[1],d[2]=e[2]-s[2],g[0]=d[0],g[1]=d[1]*Math.cos(l)-d[2]*Math.sin(l),g[2]=d[1]*Math.sin(l)+d[2]*Math.cos(l),r[0]=g[0]+s[0],r[1]=g[1]+s[1],r[2]=g[2]+s[2],r},T.bI=function(r,e,s,l){var d=[],g=[];return d[0]=e[0]-s[0],d[1]=e[1]-s[1],d[2]=e[2]-s[2],g[0]=d[2]*Math.sin(l)+d[0]*Math.cos(l),g[1]=d[1],g[2]=d[2]*Math.cos(l)-d[0]*Math.sin(l),r[0]=g[0]+s[0],r[1]=g[1]+s[1],r[2]=g[2]+s[2],r},T.bJ=function(r,e,s){var l=Math.sin(s),d=Math.cos(s),g=e[0],y=e[1],w=e[2],N=e[3],A=e[8],R=e[9],I=e[10],B=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=g*d-A*l,r[1]=y*d-R*l,r[2]=w*d-I*l,r[3]=N*d-B*l,r[8]=g*l+A*d,r[9]=y*l+R*d,r[10]=w*l+I*d,r[11]=N*l+B*d,r},T.bK=function(r,e){const s=le(r,360),l=le(e,360),d=l-s,g=l>s?d-360:d+360;return Math.abs(d)<Math.abs(g)?d:g},T.bL=function(r){return r[0]=0,r[1]=0,r[2]=0,r},T.bM=function(r,e,s,l){const d=Math.sqrt(r*r+e*e),g=Math.sqrt(s*s+l*l);r/=d,e/=d,s/=g,l/=g;const y=Math.acos(r*s+e*l);return-e*s+r*l>0?y:-y},T.bN=function(r,e){const s=le(r,2*Math.PI),l=le(e,2*Math.PI);return Math.min(Math.abs(s-l),Math.abs(s-l+2*Math.PI),Math.abs(s-l-2*Math.PI))},T.bO=function(){const r={},e=Te.$version;for(const s in Te.$root){const l=Te.$root[s];if(l.required){let d=null;d=s==="version"?e:l.type==="array"?[]:{},d!=null&&(r[s]=d)}}return r},T.bP=he,T.bQ=_d,T.bR=function r(e,s){if(Array.isArray(e)){if(!Array.isArray(s)||e.length!==s.length)return!1;for(let l=0;l<e.length;l++)if(!r(e[l],s[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&s!==null){if(typeof s!="object"||Object.keys(e).length!==Object.keys(s).length)return!1;for(const l in e)if(!r(e[l],s[l]))return!1;return!0}return e===s},T.bS=function(r){r=r.slice();const e=Object.create(null);for(let s=0;s<r.length;s++)e[r[s].id]=r[s];for(let s=0;s<r.length;s++)"ref"in r[s]&&(r[s]=as(r[s],e[r[s].ref]));return r},T.bT=function(r,e){if(r.type==="custom")return new Im(r,e);switch(r.type){case"background":return new Vs(r,e);case"circle":return new Gf(r,e);case"color-relief":return new Og(r,e);case"fill":return new $g(r,e);case"fill-extrusion":return new bm(r,e);case"heatmap":return new Ig(r,e);case"hillshade":return new Hr(r,e);case"line":return new Sm(r,e);case"raster":return new xo(r,e);case"symbol":return new Pc(r,e)}},T.bU=r=>r.type==="raster",T.bV=Es,T.bW=function(r,e){if(!r)return[{command:"setStyle",args:[e]}];let s=[];try{if(!Kt(r.version,e.version))return[{command:"setStyle",args:[e]}];Kt(r.center,e.center)||s.push({command:"setCenter",args:[e.center]}),Kt(r.state,e.state)||s.push({command:"setGlobalState",args:[e.state]}),Kt(r.centerAltitude,e.centerAltitude)||s.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Kt(r.zoom,e.zoom)||s.push({command:"setZoom",args:[e.zoom]}),Kt(r.bearing,e.bearing)||s.push({command:"setBearing",args:[e.bearing]}),Kt(r.pitch,e.pitch)||s.push({command:"setPitch",args:[e.pitch]}),Kt(r.roll,e.roll)||s.push({command:"setRoll",args:[e.roll]}),Kt(r.sprite,e.sprite)||s.push({command:"setSprite",args:[e.sprite]}),Kt(r.glyphs,e.glyphs)||s.push({command:"setGlyphs",args:[e.glyphs]}),Kt(r.transition,e.transition)||s.push({command:"setTransition",args:[e.transition]}),Kt(r.light,e.light)||s.push({command:"setLight",args:[e.light]}),Kt(r.terrain,e.terrain)||s.push({command:"setTerrain",args:[e.terrain]}),Kt(r.sky,e.sky)||s.push({command:"setSky",args:[e.sky]}),Kt(r.projection,e.projection)||s.push({command:"setProjection",args:[e.projection]});const l={},d=[];(function(y,w,N,A){let R;for(R in w=w||{},y=y||{})Object.prototype.hasOwnProperty.call(y,R)&&(Object.prototype.hasOwnProperty.call(w,R)||ls(R,N,A));for(R in w)Object.prototype.hasOwnProperty.call(w,R)&&(Object.prototype.hasOwnProperty.call(y,R)?Kt(y[R],w[R])||(y[R].type==="geojson"&&w[R].type==="geojson"&&Sr(y,w,R)?ss(N,{command:"setGeoJSONSourceData",args:[R,w[R].data]}):xr(R,w,N,A)):Qt(R,w,N))})(r.sources,e.sources,d,l);const g=[];r.layers&&r.layers.forEach((y=>{"source"in y&&l[y.source]?s.push({command:"removeLayer",args:[y.id]}):g.push(y)})),s=s.concat(d),(function(y,w,N){w=w||[];const A=(y=y||[]).map(vr),R=w.map(vr),I=y.reduce(Rs,{}),B=w.reduce(Rs,{}),$=A.slice(),W=Object.create(null);let X,te,oe,be,ne;for(let me=0,Ee=0;me<A.length;me++)X=A[me],Object.prototype.hasOwnProperty.call(B,X)?Ee++:(ss(N,{command:"removeLayer",args:[X]}),$.splice($.indexOf(X,Ee),1));for(let me=0,Ee=0;me<R.length;me++)X=R[R.length-1-me],$[$.length-1-me]!==X&&(Object.prototype.hasOwnProperty.call(I,X)?(ss(N,{command:"removeLayer",args:[X]}),$.splice($.lastIndexOf(X,$.length-Ee),1)):Ee++,be=$[$.length-me],ss(N,{command:"addLayer",args:[B[X],be]}),$.splice($.length-me,0,X),W[X]=!0);for(let me=0;me<R.length;me++)if(X=R[me],te=I[X],oe=B[X],!W[X]&&!Kt(te,oe))if(Kt(te.source,oe.source)&&Kt(te["source-layer"],oe["source-layer"])&&Kt(te.type,oe.type)){for(ne in Gs(te.layout,oe.layout,N,X,null,"setLayoutProperty"),Gs(te.paint,oe.paint,N,X,null,"setPaintProperty"),Kt(te.filter,oe.filter)||ss(N,{command:"setFilter",args:[X,oe.filter]}),Kt(te.minzoom,oe.minzoom)&&Kt(te.maxzoom,oe.maxzoom)||ss(N,{command:"setLayerZoomRange",args:[X,oe.minzoom,oe.maxzoom]}),te)Object.prototype.hasOwnProperty.call(te,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?Gs(te[ne],oe[ne],N,X,ne.slice(6),"setPaintProperty"):Kt(te[ne],oe[ne])||ss(N,{command:"setLayerProperty",args:[X,ne,oe[ne]]}));for(ne in oe)Object.prototype.hasOwnProperty.call(oe,ne)&&!Object.prototype.hasOwnProperty.call(te,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?Gs(te[ne],oe[ne],N,X,ne.slice(6),"setPaintProperty"):Kt(te[ne],oe[ne])||ss(N,{command:"setLayerProperty",args:[X,ne,oe[ne]]}))}else ss(N,{command:"removeLayer",args:[X]}),be=$[$.lastIndexOf(X)+1],ss(N,{command:"addLayer",args:[oe,be]})})(g,e.layers,s)}catch(l){console.warn("Unable to compute style diff:",l),s=[{command:"setStyle",args:[e]}]}return s},T.bX=function(r){const e=[],s=r.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},T.bY=js,T.bZ=ks,T.b_=class extends ua{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},T.ba=function(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r},T.bb=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]},T.bc=hy,T.bd=Fd,T.be=function(r,e,s,l,d){var g=1/Math.tan(e/2);if(r[0]=g/s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0){var y=1/(l-d);r[10]=(d+l)*y,r[14]=2*d*l*y}else r[10]=-1,r[14]=-2*l;return r},T.bf=function(r){var e=new Ne(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},T.bg=function(r,e,s){var l=Math.sin(s),d=Math.cos(s),g=e[0],y=e[1],w=e[2],N=e[3],A=e[4],R=e[5],I=e[6],B=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=g*d+A*l,r[1]=y*d+R*l,r[2]=w*d+I*l,r[3]=N*d+B*l,r[4]=A*d-g*l,r[5]=R*d-y*l,r[6]=I*d-w*l,r[7]=B*d-N*l,r},T.bh=function(r,e,s){var l=Math.sin(s),d=Math.cos(s),g=e[4],y=e[5],w=e[6],N=e[7],A=e[8],R=e[9],I=e[10],B=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=g*d+A*l,r[5]=y*d+R*l,r[6]=w*d+I*l,r[7]=N*d+B*l,r[8]=A*d-g*l,r[9]=R*d-y*l,r[10]=I*d-w*l,r[11]=B*d-N*l,r},T.bi=function(){const r=new Float32Array(16);return Be(r),r},T.bj=function(){const r=new Float64Array(16);return Be(r),r},T.bk=function(){return new Float64Array(16)},T.bl=function(r,e,s){const l=new Float64Array(4);return Ce(l,r,e-90,s),l},T.bm=function(r,e,s,l){var d,g,y,w,N,A=e[0],R=e[1],I=e[2],B=e[3],$=s[0],W=s[1],X=s[2],te=s[3];return(g=A*$+R*W+I*X+B*te)<0&&(g=-g,$=-$,W=-W,X=-X,te=-te),1-g>_e?(d=Math.acos(g),y=Math.sin(d),w=Math.sin((1-l)*d)/y,N=Math.sin(l*d)/y):(w=1-l,N=l),r[0]=w*A+N*$,r[1]=w*R+N*W,r[2]=w*I+N*X,r[3]=w*B+N*te,r},T.bn=function(r){const e=new Float64Array(9);var s,l,d,g,y,w,N,A,R,I,B,$,W,X,te,oe,be,ne;I=(d=(l=r)[0])*(N=d+d),B=(g=l[1])*N,W=(y=l[2])*N,X=y*(A=g+g),oe=(w=l[3])*N,be=w*A,ne=w*(R=y+y),(s=e)[0]=1-($=g*A)-(te=y*R),s[3]=B-ne,s[6]=W+be,s[1]=B+ne,s[4]=1-I-te,s[7]=X-oe,s[2]=W-be,s[5]=X+oe,s[8]=1-I-$;const me=oi(-Math.asin(Mt(e[2],-1,1)));let Ee,Ie;return Math.hypot(e[5],e[8])<.001?(Ee=0,Ie=-oi(Math.atan2(e[3],e[4]))):(Ee=oi(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),Ie=oi(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:Ee,pitch:me+90,bearing:Ie}},T.bo=function(r,e){return r.roll==e.roll&&r.pitch==e.pitch&&r.bearing==e.bearing},T.bp=_s,T.bq=Dl,T.br=cn,T.bs=So,T.bt=Ii,T.bu=Le,T.bv=nt,T.bw=mi,T.bx=function(r,e,s,l,d){return Le(l,d,Mt((r-e)/(s-e),0,1))},T.by=function(r,e,s,l){return r[0]=e[0]+s[0]*l,r[1]=e[1]+s[1]*l,r[2]=e[2]+s[2]*l,r},T.bz=le,T.c=Fe,T.c$=class{constructor(r){this.start=`${r}#start`,this.end=`${r}#end`,this.measure=r,performance.mark(this.start)}finish(){performance.mark(this.end);let r=performance.getEntriesByName(this.measure);return r.length===0&&(performance.measure(this.measure,this.start,this.end),r=performance.getEntriesByName(this.measure),performance.clearMarks(this.start),performance.clearMarks(this.end),performance.clearMeasures(this.measure)),r}},T.c0=class extends ua{constructor(r,e){super(r,e),this.current=da}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},T.c1=Nc,T.c2=class extends ua{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},T.c3=class extends ua{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},T.c4=Oe,T.c5=function(r,e){var s=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=s,r[2]=0,r[3]=-s,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},T.c6=function(r,e,s){var l=e[0],d=e[1],g=e[2];return r[0]=l*s[0]+d*s[3]+g*s[6],r[1]=l*s[1]+d*s[4]+g*s[7],r[2]=l*s[2]+d*s[5]+g*s[8],r},T.c7=function(r,e,s,l,d,g,y){var w=1/(e-s),N=1/(l-d),A=1/(g-y);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*N,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*A,r[11]=0,r[12]=(e+s)*w,r[13]=(d+l)*N,r[14]=(y+g)*A,r[15]=1,r},T.c8=class extends ua{constructor(r,e){super(r,e),this.current=new Array}set(r){if(r!=this.current){this.current=r;const e=new Float32Array(4*r.length);for(let s=0;s<r.length;s++)e[4*s]=r[s].r,e[4*s+1]=r[s].g,e[4*s+2]=r[s].b,e[4*s+3]=r[s].a;this.gl.uniform4fv(this.location,e)}}},T.c9=class extends ua{constructor(r,e){super(r,e),this.current=new Array}set(r){if(r!=this.current){this.current=r;const e=new Float32Array(r);this.gl.uniform1fv(this.location,e)}}},T.cA=function(r,e){var s;if(!Oi[e])return!1;const l=r?.target,d=((s=l?.ownerDocument)===null||s===void 0?void 0:s.defaultView)||window;return r instanceof d.MouseEvent||r instanceof d.WheelEvent},T.cB=function(r,e){return Fr[e]&&"touches"in r},T.cC=function(r){return Fr[r]||Oi[r]},T.cD=function(r,e,s){var l=e[0],d=e[1];return r[0]=s[0]*l+s[4]*d+s[12],r[1]=s[1]*l+s[5]*d+s[13],r},T.cE=function(r,e){const{x:s,y:l}=lr.fromLngLat(e);return!(r<0||r>25||l<0||l>=1||s<0||s>=1)},T.cF=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},T.cG=class extends Al{},T.cH=Tv,T.cJ=U,T.cK=function(r,e){Fe.REGISTERED_PROTOCOLS[r]=e},T.cL=function(r){delete Fe.REGISTERED_PROTOCOLS[r]},T.cM=function(r,e){const s={};for(let d=0;d<r.length;d++){const g=e&&e[r[d].id]||uo(r[d]);e&&(e[r[d].id]=g);let y=s[g];y||(y=s[g]=[]),y.push(r[d])}const l=[];for(const d in s)l.push(s[d]);return l},T.cN=Ut,T.cO=Fm,T.cP=Ay,T.cQ=cp,T.cR=function(r){var e;r.bucket.createArrays(),r.bucket.tilePixelRatio=Ze/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const s=r.bucket.layers[0],l=s.layout,d=s._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new sr(r.bucket.zoom+1),r.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new sr(r.bucket.zoom+1),r.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new sr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:R,maxZoom:I}=r.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new sr(R),r.canonical),d["text-size"].possiblyEvaluate(new sr(I),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:R,maxZoom:I}=r.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new sr(R),r.canonical),d["icon-size"].possiblyEvaluate(new sr(I),r.canonical)]}const y=l.get("text-line-height")*xi,w=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",N=l.get("text-keep-upright"),A=l.get("text-size");for(const R of r.bucket.features){const I=l.get("text-font").evaluate(R,{},r.canonical).join(","),B=A.evaluate(R,{},r.canonical),$=g.layoutTextSize.evaluate(R,{},r.canonical),W=g.layoutIconSize.evaluate(R,{},r.canonical),X={horizontal:{},vertical:void 0},te=R.text;let oe,be=[0,0];if(te){const Ee=te.toString(),Ie=l.get("text-letter-spacing").evaluate(R,{},r.canonical)*xi,Je=vd(Ee)?Ie:0,pt=l.get("text-anchor").evaluate(R,{},r.canonical),gt=ky(s,R,r.canonical);if(!gt){const yt=l.get("text-radial-offset").evaluate(R,{},r.canonical);be=yt?Yl(pt,[yt*xi,tr]):l.get("text-offset").evaluate(R,{},r.canonical).map((ut=>ut*xi))}let Tt=w?"center":l.get("text-justify").evaluate(R,{},r.canonical);const Lt=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(R,{},r.canonical)*xi:1/0,kt=()=>{r.bucket.allowVerticalPlacement&&Wn(Ee)&&(X.vertical=Oh(te,r.glyphMap,r.glyphPositions,r.imagePositions,I,Lt,y,pt,"left",Je,be,T.az.vertical,!0,$,B))};if(!w&&gt){const yt=new Set;if(Tt==="auto")for(let qt=0;qt<gt.values.length;qt+=2)yt.add(xx(gt.values[qt]));else yt.add(Tt);let ut=!1;for(const qt of yt)if(!X.horizontal[qt])if(ut)X.horizontal[qt]=X.horizontal[0];else{const Zt=Oh(te,r.glyphMap,r.glyphPositions,r.imagePositions,I,Lt,y,"center",qt,Je,be,T.az.horizontal,!1,$,B);Zt&&(X.horizontal[qt]=Zt,ut=Zt.positionedLines.length===1)}kt()}else{Tt==="auto"&&(Tt=xx(pt));const yt=Oh(te,r.glyphMap,r.glyphPositions,r.imagePositions,I,Lt,y,pt,Tt,Je,be,T.az.horizontal,!1,$,B);yt&&(X.horizontal[Tt]=yt),kt(),Wn(Ee)&&w&&N&&(X.vertical=Oh(te,r.glyphMap,r.glyphPositions,r.imagePositions,I,Lt,y,pt,Tt,Je,be,T.az.vertical,!1,$,B))}}let ne=!1;if(R.icon&&R.icon.name){const Ee=r.imageMap[R.icon.name];Ee&&(oe=km(r.imagePositions[R.icon.name],l.get("icon-offset").evaluate(R,{},r.canonical),l.get("icon-anchor").evaluate(R,{},r.canonical)),ne=!!Ee.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ne:r.bucket.sdfIcons!==ne&&us("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ee.pixelRatio!==r.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const me=b_(X.horizontal)||X.vertical;(e=r.bucket).iconsInText||(e.iconsInText=!!me&&me.iconsInText),(me||oe)&&Sv(r.bucket,R,X,oe,r.imageMap,g,$,W,be,ne,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},T.cS=Pu,T.cT=Cc,T.cU=Md,T.cV=function(r){const e=new np;return(function(s,l){for(const d in s.layers)l.writeMessage(3,Ip,s.layers[d])})(r,e),e.finish()},T.cW=function(r,e,s,l,d,g){let y=f(r,e,s,d,0);return y=f(y,e,l,g,1),y},T.cX=class{constructor(r){this.maxEntries=r,this.map=new Map}get(r){const e=this.map.get(r);return e!==void 0&&(this.map.delete(r),this.map.set(r,e)),e}set(r,e){if(this.map.has(r))this.map.delete(r);else if(this.map.size>=this.maxEntries){const s=this.map.keys().next().value;this.map.delete(s)}this.map.set(r,e)}clear(){this.map.clear()}},T.cY=$s,T.cZ=np,T.c_=eg,T.ca=class extends vo{},T.cb=Zg,T.cc=class extends Pr{},T.cd=wh,T.ce=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},T.cf=el,T.cg=function(r,e,s){var l=e[0],d=e[1],g=e[2],y=s[3]*l+s[7]*d+s[11]*g+s[15];return r[0]=(s[0]*l+s[4]*d+s[8]*g+s[12])/(y=y||1),r[1]=(s[1]*l+s[5]*d+s[9]*g+s[13])/y,r[2]=(s[2]*l+s[6]*d+s[10]*g+s[14])/y,r},T.ch=class extends kl{},T.ci=class extends t{},T.cj=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},T.ck=function(r,e){var s=r[0],l=r[1],d=r[2],g=r[3],y=r[4],w=r[5],N=r[6],A=r[7],R=r[8],I=r[9],B=r[10],$=r[11],W=r[12],X=r[13],te=r[14],oe=r[15],be=e[0],ne=e[1],me=e[2],Ee=e[3],Ie=e[4],Je=e[5],pt=e[6],gt=e[7],Tt=e[8],Lt=e[9],kt=e[10],yt=e[11],ut=e[12],qt=e[13],Zt=e[14],ts=e[15];return Math.abs(s-be)<=_e*Math.max(1,Math.abs(s),Math.abs(be))&&Math.abs(l-ne)<=_e*Math.max(1,Math.abs(l),Math.abs(ne))&&Math.abs(d-me)<=_e*Math.max(1,Math.abs(d),Math.abs(me))&&Math.abs(g-Ee)<=_e*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(y-Ie)<=_e*Math.max(1,Math.abs(y),Math.abs(Ie))&&Math.abs(w-Je)<=_e*Math.max(1,Math.abs(w),Math.abs(Je))&&Math.abs(N-pt)<=_e*Math.max(1,Math.abs(N),Math.abs(pt))&&Math.abs(A-gt)<=_e*Math.max(1,Math.abs(A),Math.abs(gt))&&Math.abs(R-Tt)<=_e*Math.max(1,Math.abs(R),Math.abs(Tt))&&Math.abs(I-Lt)<=_e*Math.max(1,Math.abs(I),Math.abs(Lt))&&Math.abs(B-kt)<=_e*Math.max(1,Math.abs(B),Math.abs(kt))&&Math.abs($-yt)<=_e*Math.max(1,Math.abs($),Math.abs(yt))&&Math.abs(W-ut)<=_e*Math.max(1,Math.abs(W),Math.abs(ut))&&Math.abs(X-qt)<=_e*Math.max(1,Math.abs(X),Math.abs(qt))&&Math.abs(te-Zt)<=_e*Math.max(1,Math.abs(te),Math.abs(Zt))&&Math.abs(oe-ts)<=_e*Math.max(1,Math.abs(oe),Math.abs(ts))},T.cl=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},T.cm=r=>r.type==="symbol",T.cn=r=>r.type==="circle",T.co=r=>r.type==="heatmap",T.cp=r=>r.type==="line",T.cq=r=>r.type==="fill",T.cr=r=>r.type==="fill-extrusion",T.cs=r=>r.type==="hillshade",T.ct=r=>r.type==="color-relief",T.cu=r=>r.type==="background",T.cv=r=>r.type==="custom",T.cw=lt,T.cx=function(r,e,s){if(e<=0)return r;const l=1/e;return s===void 0||Math.abs(s)<1e-10?Math.round(r*l)/l:(s>0?Math.ceil(r*l-1e-9):Math.floor(r*l+1e-10))/l},T.cy=function(r,e,s){const l=dt(e.x-s.x,e.y-s.y),d=dt(r.x-s.x,r.y-s.y);var g,y;return oi(Math.atan2(l[0]*d[1]-l[1]*d[0],(g=l)[0]*(y=d)[0]+g[1]*y[1]))},T.cz=Ot,T.d=Ve,T.d0=function(r,e,s,l,d){return c(this,void 0,void 0,(function*(){if(pe())try{return yield wt(r,e,s,l,d)}catch{}return(function(g,y,w,N,A){const R=g.width,I=g.height;qs&&yr||(qs=new OffscreenCanvas(R,I),yr=qs.getContext("2d",{willReadFrequently:!0})),qs.width=R,qs.height=I,yr.drawImage(g,0,0,R,I);const B=yr.getImageData(y,w,N,A);return yr.clearRect(0,0,R,I),B.data})(r,e,s,l,d)}))},T.d1=Ed,T.d2=F,T.d3=class{constructor(r,e){this.layers={[Bc]:this},this.name=Bc,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=r.length,this.features=r}feature(r){return new yx(this.features[r],this.extent)}},T.d4=gc,T.d5=sn,T.e=Dt,T.f=r=>c(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(e)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),T.g=H,T.h=r=>new Promise(((e,s)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=vi}))},l.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(r)],{type:"image/png"});l.src=r.byteLength?URL.createObjectURL(d):vi})),T.i=Is,T.j=(r,e)=>ve(Dt(r,{type:"json"}),e),T.k=ot,T.l=Re,T.m=ve,T.n=(r,e)=>ve(Dt(r,{type:"arrayBuffer"}),e),T.o=function(r){return new np(r).readFields(sy,[])},T.p=Em,T.q=function(r){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))},T.r=bh,T.s=Ha,T.t=Xr,T.u=Te,T.v=gu,T.w=us,T.x=wd,T.y=xn,T.z=yo})),k("worker",["./shared"],(function(T){class c{constructor(H,K){this.keyCache={},H&&this.replace(H,K)}replace(H,K){this._layerConfigs={},this._layers={},this.update(H,[],K)}update(H,K,U){for(const ve of H){this._layerConfigs[ve.id]=ve;const Ve=this._layers[ve.id]=T.bT(ve,U);Ve._featureFilter=T.aj(Ve.filter,U),this.keyCache[ve.id]&&delete this.keyCache[ve.id]}for(const ve of K)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const he=T.cM(Object.values(this._layerConfigs),this.keyCache);for(const ve of he){const Ve=ve.map((Te=>this._layers[Te.id])),He=Ve[0];if(He.isHidden())continue;const Ue=He.source||"";let Re=this.familiesBySource[Ue];Re||(Re=this.familiesBySource[Ue]={});const ot=He.sourceLayer||T.ai;let rt=Re[ot];rt||(rt=Re[ot]=[]),rt.push(Ve)}}}class O{constructor(H){const K={},U=[];for(const He in H){const Ue=H[He],Re=K[He]={};for(const ot in Ue){const rt=Ue[+ot];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Te={x:0,y:0,w:rt.bitmap.width+2,h:rt.bitmap.height+2};U.push(Te),Re[ot]={rect:Te,metrics:rt.metrics}}}const{w:he,h:ve}=T.p(U),Ve=new T.r({width:he||1,height:ve||1});for(const He in H){const Ue=H[He];for(const Re in Ue){const ot=Ue[+Re];if(!ot||ot.bitmap.width===0||ot.bitmap.height===0)continue;const rt=K[He][Re].rect;T.r.copy(ot.bitmap,Ve,{x:0,y:0},{x:rt.x+1,y:rt.y+1},ot.bitmap)}}this.image=Ve,this.positions=K}}T.cN("GlyphAtlas",O);class F{constructor(H){this.tileID=new T.a2(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,K,U,he,ve){return T._(this,void 0,void 0,(function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new T.ag;const Ve=new T.cO(Object.keys(H.layers).sort()),He=new T.cP(this.tileID,this.promoteId);He.bucketLayerIDs=[];const Ue={},Re={featureIndex:He,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:U,subdivisionGranularity:ve},ot=K.familiesBySource[this.source];for(const Ps in ot){const Ks=H.layers[Ps];if(!Ks)continue;Ks.version===1&&T.w(`Vector tile source "${this.source}" layer "${Ps}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const li=Ve.encode(Ps),Hs=[];for(let Ct=0;Ct<Ks.length;Ct++){const is=Ks.feature(Ct),es=He.getId(is,Ps);Hs.push({feature:is,id:es,index:Ct,sourceLayerIndex:li})}for(const Ct of ot[Ps]){const is=Ct[0];is.source!==this.source&&T.w(`layer.source = ${is.source} does not equal this.source = ${this.source}`),is.isHidden(this.zoom,!0)||(re(Ct,this.zoom,U),(Ue[is.id]=is.createBucket({index:He.bucketLayerIDs.length,layers:Ct,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:li,sourceID:this.source})).populate(Hs,Re,this.tileID.canonical),He.bucketLayerIDs.push(Ct.map((es=>es.id))))}}const rt=T.bY(Re.glyphDependencies,(Ps=>Object.keys(Ps).map(Number)));this.inFlightDependencies.forEach((Ps=>Ps?.abort())),this.inFlightDependencies=[];let Te=Promise.resolve({});if(Object.keys(rt).length){const Ps=new AbortController;this.inFlightDependencies.push(Ps),Te=he.sendAsync({type:"GG",data:{stacks:rt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ps)}const Vt=Object.keys(Re.iconDependencies);let as=Promise.resolve({});if(Vt.length){const Ps=new AbortController;this.inFlightDependencies.push(Ps),as=he.sendAsync({type:"GI",data:{icons:Vt,source:this.source,tileID:this.tileID,type:"icons"}},Ps)}const Kt=Object.keys(Re.patternDependencies);let ss=Promise.resolve({});if(Kt.length){const Ps=new AbortController;this.inFlightDependencies.push(Ps),ss=he.sendAsync({type:"GI",data:{icons:Kt,source:this.source,tileID:this.tileID,type:"patterns"}},Ps)}const Qt=Re.dashDependencies;let ls=Promise.resolve({});if(Object.keys(Qt).length){const Ps=new AbortController;this.inFlightDependencies.push(Ps),ls=he.sendAsync({type:"GDA",data:{dashes:Qt}},Ps)}const[xr,Sr,Gs,vr]=yield Promise.all([Te,as,ss,ls]),Rs=new O(xr),Nt=new T.cQ(Sr,Gs);for(const Ps in Ue){const Ks=Ue[Ps];Ks instanceof T.ah?(re(Ks.layers,this.zoom,U),T.cR({bucket:Ks,glyphMap:xr,glyphPositions:Rs.positions,imageMap:Sr,imagePositions:Nt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Re.subdivisionGranularity})):Ks.hasDependencies&&(Ks instanceof T.cS||Ks instanceof T.cT||Ks instanceof T.cU)&&(re(Ks.layers,this.zoom,U),Ks.addFeatures(Re,this.tileID.canonical,Nt.patternPositions,vr))}return this.status="done",{buckets:Object.values(Ue).filter((Ps=>!Ps.isEmpty())),featureIndex:He,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rs.image,imageAtlas:Nt,dashPositions:vr,glyphMap:this.returnDependencies?xr:null,iconMap:this.returnDependencies?Sr:null,glyphPositions:this.returnDependencies?Rs.positions:null}}))}}function re(Fe,H,K){const U=new T.H(H);for(const he of Fe)he.recalculate(U,K)}class se{constructor(){this.loading={},this.loaded={},this.parsing={}}startLoading(H,K){this.loading[H]=K}finishLoading(H){delete this.loading[H]}abort(H){const K=this.loading[H];K?.abort&&(K.abort.abort(),delete this.loading[H])}setParsing(H,K){this.parsing[H]=K}consumeParsing(H){const K=this.parsing[H];if(K)return delete this.parsing[H],K}clearParsing(H){delete this.parsing[H]}markLoaded(H,K){this.loaded[H]=K}getLoaded(H){const K=this.loaded[H];if(K)return K}removeLoaded(H){delete this.loaded[H]}clearLoaded(){this.loaded={}}}class ue{constructor(H,K,U,he,ve){this.type=H,this.properties=U||{},this.extent=ve,this.pointsArray=K,this.id=he}loadGeometry(){return this.pointsArray.map((H=>H.map((K=>new T.P(K.x,K.y)))))}}class ae{constructor(H,K,U){this.version=2,this._myFeatures=H,this.name=K,this.length=H.length,this.extent=U}feature(H){return this._myFeatures[H]}}class Q{constructor(){this.layers={}}addLayer(H){this.layers[H.name]=H}}function Y(Fe){let H=T.cV(Fe);return H.byteOffset===0&&H.byteLength===H.buffer.byteLength||(H=new Uint8Array(H)),{vectorTile:Fe,rawData:H.buffer}}function G(Fe,H,K){const{extent:U}=Fe,he=Math.pow(2,K.z-H.z),ve=(K.x-H.x*he)*U,Ve=(K.y-H.y*he)*U,He=[];for(let Ue=0;Ue<Fe.length;Ue++){const Re=Fe.feature(Ue);let ot=Re.loadGeometry();for(const Te of ot)for(const Vt of Te)Vt.x=Vt.x*he-ve,Vt.y=Vt.y*he-Ve;const rt=128;ot=T.cW(ot,Re.type,-rt,-rt,U+rt,U+rt),ot.length!==0&&He.push(new ue(Re.type,ot,Re.properties,Re.id,U))}return new ae(He,Fe.name,U)}class pe{constructor(H,K,U){this.actor=H,this.layerIndex=K,this.availableImages=U,this.tileState=new se,this.overzoomedTileResultCache=new T.cX(1e3)}loadVectorTile(H,K){return T._(this,void 0,void 0,(function*(){const U=yield T.n(H.request,K);try{return{vectorTile:H.encoding!=="mlt"?new T.cY(new T.cZ(U.data)):new T.c_(U.data),rawData:U.data,cacheControl:U.cacheControl,expires:U.expires}}catch(he){const ve=new Uint8Array(U.data);let Ve=`Unable to parse the tile at ${H.request.url}, `;throw Ve+=ve[0]===31&&ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.message}`,new Error(Ve)}}))}loadTile(H){return T._(this,void 0,void 0,(function*(){const{uid:K,overzoomParameters:U}=H;U&&(H.request=U.overzoomRequest);const he=this._startRequestTiming(H),ve=new F(H);this.tileState.startLoading(K,ve);const Ve=new AbortController;ve.abort=Ve;try{const He=yield this.loadVectorTile(H,Ve);if(this.tileState.finishLoading(K),!He)return null;let{vectorTile:Ue,rawData:Re}=He;U&&({vectorTile:Ue,rawData:Re}=this._getOverzoomTile(H,He.vectorTile));const ot=this._getExpiryData(He),rt=this._finishRequestTiming(he);ve.vectorTile=Ue,this.tileState.markLoaded(K,ve);const Te={rawData:Re,cacheControl:ot,resourceTiming:rt};this.tileState.setParsing(K,Te);try{return yield this._parseWorkerTile(ve,H,Te)}finally{this.tileState.clearParsing(K)}}catch(He){throw this.tileState.finishLoading(K),ve.status="done",this.tileState.markLoaded(K,ve),He}}))}_parseWorkerTile(H,K,U){return T._(this,void 0,void 0,(function*(){let he=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);if(U){const{rawData:ve,cacheControl:Ve,resourceTiming:He}=U;he=T.e({rawTileData:ve.slice(0),encoding:K.encoding},he,Ve,He)}return he}))}_getExpiryData(H){const{expires:K,cacheControl:U}=H,he={};return K&&(he.expires=K),U&&(he.cacheControl=U),he}_startRequestTiming(H){var K;if(!((K=H.request)===null||K===void 0)&&K.collectResourceTiming)return new T.c$(H.request.url)}_finishRequestTiming(H){const K=H?.finish();return K?{resourceTiming:JSON.parse(JSON.stringify(K))}:{}}_getOverzoomTile(H,K){const{tileID:U,source:he,overzoomParameters:ve}=H,{maxZoomTileID:Ve}=ve,He=`${Ve.key}_${U.key}`,Ue=this.overzoomedTileResultCache.get(He);if(Ue)return Ue;const Re=new Q,ot=this.layerIndex.familiesBySource[he];for(const Te in ot){const Vt=K.layers[Te];if(!Vt)continue;const as=G(Vt,Ve,U.canonical);as.length>0&&Re.addLayer(as)}const rt=Y(Re);return this.overzoomedTileResultCache.set(He,rt),rt}reloadTile(H){return T._(this,void 0,void 0,(function*(){const K=H.uid,U=this.tileState.getLoaded(K);if(!U)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(U.showCollisionBoxes=H.showCollisionBoxes,U.status==="parsing"){const he=this.tileState.consumeParsing(K);return yield this._parseWorkerTile(U,H,he)}if(U.status==="done"&&U.vectorTile)return yield this._parseWorkerTile(U,H)}))}abortTile(H){return T._(this,void 0,void 0,(function*(){this.tileState.abort(H.uid)}))}removeTile(H){return T._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(H.uid)}))}}class _e{constructor(){this.loaded={}}loadTile(H){return T._(this,void 0,void 0,(function*(){const{uid:K,encoding:U,rawImageData:he,redFactor:ve,greenFactor:Ve,blueFactor:He,baseShift:Ue}=H,Re=he.width+2,ot=he.height+2,rt=T.b(he)?new T.R({width:Re,height:ot},yield T.d0(he,-1,-1,Re,ot)):he,Te=new T.d1(K,rt,U,ve,Ve,He,Ue);return this.loaded=this.loaded||{},this.loaded[K]=Te,Te}))}removeTile(H){const K=this.loaded,U=H.uid;K&&K[U]&&delete K[U]}}var Ne,Oe,Be=(function(){if(Oe)return Ne;function Fe(K,U){if(K.length!==0){H(K[0],U);for(var he=1;he<K.length;he++)H(K[he],!U)}}function H(K,U){for(var he=0,ve=0,Ve=0,He=K.length,Ue=He-1;Ve<He;Ue=Ve++){var Re=(K[Ve][0]-K[Ue][0])*(K[Ue][1]+K[Ve][1]),ot=he+Re;ve+=Math.abs(he)>=Math.abs(Re)?he-ot+Re:Re-ot+he,he=ot}he+ve>=0!=!!U&&K.reverse()}return Oe=1,Ne=function K(U,he){var ve,Ve=U&&U.type;if(Ve==="FeatureCollection")for(ve=0;ve<U.features.length;ve++)K(U.features[ve],he);else if(Ve==="GeometryCollection")for(ve=0;ve<U.geometries.length;ve++)K(U.geometries[ve],he);else if(Ve==="Feature")K(U.geometry,he);else if(Ve==="Polygon")Fe(U.coordinates,he);else if(Ve==="MultiPolygon")for(ve=0;ve<U.coordinates.length;ve++)Fe(U.coordinates[ve],he);return U}})(),xt=T.d2(Be);const $e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Fe=>Fe},de=Math.fround||(Ae=new Float32Array(1),Fe=>(Ae[0]=+Fe,Ae[0]));var Ae;class Ye{constructor(H){this.options=Object.assign(Object.create($e),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:K,minZoom:U,maxZoom:he}=this.options;K&&console.time("total time");const ve=`prepare ${H.length} points`;K&&console.time(ve),this.points=H;const Ve=[];for(let Ue=0;Ue<H.length;Ue++){const Re=H[Ue];if(!Re.geometry)continue;const[ot,rt]=Re.geometry.coordinates,Te=de(zt(ot)),Vt=de(ht(rt));Ve.push(Te,Vt,1/0,Ue,-1,1),this.options.reduce&&Ve.push(0)}let He=this.trees[he+1]=this._createTree(Ve);K&&console.timeEnd(ve);for(let Ue=he;Ue>=U;Ue--){const Re=+Date.now();He=this.trees[Ue]=this._createTree(this._cluster(He,Ue)),K&&console.log("z%d: %d clusters in %dms",Ue,He.numItems,+Date.now()-Re)}return K&&console.timeEnd("total time"),this}getClusters(H,K){let U=((H[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,H[1]));let ve=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)U=-180,ve=180;else if(U>ve){const rt=this.getClusters([U,he,180,Ve],K),Te=this.getClusters([-180,he,ve,Ve],K);return rt.concat(Te)}const He=this.trees[this._limitZoom(K)],Ue=He.range(zt(U),ht(Ve),zt(ve),ht(he)),Re=He.data,ot=[];for(const rt of Ue){const Te=this.stride*rt;ot.push(Re[Te+5]>1?_t(Re,Te,this.clusterProps):this.points[Re[Te+3]])}return ot}getChildren(H){const K=this._getOriginId(H),U=this._getOriginZoom(H),he="No cluster with the specified id.",ve=this.trees[U];if(!ve)throw new Error(he);const Ve=ve.data;if(K*this.stride>=Ve.length)throw new Error(he);const He=this.options.radius/(this.options.extent*Math.pow(2,U-1)),Ue=ve.within(Ve[K*this.stride],Ve[K*this.stride+1],He),Re=[];for(const ot of Ue){const rt=ot*this.stride;Ve[rt+4]===H&&Re.push(Ve[rt+5]>1?_t(Ve,rt,this.clusterProps):this.points[Ve[rt+3]])}if(Re.length===0)throw new Error(he);return Re}getLeaves(H,K,U){const he=[];return this._appendLeaves(he,H,K=K||10,U=U||0,0),he}getTile(H,K,U){const he=this.trees[this._limitZoom(H)],ve=Math.pow(2,H),{extent:Ve,radius:He}=this.options,Ue=He/Ve,Re=(U-Ue)/ve,ot=(U+1+Ue)/ve,rt={features:[]};return this._addTileFeatures(he.range((K-Ue)/ve,Re,(K+1+Ue)/ve,ot),he.data,K,U,ve,rt),K===0&&this._addTileFeatures(he.range(1-Ue/ve,Re,1,ot),he.data,ve,U,ve,rt),K===ve-1&&this._addTileFeatures(he.range(0,Re,Ue/ve,ot),he.data,-1,U,ve,rt),rt.features.length?rt:null}getClusterExpansionZoom(H){let K=this._getOriginZoom(H)-1;for(;K<=this.options.maxZoom;){const U=this.getChildren(H);if(K++,U.length!==1)break;H=U[0].properties.cluster_id}return K}_appendLeaves(H,K,U,he,ve){const Ve=this.getChildren(K);for(const He of Ve){const Ue=He.properties;if(Ue&&Ue.cluster?ve+Ue.point_count<=he?ve+=Ue.point_count:ve=this._appendLeaves(H,Ue.cluster_id,U,he,ve):ve<he?ve++:H.push(He),H.length===U)break}return ve}_createTree(H){const K=new T.aT(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<H.length;U+=this.stride)K.add(H[U],H[U+1]);return K.finish(),K.data=H,K}_addTileFeatures(H,K,U,he,ve,Ve){for(const He of H){const Ue=He*this.stride,Re=K[Ue+5]>1;let ot,rt,Te;if(Re)ot=Et(K,Ue,this.clusterProps),rt=K[Ue],Te=K[Ue+1];else{const Kt=this.points[K[Ue+3]];ot=Kt.properties;const[ss,Qt]=Kt.geometry.coordinates;rt=zt(ss),Te=ht(Qt)}const Vt={type:1,geometry:[[Math.round(this.options.extent*(rt*ve-U)),Math.round(this.options.extent*(Te*ve-he))]],tags:ot};let as;as=Re||this.options.generateId?K[Ue+3]:this.points[K[Ue+3]].id,as!==void 0&&(Vt.id=as),Ve.features.push(Vt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,K){const{radius:U,extent:he,reduce:ve,minPoints:Ve}=this.options,He=U/(he*Math.pow(2,K)),Ue=H.data,Re=[],ot=this.stride;for(let rt=0;rt<Ue.length;rt+=ot){if(Ue[rt+2]<=K)continue;Ue[rt+2]=K;const Te=Ue[rt],Vt=Ue[rt+1],as=H.within(Ue[rt],Ue[rt+1],He),Kt=Ue[rt+5];let ss=Kt;for(const Qt of as){const ls=Qt*ot;Ue[ls+2]>K&&(ss+=Ue[ls+5])}if(ss>Kt&&ss>=Ve){let Qt,ls=Te*Kt,xr=Vt*Kt,Sr=-1;const Gs=(rt/ot<<5)+(K+1)+this.points.length;for(const vr of as){const Rs=vr*ot;if(Ue[Rs+2]<=K)continue;Ue[Rs+2]=K;const Nt=Ue[Rs+5];ls+=Ue[Rs]*Nt,xr+=Ue[Rs+1]*Nt,Ue[Rs+4]=Gs,ve&&(Qt||(Qt=this._map(Ue,rt,!0),Sr=this.clusterProps.length,this.clusterProps.push(Qt)),ve(Qt,this._map(Ue,Rs)))}Ue[rt+4]=Gs,Re.push(ls/ss,xr/ss,1/0,Gs,-1,ss),ve&&Re.push(Sr)}else{for(let Qt=0;Qt<ot;Qt++)Re.push(Ue[rt+Qt]);if(ss>1)for(const Qt of as){const ls=Qt*ot;if(!(Ue[ls+2]<=K)){Ue[ls+2]=K;for(let xr=0;xr<ot;xr++)Re.push(Ue[ls+xr])}}}}return Re}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,K,U){if(H[K+5]>1){const Ve=this.clusterProps[H[K+6]];return U?Object.assign({},Ve):Ve}const he=this.points[H[K+3]].properties,ve=this.options.map(he);return U&&ve===he?Object.assign({},ve):ve}}function _t(Fe,H,K){return{type:"Feature",id:Fe[H+3],properties:Et(Fe,H,K),geometry:{type:"Point",coordinates:[(U=Fe[H],360*(U-.5)),Qe(Fe[H+1])]}};var U}function Et(Fe,H,K){const U=Fe[H+5],he=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,ve=Fe[H+6],Ve=ve===-1?{}:Object.assign({},K[ve]);return Object.assign(Ve,{cluster:!0,cluster_id:Fe[H+3],point_count:U,point_count_abbreviated:he})}function zt(Fe){return Fe/360+.5}function ht(Fe){const H=Math.sin(Fe*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function Qe(Fe){const H=(180-360*Fe)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function Ce(Fe,H,K,U){let he=U;const ve=H+(K-H>>1);let Ve,He=K-H;const Ue=Fe[H],Re=Fe[H+1],ot=Fe[K],rt=Fe[K+1];for(let Te=H+3;Te<K;Te+=3){const Vt=We(Fe[Te],Fe[Te+1],Ue,Re,ot,rt);if(Vt>he)Ve=Te,he=Vt;else if(Vt===he){const as=Math.abs(Te-ve);as<He&&(Ve=Te,He=as)}}he>U&&(Ve-H>3&&Ce(Fe,H,Ve,U),Fe[Ve+2]=he,K-Ve>3&&Ce(Fe,Ve,K,U))}function We(Fe,H,K,U,he,ve){let Ve=he-K,He=ve-U;if(Ve!==0||He!==0){const Ue=((Fe-K)*Ve+(H-U)*He)/(Ve*Ve+He*He);Ue>1?(K=he,U=ve):Ue>0&&(K+=Ve*Ue,U+=He*Ue)}return Ve=Fe-K,He=H-U,Ve*Ve+He*He}function dt(Fe,H,K,U){const he={type:H,geom:K},ve={id:Fe??null,type:he.type,geometry:he.geom,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(he.type){case"Point":case"MultiPoint":case"LineString":Ze(ve,he.geom);break;case"Polygon":Ze(ve,he.geom[0]);break;case"MultiLineString":for(const Ve of he.geom)Ze(ve,Ve);break;case"MultiPolygon":for(const Ve of he.geom)Ze(ve,Ve[0])}return ve}function Ze(Fe,H){for(let K=0;K<H.length;K+=3)Fe.minX=Math.min(Fe.minX,H[K]),Fe.minY=Math.min(Fe.minY,H[K+1]),Fe.maxX=Math.max(Fe.maxX,H[K]),Fe.maxY=Math.max(Fe.maxY,H[K+1])}function Pe(Fe,H){const K=[];switch(Fe.type){case"FeatureCollection":for(let U=0;U<Fe.features.length;U++)le(K,Fe.features[U],H,U);break;case"Feature":le(K,Fe,H);break;default:le(K,{geometry:Fe,properties:void 0},H)}return K}function le(Fe,H,K,U){if(!H.geometry)return;if(H.geometry.type==="GeometryCollection"){for(const He of H.geometry.geometries)le(Fe,{id:H.id,geometry:He,properties:H.properties},K,U);return}if(!H.geometry.coordinates?.length)return;const ve=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Ve=H.id;switch(K.promoteId?Ve=H.properties?.[K.promoteId]:K.generateId&&(Ve=U||0),H.geometry.type){case"Point":{const He=[];return Le(H.geometry.coordinates,He),void Fe.push(dt(Ve,H.geometry.type,He,H.properties))}case"MultiPoint":{const He=[];for(const Ue of H.geometry.coordinates)Le(Ue,He);return void Fe.push(dt(Ve,H.geometry.type,He,H.properties))}case"LineString":{const He=[];return nt(H.geometry.coordinates,He,ve,!1),void Fe.push(dt(Ve,H.geometry.type,He,H.properties))}case"MultiLineString":{if(K.lineMetrics){for(const Ue of H.geometry.coordinates){const Re=[];nt(Ue,Re,ve,!1),Fe.push(dt(Ve,"LineString",Re,H.properties))}return}const He=[];return lt(H.geometry.coordinates,He,ve,!1),void Fe.push(dt(Ve,H.geometry.type,He,H.properties))}case"Polygon":{const He=[];return lt(H.geometry.coordinates,He,ve,!0),void Fe.push(dt(Ve,H.geometry.type,He,H.properties))}case"MultiPolygon":{const He=[];for(const Ue of H.geometry.coordinates){const Re=[];lt(Ue,Re,ve,!0),He.push(Re)}return void Fe.push(dt(Ve,H.geometry.type,He,H.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Le(Fe,H){H.push(Ot(Fe[0]),Mt(Fe[1]),0)}function nt(Fe,H,K,U){let he,ve,Ve=0;for(let Ue=0;Ue<Fe.length;Ue++){const Re=Ot(Fe[Ue][0]),ot=Mt(Fe[Ue][1]);H.push(Re,ot,0),Ue>0&&(Ve+=U?(he*ot-Re*ve)/2:Math.sqrt(Math.pow(Re-he,2)+Math.pow(ot-ve,2))),he=Re,ve=ot}const He=H.length-3;H[2]=1,K>0&&Ce(H,0,He,K),H[He+2]=1,H.size=Math.abs(Ve),H.start=0,H.end=H.size}function lt(Fe,H,K,U){for(let he=0;he<Fe.length;he++){const ve=[];nt(Fe[he],ve,K,U),H.push(ve)}}function Ot(Fe){return Fe/360+.5}function Mt(Fe){const H=Math.sin(Fe*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function mt(Fe,H,K,U,he,ve,Ve,He){if(U/=H,ve>=(K/=H)&&Ve<U)return Fe;if(Ve<K||ve>=U)return null;const Ue=[];for(const Re of Fe){const ot=he===0?Re.minX:Re.minY,rt=he===0?Re.maxX:Re.maxY;if(ot>=K&&rt<U)Ue.push(Re);else if(!(rt<K||ot>=U))switch(Re.type){case"Point":case"MultiPoint":{const Te=[];if(Dt(Re.geometry,Te,K,U,he),!Te.length)continue;Ue.push(dt(Re.id,Te.length===3?"Point":"MultiPoint",Te,Re.tags));continue}case"LineString":{const Te=[];if(ys(Re.geometry,Te,K,U,he,!1,He.lineMetrics),!Te.length)continue;if(He.lineMetrics){for(const Vt of Te)Ue.push(dt(Re.id,Re.type,Vt,Re.tags));continue}if(Te.length>1){Ue.push(dt(Re.id,"MultiLineString",Te,Re.tags));continue}Ue.push(dt(Re.id,Re.type,Te[0],Re.tags));continue}case"MultiLineString":{const Te=[];if(ks(Re.geometry,Te,K,U,he,!1),!Te.length)continue;if(Te.length===1){Ue.push(dt(Re.id,"LineString",Te[0],Re.tags));continue}Ue.push(dt(Re.id,Re.type,Te,Re.tags));continue}case"Polygon":{const Te=[];if(ks(Re.geometry,Te,K,U,he,!0),!Te.length)continue;Ue.push(dt(Re.id,Re.type,Te,Re.tags));continue}case"MultiPolygon":{const Te=[];for(const Vt of Re.geometry){const as=[];ks(Vt,as,K,U,he,!0),as.length&&Te.push(as)}if(!Te.length)continue;Ue.push(dt(Re.id,Re.type,Te,Re.tags));continue}}}return Ue.length?Ue:null}function Dt(Fe,H,K,U,he){for(let ve=0;ve<Fe.length;ve+=3){const Ve=Fe[ve+he];Ve>=K&&Ve<=U&&Es(H,Fe[ve],Fe[ve+1],Fe[ve+2])}}function ys(Fe,H,K,U,he,ve,Ve){let He=js(Fe);const Ue=he===0?Rr:us;let Re,ot,rt=Fe.start;for(let ss=0;ss<Fe.length-3;ss+=3){const Qt=Fe[ss],ls=Fe[ss+1],xr=Fe[ss+2],Sr=Fe[ss+3],Gs=Fe[ss+4],vr=he===0?Qt:ls,Rs=he===0?Sr:Gs;let Nt=!1;Ve&&(Re=Math.sqrt(Math.pow(Qt-Sr,2)+Math.pow(ls-Gs,2))),vr<K?Rs>K&&(ot=Ue(He,Qt,ls,Sr,Gs,K),Ve&&(He.start=rt+Re*ot)):vr>U?Rs<U&&(ot=Ue(He,Qt,ls,Sr,Gs,U),Ve&&(He.start=rt+Re*ot)):Es(He,Qt,ls,xr),Rs<K&&vr>=K&&(ot=Ue(He,Qt,ls,Sr,Gs,K),Nt=!0),Rs>U&&vr<=U&&(ot=Ue(He,Qt,ls,Sr,Gs,U),Nt=!0),!ve&&Nt&&(Ve&&(He.end=rt+Re*ot),H.push(He),He=js(Fe)),Ve&&(rt+=Re)}let Te=Fe.length-3;const Vt=Fe[Te],as=Fe[Te+1],Kt=he===0?Vt:as;Kt>=K&&Kt<=U&&Es(He,Vt,as,Fe[Te+2]),Te=He.length-3,ve&&Te>=3&&(He[Te]!==He[0]||He[Te+1]!==He[1])&&Es(He,He[0],He[1],He[2]),He.length&&H.push(He)}function js(Fe){const H=[];return H.size=Fe.size,H.start=Fe.start,H.end=Fe.end,H}function ks(Fe,H,K,U,he,ve){for(const Ve of Fe)ys(Ve,H,K,U,he,ve,!1)}function Es(Fe,H,K,U){Fe.push(H,K,U)}function Rr(Fe,H,K,U,he,ve){const Ve=(ve-H)/(U-H);return Es(Fe,ve,K+(he-K)*Ve,1),Ve}function us(Fe,H,K,U,he,ve){const Ve=(ve-K)/(he-K);return Es(Fe,H+(U-H)*Ve,ve,1),Ve}function xs(Fe,H){const K=H.buffer/H.extent;let U=Fe;const he=mt(Fe,1,-1-K,K,0,-1,2,H),ve=mt(Fe,1,1-K,2+K,0,-1,2,H);return(he||ve)&&(U=mt(Fe,1,-K,1+K,0,-1,2,H)||[],he&&(U=Is(he,1).concat(U)),ve&&(U=U.concat(Is(ve,-1)))),U}function Is(Fe,H){const K=[];for(const U of Fe)switch(U.type){case"Point":case"MultiPoint":case"LineString":{const he=Os(U.geometry,H);K.push(dt(U.id,U.type,he,U.tags));continue}case"MultiLineString":case"Polygon":{const he=[];for(const ve of U.geometry)he.push(Os(ve,H));K.push(dt(U.id,U.type,he,U.tags));continue}case"MultiPolygon":{const he=[];for(const ve of U.geometry){const Ve=[];for(const He of ve)Ve.push(Os(He,H));he.push(Ve)}K.push(dt(U.id,U.type,he,U.tags));continue}}return K}function Os(Fe,H){const K=[];K.size=Fe.size,Fe.start!==void 0&&(K.start=Fe.start,K.end=Fe.end);for(let U=0;U<Fe.length;U+=3)K.push(Fe[U]+H,Fe[U+1],Fe[U+2]);return K}function ar(Fe,H){if(Fe.transformed)return Fe;const K=1<<Fe.z,U=Fe.x,he=Fe.y;for(const ve of Fe.features){if(ve.type===1){const He=[];for(let Ue=0;Ue<ve.geometry.length;Ue+=2)He.push(vi(ve.geometry[Ue],ve.geometry[Ue+1],H,K,U,he));ve.geometry=He;continue}const Ve=[];for(const He of ve.geometry){const Ue=[];for(let Re=0;Re<He.length;Re+=2)Ue.push(vi(He[Re],He[Re+1],H,K,U,he));Ve.push(Ue)}ve.geometry=Ve}return Fe.transformed=!0,Fe}function vi(Fe,H,K,U,he,ve){return[Math.round(K*(Fe*U-he)),Math.round(K*(H*U-ve))]}function wt(Fe,H,K,U,he){const ve=H===he.maxZoom?0:he.tolerance/((1<<H)*he.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:Fe.length,source:null,x:K,y:U,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const He of Fe)qs(Ve,He,ve,he);return Ve}function qs(Fe,H,K,U){Fe.minX=Math.min(Fe.minX,H.minX),Fe.minY=Math.min(Fe.minY,H.minY),Fe.maxX=Math.max(Fe.maxX,H.maxX),Fe.maxY=Math.max(Fe.maxY,H.maxY);let he,ve=H.tags||null;switch(H.type){case"Point":case"MultiPoint":{const Ve=[];for(let He=0;He<H.geometry.length;He+=3)Ve.push(H.geometry[He],H.geometry[He+1]),Fe.numPoints++,Fe.numSimplified++;if(!Ve.length)return;he={type:1,tags:ve,geometry:Ve};break}case"LineString":{const Ve=[];if(yr(Ve,H.geometry,Fe,K,!1,!1),!Ve.length)return;if(U.lineMetrics){ve={};for(const He in H.tags)ve[He]=H.tags[He];ve.mapbox_clip_start=H.geometry.start/H.geometry.size,ve.mapbox_clip_end=H.geometry.end/H.geometry.size}he={type:2,tags:ve,geometry:Ve};break}case"MultiLineString":case"Polygon":{const Ve=[];for(let He=0;He<H.geometry.length;He++)yr(Ve,H.geometry[He],Fe,K,H.type==="Polygon",He===0);if(!Ve.length)return;he={type:H.type==="Polygon"?3:2,tags:ve,geometry:Ve};break}case"MultiPolygon":{const Ve=[];for(let He=0;He<H.geometry.length;He++){const Ue=H.geometry[He];for(let Re=0;Re<Ue.length;Re++)yr(Ve,Ue[Re],Fe,K,!0,Re===0)}if(!Ve.length)return;he={type:3,tags:ve,geometry:Ve};break}}H.id!==null&&(he.id=H.id),Fe.features.push(he)}function yr(Fe,H,K,U,he,ve){const Ve=U*U;if(U>0&&H.size<(he?Ve:U))return void(K.numPoints+=H.length/3);const He=[];for(let Ue=0;Ue<H.length;Ue+=3)(U===0||H[Ue+2]>Ve)&&(K.numSimplified++,He.push(H[Ue],H[Ue+1])),K.numPoints++;he&&(function(Ue,Re){let ot=0;for(let rt=0,Te=Ue.length,Vt=Te-2;rt<Te;Vt=rt,rt+=2)ot+=(Ue[rt]-Ue[Vt])*(Ue[rt+1]+Ue[Vt+1]);if(ot>0===Re)for(let rt=0,Te=Ue.length;rt<Te/2;rt+=2){const Vt=Ue[rt],as=Ue[rt+1];Ue[rt]=Ue[Te-2-rt],Ue[rt+1]=Ue[Te-1-rt],Ue[Te-2-rt]=Vt,Ue[Te-1-rt]=as}})(He,ve),Fe.push(He)}function Ha(Fe,H,K){const U=!!H.newGeometry,he=H.removeAllProperties||H.removeProperties?.length>0||H.addOrUpdateProperties?.length>0;if(U){let ve=Pe({type:"FeatureCollection",features:[{type:"Feature",id:Fe.id,geometry:H.newGeometry,properties:he?Ms(Fe.tags,H):Fe.tags}]},K);return ve=xs(ve,K),ve[0]}if(he){const ve={...Fe};return ve.tags=Ms(ve.tags,H),ve}return null}function Ms(Fe,H){if(H.removeAllProperties)return{};const K={...Fe||{}};if(H.removeProperties)for(const U of H.removeProperties)delete K[U];if(H.addOrUpdateProperties)for(const{key:U,value:he}of H.addOrUpdateProperties)K[U]=he;return K}const oi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class Fr{options;tiles;tileCoords;stats={};total=0;source;constructor(H,K){const U=(K=this.options=Object.assign({},oi,K)).debug;if(U&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let he=Pe(H,K);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=xs(he,K),he.length&&this.splitTile(he,0,0,0),K.updateable&&(this.source=he),U&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,K,U,he,ve,Ve,He){const Ue=[H,K,U,he],Re=this.options,ot=Re.debug;for(;Ue.length;){he=Ue.pop(),U=Ue.pop(),K=Ue.pop(),H=Ue.pop();const rt=1<<K,Te=Oi(K,U,he);let Vt=this.tiles[Te];if(!Vt&&(ot>1&&console.time("creation"),Vt=this.tiles[Te]=wt(H,K,U,he,Re),this.tileCoords.push({z:K,x:U,y:he,id:Te}),ot)){ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,U,he,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));const Nt=`z${K}`;this.stats[Nt]=(this.stats[Nt]||0)+1,this.total++}if(Vt.source=H,ve==null){if(K===Re.indexMaxZoom||Vt.numPoints<=Re.indexMaxPoints)continue}else{if(K===Re.maxZoom||K===ve)continue;if(ve!=null){const Nt=ve-K;if(U!==Ve>>Nt||he!==He>>Nt)continue}}if(Vt.source=null,!H.length)continue;ot>1&&console.time("clipping");const as=.5*Re.buffer/Re.extent,Kt=.5-as,ss=.5+as,Qt=1+as;let ls=null,xr=null,Sr=null,Gs=null;const vr=mt(H,rt,U-as,U+ss,0,Vt.minX,Vt.maxX,Re),Rs=mt(H,rt,U+Kt,U+Qt,0,Vt.minX,Vt.maxX,Re);vr&&(ls=mt(vr,rt,he-as,he+ss,1,Vt.minY,Vt.maxY,Re),xr=mt(vr,rt,he+Kt,he+Qt,1,Vt.minY,Vt.maxY,Re)),Rs&&(Sr=mt(Rs,rt,he-as,he+ss,1,Vt.minY,Vt.maxY,Re),Gs=mt(Rs,rt,he+Kt,he+Qt,1,Vt.minY,Vt.maxY,Re)),ot>1&&console.timeEnd("clipping"),Ue.push(ls||[],K+1,2*U,2*he),Ue.push(xr||[],K+1,2*U,2*he+1),Ue.push(Sr||[],K+1,2*U+1,2*he),Ue.push(Gs||[],K+1,2*U+1,2*he+1)}}getTile(H,K,U){H=+H,K=+K,U=+U;const he=this.options,{extent:ve,debug:Ve}=he;if(H<0||H>24)return null;const He=1<<H,Ue=Oi(H,K=K+He&He-1,U);if(this.tiles[Ue])return ar(this.tiles[Ue],ve);Ve>1&&console.log("drilling down to z%d-%d-%d",H,K,U);let Re,ot=H,rt=K,Te=U;for(;!Re&&ot>0;)ot--,rt>>=1,Te>>=1,Re=this.tiles[Oi(ot,rt,Te)];return Re?.source?(Ve>1&&(console.log("found parent tile z%d-%d-%d",ot,rt,Te),console.time("drilling down")),this.splitTile(Re.source,ot,rt,Te,H,K,U),Ve>1&&console.timeEnd("drilling down"),this.tiles[Ue]?ar(this.tiles[Ue],ve):null):null}invalidateTiles(H){const K=this.options,{debug:U}=K;let he=1/0,ve=-1/0,Ve=1/0,He=-1/0;for(const ot of H)he=Math.min(he,ot.minX),ve=Math.max(ve,ot.maxX),Ve=Math.min(Ve,ot.minY),He=Math.max(He,ot.maxY);const Ue=K.buffer/K.extent,Re=new Set;for(const ot in this.tiles){const rt=this.tiles[ot],Te=1<<rt.z,Vt=(rt.x-Ue)/Te,as=(rt.x+1+Ue)/Te,Kt=(rt.y-Ue)/Te,ss=(rt.y+1+Ue)/Te;if(ve<Vt||he>=as||He<Kt||Ve>=ss)continue;let Qt=!1;for(const ls of H)if(ls.maxX>=Vt&&ls.minX<as&&ls.maxY>=Kt&&ls.minY<ss){Qt=!0;break}if(Qt){if(U){U>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",rt.z,rt.x,rt.y,rt.numFeatures,rt.numPoints,rt.numSimplified);const ls=`z${rt.z}`;this.stats[ls]=(this.stats[ls]||0)-1,this.total--}delete this.tiles[ot],Re.add(ot)}}Re.size&&(this.tileCoords=this.tileCoords.filter((ot=>!Re.has(ot.id))))}updateData(H){const K=this.options,U=K.debug;if(!K.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:he,source:ve}=(function(rt,Te,Vt){const as=(function(ss){return ss?{removeAll:ss.removeAll,remove:new Set(ss.remove||[]),add:new Map(ss.add?.map((Qt=>[Qt.id,Qt]))),update:new Map(ss.update?.map((Qt=>[Qt.id,Qt])))}:{remove:new Set,add:new Map,update:new Map}})(Te);let Kt=[];if(as.removeAll&&(Kt=rt,rt=[]),as.remove.size||as.add.size){const ss=[];for(const Qt of rt){const{id:ls}=Qt;(as.remove.has(ls)||as.add.has(ls))&&ss.push(Qt)}if(ss.length){Kt.push(...ss);const Qt=new Set(ss.map((ls=>ls.id)));rt=rt.filter((ls=>!Qt.has(ls.id)))}if(as.add.size){let Qt=Pe({type:"FeatureCollection",features:Array.from(as.add.values())},Vt);Qt=xs(Qt,Vt),Kt.push(...Qt),rt.push(...Qt)}}if(as.update.size)for(const[ss,Qt]of as.update){const ls=rt.findIndex((Gs=>Gs.id===ss));if(ls===-1)continue;const xr=rt[ls],Sr=Ha(xr,Qt,Vt);Sr&&(Kt.push(xr,Sr),rt[ls]=Sr)}return{affected:Kt,source:rt}})(this.source,H,K);if(!he.length)return;this.source=ve,U>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(he),U>1&&console.timeEnd("invalidating");const[Ve,He,Ue]=[0,0,0],Re=wt(this.source,Ve,He,Ue,this.options);Re.source=this.source;const ot=Oi(Ve,He,Ue);if(this.tiles[ot]=Re,this.tileCoords.push({z:Ve,x:He,y:Ue,id:ot}),U){const rt=`z${Ve}`;this.stats[rt]=(this.stats[rt]||0)+1,this.total++}}}function Oi(Fe,H,K){return 32*((1<<Fe)*K+H)+Fe}class Gi{constructor(H,K,U,he=Fs){this._dataUpdateable=new Map,this.actor=H,this.layerIndex=K,this.availableImages=U,this.tileState=new se,this._createGeoJSONIndex=he}loadVectorTile(H){if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const{z:K,x:U,y:he}=H.tileID.canonical,ve=this._geoJSONIndex.getTile(K,U,he);return ve?Y(new T.d3(ve.features,{version:2,extent:T.a5})):null}loadTile(H){return T._(this,void 0,void 0,(function*(){const{uid:K}=H,U=new F(H);U.abort=new AbortController;try{const he=this.loadVectorTile(H);if(!he)return null;const{vectorTile:ve,rawData:Ve}=he;U.vectorTile=ve,this.tileState.markLoaded(K,U);const He={rawData:Ve};this.tileState.setParsing(K,He);try{return yield this._parseWorkerTile(U,H,He)}finally{this.tileState.clearParsing(K)}}catch(he){throw U.status="done",this.tileState.markLoaded(K,U),he}}))}_reloadLoadedTile(H){return T._(this,void 0,void 0,(function*(){const K=H.uid,U=this.tileState.getLoaded(K);if(!U)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(U.showCollisionBoxes=H.showCollisionBoxes,U.status==="parsing"){const he=this.tileState.consumeParsing(K);return yield this._parseWorkerTile(U,H,he)}if(U.status==="done"&&U.vectorTile)return yield this._parseWorkerTile(U,H)}))}_parseWorkerTile(H,K,U){return T._(this,void 0,void 0,(function*(){let he=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);if(U){const{rawData:ve}=U;he=T.e({rawTileData:ve.slice(0)},he)}return he}))}abortTile(H){return T._(this,void 0,void 0,(function*(){this.tileState.abort(H.uid)}))}removeTile(H){return T._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(H.uid)}))}loadData(H){return T._(this,void 0,void 0,(function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const U=this._startRequestTiming(H);this._pendingRequest=new AbortController;try{(!this._pendingData||H.request||H.data||H.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest));const he=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(he,H),this.tileState.clearLoaded();const ve={};return H.request&&(ve.data=he),this._finishRequestTiming(U,H,ve),ve}catch(he){if(delete this._pendingRequest,T.Z(he))return{abandoned:!0};throw he}}))}_startRequestTiming(H){var K;if(!((K=H.request)===null||K===void 0)&&K.collectResourceTiming)return new T.c$(H.request.url)}_finishRequestTiming(H,K,U){const he=H?.finish();he&&(U.resourceTiming={[K.source]:JSON.parse(JSON.stringify(he))})}getData(){return T._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(H){return this.tileState.getLoaded(H.uid)?this._reloadLoadedTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,K){return T._(this,void 0,void 0,(function*(){let U;if(H.request?U=yield this.loadGeoJSONFromUrl(H.request,H.promoteId,K):H.data?U=this._loadGeoJSONFromObject(H.data,H.promoteId):H.dataDiff&&(U=this._loadGeoJSONFromDiff(H.dataDiff,H.promoteId,H.source)),delete this._pendingRequest,typeof U!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);return xt(U,!0),H.filter&&(U=this._filterGeoJSON(U,H.filter)),U}))}loadGeoJSONFromUrl(H,K,U){return T._(this,void 0,void 0,(function*(){const he=yield T.j(H,U);return this._dataUpdateable=T.a7(he.data,K),he.data}))}_loadGeoJSONFromObject(H,K){return this._dataUpdateable=T.a7(H,K),H}_loadGeoJSONFromDiff(H,K,U){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${U}`);T.a8(this._dataUpdateable,H,K);const he=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(he)}_filterGeoJSON(H,K){const U=T.d4(K,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(U.result==="error")throw new Error(U.value.map((ve=>`${ve.key}: ${ve.message}`)).join(", "));const he=H.features.filter((ve=>U.value.evaluate({zoom:0},ve)));return this._toFeatureCollection(he)}_toFeatureCollection(H){return{type:"FeatureCollection",features:H}}removeSource(H){return T._(this,void 0,void 0,(function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort()}))}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}function Fs(Fe,H){return H.cluster?new Ye((function({superclusterOptions:K,clusterProperties:U}){if(!U||!K)return K;const he={},ve={},Ve={accumulated:null,zoom:0},He={properties:null},Ue=Object.keys(U);for(const Re of Ue){const[ot,rt]=U[Re],Te=T.d4(rt),Vt=T.d4(typeof ot=="string"?[ot,["accumulated"],["get",Re]]:ot);he[Re]=Te.value,ve[Re]=Vt.value}return K.map=Re=>{He.properties=Re;const ot={};for(const rt of Ue)ot[rt]=he[rt].evaluate(Ve,He);return ot},K.reduce=(Re,ot)=>{He.properties=ot;for(const rt of Ue)Ve.accumulated=Re[rt],Re[rt]=ve[rt].evaluate(Ve,He)},K})(H)).load(Fe.features):(function(K,U){return new Fr(K,U)})(Fe,H.geojsonVtOptions)}class Ls{constructor(H){this.self=H,this.actor=new T.L(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(K,U)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=U},this.self.addProtocol=T.cK,this.self.removeProtocol=T.cL,this.self.registerRTLTextPlugin=K=>{T.d5.setMethods(K)},this.actor.registerMessageHandler("LDT",((K,U)=>this._getDEMWorkerSource(K,U.source).loadTile(U))),this.actor.registerMessageHandler("RDT",((K,U)=>T._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(K,U.source).removeTile(U)})))),this.actor.registerMessageHandler("GCEZ",((K,U)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,U.type,U.source).getClusterExpansionZoom(U)})))),this.actor.registerMessageHandler("GCC",((K,U)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,U.type,U.source).getClusterChildren(U)})))),this.actor.registerMessageHandler("GCL",((K,U)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,U.type,U.source).getClusterLeaves(U)})))),this.actor.registerMessageHandler("LD",((K,U)=>this._getWorkerSource(K,U.type,U.source).loadData(U))),this.actor.registerMessageHandler("GD",((K,U)=>this._getWorkerSource(K,U.type,U.source).getData())),this.actor.registerMessageHandler("LT",((K,U)=>this._getWorkerSource(K,U.type,U.source).loadTile(U))),this.actor.registerMessageHandler("RT",((K,U)=>this._getWorkerSource(K,U.type,U.source).reloadTile(U))),this.actor.registerMessageHandler("AT",((K,U)=>this._getWorkerSource(K,U.type,U.source).abortTile(U))),this.actor.registerMessageHandler("RMT",((K,U)=>this._getWorkerSource(K,U.type,U.source).removeTile(U))),this.actor.registerMessageHandler("RS",((K,U)=>T._(this,void 0,void 0,(function*(){if(!this.workerSources[K]||!this.workerSources[K][U.type]||!this.workerSources[K][U.type][U.source])return;const he=this.workerSources[K][U.type][U.source];delete this.workerSources[K][U.type][U.source],he.removeSource!==void 0&&he.removeSource(U)})))),this.actor.registerMessageHandler("RM",(K=>T._(this,void 0,void 0,(function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],this.globalStates.delete(K)})))),this.actor.registerMessageHandler("SR",((K,U)=>T._(this,void 0,void 0,(function*(){this.referrer=U})))),this.actor.registerMessageHandler("SRPS",((K,U)=>this._syncRTLPluginState(K,U))),this.actor.registerMessageHandler("IS",((K,U)=>T._(this,void 0,void 0,(function*(){this.self.importScripts(U)})))),this.actor.registerMessageHandler("SI",((K,U)=>this._setImages(K,U))),this.actor.registerMessageHandler("UL",((K,U)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(K).update(U.layers,U.removedIds,this._getGlobalState(K))})))),this.actor.registerMessageHandler("UGS",((K,U)=>T._(this,void 0,void 0,(function*(){const he=this._getGlobalState(K);for(const ve in U)he[ve]=U[ve]})))),this.actor.registerMessageHandler("SL",((K,U)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(K).replace(U,this._getGlobalState(K))}))))}_getGlobalState(H){let K=this.globalStates.get(H);return K||(K={},this.globalStates.set(H,K)),K}_setImages(H,K){return T._(this,void 0,void 0,(function*(){this.availableImages[H]=K;for(const U in this.workerSources[H]){const he=this.workerSources[H][U];for(const ve in he)he[ve].availableImages=K}}))}_syncRTLPluginState(H,K){return T._(this,void 0,void 0,(function*(){return yield T.d5.syncState(K,this.self.importScripts)}))}_getAvailableImages(H){let K=this.availableImages[H];return K||(K=[]),K}_getLayerIndex(H){let K=this.layerIndexes[H];return K||(K=this.layerIndexes[H]=new c),K}_getWorkerSource(H,K,U){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][K]||(this.workerSources[H][K]={}),!this.workerSources[H][K][U]){const he={sendAsync:(ve,Ve)=>(ve.targetMapId=H,this.actor.sendAsync(ve,Ve))};switch(K){case"vector":this.workerSources[H][K][U]=new pe(he,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][K][U]=new Gi(he,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][K][U]=new this.externalWorkerSourceTypes[K](he,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][K][U]}_getDEMWorkerSource(H,K){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][K]||(this.demWorkerSources[H][K]=new _e),this.demWorkerSources[H][K]}}return T.i(self)&&(self.worker=new Ls(self)),Ls})),k("index",["exports","./shared"],(function(T,c){var O="5.18.0";function F(){var x=new c.A(4);return c.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}let re,se,ue;const ae={frame(x,t,a,u){const p=u||window,b=p.requestAnimationFrame((E=>{j(),t(E)})),{unsubscribe:j}=c.s(x.signal,"abort",(()=>{j(),p.cancelAnimationFrame(b),a(new c.a(x.signal.reason))}),!1)},frameAsync(x,t){return new Promise(((a,u)=>{this.frame(x,a,u,t)}))},getImageData(x,t=0){return this.getImageCanvasContext(x).getImageData(-t,-t,x.width+2*t,x.height+2*t)},getImageCanvasContext(x){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=x.width,t.height=x.height,a.drawImage(x,0,0,x.width,x.height),a},resolveURL:x=>(re||(re=document.createElement("a")),re.href=x,re.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ue!==void 0?ue:!!matchMedia&&(se==null&&(se=matchMedia("(prefers-reduced-motion: reduce)")),se.matches)},set prefersReducedMotion(x){ue=x}},Q=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(x){this._frozenAt=x}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Y(){return Q.getCurrentTime()}class G{static testProp(t){if(!G.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in G.docStyle)return t[a];return t[0]}static create(t,a,u){const p=window.document.createElement(t);return a!==void 0&&(p.className=a),u&&u.appendChild(p),p}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){G.docStyle&&G.selectProp&&(G.userSelect=G.docStyle[G.selectProp],G.docStyle[G.selectProp]="none")}static enableDrag(){G.docStyle&&G.selectProp&&(G.docStyle[G.selectProp]=G.userSelect)}static setTransform(t,a){t.style[G.transformProp]=a}static addEventListener(t,a,u,p={}){t.addEventListener(a,u,"passive"in p?p:p.capture)}static removeEventListener(t,a,u,p={}){t.removeEventListener(a,u,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",G.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",G.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",G.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,u){const p=a.boundingClientRect;return new c.P((u.clientX-p.left)/a.x-t.clientLeft,(u.clientY-p.top)/a.y-t.clientTop)}static mousePos(t,a){const u=G.getScale(t);return G.getPoint(t,u,a)}static touchPos(t,a){const u=[],p=G.getScale(t);for(let b=0;b<a.length;b++)u.push(G.getPoint(t,p,a[b]));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),u=a.querySelectorAll("script");for(const p of u)p.remove();return G.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const u=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!u.includes("javascript:")&&!u.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const u of a)G.removeAttributes(u),G.clean(u)}static removeAttributes(t){for(const{name:a,value:u}of t.attributes)G.isPossiblyDangerous(a,u)&&t.removeAttribute(a)}}G.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,G.selectProp=G.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),G.transformProp=G.testProp(["transform","WebkitTransform"]);const pe={supported:!1,testSupport:function(x){!Oe&&Ne&&(Be?xt(x):_e=x)}};let _e,Ne,Oe=!1,Be=!1;function xt(x){const t=x.createTexture();x.bindTexture(x.TEXTURE_2D,t);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,Ne),x.isContextLost())return;pe.supported=!0}catch{}x.deleteTexture(t),Oe=!0}var $e;typeof document<"u"&&(Ne=document.createElement("img"),Ne.onload=()=>{_e&&xt(_e),_e=null,Be=!0},Ne.onerror=()=>{Oe=!0,_e=null},Ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(x){let t,a,u,p;x.resetRequestQueue=()=>{t=[],a=0,u=0,p={}},x.addThrottleControl=M=>{const z=u++;return p[z]=M,z},x.removeThrottleControl=M=>{delete p[M],j()},x.getImage=(M,z,L=!0)=>new Promise(((q,V)=>{pe.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),c.e(M,{type:"image"}),t.push({abortController:z,requestParameters:M,supportImageRefresh:L,state:"queued",onError:J=>{V(J)},onSuccess:J=>{q(J)}}),j()}));const b=M=>c._(this,void 0,void 0,(function*(){M.state="running";const{requestParameters:z,supportImageRefresh:L,onError:q,onSuccess:V,abortController:J}=M,ie=L===!1&&!c.i(self)&&!c.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce(((ge,Se)=>ge&&Se==="accept"),!0));a++;const fe=ie?E(z,J):c.m(z,J);try{const ge=yield fe;delete M.abortController,M.state="completed",ge.data instanceof HTMLImageElement||c.b(ge.data)?V(ge):ge.data&&V({data:yield(ye=ge.data,typeof createImageBitmap=="function"?c.f(ye):c.h(ye)),cacheControl:ge.cacheControl,expires:ge.expires})}catch(ge){delete M.abortController,q(ge)}finally{a--,j()}var ye})),j=()=>{const M=(()=>{for(const z of Object.keys(p))if(p[z]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=a;z<M&&t.length>0;z++){const L=t.shift();L.abortController.signal.aborted?z--:b(L)}},E=(M,z)=>new Promise(((L,q)=>{const V=new Image,J=M.url,ie=M.credentials;ie&&ie==="include"?V.crossOrigin="use-credentials":(ie&&ie==="same-origin"||!c.d(J))&&(V.crossOrigin="anonymous"),z.signal.addEventListener("abort",(()=>{V.src="",q(new c.a(z.signal.reason))})),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,L({data:V})},V.onerror=()=>{V.onerror=V.onload=null,z.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=J}))})($e||($e={})),$e.resetRequestQueue();class de{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Ae(x){const t=[];if(typeof x=="string")t.push({id:"default",url:x});else if(x&&x.length>0){const a=[];for(const{id:u,url:p}of x){const b=`${u}${p}`;a.indexOf(b)===-1&&(a.push(b),t.push({id:u,url:p}))}}return t}function Ye(x,t,a){try{const u=new URL(x);return u.pathname+=`${t}${a}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${x}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function _t(x){const{userImage:t}=x;return!!(t&&t.render&&t.render())&&(x.data.replace(new Uint8Array(t.data.buffer)),!0)}class Et extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:u}of this.requestors)u(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const u=a.spriteData;a.data=new c.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let u=!0;const p=a.data||a.spriteData;return this._validateStretch(a.stretchX,p&&p.width)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,p&&p.height)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,a){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||a<p[1])return!1;u=p[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const u=a.spriteData,p=u&&u.width||a.data.width,b=u&&u.height||a.data.height;return!(t[0]<0||p<t[0]||t[1]<0||b<t[1]||t[2]<0||p<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,u=!0){const p=this.getImage(t);if(u&&(p.data.width!==a.data.width||p.data.height!==a.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=p.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,u)=>{let p=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(p=!1);this.isLoaded()||p?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const u of t){let p=this.getImage(u);p||(this.fire(new c.l("styleimagemissing",{id:u})),p=this.getImage(u)),p?a[u]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:c.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],u=this.getImage(t);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},b=new c.I(p,u);this.patterns[t]={bin:p,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:a,h:u}=c.p(t),p=this.atlasImage;p.resize({width:a||1,height:u||1});for(const b in this.patterns){const{bin:j}=this.patterns[b],E=j.x+1,M=j.y+1,z=this.getImage(b).data,L=z.width,q=z.height;c.R.copy(z,p,{x:0,y:0},{x:E,y:M},{width:L,height:q}),c.R.copy(z,p,{x:0,y:q-1},{x:E,y:M-1},{width:L,height:1}),c.R.copy(z,p,{x:0,y:0},{x:E,y:M+q},{width:L,height:1}),c.R.copy(z,p,{x:L-1,y:0},{x:E-1,y:M},{width:1,height:q}),c.R.copy(z,p,{x:0,y:0},{x:E+L,y:M},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.getImage(a);u||c.w(`Image with ID: "${a}" was not found`),_t(u)&&this.updateImage(a,u)}}cloneImages(){const t={};for(const a in this.images){const u=this.images[a];t[a]=Object.assign(Object.assign({},u),{data:u.data?u.data.clone():null})}return t}}const zt=1e20;function ht(x,t,a,u,p,b,j,E,M){for(let z=t;z<t+u;z++)Qe(x,a*b+z,b,p,j,E,M);for(let z=a;z<a+p;z++)Qe(x,z*b+t,1,u,j,E,M)}function Qe(x,t,a,u,p,b,j){b[0]=0,j[0]=-zt,j[1]=zt,p[0]=x[t];for(let E=1,M=0,z=0;E<u;E++){p[E]=x[t+E*a];const L=E*E;do{const q=b[M];z=(p[E]-p[q]+L-q*q)/(E-q)/2}while(z<=j[M]&&--M>-1);M++,b[M]=E,j[M]=z,j[M+1]=zt}for(let E=0,M=0;E<u;E++){for(;j[M+1]<E;)M++;const z=b[M],L=E-z;x[t+E*a]=p[z]+L*L}}const Ce=c.v.layout_symbol["text-font"].default.join(",");class We{constructor(t,a,u){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=u}setURL(t){this.url=t}getGlyphs(t){return c._(this,void 0,void 0,(function*(){const a=[];for(const b in t)for(const j of t[b])a.push(this._getAndCacheGlyphsPromise(b,j));const u=yield Promise.all(a),p={};for(const{stack:b,id:j,glyph:E}of u)p[b]||(p[b]={}),p[b][j]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return p}))}_getAndCacheGlyphsPromise(t,a){return c._(this,void 0,void 0,(function*(){let u=this.entries[t];u||(u=this.entries[t]={glyphs:{},requests:{},ranges:{}});let p=u.glyphs[a];return p!==void 0?{stack:t,id:a,glyph:p}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(p=u.glyphs[a]=this._drawGlyph(u,t,a),{stack:t,id:a,glyph:p}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return c._(this,void 0,void 0,(function*(){const u=this.entries[t],p=Math.floor(a/256);if(u.ranges[p])return{stack:t,id:a,glyph:null};if(!u.requests[p]){const b=We.loadGlyphRange(t,p,this.url,this.requestManager);u.requests[p]=b}try{const b=yield u.requests[p];for(const j in b)u.glyphs[+j]=b[+j];return u.ranges[p]=!0,{stack:t,id:a,glyph:b[a]||null}}catch(b){const j=u.glyphs[a]=this._drawGlyph(u,t,a);return this._warnOnMissingGlyphRange(j,p,a,b),{stack:t,id:a,glyph:j}}}))}_warnOnMissingGlyphRange(t,a,u,p){const b=256*a,j=b+255,E=u.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${a}, ${b}-${j}. Rendering codepoint U+${E} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&c.q(t)}_drawGlyph(t,a,u){const p=a===Ce&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(u),b=p?"ideographTinySDF":"tinySDF";t[b]||(t[b]=this._createTinySDF(p?this.localIdeographFontFamily:a));const j=t[b].draw(String.fromCodePoint(u)),E=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(u));return{id:u,bitmap:new c.r({width:j.width||60,height:j.height||60},j.data),metrics:{width:E?0:j.glyphWidth/2||24,height:j.glyphHeight/2||24,left:j.glyphLeft/2+.5||0,top:j.glyphTop/2-27.5||-8,advance:E?0:j.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const u=a.map((p=>/[-\w]+/.test(p)?p:`'${CSS.escape(p)}'`)).join(",");return new We.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let u;for(const[p,b]of Object.entries(a))new RegExp(`\\b${p}\\b`,"i").test(t)&&(u=`${b}`);return u}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}We.loadGlyphRange=function(x,t,a,u){return c._(this,void 0,void 0,(function*(){const p=256*t,b=p+255,j=u.transformRequest(a.replace("{fontstack}",x).replace("{range}",`${p}-${b}`),"Glyphs"),E=yield c.n(j,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${t}, ${p}-${b}`);const M={};for(const z of c.o(E.data))M[z.id]=z;return M}))},We.TinySDF=class{constructor({fontSize:x=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:b="normal",fontStyle:j="normal",lang:E=null}={}){this.buffer=t,this.cutoff=u,this.radius=a,this.lang=E;const M=this.size=x+4*t,z=this._createCanvas(M),L=this.ctx=z.getContext("2d",{willReadFrequently:!0});L.font=`${j} ${b} ${x}px ${p}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(x){const t=document.createElement("canvas");return t.width=t.height=x,t}draw(x){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:b}=this.ctx.measureText(x),j=Math.ceil(a),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-p))),M=Math.min(this.size-this.buffer,j+Math.ceil(u)),z=E+2*this.buffer,L=M+2*this.buffer,q=Math.max(z*L,0),V=new Uint8ClampedArray(q),J={data:V,width:z,height:L,glyphWidth:E,glyphHeight:M,glyphTop:j,glyphLeft:0,glyphAdvance:t};if(E===0||M===0)return J;const{ctx:ie,buffer:fe,gridInner:ye,gridOuter:ge}=this;this.lang&&(ie.lang=this.lang),ie.clearRect(fe,fe,E,M),ie.fillText(x,fe,fe+j);const Se=ie.getImageData(fe,fe,E,M);ge.fill(zt,0,q),ye.fill(0,0,q);for(let Me=0;Me<M;Me++)for(let we=0;we<E;we++){const ke=Se.data[4*(Me*E+we)+3]/255;if(ke===0)continue;const De=(Me+fe)*z+we+fe;if(ke===1)ge[De]=0,ye[De]=zt;else{const je=.5-ke;ge[De]=je>0?je*je:0,ye[De]=je<0?je*je:0}}ht(ge,0,0,z,L,z,this.f,this.v,this.z),ht(ye,fe,fe,E,M,z,this.f,this.v,this.z);for(let Me=0;Me<q;Me++){const we=Math.sqrt(ge[Me])-Math.sqrt(ye[Me]);V[Me]=Math.round(255-255*(we/this.radius+this.cutoff))}return J}};class dt{constructor(){this.specification=c.u.light.position}possiblyEvaluate(t,a){return c.F(t.expression.evaluate(a))}interpolate(t,a,u){return{x:c.G.number(t.x,a.x,u),y:c.G.number(t.y,a.y,u),z:c.G.number(t.z,a.z,u)}}}let Ze;class Pe extends c.E{constructor(t){super(),Ze=Ze||new c.t({anchor:new c.D(c.u.light.anchor),position:new dt,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(Ze,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(c.y,t,a))for(const u in t){const p=t[u];u.endsWith(c.z)?this._transitionable.setTransition(u.slice(0,-c.z.length),p):this._transitionable.setValue(u,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&c.B(this,t.call(c.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const le=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class Le extends c.E{constructor(t){super(),this._transitionable=new c.x(le,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(t,a={}){if(!this._validate(c.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in t){const p=t[u];u.endsWith(c.z)?this._transitionable.setTransition(u.slice(0,-c.z.length),p):this._transitionable.setValue(u,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u={}){return u?.validate!==!1&&c.B(this,t.call(c.C,c.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class nt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const u=t.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,a)),this.dashEntry[u]}getDashRanges(t,a,u){const p=[];let b=t.length%2==1?-t[t.length-1]*u:0,j=t[0]*u,E=!0;p.push({left:b,right:j,isDash:E,zeroLength:t[0]===0});let M=t[0];for(let z=1;z<t.length;z++){E=!E;const L=t[z];b=M*u,M+=L,j=M*u,p.push({left:b,right:j,isDash:E,zeroLength:L===0})}return p}addRoundDash(t,a,u){const p=a/2;for(let b=-u;b<=u;b++){const j=this.width*(this.nextRow+u+b);let E=0,M=t[E];for(let z=0;z<this.width;z++){z/M.right>1&&(M=t[++E]);const L=Math.abs(z-M.left),q=Math.abs(z-M.right),V=Math.min(L,q);let J;const ie=b/u*(p+1);if(M.isDash){const fe=p-Math.abs(ie);J=Math.sqrt(V*V+fe*fe)}else J=p-Math.sqrt(V*V+ie*ie);this.data[j+z]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const M=t[E],z=t[E+1];M.zeroLength?t.splice(E,1):z&&z.isDash===M.isDash&&(z.left=M.left,t.splice(E,1))}const a=t[0],u=t[t.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const p=this.width*this.nextRow;let b=0,j=t[b];for(let E=0;E<this.width;E++){E/j.right>1&&(j=t[++b]);const M=Math.abs(E-j.left),z=Math.abs(E-j.right),L=Math.min(M,z);this.data[p+E]=Math.max(0,Math.min(255,(j.isDash?L:-L)+128))}}addDash(t,a){const u=a?7:0,p=2*u+1;if(this.nextRow+p>this.height)return c.w("LineAtlas out of space"),null;let b=0;for(let E=0;E<t.length;E++)b+=t[E];if(b!==0){const E=this.width/b,M=this.getDashRanges(t,this.width,E);a?this.addRoundDash(M,E,u):this.addRegularDash(M)}const j={y:this.nextRow+u,height:2*u,width:b};return this.nextRow+=p,this.dirty=!0,j}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const lt="maplibre_preloaded_worker_pool";class Ot{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ot.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[lt]}numActive(){return Object.keys(this.active).length}}const Mt=Math.floor(ae.hardwareConcurrency/2);let mt,Dt;function ys(){return mt||(mt=new Ot),mt}Ot.workerCount=c.K(globalThis)?Math.max(Math.min(Mt,3),1):1;class js{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let p=0;p<u.length;p++){const b=new c.L(u[p],a);b.name=`Worker ${p}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const u=[];for(const p of this.actors)u.push(p.sendAsync({type:t,data:a}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const u of this.actors)u.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function ks(){return Dt||(Dt=new js(ys(),c.M),Dt.registerMessageHandler("GR",((x,t,a)=>c.m(t,a)))),Dt}function Es(x,t){const a=c.N();return c.O(a,a,[1,1,0]),c.Q(a,a,[.5*x.width,.5*x.height,1]),x.calculatePosMatrix?c.S(a,a,x.calculatePosMatrix(t.toUnwrapped())):a}function Rr(x,t,a,u,p,b,j){var E;const M=(function(V,J,ie){if(V)for(const fe of V){const ye=J[fe];if(ye&&ye.source===ie&&ye.type==="fill-extrusion")return!0}else for(const fe in J){const ye=J[fe];if(ye.source===ie&&ye.type==="fill-extrusion")return!0}return!1})((E=p?.layers)!==null&&E!==void 0?E:null,t,x.id),z=b.maxPitchScaleFactor(),L=x.tilesIn(u,z,M);L.sort(us);const q=[];for(const V of L)q.push({wrappedTileID:V.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(t,a,x.getState(),V.queryGeometry,V.cameraQueryGeometry,V.scale,p,b,z,Es(b,V.tileID),j?(J,ie)=>j(V.tileID,J,ie):void 0)});return(function(V,J){for(const ie in V)for(const fe of V[ie])xs(fe,J);return V})((function(V){const J={},ie={};for(const fe of V){const ye=fe.queryResults,ge=fe.wrappedTileID,Se=ie[ge]=ie[ge]||{};for(const Me in ye){const we=ye[Me],ke=Se[Me]=Se[Me]||{},De=J[Me]=J[Me]||[];for(const je of we)ke[je.featureIndex]||(ke[je.featureIndex]=!0,De.push(je))}}return J})(q),x)}function us(x,t){const a=x.tileID,u=t.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function xs(x,t){const a=x.feature,u=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=u}function Is(x,t,a,u){return c._(this,void 0,void 0,(function*(){let p=x;if(x.url?p=(yield c.j(t.transformRequest(x.url,"Source"),a)).data:yield ae.frameAsync(a,u),!p)return null;const b=c.U(c.e(p,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(b.vectorLayerIds=p.vector_layers.map((j=>j.id))),b}))}class Os{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}extend(t){const a=this._sw,u=this._ne;let p,b;if(t instanceof c.V)p=t,b=t;else{if(!(t instanceof Os))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Os.convert(t)):this.extend(c.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.V.convert(t)):this;if(p=t._sw,b=t._ne,!p||!b)return this}return a||u?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new c.V(p.lng,p.lat),this._ne=new c.V(b.lng,b.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:u}=c.V.convert(t);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}intersects(t){if(!((t=Os.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),u=Math.abs(t.getEast()-t.getWest());if(a>=360||u>=360)return!0;const p=c.W(this.getWest(),-180,180),b=c.W(this.getEast(),-180,180),j=c.W(t.getWest(),-180,180),E=c.W(t.getEast(),-180,180),M=p>b,z=j>E;return!(!M||!z)||(M?E>=p||j<=b:z?b>=j||p<=E:j<=b&&E>=p)}static convert(t){return t instanceof Os?t:t&&new Os(t)}static fromLngLat(t,a=0){const u=360*a/40075017,p=u/Math.cos(Math.PI/180*t.lat);return new Os(new c.V(t.lng-p,t.lat-u),new c.V(t.lng+p,t.lat+u))}adjustAntiMeridian(){const t=new c.V(this._sw.lng,this._sw.lat),a=new c.V(this._ne.lng,this._ne.lat);return new Os(t,t.lng>a.lng?new c.V(a.lng+360,a.lat):a)}}class ar{constructor(t,a,u){this.bounds=Os.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),u=Math.floor(c.Y(this.bounds.getWest())*a),p=Math.floor(c.X(this.bounds.getNorth())*a),b=Math.ceil(c.Y(this.bounds.getEast())*a),j=Math.ceil(c.X(this.bounds.getSouth())*a);return t.x>=u&&t.x<b&&t.y>=p&&t.y<j}}class vi extends c.E{constructor(t,a,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Is(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(c.e(this,t),t.bounds&&(this.tileBounds=new ar(t.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,c.Z(t)||this.fire(new c.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};u.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((b,j)=>{t.reloadPromise={resolve:b,reject:j}}))}else t.actor=this.dispatcher.getActor(),p="LT";t.abortController=new AbortController;try{const b=yield t.actor.sendAsync({type:p,data:u},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,b)}catch(b){if(delete t.abortController,t.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,u=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(u,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const u=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(u.resolve).catch(u.reject)}}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class wt extends c.E{constructor(t,a,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},a),c.e(this,c.U(a,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Is(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,a&&(c.e(this,a),a.bounds&&(this.tileBounds=new ar(a.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,c.Z(a)||this.fire(new c.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const u=yield $e.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const p=this.map.painter.context,b=p.gl,j=u.data;t.texture=this.map.painter.getTileTexture(j.width),t.texture?t.texture.update(j,{useMipmap:!0}):(t.texture=new c.T(p,j,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class qs extends wt{constructor(t,a,u,p){super(t,a,u,p),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const p=yield $e.getImage(u,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){const b=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const j=c.b(b)&&c.$()?b:yield this.readImageNow(b),E={type:this.type,uid:t.uid,source:this.id,rawImageData:j,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const M=yield t.actor.sendAsync({type:"LDT",data:E});t.dem=M,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}}))}readImageNow(t){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.a0()){const a=t.width+2,u=t.height+2;try{return new c.R({width:a,height:u},yield c.a1(t,-1,-1,a,u))}catch{}}return ae.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,u=Math.pow(2,a.z),p=(a.x-1+u)%u,b=a.x===0?t.wrap-1:t.wrap,j=(a.x+1+u)%u,E=a.x+1===u?t.wrap+1:t.wrap,M={};return M[new c.a2(t.overscaledZ,b,a.z,p,a.y).key]={backfilled:!1},M[new c.a2(t.overscaledZ,E,a.z,j,a.y).key]={backfilled:!1},a.y>0&&(M[new c.a2(t.overscaledZ,b,a.z,p,a.y-1).key]={backfilled:!1},M[new c.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},M[new c.a2(t.overscaledZ,E,a.z,j,a.y-1).key]={backfilled:!1}),a.y+1<u&&(M[new c.a2(t.overscaledZ,b,a.z,p,a.y+1).key]={backfilled:!1},M[new c.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},M[new c.a2(t.overscaledZ,E,a.z,j,a.y+1).key]={backfilled:!1}),M}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function yr(x){return x.type==="GeometryCollection"?x.geometries.map((t=>t.coordinates)).flat(1/0):x.coordinates.flat(1/0)}function Ha(x){const t=new Os;let a;switch(x.type){case"FeatureCollection":a=x.features.map((u=>yr(u.geometry))).flat(1/0);break;case"Feature":a=yr(x.geometry);break;default:a=yr(x)}if(a.length==0)return t;for(let u=0;u<a.length-1;u+=2)t.extend([a[u],a[u+1]]);return t}class Ms extends c.E{constructor(t,a,u,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=u.getActor(),this.setEventedParent(p),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=c.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(c.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const u=this._updateWorkerData();return a?u:this}updateData(t,a){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,t);const u=this._updateWorkerData();return a?u:this}getData(){return c._(this,void 0,void 0,(function*(){const t=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return c._(this,void 0,void 0,(function*(){return Ha(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:u}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,u=this._getLoadGeoJSONParameters(t,a);t!==void 0?this._pendingWorkerUpdate.data=void 0:a&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(u)}))}_getLoadGeoJSONParameters(t,a){const u=c.e({type:this.type},this.workerOptions);return typeof t=="string"?(u.request=this.map._requestManager.transformRequest(ae.resolveURL(t),"Source"),u.request.collectResourceTiming=this._collectResourceTiming,u):t!==void 0?(u.data=t,u):(a&&(u.dataDiff=a),u)}_dispatchWorkerUpdate(t){return c._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:t});if(this._isUpdatingWorker=!1,this._removed||a.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));a.data&&(this._data={geojson:a.data});const u=this._applyDiffToSource(t.dataDiff),p=this._getShouldReloadTileOptions(u),b={dataType:"source"};this._applyResourceTiming(b,a),this.fire(new c.l("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},b),{sourceDataType:"content",shouldReloadTileOptions:p})))}catch(a){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(a))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(t,a){var u;if(!this._collectResourceTiming)return;const p=(u=a.resourceTiming)===null||u===void 0?void 0:u[this.id];if(!p)return;const b=p.slice(0);b?.length&&c.e(t,{resourceTiming:b})}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const p=c.a7(this._data.geojson,a);if(!p)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:p}}if(!this._data.updateable)return;const u=c.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:u}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>Ha(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:u,extent:p}=this.workerOptions.geojsonVtOptions,b=(function({x:j,y:E,z:M},z=0){const L=c.a3((j-z)/Math.pow(2,M)),q=c.a4((E+1+z)/Math.pow(2,M)),V=c.a3((j+1+z)/Math.pow(2,M)),J=c.a4((E-z)/Math.pow(2,M));return new Os([L,q],[V,J])})(t.tileID.canonical,u/p);for(const j of a)if(b.intersects(j))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const p=yield this.actor.sendAsync({type:a,data:u},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(p,this.map.painter,a==="RT")}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class oi extends c.E{constructor(t,a,u,p){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=a}load(t){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield $e.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,c.Z(a)||this.fire(new c.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(c.a9.fromLngLat);var u;return this.tileID=(function(p){const b=c.aa.fromPoints(p),j=b.width(),E=b.height(),M=Math.max(j,E),z=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),L=Math.pow(2,z);return new c.ac(z,Math.floor((b.minX+b.maxX)/2*L),Math.floor((b.minY+b.maxY)/2*L))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new c.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,u=!0)}u&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:u,maxX:p,maxY:b}=c.aa.fromPoints(t),j={};for(let E=0;E<=c.ab;E++){const M=Math.pow(2,E),z=Math.floor(a*M),L=Math.floor(u*M),q=Math.floor(p*M),V=Math.floor(b*M),J=(z%M+M)%M,ie=q%M,fe=Math.floor(z/M),ye=Math.floor(q/M);j[E]={minWrap:fe,maxWrap:ye,minTileXWrapped:J,maxTileXWrapped:ie,minTileY:L,maxTileY:V}}return j}}class Fr extends oi{constructor(t,a,u,p){super(t,a,u,p),this.roundZoom=!0,this.type="video",this.options=a}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield c.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new c.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,u=!0)}u&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Oi extends oi{constructor(t,a,u,p){super(t,a,u,p),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((b=>!Array.isArray(b)||b.length!==2||b.some((j=>typeof j!="number"))))||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new c.k(new c.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,u=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(a,this.canvas,u.RGBA,{premultiply:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const b in this.tiles){const j=this.tiles[b];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture,p=!0)}p&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Gi={},Fs=x=>{switch(x){case"geojson":return Ms;case"image":return oi;case"raster":return wt;case"raster-dem":return qs;case"vector":return vi;case"video":return Fr;case"canvas":return Oi}return Gi[x]},Ls="RTLPluginLoaded";class Fe extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ks()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return c._(this,arguments,void 0,(function*(a,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ae.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(Ls))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let H=null;function K(){return H||(H=new Fe),H}var U,he;(function(x){x[x.Base=0]="Base",x[x.Parent=1]="Parent"})(U||(U={})),(function(x){x[x.Departing=0]="Departing",x[x.Incoming=1]="Incoming"})(he||(he={}));class ve{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=c.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttFingerprint={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:u,fadeEndTime:p}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=u,this.fadeEndTime=p}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Y(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(p,b){const j={};if(!b)return j;for(const E of p){const M=E.layerIds.map((z=>b.getLayer(z))).filter(Boolean);if(M.length!==0){E.layers=M,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map((z=>M.filter((L=>L.id===z))[0])));for(const z of M)j[z.id]=E}}return j})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const b=this.buckets[p];if(b instanceof c.ah){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const b=this.buckets[p];if(b instanceof c.ah&&b.hasRTLText){this.hasRTLText=!0,K().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const b=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(p).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,u,p,b,j,E,M,z,L,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:b,scale:j,tileSize:this.tileSize,pixelPosMatrix:L,transform:M,params:E,queryPadding:this.queryPadding*z,getElevation:q},t,a,u):{}}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),b=a&&a.sourceLayer?a.sourceLayer:"",j=p[c.ai]||p[b];if(!j)return;const E=c.aj(a?.filter,a?.globalState),{z:M,x:z,y:L}=this.tileID.canonical,q={z:M,x:z,y:L};for(let V=0;V<j.length;V++){const J=j.feature(V);if(E.needGeometry){const ye=c.ak(J,!0);if(!E.filter(new c.H(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!E.filter(new c.H(this.tileID.overscaledZ),J))continue;const ie=u.getId(J,b),fe=new c.al(J,M,z,L,ie);fe.tile=q,t.push(fe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=c.am(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const b=this.expirationTime-a;b?this.expirationTime=u+Math.max(b,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!a.style.hasLayer(p))continue;const b=this.buckets[p],j=b.layers[0].sourceLayer||c.ai,E=u[j],M=t[j];if(!E||!M||Object.keys(M).length===0)continue;b.update(M,E,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const z=a&&a.style&&a.style.getLayer(p);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Y()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=Y()+t}setDependencies(t,a){const u={};for(const p of a)u[p]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const p=this.dependencies[u];if(p){for(const b of a)if(p[b])return!0}}return!1}}class Ve{constructor(){this.state={},this.stateChanges={},this.deletedStates={},this.revision=0}updateState(t,a,u){const p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},c.e(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==p&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const b in this.state[t][p])u[b]||(this.deletedStates[t][p][b]=null)}else for(const b in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][b]===null&&delete this.deletedStates[t][p][b]}removeFeatureState(t,a,u){if(this.deletedStates[t]===null)return;const p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,a){const u=String(a),p=c.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][a];if(b===null)return{};for(const j in b)delete p[j]}return p}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const b={};for(const j in this.stateChanges[p])this.state[p][j]||(this.state[p][j]={}),c.e(this.state[p][j],this.stateChanges[p][j]),b[j]=this.state[p][j];u[p]=b}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const b={};if(this.deletedStates[p]===null)for(const j in this.state[p])b[j]={},this.state[p][j]={};else for(const j in this.deletedStates[p]){if(this.deletedStates[p][j]===null)this.state[p][j]={};else for(const E of Object.keys(this.deletedStates[p][j]))delete this.state[p][j][E];b[j]=this.state[p][j]}u[p]=u[p]||{},c.e(u[p],b)}this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0&&(this.revision++,t.setFeatureState(u,a))}}const He=89.25;function Ue(x,t){const a=c.an(t.lat,-c.ao,c.ao);return new c.P(c.Y(t.lng)*x,c.X(a)*x)}function Re(x,t){return new c.a9(t.x/x,t.y/x).toLngLat()}function ot(x){return x.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-x.pitch)),Math.tan(c.ap(He-x.pitch)))}function rt(x,t){const a=x.canonical,u=t/c.aq(a.z),p=a.x+Math.pow(2,a.z)*x.wrap,b=c.ar(new Float64Array(16));return c.O(b,b,[p*u,a.y*u,0]),c.Q(b,b,[u/c.a5,u/c.a5,1]),b}function Te(x,t,a,u,p){const b=c.a9.fromLngLat(x,t),j=p*c.as(1,x.lat),{x:E,y:M,z}=Vt(a,u);return new c.a9(b.x+j*-E,b.y+j*-M,b.z+j*-z)}function Vt(x,t){const a=c.ap(x),u=c.ap(t),p=Math.cos(-a),b=Math.sin(a);return{x:b*Math.sin(u),y:-b*Math.cos(u),z:p}}function as(x,t,a){const u=t.intersectsFrustum(x);if(!a||u===0)return u;const p=t.intersectsPlane(a);return p===0?0:u===2&&p===2?2:1}function Kt(x,t,a){let u=0;const p=(a-t)/10;for(let b=0;b<10;b++)u+=p*Math.pow(Math.cos(t+(b+.5)/10*(a-t)),x);return u}function ss(x,t){return function(a,u,p,b,j){const E=2*((x-1)/c.at(Math.cos(c.ap(He-j))/Math.cos(c.ap(He)))-1),M=Math.acos(p/b),z=2*Kt(E-1,0,c.ap(j/2)),L=Math.min(c.ap(He),M+c.ap(j/2)),q=Kt(E-1,Math.min(L,M-c.ap(j/2)),L),V=Math.atan(u/p),J=Math.hypot(u,p);let ie=a;return ie+=c.at(b/J/Math.max(.5,Math.cos(c.ap(j/2)))),ie+=E*c.at(Math.cos(V))/2,ie-=c.at(Math.max(1,q/z/t))/2,ie}}const Qt=ss(9.314,3);function ls(x,t){const a=(t.roundZoom?Math.round:Math.floor)(x.zoom+c.at(x.tileSize/t.tileSize));return Math.max(0,a)}function xr(x,t){const a=x.getCameraFrustum(),u=x.getClippingPlane(),p=x.screenPointToMercatorCoordinate(x.getCameraPoint()),b=c.a9.fromLngLat(x.center,x.elevation);p.z=b.z+Math.cos(x.pitchInRadians)*x.cameraToCenterDistance/x.worldSize;const j=x.getCoveringTilesDetailsProvider(),E=j.allowVariableZoom(x,t),M=ls(x,t),z=t.minzoom||0,L=t.maxzoom!==void 0?t.maxzoom:x.maxZoom,q=Math.min(Math.max(0,M),L),V=Math.pow(2,q),J=[V*p.x,V*p.y,0],ie=[V*b.x,V*b.y,0],fe=Math.hypot(b.x-p.x,b.y-p.y),ye=Math.abs(b.z-p.z),ge=Math.hypot(fe,ye),Se=ke=>({zoom:0,x:0,y:0,wrap:ke,fullyVisible:!1}),Me=[],we=[];if(x.renderWorldCopies&&j.allowWorldCopies())for(let ke=1;ke<=3;ke++)Me.push(Se(-ke)),Me.push(Se(ke));for(Me.push(Se(0));Me.length>0;){const ke=Me.pop(),De=ke.x,je=ke.y;let qe=ke.fullyVisible;const st={x:De,y:je,z:ke.zoom},Ke=j.getTileBoundingVolume(st,ke.wrap,x.elevation,t);if(!qe){const It=as(a,Ke,u);if(It===0)continue;qe=It===2}const et=j.distanceToTile2d(p.x,p.y,st,Ke);let tt=M;E&&(tt=(t.calculateTileZoom||Qt)(x.zoom+c.at(x.tileSize/t.tileSize),et,ye,ge,x.fov)),tt=(t.roundZoom?Math.round:Math.floor)(tt),tt=Math.max(0,tt);const Rt=Math.min(tt,L);if(ke.wrap=j.getWrap(b,st,ke.wrap),ke.zoom>=Rt){if(ke.zoom<z)continue;const It=q-ke.zoom,St=J[0]-.5-(De<<It),Bt=J[1]-.5-(je<<It),fs=t.reparseOverscaled?Math.max(ke.zoom,tt):ke.zoom;we.push({tileID:new c.a2(ke.zoom===L?fs:ke.zoom,ke.wrap,ke.zoom,De,je),distanceSq:c.au([ie[0]-.5-De,ie[1]-.5-je]),tileDistanceToCamera:Math.sqrt(St*St+Bt*Bt)})}else for(let It=0;It<4;It++)Me.push({zoom:ke.zoom+1,x:(De<<1)+It%2,y:(je<<1)+(It>>1),wrap:ke.wrap,fullyVisible:qe})}return we.sort(((ke,De)=>ke.distanceSq-De.distanceSq)).map((ke=>ke.tileID))}const Sr=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function Gs(x){return x==="raster"||x==="image"||x==="video"}function vr(x,t,a,u,p,b,j){if(!t.hasData())return!1;const{tileID:E,fadingRole:M,fadingDirection:z,fadingParentID:L}=t;if(M===U.Base&&z===he.Incoming&&L)return a[L.key]=L,!0;const q=Math.max(E.overscaledZ-p,b);for(let V=E.overscaledZ-1;V>=q;V--){const J=E.scaledTo(V),ie=x.getLoadedTile(J);if(ie)return t.setCrossFadeLogic({fadingRole:U.Base,fadingDirection:he.Incoming,fadingParentID:ie.tileID,fadeEndTime:u+j}),ie.setCrossFadeLogic({fadingRole:U.Parent,fadingDirection:he.Departing,fadeEndTime:u+j}),a[J.key]=J,!0}return!1}function Rs(x,t,a,u,p,b){if(!t.hasData())return!1;const j=t.tileID.children(p);let E=Nt(x,t,j,a,u,p,b);if(E)return!0;for(const M of j)Nt(x,t,M.children(p),a,u,p,b)&&(E=!0);return E}function Nt(x,t,a,u,p,b,j){if(a[0].overscaledZ>=b)return!1;let E=!1;for(const M of a){const z=x.getLoadedTile(M);if(!z)continue;const{fadingRole:L,fadingDirection:q,fadingParentID:V}=z;L===U.Base&&q===he.Departing&&V||(z.setCrossFadeLogic({fadingRole:U.Base,fadingDirection:he.Departing,fadingParentID:t.tileID,fadeEndTime:p+j}),t.setCrossFadeLogic({fadingRole:U.Parent,fadingDirection:he.Incoming,fadeEndTime:p+j})),u[M.key]=M,E=!0}return E}function Ps(x,t,a,u){const p=x.tileID;return!!x.selfFading||!x.hasData()&&!!t.has(p)&&(x.setSelfFadeLogic(a+u),!0)}function Ks(x,t){var a;x.needsHillshadePrepare=!0,x.needsTerrainPrepare=!0;let u=t.tileID.canonical.x-x.tileID.canonical.x;const p=t.tileID.canonical.y-x.tileID.canonical.y,b=Math.pow(2,x.tileID.canonical.z),j=t.tileID.key;u===0&&p===0||Math.abs(p)>1||(Math.abs(u)>1&&(Math.abs(u+b)===1?u+=b:Math.abs(u-b)===1&&(u-=b)),t.dem&&x.dem&&(x.dem.backfillBorder(t.dem,u,p),!((a=x.neighboringTiles)===null||a===void 0)&&a[j]&&(x.neighboringTiles[j].backfilled=!0)))}class li{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+t),a[p.tileID.key]=p}this._tiles=a}setFeatureState(t,a){for(const u in this._tiles)this._tiles[u].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(c.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var u;return(u=this.getTileById(t))===null||u===void 0?void 0:u.isRenderable(a)}getRenderableIds(t=0,a){const u=[];for(const p of this.getAllIds())this.isIdRenderable(p,a)&&u.push(this.getTileById(p));return a?u.sort(((p,b)=>{const j=p.tileID,E=b.tileID,M=new c.P(j.canonical.x,j.canonical.y)._rotate(-t),z=new c.P(E.canonical.x,E.canonical.y)._rotate(-t);return j.overscaledZ-E.overscaledZ||z.y-M.y||z.x-M.x})).map((p=>p.tileID.key)):u.map((p=>p.tileID)).sort(c.aw).map((p=>p.key))}}class Hs extends c.E{constructor(t,a,u){super(),this.id=t,this.dispatcher=u,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,b,j,E)=>{const M=new(Fs(b.type))(p,b,j,E);if(M.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${M.id}`);return M})(t,a,u,this),this._inViewTiles=new li,this._outOfViewCache=new c.ax(0,(p=>this._unloadTile(p))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Ve,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new li}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,u){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,u)}catch(p){t.state="errored",p.status!==404?this._source.fire(new c.k(p,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new c.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const u=this.getLoadedTile(t.scaledTo(a));if(u)return this._inViewTiles.isIdRenderable(u.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const u of this._inViewTiles.getAllIds()){const p=this._inViewTiles.getTileById(u);a&&!this._source.shouldReloadTile(p,a)||(t?this._reloadTile(u,"expired"):p.state!=="errored"&&this._reloadTile(u,"reloading"))}}}_reloadTile(t,a){return c._(this,void 0,void 0,(function*(){const u=this._inViewTiles.getTileById(t);u&&(u.state!=="loading"&&(u.state=a),yield this._loadTile(u,t,a))}))}_tileLoaded(t,a,u){t.timeAdded=Y(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(p,b){var j,E;const M=b.getRenderableIds();for(const z of M){if(!p.neighboringTiles||!p.neighboringTiles[z])continue;const L=b.getTileById(z);p.neighboringTiles[z].backfilled||Ks(p,L),!((E=(j=L.neighboringTiles)===null||j===void 0?void 0:j[p.tileID.key])===null||E===void 0)&&E.backfilled||Ks(L,p)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const u=this._getLoadedDescendents(a),p=new Set;for(const b of a){const j=u[b.key];if(!j?.length){p.add(b);continue}const E=b.overscaledZ+Hs.maxOverzooming,M=j.filter((q=>q.tileID.overscaledZ<=E));if(!M.length){p.add(b);continue}const z=Math.min(...M.map((q=>q.tileID.overscaledZ))),L=M.filter((q=>q.tileID.overscaledZ===z)).map((q=>q.tileID));for(const q of L)t[q.key]=q;this._areDescendentsComplete(L,z,b.overscaledZ)||p.add(b)}return p}_getLoadedDescendents(t){var a;const u={};for(const p of this._inViewTiles.getAllTiles().filter((b=>b.hasData())))for(const b of t)p.tileID.isChildOf(b)&&(u[a=b.key]||(u[a]=[])).push(p);return u}_areDescendentsComplete(t,a,u){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-u)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(a*u*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(b)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let u;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((M=>new c.a2(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y))):(u=xr(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((M=>this._source.hasTile(M))))):u=[],this.usedForTerrain&&(u=this._addTerrainIdealTiles(u));const p=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=ls(t,this._source),j=this._updateRetainedTiles(u,b),E=Gs(this._source.type);E&&this._rasterFadeDuration>0&&!a&&(function(M,z,L,q,V,J,ie){const fe=Y(),ye=c.av(z);for(const ge of z){const Se=M.getTileById(ge.key);Se.fadingDirection!==he.Departing&&Se.fadeOpacity!==0||Se.resetFadeLogic(),vr(M,Se,L,fe,q,V,ie)||Rs(M,Se,L,fe,J,ie)||Ps(Se,ye,fe,ie)||Se.resetFadeLogic()}})(this._inViewTiles,u,j,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),E?this._cleanUpRasterTiles(j):this._cleanUpVectorTiles(j)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(a);t[a]?u.clearSymbolFadeHold():u.hasSymbolBuckets?u.holdingForSymbolFade()?u.symbolFadeFinished()&&this._removeTile(a):u.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const u of t)if(u.canonical.z>this._source.minzoom){const p=u.scaledTo(u.canonical.z-1);a.push(p);const b=u.scaledTo(Math.max(this._source.minzoom,Math.min(u.canonical.z,5)));a.push(b)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var u;const p=new Set;for(const z of t)this._addTile(z).hasData()||p.add(z);const b=t.reduce(((z,L)=>(z[L.key]=L,z)),{}),j=this._retainLoadedChildren(b,p),E={},M=Math.max(a-Hs.maxUnderzooming,this._source.minzoom);for(const z of j){let L=this._inViewTiles.getTileById(z.key),q=L?.wasRequested();for(let V=z.overscaledZ-1;V>=M;--V){const J=z.scaledTo(V);if(E[J.key])break;if(E[J.key]=!0,L=this.getTile(J),!L&&q&&(L=this._addTile(J)),L){const ie=L.hasData();if((ie||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||q)&&(b[J.key]=J),q=L.wasRequested(),ie)break}}}return b}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const u=a;return a||(a=new ve(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),u||this._source.fire(new c.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),u))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||u.state=="errored")&&t.some((p=>p.equals(u.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,u){const p=[],b=this.transform;if(!b)return p;const j=b.getCoveringTilesDetailsProvider().allowWorldCopies(),E=u?b.getCameraQueryGeometry(t):t,M=J=>b.screenPointToMercatorCoordinate(J,this.terrain),z=this.transformBbox(t,M,!j),L=this.transformBbox(E,M,!j),q=this.getIds(),V=c.aa.fromPoints(L);for(let J=0;J<q.length;J++){const ie=this._inViewTiles.getTileById(q[J]);if(ie.holdingForSymbolFade())continue;const fe=j?[ie.tileID]:[ie.tileID.unwrapTo(-1),ie.tileID.unwrapTo(0)],ye=Math.pow(2,b.zoom-ie.tileID.overscaledZ),ge=a*ie.queryPadding*c.a5/ie.tileSize/ye;for(const Se of fe){const Me=V.map((we=>Se.getTilePoint(new c.a9(we.x,we.y))));if(Me.expandBy(ge),Me.intersects(Sr)){const we=z.map((De=>Se.getTilePoint(De))),ke=L.map((De=>Se.getTilePoint(De)));p.push({tile:ie,tileID:j?Se:Se.unwrapTo(0),queryGeometry:we,cameraQueryGeometry:ke,scale:ye})}}}return p}transformBbox(t,a,u){let p=t.map(a);if(u){const b=c.aa.fromPoints(t);b.shrinkBy(.001*Math.min(b.width(),b.height()));const j=b.map(a);c.aa.fromPoints(p).covers(j)||(p=p.map((E=>E.x>.5?new c.a9(E.x-1,E.y,E.z):E)))}return p}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((u=>this._inViewTiles.getTileById(u).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!Gs(this._source.type)||!(function(t,a){if(a<=0)return!1;const u=Y();for(const p of t.getAllTiles())if(p.fadeEndTime>=u)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,u){this._state.updateState(t=t||c.ai,a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||c.ai,a,u)}getFeatureState(t,a){return this._state.getState(t=t||c.ai,a)}setDependencies(t,a,u){const p=this._inViewTiles.getTileById(t);p&&p.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(u).hasDependency(t,a)&&this._reloadTile(u,"reloading");this._outOfViewCache.filter((u=>!u.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Hs.maxUnderzooming=10,Hs.maxOverzooming=3;class Ct{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.an(t,0,1);let a=1,u=this._distances[a];const p=t*this.paddedLength+this.padding;for(;u<p&&a<this._distances.length;)u=this._distances[++a];const b=a-1,j=this._distances[b],E=u-j,M=E>0?(p-j)/E:0;return this.points[b].mult(1-M).add(this.points[a].mult(M))}}function is(x,t){let a=!0;return x==="always"||x!=="never"&&t!=="never"||(a=!1),a}class es{constructor(t,a,u){const p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(a/u);for(let j=0;j<this.xCellCount*this.yCellCount;j++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,u,p,b){this._forEachCell(a,u,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(b)}insertCircle(t,a,u,p){this._forEachCell(a-p,u-p,a+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,a,u,p,b,j){this.boxCells[b].push(j)}_insertCircleCell(t,a,u,p,b,j){this.circleCells[b].push(j)}_query(t,a,u,p,b,j,E){if(u<0||t>this.width||p<0||a>this.height)return[];const M=[];if(t<=0&&a<=0&&this.width<=u&&this.height<=p){if(b)return[{key:null,x1:t,y1:a,x2:u,y2:p}];for(let z=0;z<this.boxKeys.length;z++)M.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const L=this.circles[3*z],q=this.circles[3*z+1],V=this.circles[3*z+2];M.push({key:this.circleKeys[z],x1:L-V,y1:q-V,x2:L+V,y2:q+V})}}else this._forEachCell(t,a,u,p,this._queryCell,M,{hitTest:b,overlapMode:j,seenUids:{box:{},circle:{}}},E);return M}query(t,a,u,p){return this._query(t,a,u,p,!1,null)}hitTest(t,a,u,p,b,j){return this._query(t,a,u,p,!0,b,j).length>0}hitTestCircle(t,a,u,p,b){const j=t-u,E=t+u,M=a-u,z=a+u;if(E<0||j>this.width||z<0||M>this.height)return!1;const L=[];return this._forEachCell(j,M,E,z,this._queryCellCircle,L,{hitTest:!0,overlapMode:p,circle:{x:t,y:a,radius:u},seenUids:{box:{},circle:{}}},b),L.length>0}_queryCell(t,a,u,p,b,j,E,M){const{seenUids:z,hitTest:L,overlapMode:q}=E,V=this.boxCells[b];if(V!==null){const ie=this.bboxes;for(const fe of V)if(!z.box[fe]){z.box[fe]=!0;const ye=4*fe,ge=this.boxKeys[fe];if(t<=ie[ye+2]&&a<=ie[ye+3]&&u>=ie[ye+0]&&p>=ie[ye+1]&&(!M||M(ge))&&(!L||!is(q,ge.overlapMode))&&(j.push({key:ge,x1:ie[ye],y1:ie[ye+1],x2:ie[ye+2],y2:ie[ye+3]}),L))return!0}}const J=this.circleCells[b];if(J!==null){const ie=this.circles;for(const fe of J)if(!z.circle[fe]){z.circle[fe]=!0;const ye=3*fe,ge=this.circleKeys[fe];if(this._circleAndRectCollide(ie[ye],ie[ye+1],ie[ye+2],t,a,u,p)&&(!M||M(ge))&&(!L||!is(q,ge.overlapMode))){const Se=ie[ye],Me=ie[ye+1],we=ie[ye+2];if(j.push({key:ge,x1:Se-we,y1:Me-we,x2:Se+we,y2:Me+we}),L)return!0}}}return!1}_queryCellCircle(t,a,u,p,b,j,E,M){const{circle:z,seenUids:L,overlapMode:q}=E,V=this.boxCells[b];if(V!==null){const ie=this.bboxes;for(const fe of V)if(!L.box[fe]){L.box[fe]=!0;const ye=4*fe,ge=this.boxKeys[fe];if(this._circleAndRectCollide(z.x,z.y,z.radius,ie[ye+0],ie[ye+1],ie[ye+2],ie[ye+3])&&(!M||M(ge))&&!is(q,ge.overlapMode))return j.push(!0),!0}}const J=this.circleCells[b];if(J!==null){const ie=this.circles;for(const fe of J)if(!L.circle[fe]){L.circle[fe]=!0;const ye=3*fe,ge=this.circleKeys[fe];if(this._circlesCollide(ie[ye],ie[ye+1],ie[ye+2],z.x,z.y,z.radius)&&(!M||M(ge))&&!is(q,ge.overlapMode))return j.push(!0),!0}}}_forEachCell(t,a,u,p,b,j,E,M){const z=this._convertToXCellCoord(t),L=this._convertToYCellCoord(a),q=this._convertToXCellCoord(u),V=this._convertToYCellCoord(p);for(let J=z;J<=q;J++)for(let ie=L;ie<=V;ie++)if(b.call(this,t,a,u,p,this.xCellCount*ie+J,j,E,M))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,u,p,b,j){const E=p-t,M=b-a,z=u+j;return z*z>E*E+M*M}_circleAndRectCollide(t,a,u,p,b,j,E){const M=(j-p)/2,z=Math.abs(t-(p+M));if(z>M+u)return!1;const L=(E-b)/2,q=Math.abs(a-(b+L));if(q>L+u)return!1;if(z<=M||q<=L)return!0;const V=z-M,J=q-L;return V*V+J*J<=u*u}}function ra(x,t,a){const u=c.N();if(!x){const{vecSouth:q,vecEast:V}=va(t),J=F();J[0]=V[0],J[1]=V[1],J[2]=q[0],J[3]=q[1],p=J,(L=(j=(b=J)[0])*(z=b[3])-(M=b[2])*(E=b[1]))&&(p[0]=z*(L=1/L),p[1]=-E*L,p[2]=-M*L,p[3]=j*L),u[0]=J[0],u[1]=J[1],u[4]=J[2],u[5]=J[3]}var p,b,j,E,M,z,L;return c.Q(u,u,[1/a,1/a,1]),u}function rc(x,t,a,u){if(x){const p=c.N();if(!t){const{vecSouth:b,vecEast:j}=va(a);p[0]=j[0],p[1]=j[1],p[4]=b[0],p[5]=b[1]}return c.Q(p,p,[u,u,1]),p}return a.pixelsToClipSpaceMatrix}function va(x){const t=Math.cos(x.rollInRadians),a=Math.sin(x.rollInRadians),u=Math.cos(x.pitchInRadians),p=Math.cos(x.bearingInRadians),b=Math.sin(x.bearingInRadians),j=c.aC();j[0]=-p*u*a-b*t,j[1]=-b*u*a+p*t;const E=c.aD(j);E<1e-9?c.aE(j):c.aF(j,j,1/E);const M=c.aC();M[0]=p*u*t-b*a,M[1]=b*u*t+p*a;const z=c.aD(M);return z<1e-9?c.aE(M):c.aF(M,M,1/z),{vecEast:M,vecSouth:j}}function ds(x,t,a,u){let p;u?(p=[x,t,u(x,t),1],c.aH(p,p,a)):(p=[x,t,0,1],Wa(p,p,a));const b=p[3];return{point:new c.P(p[0]/b,p[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function no(x,t){return .5+x/t*.5}function ba(x,t){return x.x>=-t[0]&&x.x<=t[0]&&x.y>=-t[1]&&x.y<=t[1]}function Za(x,t,a,u,p,b,j,E,M,z,L,q,V){const J=a?x.textSizeData:x.iconSizeData,ie=c.ay(J,t.transform.zoom),fe=[256/t.width*2+1,256/t.height*2+1],ye=a?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;ye.clear();const ge=x.lineVertexArray,Se=a?x.text.placedSymbolArray:x.icon.placedSymbolArray,Me=t.transform.width/t.transform.height;let we=!1;for(let ke=0;ke<Se.length;ke++){const De=Se.get(ke);if(De.hidden||De.writingMode===c.az.vertical&&!we){Rn(De.numGlyphs,ye);continue}we=!1;const je=new c.P(De.anchorX,De.anchorY),qe={getElevation:V,pitchedLabelPlaneMatrix:u,lineVertexArray:ge,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:je,unwrappedTileID:M,width:z,height:L,translation:q},st=fi(De.anchorX,De.anchorY,qe);if(!ba(st.point,fe)){Rn(De.numGlyphs,ye);continue}const Ke=no(t.transform.cameraToCenterDistance,st.signedDistanceFromCamera),et=c.aA(J,ie,De),tt=b?et*t.transform.getPitchedTextCorrection(De.anchorX,De.anchorY,M)/Ke:et*Ke,Rt=Pt({projectionContext:qe,pitchedLabelPlaneMatrixInverse:p,symbol:De,fontSize:tt,flip:!1,keepUpright:j,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:ye,aspectRatio:Me,rotateToLine:E});we=Rt.useVertical,(Rt.notEnoughRoom||we||Rt.needsFlipping&&Pt({projectionContext:qe,pitchedLabelPlaneMatrixInverse:p,symbol:De,fontSize:tt,flip:!0,keepUpright:j,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:ye,aspectRatio:Me,rotateToLine:E}).notEnoughRoom)&&Rn(De.numGlyphs,ye)}a?x.text.dynamicLayoutVertexBuffer.updateData(ye):x.icon.dynamicLayoutVertexBuffer.updateData(ye)}function hi(x,t,a,u,p,b,j,E){const M=b.glyphStartIndex+b.numGlyphs,z=b.lineStartIndex,L=b.lineStartIndex+b.lineLength,q=t.getoffsetX(b.glyphStartIndex),V=t.getoffsetX(M-1),J=Er(x*q,a,u,p,b.segment,z,L,E,j);if(!J)return null;const ie=Er(x*V,a,u,p,b.segment,z,L,E,j);return ie?E.projectionCache.anyProjectionOccluded?null:{first:J,last:ie}:null}function xe(x,t,a,u){return x===c.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*u?{useVertical:!0}:(x===c.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Pt(x){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:u,fontSize:p,flip:b,keepUpright:j,glyphOffsetArray:E,dynamicLayoutVertexArray:M,aspectRatio:z,rotateToLine:L}=x,q=p/24,V=u.lineOffsetX*q,J=u.lineOffsetY*q;let ie;if(u.numGlyphs>1){const fe=u.glyphStartIndex+u.numGlyphs,ye=u.lineStartIndex,ge=u.lineStartIndex+u.lineLength,Se=hi(q,E,V,J,b,u,L,t);if(!Se)return{notEnoughRoom:!0};const Me=Js(Se.first.point.x,Se.first.point.y,t,a),we=Js(Se.last.point.x,Se.last.point.y,t,a);if(j&&!b){const ke=xe(u.writingMode,Me,we,z);if(ke)return ke}ie=[Se.first];for(let ke=u.glyphStartIndex+1;ke<fe-1;ke++){const De=Er(q*E.getoffsetX(ke),V,J,b,u.segment,ye,ge,t,L);if(!De)return{notEnoughRoom:!0};ie.push(De)}ie.push(Se.last)}else{if(j&&!b){const ye=Ht(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ge=u.lineStartIndex+u.segment+1,Se=new c.P(t.lineVertexArray.getx(ge),t.lineVertexArray.gety(ge)),Me=Ht(Se.x,Se.y,t),we=Me.signedDistanceFromCamera>0?Me.point:Ft(t.tileAnchorPoint,Se,ye,1,t),ke=Js(ye.x,ye.y,t,a),De=Js(we.x,we.y,t,a),je=xe(u.writingMode,ke,De,z);if(je)return je}const fe=Er(q*E.getoffsetX(u.glyphStartIndex),V,J,b,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,t,L);if(!fe||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ie=[fe]}for(const fe of ie)c.aG(M,fe.point,fe.angle);return{}}function Ft(x,t,a,u,p){const b=x.add(x.sub(t)._unit()),j=Ht(b.x,b.y,p).point,E=a.sub(j);return a.add(E._mult(u/E.mag()))}function Gt(x,t,a){const u=t.projectionCache;if(u.projections[x])return u.projections[x];const p=new c.P(t.lineVertexArray.getx(x),t.lineVertexArray.gety(x)),b=Ht(p.x,p.y,t);if(b.signedDistanceFromCamera>0)return u.projections[x]=b.point,u.anyProjectionOccluded=u.anyProjectionOccluded||b.isOccluded,b.point;const j=x-a.direction;return Ft(a.distanceFromAnchor===0?t.tileAnchorPoint:new c.P(t.lineVertexArray.getx(j),t.lineVertexArray.gety(j)),p,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function Ht(x,t,a){const u=x+a.translation[0],p=t+a.translation[1];let b;return a.pitchWithMap?(b=ds(u,p,a.pitchedLabelPlaneMatrix,a.getElevation),b.isOccluded=!1):(b=a.transform.projectTileCoordinates(u,p,a.unwrappedTileID,a.getElevation),b.point.x=(.5*b.point.x+.5)*a.width,b.point.y=(.5*-b.point.y+.5)*a.height),b}function Js(x,t,a,u){if(a.pitchWithMap){const p=[x,t,0,1];return c.aH(p,p,u),a.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],a.unwrappedTileID,a.getElevation).point}return{x:x/a.width*2-1,y:1-t/a.height*2}}function fi(x,t,a){return a.transform.projectTileCoordinates(x,t,a.unwrappedTileID,a.getElevation)}function ia(x,t,a){return x._unit()._perp()._mult(t*a)}function ei(x,t,a,u,p,b,j,E,M){if(E.projectionCache.offsets[x])return E.projectionCache.offsets[x];const z=a.add(t);if(x+M.direction<u||x+M.direction>=p)return E.projectionCache.offsets[x]=z,z;const L=Gt(x+M.direction,E,M),q=ia(L.sub(a),j,M.direction),V=a.add(q),J=L.add(q);return E.projectionCache.offsets[x]=c.aI(b,z,V,J)||z,E.projectionCache.offsets[x]}function Er(x,t,a,u,p,b,j,E,M){const z=u?x-t:x+t;let L=z>0?1:-1,q=0;u&&(L*=-1,q=Math.PI),L<0&&(q+=Math.PI);let V,J=L>0?b+p:b+p+1;E.projectionCache.cachedAnchorPoint?V=E.projectionCache.cachedAnchorPoint:(V=Ht(E.tileAnchorPoint.x,E.tileAnchorPoint.y,E).point,E.projectionCache.cachedAnchorPoint=V);let ie,fe,ye=V,ge=V,Se=0,Me=0;const we=Math.abs(z),ke=[];let De;for(;Se+Me<=we;){if(J+=L,J<b||J>=j)return null;Se+=Me,ge=ye,fe=ie;const st={absOffsetX:we,direction:L,distanceFromAnchor:Se,previousVertex:ge};if(ye=Gt(J,E,st),a===0)ke.push(ge),De=ye.sub(ge);else{let Ke;const et=ye.sub(ge);Ke=et.mag()===0?ia(Gt(J+L,E,st).sub(ye),a,L):ia(et,a,L),fe||(fe=ge.add(Ke)),ie=ei(J,Ke,ye,b,j,fe,a,E,st),ke.push(fe),De=ie.sub(fe)}Me=De.mag()}const je=De._mult((we-Se)/Me)._add(fe||ge),qe=q+Math.atan2(ye.y-ge.y,ye.x-ge.x);return ke.push(je),{point:je,angle:M?qe:0,path:ke}}const mn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Rn(x,t){for(let a=0;a<x;a++){const u=t.length;t.resize(u+4),t.float32.set(mn,3*u)}}function Wa(x,t,a){const u=t[0],p=t[1];return x[0]=a[0]*u+a[4]*p+a[12],x[1]=a[1]*u+a[5]*p+a[13],x[3]=a[3]*u+a[7]*p+a[15],x}const Zs=100;class Kd{constructor(t,a=new es(t.width+200,t.height+200,25),u=new es(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=u,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Zs,this.screenBottomBoundary=t.height+Zs,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,u,p,b,j,E,M,z,L,q,V){const J=this.projectAndGetPerspectiveRatio(t.anchorPointX+M[0],t.anchorPointY+M[1],b,L,V),ie=u*J.perspectiveRatio;let fe;if(j||E)fe=this._projectCollisionBox(t,ie,p,b,j,E,M,J,L,q,V);else{const De=J.x+(q?q.x*ie:0),je=J.y+(q?q.y*ie:0);fe={allPointsOccluded:!1,box:[De+t.x1*ie,je+t.y1*ie,De+t.x2*ie,je+t.y2*ie]}}const[ye,ge,Se,Me]=fe.box,we=j?fe.allPointsOccluded:J.isOccluded;let ke=we;return ke||(ke=J.perspectiveRatio<this.perspectiveRatioCutoff),ke||(ke=!this.isInsideGrid(ye,ge,Se,Me)),ke||a!=="always"&&this.grid.hitTest(ye,ge,Se,Me,a,z)?{box:[ye,ge,Se,Me],placeable:!1,offscreen:!1,occluded:we}:{box:[ye,ge,Se,Me],placeable:!0,offscreen:this.isOffscreen(ye,ge,Se,Me),occluded:we}}placeCollisionCircles(t,a,u,p,b,j,E,M,z,L,q,V,J,ie){const fe=[],ye=new c.P(a.anchorX,a.anchorY),ge=this.getPerspectiveRatio(ye.x,ye.y,j,ie),Se=(z?b*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,j)/ge:b*ge)/c.aM,Me={getElevation:ie,pitchedLabelPlaneMatrix:E,lineVertexArray:u,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ye,unwrappedTileID:j,width:this.transform.width,height:this.transform.height,translation:J},we=hi(Se,p,a.lineOffsetX*Se,a.lineOffsetY*Se,!1,a,!1,Me);let ke=!1,De=!1,je=!0;if(we){const qe=.5*q*ge+V,st=new c.P(-100,-100),Ke=new c.P(this.screenRightBoundary,this.screenBottomBoundary),et=new Ct,tt=we.first,Rt=we.last;let It=[];for(let fs=tt.path.length-1;fs>=1;fs--)It.push(tt.path[fs]);for(let fs=1;fs<Rt.path.length;fs++)It.push(Rt.path[fs]);const St=2.5*qe;if(z){const fs=this.projectPathToScreenSpace(It,Me);It=fs.some((er=>er.signedDistanceFromCamera<=0))?[]:fs.map((er=>er.point))}let Bt=[];if(It.length>0){const fs=It[0].clone(),er=It[0].clone();for(let _r=1;_r<It.length;_r++)fs.x=Math.min(fs.x,It[_r].x),fs.y=Math.min(fs.y,It[_r].y),er.x=Math.max(er.x,It[_r].x),er.y=Math.max(er.y,It[_r].y);Bt=fs.x>=st.x&&er.x<=Ke.x&&fs.y>=st.y&&er.y<=Ke.y?[It]:er.x<st.x||fs.x>Ke.x||er.y<st.y||fs.y>Ke.y?[]:c.aJ([It],st.x,st.y,Ke.x,Ke.y)}for(const fs of Bt){et.reset(fs,.25*qe);let er=0;er=et.length<=.5*qe?1:Math.ceil(et.paddedLength/St)+1;for(let _r=0;_r<er;_r++){const hr=_r/Math.max(er-1,1),Tr=et.lerp(hr),or=Tr.x+Zs,Or=Tr.y+Zs;fe.push(or,Or,qe,0);const Nr=or-qe,Si=Or-qe,qr=or+qe,Gr=Or+qe;if(je=je&&this.isOffscreen(Nr,Si,qr,Gr),De=De||this.isInsideGrid(Nr,Si,qr,Gr),t!=="always"&&this.grid.hitTestCircle(or,Or,qe,t,L)&&(ke=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!M&&ke||!De||ge<this.perspectiveRatioCutoff?[]:fe,offscreen:je,collisionDetected:ke}}projectPathToScreenSpace(t,a){const u=(function(p,b){const j=c.N();return c.aB(j,b.pitchedLabelPlaneMatrix),p.map((E=>{const M=ds(E.x,E.y,j,b.getElevation),z=b.transform.projectTileCoordinates(M.point.x,M.point.y,b.unwrappedTileID,b.getElevation);return z.point.x=(.5*z.point.x+.5)*b.width,z.point.y=(.5*-z.point.y+.5)*b.height,z}))})(t,a);return(function(p){let b=0,j=0,E=0,M=0;for(let z=0;z<p.length;z++)p[z].isOccluded?(E=z+1,M=0):(M++,M>j&&(j=M,b=E));return p.slice(b,b+j)})(u)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],u=new c.aa;for(const q of t){const V=new c.P(q.x+Zs,q.y+Zs);u.extend(V),a.push(V)}const{minX:p,minY:b,maxX:j,maxY:E}=u,M=this.grid.query(p,b,j,E).concat(this.ignoredGrid.query(p,b,j,E)),z={},L={};for(const q of M){const V=q.key;if(z[V.bucketInstanceId]===void 0&&(z[V.bucketInstanceId]={}),z[V.bucketInstanceId][V.featureIndex])continue;const J=[new c.P(q.x1,q.y1),new c.P(q.x2,q.y1),new c.P(q.x2,q.y2),new c.P(q.x1,q.y2)];c.aK(a,J)&&(z[V.bucketInstanceId][V.featureIndex]=!0,L[V.bucketInstanceId]===void 0&&(L[V.bucketInstanceId]=[]),L[V.bucketInstanceId].push(V.featureIndex))}return L}insertCollisionBox(t,a,u,p,b,j){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:b,collisionGroupID:j,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,u,p,b,j){const E=u?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:b,collisionGroupID:j,overlapMode:a};for(let z=0;z<t.length;z+=4)E.insertCircle(M,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,a,u,p,b){if(b){let j;p?(j=[t,a,p(t,a),1],c.aH(j,j,b)):(j=[t,a,0,1],Wa(j,j,b));const E=j[3];return{x:(j[0]/E+1)/2*this.transform.width+Zs,y:(-j[1]/E+1)/2*this.transform.height+Zs,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E*.5,isOccluded:!1,signedDistanceFromCamera:E}}{const j=this.transform.projectTileCoordinates(t,a,u,p);return{x:(j.point.x+1)/2*this.transform.width+Zs,y:(1-j.point.y)/2*this.transform.height+Zs,perspectiveRatio:.5+this.transform.cameraToCenterDistance/j.signedDistanceFromCamera*.5,isOccluded:j.isOccluded,signedDistanceFromCamera:j.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,u,p){const b=this.transform.projectTileCoordinates(t,a,u,p);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(t,a,u,p){return u<Zs||t>=this.screenRightBoundary||p<Zs||a>this.screenBottomBoundary}isInsideGrid(t,a,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=c.ar([]);return c.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,u,p,b,j,E,M,z,L,q){let V=1,J=0,ie=0,fe=1;const ye=t.anchorPointX+E[0],ge=t.anchorPointY+E[1];if(j&&!b){const It=this.projectAndGetPerspectiveRatio(ye+1,ge,p,z,q),St=It.x-M.x,Bt=Math.atan((It.y-M.y)/St)+(St<0?Math.PI:0),fs=Math.sin(Bt),er=Math.cos(Bt);V=er,J=fs,ie=-fs,fe=er}else if(!j&&b){const It=va(this.transform);V=It.vecEast[0],J=It.vecEast[1],ie=It.vecSouth[0],fe=It.vecSouth[1]}let Se=M.x,Me=M.y,we=a;b&&(Se=ye,Me=ge,we=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),we*=this.transform.getPitchedTextCorrection(ye,ge,p),L||(we*=c.an(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),L&&(Se+=V*L.x*we+ie*L.y*we,Me+=J*L.x*we+fe*L.y*we);const ke=t.x1*we,De=t.x2*we,je=(ke+De)/2,qe=t.y1*we,st=t.y2*we,Ke=(qe+st)/2,et=[{offsetX:ke,offsetY:qe},{offsetX:je,offsetY:qe},{offsetX:De,offsetY:qe},{offsetX:De,offsetY:Ke},{offsetX:De,offsetY:st},{offsetX:je,offsetY:st},{offsetX:ke,offsetY:st},{offsetX:ke,offsetY:Ke}];let tt=[];for(const{offsetX:It,offsetY:St}of et)tt.push(new c.P(Se+V*It+ie*St,Me+J*It+fe*St));let Rt=!1;if(b){const It=tt.map((St=>this.projectAndGetPerspectiveRatio(St.x,St.y,p,z,q)));Rt=It.some((St=>!St.isOccluded)),tt=It.map((St=>new c.P(St.x,St.y)))}else Rt=!0;return{box:c.aL(tt),allPointsOccluded:!Rt}}}class xf{constructor(t,a,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class cl{constructor(t,a,u,p,b){this.text=new xf(t?t.text:null,a,u,b),this.icon=new xf(t?t.icon:null,a,p,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jd{constructor(t,a,u){this.text=t,this.icon=a,this.skipFade=u}}class Gc{constructor(t,a,u,p,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=b}}class _f{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[t]}}function Hi(x,t,a,u,p){const{horizontalAlign:b,verticalAlign:j}=c.aS(x);return new c.P(-(b-.5)*t+u[0]*p,-(j-.5)*a+u[1]*p)}class Hc{constructor(t,a,u,p,b){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Kd(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new _f(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(u,p)=>a.getElevation(t,u,p):null}getBucketParts(t,a,u,p){const b=u.getBucket(a),j=u.latestFeatureIndex;if(!b||!j||a.id!==b.layerIds[0])return;const E=u.collisionBoxArray,M=b.layers[0].layout,z=b.layers[0].paint,L=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),q=u.tileSize/c.a5,V=u.tileID.toUnwrapped(),J=M.get("text-rotation-alignment")==="map",ie=c.aN(u,1,this.transform.zoom),fe=c.aO(this.collisionIndex.transform,u,z.get("text-translate"),z.get("text-translate-anchor")),ye=c.aO(this.collisionIndex.transform,u,z.get("icon-translate"),z.get("icon-translate-anchor")),ge=ra(J,this.transform,ie);this.retainedQueryData[b.bucketInstanceId]=new Gc(b.bucketInstanceId,j,b.sourceLayerIndex,b.index,u.tileID);const Se={bucket:b,layout:M,translationText:fe,translationIcon:ye,unwrappedTileID:V,pitchedLabelPlaneMatrix:ge,scale:L,textPixelRatio:q,holdingForFade:u.holdingForSymbolFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:c.ay(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(const Me of b.sortKeyRanges){const{sortKey:we,symbolInstanceStart:ke,symbolInstanceEnd:De}=Me;t.push({sortKey:we,symbolInstanceStart:ke,symbolInstanceEnd:De,parameters:Se})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(t,a,u,p,b,j,E,M,z,L,q,V,J,ie,fe,ye,ge,Se,Me,we){const ke=c.aP[t.textAnchor],De=[t.textOffset0,t.textOffset1],je=Hi(ke,u,p,De,b),qe=this.collisionIndex.placeCollisionBox(a,V,M,z,L,E,j,ye,q.predicate,Me,je,we);if((!Se||this.collisionIndex.placeCollisionBox(Se,V,M,z,L,E,j,ge,q.predicate,Me,je,we).placeable)&&qe.placeable){let st;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(st=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:De,width:u,height:p,anchor:ke,textBoxScale:b,prevAnchor:st},this.markUsedJustification(ie,ke,J,fe),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,fe,J),this.placedOrientations[J.crossTileID]=fe),{shift:je,placedGlyphBoxes:qe}}}placeLayerBucketPart(t,a,u){const{bucket:p,layout:b,translationText:j,translationIcon:E,unwrappedTileID:M,pitchedLabelPlaneMatrix:z,textPixelRatio:L,holdingForFade:q,collisionBoxArray:V,partiallyEvaluatedTextSize:J,collisionGroup:ie}=t.parameters,fe=b.get("text-optional"),ye=b.get("icon-optional"),ge=c.aQ(b,"text-overlap","text-allow-overlap"),Se=ge==="always",Me=c.aQ(b,"icon-overlap","icon-allow-overlap"),we=Me==="always",ke=b.get("text-rotation-alignment")==="map",De=b.get("text-pitch-alignment")==="map",je=b.get("icon-text-fit")!=="none",qe=b.get("symbol-z-order")==="viewport-y",st=Se&&(we||!p.hasIconData()||ye),Ke=we&&(Se||!p.hasTextData()||fe);!p.collisionArrays&&V&&p.deserializeCollisionBoxes(V);const et=this.retainedQueryData[p.bucketInstanceId].tileID,tt=this._getTerrainElevationFunc(et),Rt=this.transform.getFastPathSimpleProjectionMatrix(et),It=(St,Bt,fs)=>{var er,_r;if(a[St.crossTileID])return;if(q)return void(this.placements[St.crossTileID]=new Jd(!1,!1,!1));let hr=!1,Tr=!1,or=!0,Or=null,Nr={box:null,placeable:!1,offscreen:null,occluded:!1},Si={placeable:!1},qr=null,Gr=null,ji=null,Qn=0,eo=0,jn=0;Bt.textFeatureIndex?Qn=Bt.textFeatureIndex:St.useRuntimeCollisionCircles&&(Qn=St.featureIndex),Bt.verticalTextFeatureIndex&&(eo=Bt.verticalTextFeatureIndex);const ua=Bt.textBox;if(ua){const da=rr=>{let fr=c.az.horizontal;if(p.allowVerticalPlacement&&!rr&&this.prevPlacement){const ri=this.prevPlacement.placedOrientations[St.crossTileID];ri&&(this.placedOrientations[St.crossTileID]=ri,fr=ri,this.markUsedOrientation(p,fr,St))}return fr},Pa=(rr,fr)=>{if(p.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const ri of p.writingModes)if(ri===c.az.vertical?(Nr=fr(),Si=Nr):Nr=rr(),Nr&&Nr.placeable)break}else Nr=rr()},nn=St.textAnchorOffsetStartIndex,on=St.textAnchorOffsetEndIndex;if(on===nn){const rr=(fr,ri)=>{const ui=this.collisionIndex.placeCollisionBox(fr,ge,L,et,M,De,ke,j,ie.predicate,tt,void 0,Rt);return ui&&ui.placeable&&(this.markUsedOrientation(p,ri,St),this.placedOrientations[St.crossTileID]=ri),ui};Pa((()=>rr(ua,c.az.horizontal)),(()=>{const fr=Bt.verticalTextBox;return p.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&fr?rr(fr,c.az.vertical):{box:null,offscreen:null}})),da(Nr&&Nr.placeable)}else{let rr=c.aP[(_r=(er=this.prevPlacement)===null||er===void 0?void 0:er.variableOffsets[St.crossTileID])===null||_r===void 0?void 0:_r.anchor];const fr=(ui,Sd,jd)=>{const Xo=ui.x2-ui.x1,Of=ui.y2-ui.y1,Ko=St.textBoxScale,Td=je&&Me==="never"?Sd:null;let bo=null,wo=ge==="never"?1:2,Nn="never";rr&&wo++;for(let Nd=0;Nd<wo;Nd++){for(let Cu=nn;Cu<on;Cu++){const Au=p.textAnchorOffsets.get(Cu);if(rr&&Au.textAnchor!==rr)continue;const ku=this.attemptAnchorPlacement(Au,ui,Xo,Of,Ko,ke,De,L,et,M,ie,Nn,St,p,jd,j,E,Td,tt);if(ku&&(bo=ku.placedGlyphBoxes,bo&&bo.placeable))return hr=!0,Or=ku.shift,bo}rr?rr=null:Nn=ge}return u&&!bo&&(bo={box:this.collisionIndex.placeCollisionBox(ua,"always",L,et,M,De,ke,j,ie.predicate,tt,void 0,Rt).box,offscreen:!1,placeable:!1,occluded:!1}),bo};Pa((()=>fr(ua,Bt.iconBox,c.az.horizontal)),(()=>{const ui=Bt.verticalTextBox;return p.allowVerticalPlacement&&(!Nr||!Nr.placeable)&&St.numVerticalGlyphVertices>0&&ui?fr(ui,Bt.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}})),Nr&&(hr=Nr.placeable,or=Nr.offscreen);const ri=da(Nr&&Nr.placeable);if(!hr&&this.prevPlacement){const ui=this.prevPlacement.variableOffsets[St.crossTileID];ui&&(this.variableOffsets[St.crossTileID]=ui,this.markUsedJustification(p,ui.anchor,St,ri))}}}if(qr=Nr,hr=qr&&qr.placeable,or=qr&&qr.offscreen,St.useRuntimeCollisionCircles&&St.centerJustifiedTextSymbolIndex>=0){const da=p.text.placedSymbolArray.get(St.centerJustifiedTextSymbolIndex),Pa=c.aA(p.textSizeData,J,da),nn=b.get("text-padding");Gr=this.collisionIndex.placeCollisionCircles(ge,da,p.lineVertexArray,p.glyphOffsetArray,Pa,M,z,u,De,ie.predicate,St.collisionCircleDiameter,nn,j,tt),Gr.circles.length&&Gr.collisionDetected&&!u&&c.w("Collisions detected, but collision boxes are not shown"),hr=Se||Gr.circles.length>0&&!Gr.collisionDetected,or=or&&Gr.offscreen}if(Bt.iconFeatureIndex&&(jn=Bt.iconFeatureIndex),Bt.iconBox){const da=Pa=>this.collisionIndex.placeCollisionBox(Pa,Me,L,et,M,De,ke,E,ie.predicate,tt,je&&Or?Or:void 0,Rt);Si&&Si.placeable&&Bt.verticalIconBox?(ji=da(Bt.verticalIconBox),Tr=ji.placeable):(ji=da(Bt.iconBox),Tr=ji.placeable),or=or&&ji.offscreen}const Dl=fe||St.numHorizontalGlyphVertices===0&&St.numVerticalGlyphVertices===0,Nc=ye||St.numIconVertices===0;Dl||Nc?Nc?Dl||(Tr=Tr&&hr):hr=Tr&&hr:Tr=hr=Tr&&hr;const Tn=Tr&&ji.placeable;if(hr&&qr.placeable&&this.collisionIndex.insertCollisionBox(qr.box,ge,b.get("text-ignore-placement"),p.bucketInstanceId,Si&&Si.placeable&&eo?eo:Qn,ie.ID),Tn&&this.collisionIndex.insertCollisionBox(ji.box,Me,b.get("icon-ignore-placement"),p.bucketInstanceId,jn,ie.ID),Gr&&hr&&this.collisionIndex.insertCollisionCircles(Gr.circles,ge,b.get("text-ignore-placement"),p.bucketInstanceId,Qn,ie.ID),u&&this.storeCollisionData(p.bucketInstanceId,fs,Bt,qr,ji,Gr),St.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[St.crossTileID]=new Jd((hr||st)&&!qr?.occluded,(Tr||Ke)&&!ji?.occluded,or||p.justReloaded),a[St.crossTileID]=!0};if(qe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const St=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Bt=St.length-1;Bt>=0;--Bt){const fs=St[Bt];It(p.symbolInstances.get(fs),p.collisionArrays[fs],fs)}}else for(let St=t.symbolInstanceStart;St<t.symbolInstanceEnd;St++)It(p.symbolInstances.get(St),p.collisionArrays[St],St);p.justReloaded=!1}storeCollisionData(t,a,u,p,b,j){if(u.textBox||u.iconBox){let E,M;this.collisionBoxArrays.has(t)?E=this.collisionBoxArrays.get(t):(E=new Map,this.collisionBoxArrays.set(t,E)),E.has(a)?M=E.get(a):(M={text:null,icon:null},E.set(a,M)),u.textBox&&(M.text=p.box),u.iconBox&&(M.icon=b.box)}if(j){let E=this.collisionCircleArrays[t];E===void 0&&(E=this.collisionCircleArrays[t]=[]);for(let M=0;M<j.circles.length;M+=4)E.push(j.circles[M+0]-Zs),E.push(j.circles[M+1]-Zs),E.push(j.circles[M+2]),E.push(j.collisionDetected?1:0)}}markUsedJustification(t,a,u,p){let b;b=p===c.az.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[c.aR(a)];const j=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const E of j)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=b>=0&&E!==b?0:u.crossTileID)}markUsedOrientation(t,a,u){const p=a===c.az.horizontal||a===c.az.horizontalOnly?a:0,b=a===c.az.vertical?a:0,j=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const E of j)t.text.placedSymbolArray.get(E).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const p=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},j=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],L=b[M];L?(this.opacities[M]=new cl(L,p,z.text,z.icon),u=u||z.text!==L.text.placed||z.icon!==L.icon.placed):(this.opacities[M]=new cl(null,p,z.text,z.icon,z.skipFade),u=u||z.text||z.icon)}for(const M in b){const z=b[M];if(!this.opacities[M]){const L=new cl(z,p,!1,!1);L.isHidden()||(this.opacities[M]=L,u=u||z.text.placed||z.icon.placed)}}for(const M in j)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=j[M]);for(const M in E)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=E[M]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const u={};for(const p of a){const b=p.getBucket(t);b&&p.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,p.tileID,u,p.collisionBoxArray)}}updateBucketOpacities(t,a,u,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0],j=b.layout,E=new cl(null,0,!1,!1,!0),M=j.get("text-allow-overlap"),z=j.get("icon-allow-overlap"),L=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=j.get("text-rotation-alignment")==="map",V=j.get("text-pitch-alignment")==="map",J=j.get("icon-text-fit")!=="none",ie=new cl(null,0,M&&(z||!t.hasIconData()||j.get("icon-optional")),z&&(M||!t.hasTextData()||j.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const fe=(ge,Se,Me)=>{for(let we=0;we<Se/4;we++)ge.opacityVertexArray.emplaceBack(Me);ge.hasVisibleVertices=ge.hasVisibleVertices||Me!==dl},ye=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ge=0;ge<t.symbolInstances.length;ge++){const Se=t.symbolInstances.get(ge),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:we,crossTileID:ke}=Se;let De=this.opacities[ke];u[ke]?De=E:De||(De=ie,this.opacities[ke]=De),u[ke]=!0;const je=Se.numIconVertices>0,qe=this.placedOrientations[Se.crossTileID],st=qe===c.az.vertical,Ke=qe===c.az.horizontal||qe===c.az.horizontalOnly;if(Me>0||we>0){const tt=Ku(De.text);fe(t.text,Me,st?dl:tt),fe(t.text,we,Ke?dl:tt);const Rt=De.text.isHidden();[Se.rightJustifiedTextSymbolIndex,Se.centerJustifiedTextSymbolIndex,Se.leftJustifiedTextSymbolIndex].forEach((Bt=>{Bt>=0&&(t.text.placedSymbolArray.get(Bt).hidden=Rt||st?1:0)})),Se.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Se.verticalPlacedTextSymbolIndex).hidden=Rt||Ke?1:0);const It=this.variableOffsets[Se.crossTileID];It&&this.markUsedJustification(t,It.anchor,Se,qe);const St=this.placedOrientations[Se.crossTileID];St&&(this.markUsedJustification(t,"left",Se,St),this.markUsedOrientation(t,St,Se))}if(je){const tt=Ku(De.icon),Rt=!(J&&Se.verticalPlacedIconSymbolIndex&&st);Se.placedIconSymbolIndex>=0&&(fe(t.icon,Se.numIconVertices,Rt?tt:dl),t.icon.placedSymbolArray.get(Se.placedIconSymbolIndex).hidden=De.icon.isHidden()),Se.verticalPlacedIconSymbolIndex>=0&&(fe(t.icon,Se.numVerticalIconVertices,Rt?dl:tt),t.icon.placedSymbolArray.get(Se.verticalPlacedIconSymbolIndex).hidden=De.icon.isHidden())}const et=ye&&ye.has(ge)?ye.get(ge):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const tt=t.collisionArrays[ge];if(tt){let Rt=new c.P(0,0);if(tt.textBox||tt.verticalTextBox){let It=!0;if(L){const St=this.variableOffsets[ke];St?(Rt=Hi(St.anchor,St.width,St.height,St.textOffset,St.textBoxScale),q&&Rt._rotate(V?-this.transform.bearingInRadians:this.transform.bearingInRadians)):It=!1}if(tt.textBox||tt.verticalTextBox){let St;tt.textBox&&(St=st),tt.verticalTextBox&&(St=Ke),Xu(t.textCollisionBox.collisionVertexArray,De.text.placed,!It||St,et.text,Rt.x,Rt.y)}}if(tt.iconBox||tt.verticalIconBox){const It=!!(!Ke&&tt.verticalIconBox);let St;tt.iconBox&&(St=It),tt.verticalIconBox&&(St=!It),Xu(t.iconCollisionBox.collisionVertexArray,De.icon.placed,St,et.icon,J?Rt.x:0,J?Rt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Xu(x,t,a,u,p,b){u&&u.length!==0||(u=[0,0,0,0]);const j=u[0]-Zs,E=u[1]-Zs,M=u[2]-Zs,z=u[3]-Zs;x.emplaceBack(t?1:0,a?1:0,p||0,b||0,j,E),x.emplaceBack(t?1:0,a?1:0,p||0,b||0,M,E),x.emplaceBack(t?1:0,a?1:0,p||0,b||0,M,z),x.emplaceBack(t?1:0,a?1:0,p||0,b||0,j,z)}const Zc=Math.pow(2,25),Mo=Math.pow(2,24),vf=Math.pow(2,17),ic=Math.pow(2,16),oo=Math.pow(2,9),bf=Math.pow(2,8),ul=Math.pow(2,1);function Ku(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const t=x.placed?1:0,a=Math.floor(127*x.opacity);return a*Zc+t*Mo+a*vf+t*ic+a*oo+t*bf+a*ul+t}const dl=0;class Po{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,u,p,b){const j=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(j,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort(((E,M)=>E.sortKey-M.sortKey)));this._currentPartIndex<j.length;)if(a.placeLayerBucketPart(j[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,b())return!0;return!1}}class ac{constructor(t,a,u,p,b,j,E,M){this.placement=new Hc(t,a,j,E,M),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,a,u){const p=Y(),b=()=>!this._forceFullPlacement&&Y()-p>2;for(;this._currentPlacementIndex>=0;){const j=a[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=E)&&(!j.maxzoom||j.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Po(j)),this._inProgressLayer.continuePlacement(u[j.source],this.placement,this._showCollisionBoxes,j,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const _s=512/c.a5/2;class gn{constructor(t,a,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const p=new Map;for(let b=0;b<a.length;b++){const j=a.get(b),E=j.key,M=p.get(E);M?M.push(j):p.set(E,[j])}for(const[b,j]of p){const E={positions:j.map((M=>({x:Math.floor(M.anchorX*_s),y:Math.floor(M.anchorY*_s)}))),crossTileIDs:j.map((M=>M.crossTileID))};if(E.positions.length>128){const M=new c.aT(E.positions.length,16,Uint16Array);for(const{x:z,y:L}of E.positions)M.add(z,L);M.finish(),delete E.positions,E.index=M}this._symbolsByKey[b]=E}}getScaledCoordinates(t,a){const{x:u,y:p,z:b}=this.tileID.canonical,{x:j,y:E,z:M}=a.canonical,z=_s/Math.pow(2,M-b),L=(E*c.a5+t.anchorY)*z,q=p*c.a5*_s;return{x:Math.floor((j*c.a5+t.anchorX)*z-u*c.a5*_s),y:Math.floor(L-q)}}findMatches(t,a,u){const p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let b=0;b<t.length;b++){const j=t.get(b);if(j.crossTileID)continue;const E=this._symbolsByKey[j.key];if(!E)continue;const M=this.getScaledCoordinates(j,a);if(E.index){const z=E.index.range(M.x-p,M.y-p,M.x+p,M.y+p).sort();for(const L of z){const q=E.crossTileIDs[L];if(!u[q]){u[q]=!0,j.crossTileID=q;break}}}else if(E.positions)for(let z=0;z<E.positions.length;z++){const L=E.positions[z],q=E.crossTileIDs[z];if(Math.abs(L.x-M.x)<=p&&Math.abs(L.y-M.y)<=p&&!u[q]){u[q]=!0,j.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Qd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const u in this.indexes){const p=this.indexes[u],b={};for(const j in p){const E=p[j];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),b[E.tileID.key]=E}this.indexes[u]=b}this.lng=t}addBucket(t,a,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const j=this.indexes[b];if(Number(b)>t.overscaledZ)for(const E in j){const M=j[E];M.tileID.isChildOf(t)&&M.findMatches(a.symbolInstances,t,p)}else{const E=j[t.scaledTo(Number(b)).key];E&&E.findMatches(a.symbolInstances,t,p)}}for(let b=0;b<a.symbolInstances.length;b++){const j=a.symbolInstances.get(b);j.crossTileID||(j.crossTileID=u.generate(),p[j.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new gn(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const u of a.getCrossTileIDsLists())for(const p of u)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let a=!1;for(const u in this.indexes){const p=this.indexes[u];for(const b in p)t[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[b]),delete p[b],a=!0)}return a}}class pi{constructor(){this.layerIndexes={},this.crossTileIDs=new Qd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,u){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new Wc);let b=!1;const j={};p.handleWrapJump(u);for(const E of a){const M=E.getBucket(t);M&&t.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(E.tileID,M,this.crossTileIDs)&&(b=!0),j[M.bucketInstanceId]=!0)}return p.removeStaleBuckets(j)&&(b=!0),b}pruneUnusedLayers(t){const a={};t.forEach((u=>{a[u]=!0}));for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}var ti="void main() {fragColor=vec4(1.0);}";const Cr={prelude:ns(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ns("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ns("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ns(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ns(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ns(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ns(ti,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ns(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ns(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ns("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ns("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ns(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ns("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ns(ti,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ns(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ns(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ns(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ns(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ns(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ns(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ns(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ns(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ns(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ns(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ns(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ns(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:ns(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:ns(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ns(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ns(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ns(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ns("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ns("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ns("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ns("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ns(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ns("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ns(x,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/in ([\w]+) ([\w]+)/g),p=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),j=b?b.concat(p):p,E={};return{fragmentSource:x=x.replace(a,((M,z,L,q,V)=>(E[V]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${L} ${q} ${V};
#else
uniform ${L} ${q} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${L} ${q} ${V} = u_${V};
#endif
`))),vertexSource:t=t.replace(a,((M,z,L,q,V)=>{const J=q==="float"?"vec2":"vec4",ie=V.match(/color/)?"color":J;return E[V]?z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${L} ${J} a_${V};
out ${L} ${q} ${V};
#else
uniform ${L} ${q} u_${V};
#endif
`:ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${L} ${q} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${ie}(a_${V}, u_${V}_t);
#else
    ${L} ${q} ${V} = u_${V};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${L} ${J} a_${V};
#else
uniform ${L} ${q} u_${V};
#endif
`:ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${L} ${q} ${V} = a_${V};
#else
    ${L} ${q} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${L} ${q} ${V} = unpack_mix_${ie}(a_${V}, u_${V}_t);
#else
    ${L} ${q} ${V} = u_${V};
#endif
`})),staticAttributes:u,staticUniforms:j}}class ur{constructor(t,a,u){this.vertexBuffer=t,this.indexBuffer=a,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ya=c.aU([{name:"a_pos",type:"Int16",components:2}]);const Ur="#define PROJECTION_MERCATOR",Zi="mercator";class mi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Zi}get shaderDefine(){return Ur}get shaderPreludeCode(){return Cr.projectionMercator}get vertexShaderPreludeCode(){return Cr.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,u,p,b){if(this._cachedMesh)return this._cachedMesh;const j=new c.aW;j.emplaceBack(0,0),j.emplaceBack(c.a5,0),j.emplaceBack(0,c.a5),j.emplaceBack(c.a5,c.a5);const E=t.createVertexBuffer(j,Ya.members),M=c.aX.simpleSegment(0,0,4,2),z=new c.aY;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const L=t.createIndexBuffer(z);return this._cachedMesh=new ur(E,L,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class wa{constructor(t=0,a=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=u,this.right=p}interpolate(t,a,u){return a.top!=null&&t.top!=null&&(this.top=c.G.number(t.top,a.top,u)),a.bottom!=null&&t.bottom!=null&&(this.bottom=c.G.number(t.bottom,a.bottom,u)),a.left!=null&&t.left!=null&&(this.left=c.G.number(t.left,a.left,u)),a.right!=null&&t.right!=null&&(this.right=c.G.number(t.right,a.right,u)),this}getCenter(t,a){const u=c.an((this.left+t-this.right)/2,0,t),p=c.an((this.top+a-this.bottom)/2,0,a);return new c.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function In(x,t){if(!x.renderWorldCopies||x.lngRange)return;const a=t.lng-x.center.lng;t.lng+=a>180?-360:a<-180?360:0}function Ar(x){return Math.max(0,Math.floor(x))}class Do{constructor(t,a){var u;this.applyConstrain=(p,b)=>this._constrainOverride!==null?this._constrainOverride(p,b):this._callbacks.defaultConstrain(p,b),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(u=a?.constrainOverride)!==null&&u!==void 0?u:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ar(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new wa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,u){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Ar(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new wa(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!u&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=c.W(t,-180,180)*Math.PI/180;var u,p,b,j,E,M,z,L,q;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=F(),u=this._rotationMatrix,b=-this._bearingInRadians,j=(p=this._rotationMatrix)[0],E=p[1],M=p[2],z=p[3],L=Math.sin(b),q=Math.cos(b),u[0]=j*q+M*L,u[1]=E*q+z*L,u[2]=j*-L+M*q,u[3]=E*-L+z*q)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=c.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(t){t=c.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=c.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=c.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,u){this._unmodified=!1,this._edgeInsets.interpolate(t,a,u),this.constrainInternal(),this._calcMatrices()}resize(t,a,u=!0){this._width=t,this._height=a,u&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Os([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:u,minY:p,maxX:b,maxY:j}=c.aa.fromPoints(a).extend(t);return[new c.P(u,p),new c.P(b,p),new c.P(b,j),new c.P(u,j),new c.P(u,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:u}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(u),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=c.ar(new Float64Array(16));c.Q(t,t,[this._width/2,-this._height/2,1]),c.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=c.ar(new Float64Array(16)),c.Q(t,t,[1,-1,1]),c.O(t,t,[-1,-1,0]),c.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,u,p){const b=u!==void 0?u:this.bearing,j=p=p!==void 0?p:this.pitch,{distanceToCenter:E,clampedElevation:M}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,j),{x:z,y:L}=Vt(j,b),q=c.a9.fromLngLat(t,a);let V,J,ie=c.a_(1,q.y),fe=0;do{if(fe+=1,fe>10)break;J=E/ie,V=new c.a9(q.x+z*J,q.y+L*J),ie=1/V.meterInMercatorCoordinateUnits()}while(Math.abs(E-J*ie)>1e-12);return{center:V.toLngLat(),elevation:M,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/J/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,u=c.as(1,this.center.lat)*this.worldSize,p=c.a9.fromLngLat(this.center,this.elevation),b=p.x/a,j=p.y/a,E=p.z/a,M=this.pitch,z=this.bearing,{x:L,y:q,z:V}=Vt(M,z),J=this.cameraToCenterDistance,ie=b+J*-L,fe=j+J*-q,ye=E+J*V,{distanceToCenter:ge,clampedElevation:Se}=this._distanceToCenterFromAltElevationPitch(ye/u,t,M),Me=ge*u,we=new c.a9((ie+L*Me)*a,(fe+q*Me)*a,0).toLngLat(),ke=c.as(1,we.lat),De=c.at(this.height/2/Math.tan(this.fovInRadians/2)/ge/ke/this.tileSize);this._elevation=Se,this._center=we,this.setZoom(De)}_distanceToCenterFromAltElevationPitch(t,a,u){const p=-Math.cos(c.ap(u)),b=t-a;let j,E=a;return p*b>=0||Math.abs(p)<.1?(j=1e4,E=t+j*p):j=-b/p,{distanceToCenter:j,clampedElevation:E}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/c.a5,1/a/c.a5]}}class Sa{constructor(t,a){this.min=t,this.max=a,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],u=c.b1(this.min),p=c.b1(this.max);for(let b=0;b<a.length;b++)u[b]=a[b]?this.min[b]:this.center[b],p[b]=a[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new Sa(u,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let u=0;u<t.planes.length;u++){const p=this.intersectsPlane(t.planes[u]);if(p===0)return 0;p===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],u=t[3];for(let p=0;p<3;p++)t[p]>0?(a+=t[p]*this.min[p],u+=t[p]*this.max[p]):(u+=t[p]*this.min[p],a+=t[p]*this.max[p]);return a>=0?2:u<0?0:1}}class hl{distanceToTile2d(t,a,u,p){const b=p.distanceX([t,a]),j=p.distanceY([t,a]);return Math.hypot(b,j)}getWrap(t,a,u){return u}getTileBoundingVolume(t,a,u,p){var b,j;let E=0,M=0;if(p?.terrain){const L=new c.a2(t.z,a,t.z,t.x,t.y),q=p.terrain.getMinMaxElevation(L);E=(b=q.minElevation)!==null&&b!==void 0?b:Math.min(0,u),M=(j=q.maxElevation)!==null&&j!==void 0?j:Math.max(0,u)}const z=1<<t.z;return new Sa([a+t.x/z,t.y/z,E],[a+(t.x+1)/z,(t.y+1)/z,M])}allowVariableZoom(t,a){const u=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,p=c.an(78.5-u/2,0,60);return!!a.terrain||t.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Wi{constructor(t,a,u){this.points=t,this.planes=a,this.aabb=u}static fromInvProjectionMatrix(t,a=1,u=0,p,b){const j=b?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],E=Math.pow(2,u),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((V=>(function(J,ie,fe,ye){const ge=c.aH([],J,ie),Se=1/ge[3]/fe*ye;return c.b6(ge,ge,[Se,Se,1/ge[3],Se])})(V,t,a,E)));p&&(function(V,J,ie,fe){const ye=fe?4:0,ge=fe?0:4;let Se=0;const Me=[],we=[];for(let je=0;je<4;je++){const qe=c.b2([],V[je+ge],V[je+ye]),st=c.b7(qe);c.a$(qe,qe,1/st),Me.push(st),we.push(qe)}for(let je=0;je<4;je++){const qe=c.b8(V[je+ye],we[je],ie);Se=qe!==null&&qe>=0?Math.max(Se,qe):Math.max(Se,Me[je])}const ke=(function(je,qe){const st=c.b2([],je[qe[0]],je[qe[1]]),Ke=c.b2([],je[qe[2]],je[qe[1]]),et=[0,0,0,0];return c.b3(et,c.b4([],st,Ke)),et[3]=-c.b5(et,je[qe[0]]),et})(V,J),De=(function(je,qe){const st=c.b9(je),Ke=c.ba([],je,1/st),et=c.b2([],qe,c.a$([],Ke,c.b5(qe,Ke))),tt=c.b9(et);if(tt>0){const Rt=Math.sqrt(1-Ke[3]*Ke[3]),It=c.a$([],Ke,-Ke[3]),St=c.b0([],It,c.a$([],et,Rt/tt));return c.bb(qe,St)}return null})(ie,ke);if(De!==null){const je=De/c.b5(we[0],ke);Se=Math.min(Se,je)}for(let je=0;je<4;je++){const qe=Math.min(Se,Me[je]);V[je+ge]=[V[je+ye][0]+we[je][0]*qe,V[je+ye][1]+we[je][1]*qe,V[je+ye][2]+we[je][2]*qe,1]}})(M,j[0],p,b);const z=j.map((V=>{const J=c.b2([],M[V[0]],M[V[1]]),ie=c.b2([],M[V[2]],M[V[1]]),fe=c.b3([],c.b4([],J,ie)),ye=-c.b5(fe,M[V[1]]);return fe.concat(ye)})),L=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],q=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const V of M)for(let J=0;J<3;J++)L[J]=Math.min(L[J],V[J]),q[J]=Math.max(q[J],V[J]);return new Wi(M,z,new Sa(L,q))}}class ci{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,u){return this._helper.interpolatePadding(t,a,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,u=!0){this._helper.resize(t,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,u)=>{u=c.an(+u,this.minZoom,this.maxZoom);const p={center:new c.V(a.lng,a.lat),zoom:u};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const we=179.9999999999;b=[-we,we]}const j=this.tileSize*c.aq(p.zoom);let E=0,M=j,z=0,L=j,q=0,V=0;const{x:J,y:ie}=this.size;if(this._helper._latRange){const we=this._helper._latRange;E=c.X(we[1])*j,M=c.X(we[0])*j,M-E<ie&&(q=ie/(M-E))}b&&(z=c.W(c.Y(b[0])*j,0,j),L=c.W(c.Y(b[1])*j,0,j),L<z&&(L+=j),L-z<J&&(V=J/(L-z)));const{x:fe,y:ye}=Ue(j,a);let ge,Se;const Me=Math.max(V||0,q||0);if(Me){const we=new c.P(V?(L+z)/2:fe,q?(M+E)/2:ye);return p.center=Re(j,we).wrap(),p.zoom+=c.at(Me),p}if(this._helper._latRange){const we=ie/2;ye-we<E&&(Se=E+we),ye+we>M&&(Se=M-we)}if(b){const we=(z+L)/2;let ke=fe;this._helper._renderWorldCopies&&(ke=c.W(fe,we-j/2,we+j/2));const De=J/2;ke-De<z&&(ge=z+De),ke+De>L&&(ge=L-De)}if(ge!==void 0||Se!==void 0){const we=new c.P(ge??fe,Se??ye);p.center=Re(j,we).wrap()}return p},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new Do({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},t),this._coveringTilesDetailsProvider=new hl}clone(){const t=new ci;return t.apply(this,!1),t}apply(t,a,u){this._helper.apply(t,a,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new c.bc(0,t)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new c.P(0,0)),p=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),j=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),E=Math.floor(Math.min(u.x,p.x,b.x,j.x)),M=Math.floor(Math.max(u.x,p.x,b.x,j.x)),z=1;for(let L=E-z;L<=M+z;L++)L!==0&&a.push(new c.bc(L,t))}return a}getCameraFrustum(){return Wi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),u=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(t,a){const u=c.as(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(a,u),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),j=c.a9.fromLngLat(t),E=new c.a9(j.x-(p.x-b.x),j.y-(p.y-b.y));this.setCenter(E?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(c.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(t))}screenPointToLocation(t,a){var u;return(u=this.screenPointToMercatorCoordinate(t,a))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const u=a.pointCoordinate(t);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const u=a||0,p=[t.x,t.y,0,1],b=[t.x,t.y,1,1];c.aH(p,p,this._pixelMatrixInverse),c.aH(b,b,this._pixelMatrixInverse);const j=p[3],E=b[3],M=p[1]/j,z=b[1]/E,L=p[2]/j,q=b[2]/E,V=L===q?0:(u-L)/(q-L);return new c.a9(c.G.number(p[0]/j,b[0]/E,V)/this.worldSize,c.G.number(M,z,V)/this.worldSize,u)}coordinatePoint(t,a=0,u=this._pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,a,1];return c.aH(p,p,u),new c.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ot(this));return new Os().extend(this.screenPointToLocation(new c.P(0,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-ot(this)}calculatePosMatrix(t,a=!1,u){var p;const b=(p=t.key)!==null&&p!==void 0?p:c.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),j=a?this._alignedPosMatrixCache:this._posMatrixCache;if(j.has(b)){const z=j.get(b);return u?z.f32:z.f64}const E=rt(t,this.worldSize);c.S(E,a?this._alignedProjMatrix:this._viewProjMatrix,E);const M={f64:E,f32:new Float32Array(E)};return j.set(b,M),u?M.f32:M.f64}calculateFogMatrix(t){const a=t.key,u=this._fogMatrixCacheF32;if(u.has(a))return u.get(a);const p=rt(t,this.worldSize);return c.S(p,this._fogMatrix,p),u.set(a,new Float32Array(p)),u.get(a)}calculateCenterFromCameraLngLatAlt(t,a,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,u,p)}_calculateNearFarZIfNeeded(t,a,u){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=t-p*this._helper._pixelPerMeter/Math.cos(a),j=p<0?b:t,E=Math.PI/2+this.pitchInRadians,M=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+u.y/this.height),z=Math.sin(M)*j/Math.sin(c.an(Math.PI-E-M,.01,Math.PI-.01)),L=ot(this),q=Math.atan(L/this._helper.cameraToCenterDistance),V=c.ap(.75),J=q>V?2*q*(.5+u.y/(2*L)):V,ie=Math.sin(J)*j/Math.sin(c.an(Math.PI-E-J,.01,Math.PI-.01)),fe=Math.min(z,ie);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*fe+j),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Ue(this.worldSize,this.center),u=a.x,p=a.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const b=c.ap(Math.min(this.pitch,He)),j=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let E;this._calculateNearFarZIfNeeded(j,b,t),E=new Float64Array(16),c.be(E,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,E),E[8]=2*-t.x/this._helper._width,E[9]=2*t.y/this._helper._height,this._projectionMatrix=c.bf(E),c.Q(E,E,[1,-1,1]),c.O(E,E,[0,0,-this._helper.cameraToCenterDistance]),c.bg(E,E,-this.rollInRadians),c.bh(E,E,this.pitchInRadians),c.bg(E,E,-this.bearingInRadians),c.O(E,E,[-u,-p,0]),this._mercatorMatrix=c.Q([],E,[this.worldSize,this.worldSize,this.worldSize]),c.Q(E,E,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E),c.O(E,E,[0,0,-this.elevation]),this._viewProjMatrix=E,this._invViewProjMatrix=c.aB([],E);const M=[0,0,-1,1];c.aH(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,j,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-u,-p,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E);const z=this._helper._width%2/2,L=this._helper._height%2/2,q=Math.cos(this.bearingInRadians),V=Math.sin(-this.bearingInRadians),J=u-Math.round(u)+q*z+V*L,ie=p-Math.round(p)+q*L+V*z,fe=new Float64Array(E);if(c.O(fe,fe,[J>.5?J-1:J,ie>.5?ie-1:ie,0]),this._alignedProjMatrix=fe,E=c.aB(new Float64Array(16),this._pixelMatrix),!E)throw new Error("failed to invert matrix");this._pixelMatrixInverse=E,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new c.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const u=c.a9.fromLngLat(t),p=[u.x*this.worldSize,u.y*this.worldSize,a,1];return c.aH(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(t){const{overscaledTileID:a,aligned:u,applyTerrainMatrix:p}=t,b=this._helper.getMercatorTileCoordinates(a),j=a?this.calculatePosMatrix(a,u,!0):null;let E;return E=a&&a.terrainRttPosMatrix32f&&p?a.terrainRttPosMatrix32f:j||c.bi(),{mainMatrix:E,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:E}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,u){return 1}transformLightDirection(t){return c.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,u,p){const b=this.calculatePosMatrix(u);let j;p?(j=[t,a,p(t,a),1],c.aH(j,j,b)):(j=[t,a,0,1],Wa(j,j,b));const E=j[3];return{point:new c.P(j[0]/E,j[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const u=c.a9.fromLngLat(t,a),p=u.meterInMercatorCoordinateUnits(),b=c.bj();return c.O(b,b,[u.x,u.y,u.z]),c.bg(b,b,Math.PI),c.bh(b,b,Math.PI/2),c.Q(b,b,[-p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=new c.a2(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),p=rt(a,this.worldSize);c.S(p,this._viewProjMatrix,p),u.tileMercatorCoords=[0,0,1,1];const b=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],j=c.bk();return c.Q(j,p,b),u.fallbackMatrix=j,u.mainMatrix=j,u}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Yi(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Yc(x){if(x.useSlerp)if(x.k<1){const t=c.bl(x.startEulerAngles.roll,x.startEulerAngles.pitch,x.startEulerAngles.bearing),a=c.bl(x.endEulerAngles.roll,x.endEulerAngles.pitch,x.endEulerAngles.bearing),u=new Float64Array(4);c.bm(u,t,a,x.k);const p=c.bn(u);x.tr.setRoll(p.roll),x.tr.setPitch(p.pitch),x.tr.setBearing(p.bearing)}else x.tr.setRoll(x.endEulerAngles.roll),x.tr.setPitch(x.endEulerAngles.pitch),x.tr.setBearing(x.endEulerAngles.bearing);else x.tr.setRoll(c.G.number(x.startEulerAngles.roll,x.endEulerAngles.roll,x.k)),x.tr.setPitch(c.G.number(x.startEulerAngles.pitch,x.endEulerAngles.pitch,x.k)),x.tr.setBearing(c.G.number(x.startEulerAngles.bearing,x.endEulerAngles.bearing,x.k))}function fl(x,t,a,u,p){const b=p.padding,j=Ue(p.worldSize,a.getNorthWest()),E=Ue(p.worldSize,a.getNorthEast()),M=Ue(p.worldSize,a.getSouthEast()),z=Ue(p.worldSize,a.getSouthWest()),L=c.ap(-u),q=j.rotate(L),V=E.rotate(L),J=M.rotate(L),ie=z.rotate(L),fe=new c.P(Math.max(q.x,V.x,ie.x,J.x),Math.max(q.y,V.y,ie.y,J.y)),ye=new c.P(Math.min(q.x,V.x,ie.x,J.x),Math.min(q.y,V.y,ie.y,J.y)),ge=fe.sub(ye),Se=(p.width-(b.left+b.right+t.left+t.right))/ge.x,Me=(p.height-(b.top+b.bottom+t.top+t.bottom))/ge.y;if(Me<0||Se<0)return void Yi();const we=Math.min(c.at(p.scale*Math.min(Se,Me)),x.maxZoom),ke=c.P.convert(x.offset),De=new c.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(c.ap(u)),je=ke.add(De).mult(p.scale/c.aq(we));return{center:Re(p.worldSize,j.add(M).div(2).sub(je)),zoom:we,bearing:u}}class pl{get useGlobeControls(){return!1}handlePanInertia(t,a){const u=t.mag(),p=Math.abs(ot(a));return{easingOffset:t.mult(Math.min(.75*p/u,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,u){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(u,t.around)}cameraForBoxAndBearing(t,a,u,p,b){return fl(t,a,u,p,b)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(c.V.convert(a.center))}handleEaseTo(t,a){const u=t.zoom,p=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},j={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},E=a.zoom!==void 0,M=!t.isPaddingEqual(a.padding);let z=!1;const L=E?+a.zoom:t.zoom;let q=t.centerPoint.add(a.offsetAsPoint);const V=t.screenPointToLocation(q),{center:J,zoom:ie}=t.applyConstrain(c.V.convert(a.center||V),L??u);In(t,J);const fe=Ue(t.worldSize,V),ye=Ue(t.worldSize,J).sub(fe),ge=c.aq(ie-u);return z=ie!==u,{easeFunc:Se=>{if(z&&t.setZoom(c.G.number(u,ie,Se)),c.bo(b,j)||Yc({startEulerAngles:b,endEulerAngles:j,tr:t,k:Se,useSlerp:b.roll!=j.roll}),M&&(t.interpolatePadding(p,a.padding,Se),q=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const Me=c.aq(t.zoom-u),we=ie>u?Math.min(2,ge):Math.max(.5,ge),ke=Math.pow(we,1-Se),De=Re(t.worldSize,fe.add(ye.mult(Se*ke)).mult(Me));t.setLocationAtPoint(t.renderWorldCopies?De.wrap():De,q)}},isZooming:z,elevationCenter:J}}handleFlyTo(t,a){const u=a.zoom!==void 0,p=t.zoom,b=t.applyConstrain(c.V.convert(a.center||a.locationAtOffset),u?+a.zoom:p),j=b.center,E=b.zoom;In(t,j);const M=Ue(t.worldSize,a.locationAtOffset),z=Ue(t.worldSize,j).sub(M),L=z.mag(),q=c.aq(E-p);let V;if(a.minZoom!==void 0){const J=Math.min(+a.minZoom,p,E),ie=t.applyConstrain(j,J).zoom;V=c.aq(ie-p)}return{easeFunc:(J,ie,fe,ye)=>{t.setZoom(J===1?E:p+c.at(ie));const ge=J===1?j:Re(t.worldSize,M.add(z.mult(fe)).mult(ie));t.setLocationAtPoint(t.renderWorldCopies?ge.wrap():ge,ye)},scaleOfZoom:q,targetCenter:j,scaleOfMinZoom:V,pixelPathLength:L}}}class nr{constructor(t,a,u){this.blendFunction=t,this.blendColor=a,this.mask=u}}nr.Replace=[1,0],nr.disabled=new nr(nr.Replace,c.bp.transparent,[!1,!1,!1,!1]),nr.unblended=new nr(nr.Replace,c.bp.transparent,[!0,!0,!0,!0]),nr.alphaBlended=new nr([1,771],c.bp.transparent,[!0,!0,!0,!0]);const Ro=2305;class As{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}As.disabled=new As(!1,1029,Ro),As.backCCW=new As(!0,1029,Ro),As.frontCCW=new As(!0,1028,Ro);class ms{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}ms.ReadOnly=!1,ms.ReadWrite=!0,ms.disabled=new ms(519,ms.ReadOnly,[0,1]);const ml=7680;class Bs{constructor(t,a,u,p,b,j){this.test=t,this.ref=a,this.mask=u,this.fail=p,this.depthFail=b,this.pass=j}}Bs.disabled=new Bs({func:519,mask:0},0,0,ml,ml,ml);const Xc=new WeakMap;function Xa(x){var t;if(Xc.has(x))return Xc.get(x);{const a=(t=x.getParameter(x.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Xc.set(x,a),a}}class Io{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,u=a.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const p=new c.aW;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const b=new c.aY;b.emplaceBack(0,1,2),this._fullscreenTriangle=new ur(a.createVertexBuffer(p,Ya.members),a.createIndexBuffer(b),c.aX.simpleSegment(0,0,p.length,b.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(u.TEXTURE1);const j=u.createTexture();u.bindTexture(u.TEXTURE_2D,j),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(j),Xa(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const u=this._cachedRenderContext.context,p=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,p.TRIANGLES,ms.disabled,Bs.disabled,nr.unblended,As.disabled,((b,j)=>({u_input:b,u_output_expected:j}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Xa(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const b=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Xa(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Io._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const zo=c.a5/128;function wf(x,t){const a=x.granularity!==void 0?Math.max(x.granularity,1):1,u=a+(x.generateBorders?2:0),p=a+(x.extendToNorthPole||x.generateBorders?1:0)+(x.extendToSouthPole||x.generateBorders?1:0),b=u+1,j=p+1,E=x.generateBorders?-1:0,M=x.generateBorders||x.extendToNorthPole?-1:0,z=a+(x.generateBorders?1:0),L=a+(x.generateBorders||x.extendToSouthPole?1:0),q=b*j,V=u*p*6,J=b*j>65536;if(J&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ie=J||t==="32bit",fe=new Int16Array(2*q);let ye=0;for(let Me=M;Me<=L;Me++)for(let we=E;we<=z;we++){let ke=we/a*c.a5;we===-1&&(ke=-zo),we===a+1&&(ke=c.a5+zo);let De=Me/a*c.a5;Me===-1&&(De=x.extendToNorthPole?c.br:-zo),Me===a+1&&(De=x.extendToSouthPole?c.bs:c.a5+zo),fe[ye++]=ke,fe[ye++]=De}const ge=ie?new Uint32Array(V):new Uint16Array(V);let Se=0;for(let Me=0;Me<p;Me++)for(let we=0;we<u;we++){const ke=we+1+Me*b,De=we+(Me+1)*b,je=we+1+(Me+1)*b;ge[Se++]=we+Me*b,ge[Se++]=De,ge[Se++]=ke,ge[Se++]=ke,ge[Se++]=De,ge[Se++]=je}return{vertices:fe.buffer.slice(0),indices:ge.buffer.slice(0),uses32bitIndices:ie}}const Kc=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class eh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Cr.projectionGlobe}get vertexShaderPreludeCode(){return Cr.projectionMercator.vertexSource}get subdivisionGranularity(){return Kc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Io(t));const a=c.X(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(a,u),b=Y();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=b);const j=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(j))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,u,p,b){const j=(b==="stencil"?Kc.stencil:Kc.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:j,generateBorders:u,extendToNorthPole:a.y===0&&p,extendToSouthPole:a.y===(1<<a.z)-1&&p})}_getMesh(t,a){const u=this._getMeshKey(a);if(u in this._tileMeshCache)return this._tileMeshCache[u];const p=(function(b,j){const E=wf(j,"16bit"),M=c.aW.deserialize({arrayBuffer:E.vertices,length:E.vertices.byteLength/2/2}),z=c.aY.deserialize({arrayBuffer:E.indices,length:E.indices.byteLength/2/3});return new ur(b.createVertexBuffer(M,Ya.members),b.createIndexBuffer(z),c.aX.simpleSegment(0,0,M.length,z.length))})(t,a);return this._tileMeshCache[u]=p,p}recalculate(t){}hasTransition(){const t=Y();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const im=new c.t({type:new c.D(c.u.projection.type)});class th extends c.E{constructor(t){super(),this._transitionable=new c.x(im,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new mi,this._verticalPerspectiveProjection=new eh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof c.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,u,p,b){return this.currentProjection.getMeshFromTileID(t,a,u,p,b)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Xi(x){const t=gl(x.worldSize,x.center.lat);return 2*Math.PI*t}function zn(x,t,a,u,p){const b=1/(1<<p),j=t/c.a5*b+u*b,E=c.bz((x/c.a5*b+a*b)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-j*Math.PI*2))-.5*Math.PI,z=Math.cos(M),L=new Float64Array(3);return L[0]=Math.sin(E)*z,L[1]=Math.sin(M),L[2]=Math.cos(E)*z,L}function kr(x){return(function(t,a){const u=Math.cos(a),p=new Float64Array(3);return p[0]=Math.sin(t)*u,p[1]=Math.sin(a),p[2]=Math.cos(t)*u,p})(x.lng*Math.PI/180,x.lat*Math.PI/180)}function gl(x,t){return x/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Jc(x){const t=Math.asin(x[1])/Math.PI*180,a=Math.sqrt(x[0]*x[0]+x[2]*x[2]);if(a>1e-6){const u=x[0]/a,p=Math.acos(x[2]/a),b=(u>0?p:-p)/Math.PI*180;return new c.V(c.W(b,-180,180),t)}return new c.V(0,t)}function Qc(x){return Math.cos(x*Math.PI/180)}function $r(x,t){const a=Qc(x),u=Qc(t);return c.at(u/a)}function Sf(x,t){const a=x.rotate(t.bearingInRadians),u=t.zoom+$r(t.center.lat,0),p=c.bu(1/Qc(t.center.lat),1/Qc(Math.min(Math.abs(t.center.lat),60)),c.bx(u,7,3,0,1)),b=360/Xi({worldSize:t.worldSize,center:{lat:t.center.lat}});return new c.V(t.center.lng-a.x*b*p,c.an(t.center.lat+a.y*b,-c.ao,c.ao))}function Ju(x){const t=.5*x,a=Math.sin(t),u=Math.cos(t);return Math.log(a+u)-Math.log(u-a)}function jf(x,t,a,u){const p=x.lat+a*u;if(Math.abs(a)>1){const b=(Math.sign(x.lat+a)!==Math.sign(x.lat)?-Math.abs(x.lat):Math.abs(x.lat))*Math.PI/180,j=Math.abs(x.lat+a)*Math.PI/180,E=Ju(b+u*(j-b)),M=Ju(b),z=Ju(j);return new c.V(x.lng+t*((E-M)/(z-M)),p)}return new c.V(x.lng+t*u,p)}class am{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,u,p){const b=`${t.z}_${t.x}_${t.y}_${p?.terrain?"t":""}`,j=this._cache.get(b);if(j)return j;const E=this._cachePrevious.get(b);if(E)return this._cache.set(b,E),E;const M=this._boundingVolumeFactory(t,a,u,p);return this._cache.set(b,M),this._hadAnyChanges=!0,M}}class nc{constructor(t,a,u,p){this.min=u,this.max=p,this.points=t,this.planes=a}static fromAabb(t,a){const u=[];for(let p=0;p<8;p++)u.push([1&~p?t[0]:a[0],(p>>1&1)==1?a[1]:t[1],(p>>2&1)==1?a[2]:t[2]]);return new nc(u,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,u){const p=c.bB([],u[0],u[1],u[2]),b=c.bC([],[a[0],0,0],p),j=c.bC([],[0,a[1],0],p),E=c.bC([],[0,0,a[2]],p),M=[...t],z=[...t];for(let q=0;q<8;q++)for(let V=0;V<3;V++){const J=t[V]+b[V]*(1&~q?-1:1)+j[V]*((q>>1&1)==1?1:-1)+E[V]*((q>>2&1)==1?1:-1);M[V]=Math.min(M[V],J),z[V]=Math.max(z[V],J)}const L=[];for(let q=0;q<8;q++){const V=[...t];c.b0(V,V,c.a$([],b,1&~q?-1:1)),c.b0(V,V,c.a$([],j,(q>>1&1)==1?1:-1)),c.b0(V,V,c.a$([],E,(q>>2&1)==1?1:-1)),L.push(V)}return new nc(L,[[...b,-c.b5(b,L[0])],[...j,-c.b5(j,L[0])],[...E,-c.b5(E,L[0])],[-b[0],-b[1],-b[2],-c.b5(b,L[7])],[-j[0],-j[1],-j[2],-c.b5(j,L[7])],[-E[0],-E[1],-E[2],-c.b5(E,L[7])]],M,z)}intersectsFrustum(t){let a=!0;const u=this.points.length,p=this.planes.length,b=t.planes.length,j=t.points.length;for(let E=0;E<b;E++){const M=t.planes[E];let z=0;for(let L=0;L<u;L++){const q=this.points[L];M[0]*q[0]+M[1]*q[1]+M[2]*q[2]+M[3]>=0&&z++}if(z===0)return 0;z<u&&(a=!1)}if(a)return 2;for(let E=0;E<p;E++){const M=this.planes[E];let z=0;for(let L=0;L<j;L++){const q=t.points[L];M[0]*q[0]+M[1]*q[1]+M[2]*q[2]+M[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let u=0;for(let p=0;p<a;p++){const b=this.points[p];t[0]*b[0]+t[1]*b[1]+t[2]*b[2]+t[3]>=0&&u++}return u===a?2:u===0?0:1}}function Qu(x,t,a){const u=x-t;return u<0?-u:Math.max(0,u-a)}function oc(x,t,a,u,p){const b=x-a;let j;return j=b<0?Math.min(-b,1+b-p):b>1?Math.min(Math.max(b-p,0),1-b):0,Math.max(j,Qu(t,u,p))}class sh{constructor(){this._boundingVolumeCache=new am(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,u,p){const b=1<<u.z,j=1/b,E=u.x/b,M=u.y/b;let z=2;return z=Math.min(z,oc(t,a,E,M,j)),z=Math.min(z,oc(t,a,E+.5,-M-j,j)),z=Math.min(z,oc(t,a,E+.5,2-M-j,j)),z}getWrap(t,a,u){const p=1<<a.z,b=1/p,j=a.x/p,E=Qu(t.x,j,b),M=Qu(t.x,j-1,b),z=Qu(t.x,j+1,b),L=Math.min(E,M,z);return L===z?1:L===M?-1:0}allowVariableZoom(t,a){return ls(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,u,p){return this._boundingVolumeCache.getTileBoundingVolume(t,a,u,p)}_computeTileBoundingVolume(t,a,u,p){var b,j;let E=0,M=0;if(p?.terrain){const z=new c.a2(t.z,a,t.z,t.x,t.y),L=p.terrain.getMinMaxElevation(z);E=(b=L.minElevation)!==null&&b!==void 0?b:Math.min(0,u),M=(j=L.maxElevation)!==null&&j!==void 0?j:Math.max(0,u)}if(E/=c.bE,M/=c.bE,E+=1,M+=1,t.z<=0)return nc.fromAabb([-M,-M,-M],[M,M,M]);if(t.z===1)return nc.fromAabb([t.x===0?-M:0,t.y===0?0:-M,-M],[t.x===0?0:M,t.y===0?M:0,M]);{const z=[zn(0,0,t.x,t.y,t.z),zn(c.a5,0,t.x,t.y,t.z),zn(c.a5,c.a5,t.x,t.y,t.z),zn(0,c.a5,t.x,t.y,t.z)],L=[];for(const et of z)L.push(c.a$([],et,M));if(M!==E)for(const et of z)L.push(c.a$([],et,E));t.y===0&&L.push([0,1,0]),t.y===(1<<t.z)-1&&L.push([0,-1,0]);const q=[1,1,1],V=[-1,-1,-1];for(const et of L)for(let tt=0;tt<3;tt++)q[tt]=Math.min(q[tt],et[tt]),V[tt]=Math.max(V[tt],et[tt]);const J=zn(c.a5/2,c.a5/2,t.x,t.y,t.z),ie=c.b4([],[0,1,0],J);c.b3(ie,ie);const fe=c.b4([],J,ie);c.b3(fe,fe);const ye=c.b4([],z[2],z[1]);c.b3(ye,ye);const ge=c.b4([],z[0],z[3]);c.b3(ge,ge),L.push(c.a$([],J,M)),t.y>=(1<<t.z)/2&&L.push(c.a$([],zn(c.a5/2,0,t.x,t.y,t.z),M)),t.y<(1<<t.z)/2&&L.push(c.a$([],zn(c.a5/2,c.a5,t.x,t.y,t.z),M));const Se=eu(J,L),Me=eu(fe,L),we=[-J[0],-J[1],-J[2],Se.max],ke=[J[0],J[1],J[2],-Se.min],De=[-fe[0],-fe[1],-fe[2],Me.max],je=[fe[0],fe[1],fe[2],-Me.min],qe=[...ye,0],st=[...ge,0],Ke=[];return t.y===0?Ke.push(c.bD(st,qe,we),c.bD(st,qe,ke)):Ke.push(c.bD(De,qe,we),c.bD(De,qe,ke),c.bD(De,st,we),c.bD(De,st,ke)),t.y===(1<<t.z)-1?Ke.push(c.bD(st,qe,we),c.bD(st,qe,ke)):Ke.push(c.bD(je,qe,we),c.bD(je,qe,ke),c.bD(je,st,we),c.bD(je,st,ke)),new nc(Ke,[we,ke,De,je,qe,st],q,V)}}}function eu(x,t){let a=1/0,u=-1/0;for(const p of t){const b=c.b5(x,p);a=Math.min(a,b),u=Math.max(u,b)}return{min:a,max:u}}class lc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,u){return this._helper.interpolatePadding(t,a,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,u)=>{const p=c.an(a.lat,-c.ao,c.ao),b=c.an(+u,this.minZoom+$r(0,p),this.maxZoom);return{center:new c.V(a.lng,p),zoom:b}},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new Do({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},t),this._coveringTilesDetailsProvider=new sh}clone(){const t=new lc;return t.apply(this,!1),t}apply(t,a,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(t,a)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=c.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:u}=t,p=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,u=this.cameraToCenterDistance/t,p=Math.sin(a)*u,b=Math.cos(a)*u+1,j=1/Math.sqrt(p*p+b*b)*1;let E=-p,M=b;const z=Math.sqrt(E*E+M*M);E/=z,M/=z;const L=[0,E,M];c.bG(L,L,[0,0,0],-this.bearingInRadians),c.bH(L,L,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(L,L,[0,0,0],this.center.lng*Math.PI/180);const q=1/c.b7(L);return c.a$(L,L,q),[...L,-j*q]}isLocationOccluded(t){return!this.isSurfacePointVisible(kr(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,p=Math.cos(u),b=[Math.sin(a)*p,Math.sin(u),Math.cos(a)*p],j=[b[2],0,-b[0]],E=[0,0,0];c.b4(E,j,b),c.b3(j,j),c.b3(E,E);const M=[0,0,0];return c.b3(M,[j[0]*t[0]+E[0]*t[1]+b[0]*t[2],j[1]*t[0]+E[1]*t[1]+b[1]*t[2],j[2]*t[0]+E[2]*t[1]+b[2]*t[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,u){const p=(function(E,M,z){const L=1/(1<<z.z);return new c.a9(E/c.a5*L+z.x*L,M/c.a5*L+z.y*L)})(t,a,u.canonical),b=(j=p.y,[c.bz(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-j*Math.PI*2))-.5*Math.PI]);var j;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(t,a,u,p){const b=u.canonical,j=zn(t,a,b.x,b.y,b.z),E=1+(p?p(t,a):0)/c.bE,M=[j[0]*E,j[1]*E,j[2]*E,1];c.aH(M,M,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,L=z[0]*j[0]+z[1]*j[1]+z[2]*j[2]+z[3]<0;return{point:new c.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:L}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=gl(this.worldSize,this.center.lat),a=c.bk(),u=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),c.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;a[8]=2*-p.x/this._helper._width,a[9]=2*p.y/this._helper._height,this._projectionMatrix=c.bf(a),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,a),c.O(a,a,[0,0,-this.cameraToCenterDistance]),c.bg(a,a,this.rollInRadians),c.bh(a,a,-this.pitchInRadians),c.bg(a,a,this.bearingInRadians),c.O(a,a,[0,0,-t]);const b=c.bA();b[0]=t,b[1]=t,b[2]=t,c.bh(u,a,this.center.lat*Math.PI/180),c.bJ(u,u,-this.center.lng*Math.PI/180),c.Q(u,u,b),this._globeViewProjMatrixNoCorrection=u,c.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(a,a,-this.center.lng*Math.PI/180),c.Q(a,a,b),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,u);const j=c.bA();this._cameraPosition=c.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,c.bG(this._cameraPosition,this._cameraPosition,j,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,j,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,j,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,j,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,j,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const E=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(E,E,[1,1,-1]),this._cachedFrustum=Wi.fromInvProjectionMatrix(E,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){c.w("calculateFogMatrix is not supported on globe projection.");const a=c.bk();return c.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new c.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=kr(t);c.a$(u,u,1+a/c.bE);const p=c.bF();return c.aH(p,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,u=[new c.P(0,0),new c.P(t,0),new c.P(this.width,0),new c.P(this.width,a),new c.P(this.width,this.height),new c.P(t,this.height),new c.P(0,this.height),new c.P(0,a)],p=[];for(const q of u)p.push(this.unprojectScreenPoint(q));let b=0,j=0,E=0,M=0;const z=this.center;for(const q of p){const V=c.bK(z.lng,q.lng),J=c.bK(z.lat,q.lat);V<j&&(j=V),V>b&&(b=V),J<M&&(M=J),J>E&&(E=J)}const L=[z.lng+j,z.lat+M,z.lng+b,z.lat+E];return this.isSurfacePointOnScreen([0,1,0])&&(L[3]=90,L[0]=-180,L[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(L[1]=-90,L[0]=-180,L[2]=180),new Os(L)}calculateCenterFromCameraLngLatAlt(t,a,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,u,p)}setLocationAtPoint(t,a){const u=kr(this.unprojectScreenPoint(a)),p=kr(t),b=c.bA();c.bL(b);const j=c.bA();c.bI(j,u,b,-this.center.lng*Math.PI/180),c.bH(j,j,b,this.center.lat*Math.PI/180);const E=p[0]*p[0]+p[2]*p[2],M=j[0]*j[0];if(E<M)return;const z=Math.sqrt(E-M),L=-z,q=c.bM(p[0],p[2],j[0],z),V=c.bM(p[0],p[2],j[0],L),J=c.bA();c.bI(J,p,b,-q);const ie=c.bM(J[1],J[2],j[1],j[2]),fe=c.bA();c.bI(fe,p,b,-V);const ye=c.bM(fe[1],fe[2],j[1],j[2]),ge=.5*Math.PI,Se=ie>=-ge&&ie<=ge,Me=ye>=-ge&&ye<=ge;let we,ke;if(Se&&Me){const st=this.center.lng*Math.PI/180,Ke=this.center.lat*Math.PI/180;c.bN(q,st)+c.bN(ie,Ke)<c.bN(V,st)+c.bN(ye,Ke)?(we=q,ke=ie):(we=V,ke=ye)}else if(Se)we=q,ke=ie;else{if(!Me)return;we=V,ke=ye}const De=we/Math.PI*180,je=ke/Math.PI*180,qe=this.center.lat;this.setCenter(new c.V(De,c.an(je,-90,90))),this.setZoom(this.zoom+$r(qe,this.center.lat))}locationToScreenPoint(t,a){const u=kr(t);if(a){const p=a.getElevationForLngLatZoom(t,this._helper._tileZoom);c.a$(u,u,1+p/c.bE)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(t){const a=c.bF();return c.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new c.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const u=a.pointCoordinate(t);if(u)return u}return c.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var u;return(u=this.screenPointToMercatorCoordinate(t,a))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(t,a){const u=this._cameraPosition,p=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(u,p)}getRayDirectionFromPixel(t){const a=c.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,c.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const u=c.bA();u[0]=a[0]-this._cameraPosition[0],u[1]=a[1]-this._cameraPosition[1],u[2]=a[2]-this._cameraPosition[2];const p=c.bA();return c.b3(p,u),p}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=c.bF();return c.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const u=c.b5(t,a),p=c.bA(),b=c.bA();c.a$(b,a,u),c.b2(p,t,b);const j=1-c.b5(p,p);if(j<0)return null;const E=c.b5(t,t)-1,M=-u+(u<0?1:-1)*Math.sqrt(j),z=E/M,L=M;return{tMin:Math.min(z,L),tMax:Math.max(z,L)}}unprojectScreenPoint(t){const a=this._cameraPosition,u=this.getRayDirectionFromPixel(t),p=this.rayPlanetIntersection(a,u);if(p){const L=c.bA();c.b0(L,a,[u[0]*p.tMin,u[1]*p.tMin,u[2]*p.tMin]);const q=c.bA();return c.b3(q,L),Jc(q)}const b=this._cachedClippingPlane,j=b[0]*u[0]+b[1]*u[1]+b[2]*u[2],E=-c.bb(b,a)/j,M=c.bA();if(E>0)c.b0(M,a,[u[0]*E,u[1]*E,u[2]*E]);else{const L=c.bA();c.b0(L,a,[2*u[0],2*u[1],2*u[2]]);const q=c.bb(this._cachedClippingPlane,L);c.b2(M,L,[this._cachedClippingPlane[0]*q,this._cachedClippingPlane[1]*q,this._cachedClippingPlane[2]*q])}const z=(function(L){const q=c.bA();return q[0]=L[0]*-L[3],q[1]=L[1]*-L[3],q[2]=L[2]*-L[3],{center:q,radius:Math.sqrt(1-L[3]*L[3])}})(b);return Jc((function(L,q,V){const J=c.bA();c.b2(J,V,L);const ie=c.bA();return c.by(ie,L,J,q/c.b9(J)),ie})(z.center,z.radius,M))}getMatrixForModel(t,a){const u=c.V.convert(t),p=1/c.bE,b=c.bj();return c.bJ(b,b,u.lng/180*Math.PI),c.bh(b,b,-u.lat/180*Math.PI),c.O(b,b,[0,0,1+a/c.bE]),c.bh(b,b,.5*Math.PI),c.Q(b,b,[p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class cc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,u){return this._helper.interpolatePadding(t,a,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,u=!0){this._helper.resize(t,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,u)=>this.currentTransform.defaultConstrain(a,u),this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new Do({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},t),this._globeness=1,this._mercatorTransform=new ci,this._verticalPerspectiveTransform=new lc}clone(){const t=new cc;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this,!1),t}apply(t,a){this._helper.apply(t,a),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),u=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:a.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,u){const p=this._mercatorTransform.getPitchedTextCorrection(t,a,u),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,u);return c.bu(p,b,this._globeness)}projectTileCoordinates(t,a,u,p){return this.currentTransform.projectTileCoordinates(t,a,u,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,u,p)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return u.fallbackMatrix=a.mainMatrix,u}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Wr{get useGlobeControls(){return!0}handlePanInertia(t,a){const u=Sf(t,a);return Math.abs(u.lng-a.center.lng)>180&&(u.lng=a.center.lng+179.5*Math.sign(u.lng-a.center.lng)),{easingCenter:u,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const u=t.around,p=a.screenPointToLocation(u);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const b=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const j=a.zoom-b;if(j===0)return;const E=c.bK(a.center.lng,p.lng),M=E/(Math.abs(E/180)+1),z=c.bK(a.center.lat,p.lat),L=a.getRayDirectionFromPixel(u),q=a.cameraPosition,V=-1*c.b5(q,L),J=c.bA();c.b0(J,q,[L[0]*V,L[1]*V,L[2]*V]);const ie=c.b7(J)-1,fe=Math.exp(.5*-Math.max(ie-.3,0)),ye=gl(a.worldSize,a.center.lat)/Math.min(a.width,a.height),ge=c.bx(ye,.9,.5,1,.25),Se=(1-c.aq(-j))*Math.min(fe,ge),Me=a.center.lat,we=a.zoom,ke=new c.V(a.center.lng+M*Se,c.an(a.center.lat+z*Se,-c.ao,c.ao));a.setLocationAtPoint(p,u);const De=a.center,je=c.bx(Math.abs(E),45,85,0,1),qe=c.bx(ye,.75,.35,0,1),st=Math.pow(Math.max(je,qe),.25),Ke=c.bK(De.lng,ke.lng),et=c.bK(De.lat,ke.lat);a.setCenter(new c.V(De.lng+Ke*st,De.lat+et*st).wrap()),a.setZoom(we+$r(Me,a.center.lat))}handleMapControlsPan(t,a,u){if(!t.panDelta)return;const p=a.center.lat,b=a.zoom;a.setCenter(Sf(t.panDelta,a).wrap()),a.setZoom(b+$r(p,a.center.lat))}cameraForBoxAndBearing(t,a,u,p,b){const j=fl(t,a,u,p,b),E=a.left/b.width*2-1,M=(b.width-a.right)/b.width*2-1,z=a.top/b.height*-2+1,L=(b.height-a.bottom)/b.height*-2+1,q=c.bK(u.getWest(),u.getEast())<0,V=q?u.getEast():u.getWest(),J=q?u.getWest():u.getEast(),ie=Math.max(u.getNorth(),u.getSouth()),fe=Math.min(u.getNorth(),u.getSouth()),ye=V+.5*c.bK(V,J),ge=ie+.5*c.bK(ie,fe),Se=b.clone();Se.setCenter(j.center),Se.setBearing(j.bearing),Se.setPitch(0),Se.setRoll(0),Se.setZoom(j.zoom);const Me=Se.modelViewProjectionMatrix,we=[kr(u.getNorthWest()),kr(u.getNorthEast()),kr(u.getSouthWest()),kr(u.getSouthEast()),kr(new c.V(J,ge)),kr(new c.V(V,ge)),kr(new c.V(ye,ie)),kr(new c.V(ye,fe))],ke=kr(j.center);let De=Number.POSITIVE_INFINITY;for(const je of we)E<0&&(De=Wr.getLesserNonNegativeNonNull(De,Wr.solveVectorScale(je,ke,Me,"x",E))),M>0&&(De=Wr.getLesserNonNegativeNonNull(De,Wr.solveVectorScale(je,ke,Me,"x",M))),z>0&&(De=Wr.getLesserNonNegativeNonNull(De,Wr.solveVectorScale(je,ke,Me,"y",z))),L<0&&(De=Wr.getLesserNonNegativeNonNull(De,Wr.solveVectorScale(je,ke,Me,"y",L)));if(Number.isFinite(De)&&De!==0)return j.zoom=Se.zoom+c.at(De),j;Yi()}handleJumpToCenterZoom(t,a){const u=t.center.lat,p=t.applyConstrain(a.center?c.V.convert(a.center):t.center,t.zoom).center;t.setCenter(p.wrap());const b=a.zoom!==void 0?+a.zoom:t.zoom+$r(u,p.lat);t.zoom!==b&&t.setZoom(b)}handleEaseTo(t,a){const u=t.zoom,p=t.center,b=t.padding,j={roll:t.roll,pitch:t.pitch,bearing:t.bearing},E={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},M=a.zoom!==void 0,z=!t.isPaddingEqual(a.padding);let L=!1;const q=a.center?c.V.convert(a.center):p,V=t.applyConstrain(q,u).center;In(t,V);const J=t.clone();J.setCenter(V),J.setZoom(M?+a.zoom:u+$r(p.lat,q.lat)),J.setBearing(a.bearing);const ie=new c.P(c.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));J.setLocationAtPoint(V,ie);const fe=(a.offset&&a.offsetAsPoint.mag())>0?J.center:V,ye=M?+a.zoom:u+$r(p.lat,fe.lat),ge=u+$r(p.lat,0),Se=ye+$r(fe.lat,0),Me=c.bK(p.lng,fe.lng),we=c.bK(p.lat,fe.lat),ke=c.aq(Se-ge);return L=ye!==u,{easeFunc:De=>{if(c.bo(j,E)||Yc({startEulerAngles:j,endEulerAngles:E,tr:t,k:De,useSlerp:j.roll!=E.roll}),z&&t.interpolatePadding(b,a.padding,De),a.around)c.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const je=Se>ge?Math.min(2,ke):Math.max(.5,ke),qe=Math.pow(je,1-De),st=jf(p,Me,we,De*qe);t.setCenter(st.wrap())}if(L){const je=c.G.number(ge,Se,De)+$r(0,t.center.lat);t.setZoom(je)}},isZooming:L,elevationCenter:fe}}handleFlyTo(t,a){const u=a.zoom!==void 0,p=t.center,b=t.zoom,j=t.padding,E=!t.isPaddingEqual(a.padding),M=t.applyConstrain(c.V.convert(a.center||a.locationAtOffset),b).center,z=u?+a.zoom:t.zoom+$r(t.center.lat,M.lat),L=t.clone();L.setCenter(M),L.setZoom(z),L.setBearing(a.bearing);const q=new c.P(c.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));L.setLocationAtPoint(M,q);const V=L.center;In(t,V);const J=(function(we,ke,De){const je=kr(ke),qe=kr(De),st=c.b5(je,qe),Ke=Math.acos(st),et=Xi(we);return Ke/(2*Math.PI)*et})(t,p,V),ie=b+$r(p.lat,0),fe=z+$r(V.lat,0),ye=c.aq(fe-ie);let ge;if(typeof a.minZoom=="number"){const we=+a.minZoom+$r(V.lat,0),ke=Math.min(we,ie,fe)+$r(0,V.lat),De=t.applyConstrain(V,ke).zoom+$r(V.lat,0);ge=c.aq(De-ie)}const Se=c.bK(p.lng,V.lng),Me=c.bK(p.lat,V.lat);return{easeFunc:(we,ke,De,je)=>{const qe=jf(p,Se,Me,De);E&&t.interpolatePadding(j,a.padding,we);const st=we===1?V:qe;t.setCenter(st.wrap());const Ke=ie+c.at(ke);t.setZoom(we===1?z:Ke+$r(0,st.lat))},scaleOfZoom:ye,targetCenter:V,scaleOfMinZoom:ge,pixelPathLength:J}}static solveVectorScale(t,a,u,p,b){const j=p==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],E=[u[3],u[7],u[11],u[15]],M=t[0]*j[0]+t[1]*j[1]+t[2]*j[2],z=t[0]*E[0]+t[1]*E[1]+t[2]*E[2],L=a[0]*j[0]+a[1]*j[1]+a[2]*j[2],q=a[0]*E[0]+a[1]*E[1]+a[2]*E[2];return L+b*z===M+b*q||E[3]*(M-L)+j[3]*(q-z)+M*q==L*z?null:(L+j[3]-b*q-b*E[3])/(L-M-b*q+b*z)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class uc{constructor(t){this._globe=t,this._mercatorCameraHelper=new pl,this._verticalPerspectiveCameraHelper=new Wr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,u){this.currentHelper.handleMapControlsPan(t,a,u)}cameraForBoxAndBearing(t,a,u,p,b){return this.currentHelper.cameraForBoxAndBearing(t,a,u,p,b)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const dc=(x,t)=>c.B(x,t&&t.filter((a=>a.identifier!=="source.canvas"))),hc=c.bO();class Oo extends c.E{constructor(t,a={}){var u,p;super(),this._rtlPluginLoaded=()=>{for(const j in this.tileManagers){const E=this.tileManagers[j].getSource().type;E!=="vector"&&E!=="geojson"||this.tileManagers[j].reload()}},this.map=t,this.dispatcher=new js(ys(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((j,E)=>this.getGlyphs(j,E))),this.dispatcher.registerMessageHandler("GI",((j,E)=>this.getImages(j,E))),this.dispatcher.registerMessageHandler("GDA",((j,E)=>this.getDashes(j,E))),this.imageManager=new Et,this.imageManager.setEventedParent(this);const b=((u=t._container)===null||u===void 0?void 0:u.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new We(t._requestManager,a.localIdeographFontFamily,b),this.lineAtlas=new nt(256,512),this.crossTileSymbolIndex=new pi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),K().on(Ls,this._rtlPluginLoaded),this.on("data",(j=>{if(j.dataType!=="source"||j.sourceDataType!=="metadata")return;const E=this.tileManagers[j.sourceId];if(!E)return;const M=E.getSource();if(M&&M.vectorLayerIds)for(const z in this._layers){const L=this._layers[z];L.source===M.id&&this._validateLayer(L)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var u,p,b;this._checkLoaded();const j=a===null?(b=(p=(u=this.stylesheet.state)===null||u===void 0?void 0:u[t])===null||p===void 0?void 0:p.default)!==null&&b!==void 0?b:null:a;if(c.bR(j,this._globalState[t]))return this;this._globalState[t]=j,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const u in t)!c.bR(this._globalState[u],t[u].default)&&(a.push(u),this._globalState[u]=t[u].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,u={};for(const p of t){u[p]=this._globalState[p];for(const b in this._layers){const j=this._layers[b],E=j.getLayoutAffectingGlobalStateRefs(),M=j.getPaintAffectingGlobalStateRefs(),z=j.getVisibilityAffectingGlobalStateRefs();if(E.has(p)&&a.add(j.source),M.has(p))for(const{name:L,value:q}of M.get(p))this._updatePaintProperty(j,L,q);z?.has(p)&&(j.recalculateVisibility(),this._updateLayer(j))}}this.dispatcher.broadcast("UGS",u);for(const p in this.tileManagers)a.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(t,a={},u){this.fire(new c.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const p=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;c.j(p,this._loadStyleRequest).then((j=>{this._loadStyleRequest=null,this._load(j.data,a,u)})).catch((j=>{this._loadStyleRequest=null,j&&!b.signal.aborted&&this.fire(new c.k(j))}))}loadJSON(t,a={},u){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ae.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,u)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(hc,{validate:!1})}_load(t,a,u){var p,b;let j=a.transformStyle?a.transformStyle(u,t):t;if(!a.validate||!dc(this,c.C(j))){j=Object.assign({},j),this._loaded=!0,this.stylesheet=j;for(const E in j.sources)this.addSource(E,j.sources[E],{validate:!1});j.sprite?this._loadSprite(j.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(j.glyphs),this._createLayers(),this.light=new Pe(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new Le(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var t,a,u;const p=c.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",p),this._order=p.map((b=>b.id)),this._layers={},this._serializedLayers=null;for(const b of p){const j=c.bT(b,this._globalState);if(j.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=j,c.bU(j)&&this.tileManagers[j.source]){const E=(u=(a=b.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&u!==void 0?u:j.paint.get("raster-fade-duration");this.tileManagers[j.source].setRasterFadeDuration(E)}}}_loadSprite(t,a=!1,u=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let b;this._spriteRequest=p,(function(j,E,M,z){return c._(this,void 0,void 0,(function*(){const L=Ae(j),q=M>1?"@2x":"",V={},J={};for(const{id:ie,url:fe}of L){const ye=E.transformRequest(Ye(fe,q,".json"),"SpriteJSON");V[ie]=c.j(ye,z);const ge=E.transformRequest(Ye(fe,q,".png"),"SpriteImage");J[ie]=$e.getImage(ge,z)}return yield Promise.all([...Object.values(V),...Object.values(J)]),(function(ie,fe){return c._(this,void 0,void 0,(function*(){const ye={};for(const ge in ie){ye[ge]={};const Se=ae.getImageCanvasContext((yield fe[ge]).data),Me=(yield ie[ge]).data;for(const we in Me){const{width:ke,height:De,x:je,y:qe,sdf:st,pixelRatio:Ke,stretchX:et,stretchY:tt,content:Rt,textFitWidth:It,textFitHeight:St}=Me[we];ye[ge][we]={data:null,pixelRatio:Ke,sdf:st,stretchX:et,stretchY:tt,content:Rt,textFitWidth:It,textFitHeight:St,spriteData:{width:ke,height:De,x:je,y:qe,context:Se}}}}return ye}))})(V,J)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((j=>{if(this._spriteRequest=null,j)for(const E in j){this._spritesImagesIds[E]=[];const M=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter((z=>!(z in j))):[];for(const z of M)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in j[E]){const L=E==="default"?z:`${E}:${z}`;this._spritesImagesIds[E].push(L),L in this.imageManager.images?this.imageManager.updateImage(L,j[E][z],!1):this.imageManager.addImage(L,j[E][z]),a&&(this._changedImages[L]=!0)}}})).catch((j=>{this._spriteRequest=null,b=j,p.signal.aborted||this.fire(new c.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),u&&u(b)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const u=t.sourceLayer;if(!u)return;const p=a.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(u)===-1)&&this.fire(new c.k(new Error(`Source layer "${u}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const u=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?c.bV(u):u);const p=[];for(const b of t)if(u[b]){const j=a?c.bV(u[b]):u[b];p.push(j)}return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const u of a){const p=this._layers[u];p.type!=="custom"&&(t[u]=p.serialize())}return t}hasTransitions(){var t,a,u;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const p in this.tileManagers)if(this.tileManagers[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const p=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(p.length||b.length)&&this._updateWorkerLayers(p,b);for(const j in this._updatedSources){const E=this._updatedSources[j];if(E==="reload")this._reloadSource(j);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(j)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const u={};for(const p in this.tileManagers){const b=this.tileManagers[p];u[p]=b.used,b.used=!1}for(const p of this._order){const b=this._layers[p];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.tileManagers[b.source].used=!0)}for(const p in u){const b=this.tileManagers[p];!!u[p]!=!!b.used&&b.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var u;this._checkLoaded();const p=this.serialize();if(t=a.transformStyle?a.transformStyle(p,t):t,((u=a.validate)===null||u===void 0||u)&&dc(this,c.C(t)))return!1;(t=c.bV(t)).layers=c.bS(t.layers);const b=c.bW(p,t),j=this._getOperationsToPerform(b);if(j.unimplemented.length>0)throw new Error(`Unimplemented: ${j.unimplemented.join(", ")}.`);if(j.operations.length===0)return!1;for(const E of j.operations)E();return this.stylesheet=t,this._serializedLayers=null,this.fire(new c.l("style.load",{style:this})),!0}_getOperationsToPerform(t){const a=[],u=[];for(const p of t)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":a.push((()=>{}));break;default:u.push(p.command)}return{operations:a,unimplemented:u}}addImage(t,a){if(this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,u={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(c.C.source,`sources.${t}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const p=this.tileManagers[t]=new Hs(t,a,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t}))),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new c.k(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.tileManagers[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,u={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new c.k(new Error(`Layer "${p}" already exists on this map.`)));let b;if(t.type==="custom"){if(dc(this,c.bX(t)))return;b=c.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=c.bV(t),t=c.e(t,{source:p})),this._validate(c.C.layer,`layers.${p}`,t,{arrayIndex:-1},u))return;b=c.bT(t,this._globalState),this._validateLayer(b),b.setEventedParent(this,{layer:{id:p}})}const j=a?this._order.indexOf(a):this._order.length;if(a&&j===-1)this.fire(new c.k(new Error(`Cannot add layer "${p}" before non-existing layer "${a}".`)));else{if(this._order.splice(j,0,p),this._layerOrderChanged=!0,this._layers[p]=b,this._removedLayers[p]&&b.source&&b.type!=="custom"){const E=this._removedLayers[p];delete this._removedLayers[p],E.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.tileManagers[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const u=this._order.indexOf(t);this._order.splice(u,1);const p=a?this._order.indexOf(a):this._order.length;a&&p===-1?this.fire(new c.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,u){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===a&&p.maxzoom===u||(a!=null&&(p.minzoom=a),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,u={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!c.bR(p.filter,a))return a==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(c.C.filter,`layers.${p.id}.filter`,a,null,u)||(p.setFilter(c.bV(a)),this._updateLayer(p)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,u,p={}){this._checkLoaded();const b=this.getLayer(t);b?c.bR(b.getLayoutProperty(a),u)||(b.setLayoutProperty(a,u,p),this._updateLayer(b)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const u=this.getLayer(t);if(u)return u.getLayoutProperty(a);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,u,p={}){this._checkLoaded();const b=this.getLayer(t);b?c.bR(b.getPaintProperty(a),u)||this._updatePaintProperty(b,a,u,p):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,u,p={}){t.setPaintProperty(a,u,p)&&this._updateLayer(t),c.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(u),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const u=t.source,p=t.sourceLayer,b=this.tileManagers[u];if(b===void 0)return void this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)));const j=b.getSource().type;j==="geojson"&&p?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):j!=="vector"||p?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(p,t.id,a)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const u=t.source,p=this.tileManagers[u];if(p===void 0)return void this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)));const b=p.getSource().type,j=b==="vector"?t.sourceLayer:void 0;b!=="vector"||j?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(j,t.id,a):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,u=t.sourceLayer,p=this.tileManagers[a];if(p!==void 0)return p.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(u,t.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.bY(this.tileManagers,(b=>b.serialize())),a=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,p=this.stylesheet;return c.bZ({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:t,layers:a,terrain:u},(b=>b!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=j=>this._layers[j].type==="fill-extrusion",u={},p=[];for(let j=this._order.length-1;j>=0;j--){const E=this._order[j];if(a(E)){u[E]=j;for(const M of t){const z=M[E];if(z)for(const L of z)p.push(L)}}}p.sort(((j,E)=>E.intersectionZ-j.intersectionZ));const b=[];for(let j=this._order.length-1;j>=0;j--){const E=this._order[j];if(a(E))for(let M=p.length-1;M>=0;M--){const z=p[M].feature;if(u[z.layer.id]<j)break;b.push(z),p.pop()}else for(const M of t){const z=M[E];if(z)for(const L of z)b.push(L.feature)}}return b}queryRenderedFeatures(t,a,u){a&&a.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const p={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of a.layers){const L=this._layers[z];if(!L)return this.fire(new c.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];p[L.source]=!0}}const b=[];a.availableImages=this._availableImages;const j=this._serializedAllLayers(),E=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,M=Object.assign(Object.assign({},a),{layers:E,globalState:this._globalState});for(const z in this.tileManagers)a.layers&&!p[z]||b.push(Rr(this.tileManagers[z],this._layers,j,t,M,u,this.map.terrain?(L,q,V)=>this.map.terrain.getElevation(L,q,V):void 0));return this.placement&&b.push((function(z,L,q,V,J,ie,fe){const ye={},ge=ie.queryRenderedSymbols(V),Se=[];for(const Me of Object.keys(ge).map(Number))Se.push(fe[Me]);Se.sort(us);for(const Me of Se){const we=Me.featureIndex.lookupSymbolFeatures(ge[Me.bucketInstanceId],L,Me.bucketIndex,Me.sourceLayerIndex,{filterSpec:J.filter,globalState:J.globalState},J.layers,J.availableImages,z);for(const ke in we){const De=ye[ke]=ye[ke]||[],je=we[ke];je.sort(((qe,st)=>{const Ke=Me.featureSortOrder;if(Ke){const et=Ke.indexOf(qe.featureIndex);return Ke.indexOf(st.featureIndex)-et}return st.featureIndex-qe.featureIndex}));for(const qe of je)De.push(qe)}}return(function(Me,we,ke){for(const De in Me)for(const je of Me[De])xs(je,ke[we[De].source]);return Me})(ye,z,q)})(this._layers,j,this.tileManagers,t,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,a){a?.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.tileManagers[t];return u?(function(p,b){const j=p.getRenderableIds().map((z=>p.getTileByID(z))),E=[],M={};for(let z=0;z<j.length;z++){const L=j[z],q=L.tileID.canonical.key;M[q]||(M[q]=!0,L.querySourceFeatures(E,b))}return E})(u,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const j in t)if(!c.bR(t[j],u[j])){p=!0;break}if(!p)return;const b={now:Y(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(b)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.stylesheet.projection=t,this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const u=this.getSky();let p=!1;if(!t&&!u)return;if(t&&!u)p=!0;else if(!t&&u)p=!0;else for(const j in t)if(!c.bR(t[j],u[j])){p=!0;break}if(!p)return;const b={now:Y(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(b)}_setProjectionInternal(t){const a=(function(u,p){const b={constrainOverride:p};if(Array.isArray(u)){const j=new th({type:u});return{projection:j,transform:new cc(b),cameraHelper:new uc(j)}}switch(u){case"mercator":return{projection:new mi,transform:new ci(b),cameraHelper:new pl};case"globe":{const j=new th({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:j,transform:new cc(b),cameraHelper:new uc(j)}}case"vertical-perspective":return{projection:new eh,transform:new lc(b),cameraHelper:new Wr};default:return c.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new mi,transform:new ci(b),cameraHelper:new pl}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const u in this.tileManagers)this.tileManagers[u].reload()}_validate(t,a,u,p,b={}){return(!b||b.validate!==!1)&&dc(this,t.call(c.C,c.e({key:a,style:this.serialize(),value:u,styleSpec:c.u},p)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),K().off(Ls,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const u=this.tileManagers[a];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,u,p,b=!1){let j=!1,E=!1;const M={};for(const z of this._order){const L=this._layers[z];if(L.type!=="symbol")continue;if(!M[L.source]){const V=this.tileManagers[L.source];M[L.source]=V.getRenderableIds(!0).map((J=>V.getTileByID(J))).sort(((J,ie)=>ie.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ie.tileID)?-1:1)))}const q=this.crossTileSymbolIndex.addLayer(L,M[L.source],t.center.lng);j=j||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Y(),t.zoom))&&(this.pauseablePlacement=new ac(t,this.map.terrain,this._order,b,a,u,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Y()),E=!0),j&&this.pauseablePlacement.placement.setStale()),E||j)for(const z of this._order){const L=this._layers[z];L.type==="symbol"&&this.placement.updateLayerOpacities(L,M[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Y())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return c._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,a.icons),u}))}getGlyphs(t,a){return c._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(a.stacks),p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(c.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return c._(this,void 0,void 0,(function*(){const u={};for(const[p,b]of Object.entries(a.dashes))u[p]=this.lineAtlas.getDash(b.dasharray,b.round);return u}))}addSprite(t,a,u={},p){this._checkLoaded();const b=[{id:t,url:a}],j=[...Ae(this.stylesheet.sprite),...b];this._validate(c.C.sprite,"sprite",j,null,u)||(this.stylesheet.sprite=j,this._loadSprite(b,!0,p))}removeSprite(t){this._checkLoaded();const a=Ae(this.stylesheet.sprite);if(a.find((u=>u.id===t))){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;a.splice(a.findIndex((u=>u.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ae(this.stylesheet.sprite)}setSprite(t,a={},u){this._checkLoaded(),t&&this._validate(c.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Tf=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class tu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,u,p,b,j,E,M,z){this.context=t;let L=this.boundPaintVertexBuffers.length!==p.length;for(let q=0;!L&&q<p.length;q++)this.boundPaintVertexBuffers[q]!==p[q]&&(L=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||L||this.boundIndexBuffer!==b||this.boundVertexOffset!==j||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==z?this.freshBind(a,u,p,b,j,E,M,z):(t.bindVertexArray.set(this.vao),E&&E.bind(),b&&b.dynamicDraw&&b.bind(),M&&M.bind(),z&&z.bind())}freshBind(t,a,u,p,b,j,E,M){const z=t.numAttributes,L=this.context,q=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=j,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=M,a.enableAttributes(q,t);for(const V of u)V.enableAttributes(q,t);j&&j.enableAttributes(q,t),E&&E.enableAttributes(q,t),M&&M.enableAttributes(q,t),a.bind(),a.setVertexAttribPointers(q,t,b);for(const V of u)V.bind(),V.setVertexAttribPointers(q,t,b);j&&(j.bind(),j.setVertexAttribPointers(q,t,b)),p&&p.bind(),E&&(E.bind(),E.setVertexAttribPointers(q,t,b)),M&&(M.bind(),M.setVertexAttribPointers(q,t,b)),L.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Nf=(x,t,a,u,p)=>({u_texture:0,u_ele_delta:x,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:a?a.calculateFogBlendOpacity(u):0,u_horizon_color:a?a.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),yn={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ed(x){const t=[];for(let a=0;a<x.length;a++){if(x[a]===null)continue;const u=x[a].split(" ");t.push(u.pop())}return t}class Ef{constructor(t,a,u,p,b,j,E,M,z=[]){const L=t.gl;this.program=L.createProgram();const q=ed(a.staticAttributes),V=u?u.getBinderAttributes():[],J=q.concat(V),ie=Cr.prelude.staticUniforms?ed(Cr.prelude.staticUniforms):[],fe=E.staticUniforms?ed(E.staticUniforms):[],ye=a.staticUniforms?ed(a.staticUniforms):[],ge=u?u.getBinderUniforms():[],Se=ie.concat(fe).concat(ye).concat(ge),Me=[];for(const Ke of Se)Me.indexOf(Ke)<0&&Me.push(Ke);const we=u?u.defines():[];Xa(L)&&we.unshift("#version 300 es"),b&&we.push("#define OVERDRAW_INSPECTOR;"),j&&we.push("#define TERRAIN3D;"),M&&we.push(M),z&&we.push(...z);let ke=we.concat(Cr.prelude.fragmentSource,E.fragmentSource,a.fragmentSource).join(`
`),De=we.concat(Cr.prelude.vertexSource,E.vertexSource,a.vertexSource).join(`
`);Xa(L)||(ke=(function(Ke){return Ke.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ke),De=(function(Ke){return Ke.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(De));const je=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(je,ke),L.compileShader(je),!L.getShaderParameter(je,L.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${L.getShaderInfoLog(je)}`);L.attachShader(this.program,je);const qe=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(qe,De),L.compileShader(qe),!L.getShaderParameter(qe,L.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${L.getShaderInfoLog(qe)}`);L.attachShader(this.program,qe),this.attributes={};const st={};this.numAttributes=J.length;for(let Ke=0;Ke<this.numAttributes;Ke++)J[Ke]&&(L.bindAttribLocation(this.program,Ke,J[Ke]),this.attributes[J[Ke]]=Ke);if(L.linkProgram(this.program),!L.getProgramParameter(this.program,L.LINK_STATUS))throw new Error(`Program failed to link: ${L.getProgramInfoLog(this.program)}`);L.deleteShader(qe),L.deleteShader(je);for(let Ke=0;Ke<Me.length;Ke++){const et=Me[Ke];if(et&&!st[et]){const tt=L.getUniformLocation(this.program,et);tt&&(st[et]=tt)}}this.fixedUniforms=p(t,st),this.terrainUniforms=((Ke,et)=>({u_depth:new c.b_(Ke,et.u_depth),u_terrain:new c.b_(Ke,et.u_terrain),u_terrain_dim:new c.bq(Ke,et.u_terrain_dim),u_terrain_matrix:new c.c0(Ke,et.u_terrain_matrix),u_terrain_unpack:new c.c1(Ke,et.u_terrain_unpack),u_terrain_exaggeration:new c.bq(Ke,et.u_terrain_exaggeration)}))(t,st),this.projectionUniforms=((Ke,et)=>({u_projection_matrix:new c.c0(Ke,et.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(Ke,et.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(Ke,et.u_projection_clipping_plane),u_projection_transition:new c.bq(Ke,et.u_projection_transition),u_projection_fallback_matrix:new c.c0(Ke,et.u_projection_fallback_matrix)}))(t,st),this.binderUniforms=u?u.getUniforms(t,st):[]}draw(t,a,u,p,b,j,E,M,z,L,q,V,J,ie,fe,ye,ge,Se,Me){const we=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(p),t.setColorMode(b),t.setCullFace(j),M){t.activeTexture.set(we.TEXTURE2),we.bindTexture(we.TEXTURE_2D,M.depthTexture),t.activeTexture.set(we.TEXTURE3),we.bindTexture(we.TEXTURE_2D,M.texture);for(const De in this.terrainUniforms)this.terrainUniforms[De].set(M[De])}if(z)for(const De in z)this.projectionUniforms[yn[De]].set(z[De]);if(E)for(const De in this.fixedUniforms)this.fixedUniforms[De].set(E[De]);ye&&ye.setUniforms(t,this.binderUniforms,ie,{zoom:fe});let ke=0;switch(a){case we.LINES:ke=2;break;case we.TRIANGLES:ke=3;break;case we.LINE_STRIP:ke=1}for(const De of J.get()){const je=De.vaos||(De.vaos={});(je[L]||(je[L]=new tu)).bind(t,this,q,ye?ye.getPaintVertexBuffers():[],V,De.vertexOffset,ge,Se,Me),we.drawElements(a,De.primitiveLength*ke,we.UNSIGNED_SHORT,De.primitiveOffset*ke*2)}}}function Cf(x,t,a){const u=1/c.aN(a,1,t.transform.tileZoom),p=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,t.transform.tileZoom)/p,j=b*(a.tileID.canonical.x+a.tileID.wrap*p),E=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[j>>16,E>>16],u_pixel_coord_lower:[65535&j,65535&E]}}const td=(x,t,a,u)=>{const p=x.style.light,b=p.properties.get("position"),j=[b.x,b.y,b.z],E=c.c4();p.properties.get("anchor")==="viewport"&&c.c5(E,x.transform.bearingInRadians),c.c6(j,j,E);const M=x.transform.transformLightDirection(j),z=p.properties.get("color");return{u_lightpos:j,u_lightpos_globe:M,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:u}},sd=(x,t,a,u,p,b,j)=>c.e(td(x,t,a,u),Cf(b,x,j),{u_height_factor:-Math.pow(2,p.overscaledZ)/j.tileSize/8}),yl=(x,t,a,u)=>c.e(Cf(t,x,a),{u_fill_translate:u}),fc=(x,t)=>({u_world:x,u_fill_translate:t}),Af=(x,t,a,u,p)=>c.e(yl(x,t,a,p),{u_world:u}),su=(x,t,a,u,p)=>{const b=x.transform;let j,E,M=0;if(a.paint.get("circle-pitch-alignment")==="map"){const z=c.aN(t,1,b.zoom);j=!0,E=[z,z],M=z/(c.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*p}else j=!1,E=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+j,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:E,u_globe_extrude_scale:M,u_translate:u}},Lo=x=>({u_pixel_extrude_scale:[1/x.width,1/x.height]}),rh=x=>({u_viewport_size:[x.width,x.height]}),ru=(x,t=1)=>({u_color:x,u_overlay:0,u_overlay_scale:t}),Bo=(x,t,a,u)=>{const p=c.aN(x,1,t)/(c.a5*Math.pow(2,x.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:c.aN(x,1,t),u_intensity:a,u_globe_extrude_scale:p}},ih=(x,t,a,u)=>{const p=c.N();c.c7(p,0,x.width,x.height,0,0,1);const b=x.context.gl;return{u_matrix:p,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:a,u_color_ramp:u,u_opacity:t.paint.get("heatmap-opacity")}},iu=(x,t,a)=>{const u=a.paint.get("hillshade-accent-color");let p;switch(a.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const b=a.getIlluminationProperties();for(let j=0;j<b.directionRadians.length;j++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(b.directionRadians[j]+=x.transform.bearingInRadians);return{u_image:0,u_latrange:nm(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:b.altitudeRadians,u_azimuths:b.directionRadians,u_accent:u,u_method:p,u_highlights:b.highlightColor,u_shadows:b.shadowColor}},kf=(x,t)=>{const a=t.stride,u=c.N();return c.c7(u,0,c.a5,-c.a5,0,0,1),c.O(u,u,[0,-c.a5,0]),{u_matrix:u,u_image:1,u_dimension:[a,a],u_zoom:x.overscaledZ,u_unpack:t.getUnpackVector()}};function nm(x,t){const a=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new c.a9(0,u/a).toLngLat().lat,new c.a9(0,(u+1)/a).toLngLat().lat]}const Mf=(x,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:x.paint.get("color-relief-opacity")}),au=(x,t,a,u)=>{const p=x.transform;return{u_translation:nu(x,t,a),u_ratio:u/c.aN(t,1,p.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Pf=(x,t,a,u,p)=>c.e(au(x,t,a,u),{u_image:0,u_image_height:p}),ah=(x,t,a,u,p)=>{const b=x.transform,j=Ka(t,b);return{u_translation:nu(x,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:u/c.aN(t,1,b.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[j,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},aa=(x,t,a,u,p)=>{const b=Ka(t,x.transform);return c.e(au(x,t,a,u),{u_tileratio:b,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image:0,u_mix:p.t,u_lineatlas_width:x.lineAtlas.width,u_lineatlas_height:x.lineAtlas.height})},Fo=(x,t,a,u,p,b)=>{const j=Ka(t,x.transform);return c.e(au(x,t,a,u),{u_image:0,u_image_height:b,u_tileratio:j,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image_dash:1,u_mix:p.t,u_lineatlas_width:x.lineAtlas.width,u_lineatlas_height:x.lineAtlas.height})};function Ka(x,t){return 1/c.aN(x,1,t.tileZoom)}function nu(x,t,a){return c.aO(x.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const rd=(x,t,a,u,p)=>{return{u_tl_parent:x,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(j=u.paint.get("raster-saturation"),j>0?1-1/(1.001-j):-j),u_contrast_factor:(b=u.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:id(u.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var b,j};function id(x){x*=Math.PI/180;const t=Math.sin(x),a=Math.cos(x);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ou=(x,t,a,u,p,b,j,E,M,z,L,q,V)=>{const J=j.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_pitch:J.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:J.width/J.height,u_fade_change:j.options.fadeDuration?j.symbolFadeChange:1,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+L,u_pitch_with_map:+u,u_is_along_line:p,u_is_variable_anchor:b,u_texsize:q,u_texture:0,u_translation:z,u_pitched_scale:V}},ad=(x,t,a,u,p,b,j,E,M,z,L,q,V,J)=>{const ie=j.transform;return c.e(ou(x,t,a,u,p,b,j,E,M,z,L,q,J),{u_gamma_scale:u?Math.cos(ie.pitch*Math.PI/180)*ie.cameraToCenterDistance:1,u_device_pixel_ratio:j.pixelRatio,u_is_halo:1})},Ja=(x,t,a,u,p,b,j,E,M,z,L,q,V)=>c.e(ad(x,t,a,u,p,b,j,E,M,z,!0,L,0,V),{u_texsize_icon:q,u_texture_icon:1}),lu=(x,t)=>({u_opacity:x,u_color:t}),cu=(x,t,a,u,p)=>c.e((function(b,j,E,M){const z=E.imageManager.getPattern(b.from.toString()),L=E.imageManager.getPattern(b.to.toString()),{width:q,height:V}=E.imageManager.getPixelSize(),J=Math.pow(2,M.tileID.overscaledZ),ie=M.tileSize*Math.pow(2,E.transform.tileZoom)/J,fe=ie*(M.tileID.canonical.x+M.tileID.wrap*J),ye=ie*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[q,V],u_mix:j.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:j.fromScale,u_scale_b:j.toScale,u_tile_units_to_pixels:1/c.aN(M,1,E.transform.tileZoom),u_pixel_coord_upper:[fe>>16,ye>>16],u_pixel_coord_lower:[65535&fe,65535&ye]}})(a,p,t,u),{u_opacity:x}),nd=(x,t)=>{},Df={fillExtrusion:(x,t)=>({u_lightpos:new c.c2(x,t.u_lightpos),u_lightpos_globe:new c.c2(x,t.u_lightpos_globe),u_lightintensity:new c.bq(x,t.u_lightintensity),u_lightcolor:new c.c2(x,t.u_lightcolor),u_vertical_gradient:new c.bq(x,t.u_vertical_gradient),u_opacity:new c.bq(x,t.u_opacity),u_fill_translate:new c.c3(x,t.u_fill_translate)}),fillExtrusionPattern:(x,t)=>({u_lightpos:new c.c2(x,t.u_lightpos),u_lightpos_globe:new c.c2(x,t.u_lightpos_globe),u_lightintensity:new c.bq(x,t.u_lightintensity),u_lightcolor:new c.c2(x,t.u_lightcolor),u_vertical_gradient:new c.bq(x,t.u_vertical_gradient),u_height_factor:new c.bq(x,t.u_height_factor),u_opacity:new c.bq(x,t.u_opacity),u_fill_translate:new c.c3(x,t.u_fill_translate),u_image:new c.b_(x,t.u_image),u_texsize:new c.c3(x,t.u_texsize),u_pixel_coord_upper:new c.c3(x,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(x,t.u_pixel_coord_lower),u_scale:new c.c2(x,t.u_scale),u_fade:new c.bq(x,t.u_fade)}),fill:(x,t)=>({u_fill_translate:new c.c3(x,t.u_fill_translate)}),fillPattern:(x,t)=>({u_image:new c.b_(x,t.u_image),u_texsize:new c.c3(x,t.u_texsize),u_pixel_coord_upper:new c.c3(x,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(x,t.u_pixel_coord_lower),u_scale:new c.c2(x,t.u_scale),u_fade:new c.bq(x,t.u_fade),u_fill_translate:new c.c3(x,t.u_fill_translate)}),fillOutline:(x,t)=>({u_world:new c.c3(x,t.u_world),u_fill_translate:new c.c3(x,t.u_fill_translate)}),fillOutlinePattern:(x,t)=>({u_world:new c.c3(x,t.u_world),u_image:new c.b_(x,t.u_image),u_texsize:new c.c3(x,t.u_texsize),u_pixel_coord_upper:new c.c3(x,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(x,t.u_pixel_coord_lower),u_scale:new c.c2(x,t.u_scale),u_fade:new c.bq(x,t.u_fade),u_fill_translate:new c.c3(x,t.u_fill_translate)}),circle:(x,t)=>({u_camera_to_center_distance:new c.bq(x,t.u_camera_to_center_distance),u_scale_with_map:new c.b_(x,t.u_scale_with_map),u_pitch_with_map:new c.b_(x,t.u_pitch_with_map),u_extrude_scale:new c.c3(x,t.u_extrude_scale),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(x,t.u_globe_extrude_scale),u_translate:new c.c3(x,t.u_translate)}),collisionBox:(x,t)=>({u_pixel_extrude_scale:new c.c3(x,t.u_pixel_extrude_scale)}),collisionCircle:(x,t)=>({u_viewport_size:new c.c3(x,t.u_viewport_size)}),debug:(x,t)=>({u_color:new c.b$(x,t.u_color),u_overlay:new c.b_(x,t.u_overlay),u_overlay_scale:new c.bq(x,t.u_overlay_scale)}),depth:nd,clippingMask:nd,heatmap:(x,t)=>({u_extrude_scale:new c.bq(x,t.u_extrude_scale),u_intensity:new c.bq(x,t.u_intensity),u_globe_extrude_scale:new c.bq(x,t.u_globe_extrude_scale)}),heatmapTexture:(x,t)=>({u_matrix:new c.c0(x,t.u_matrix),u_world:new c.c3(x,t.u_world),u_image:new c.b_(x,t.u_image),u_color_ramp:new c.b_(x,t.u_color_ramp),u_opacity:new c.bq(x,t.u_opacity)}),hillshade:(x,t)=>({u_image:new c.b_(x,t.u_image),u_latrange:new c.c3(x,t.u_latrange),u_exaggeration:new c.bq(x,t.u_exaggeration),u_altitudes:new c.c9(x,t.u_altitudes),u_azimuths:new c.c9(x,t.u_azimuths),u_accent:new c.b$(x,t.u_accent),u_method:new c.b_(x,t.u_method),u_shadows:new c.c8(x,t.u_shadows),u_highlights:new c.c8(x,t.u_highlights)}),hillshadePrepare:(x,t)=>({u_matrix:new c.c0(x,t.u_matrix),u_image:new c.b_(x,t.u_image),u_dimension:new c.c3(x,t.u_dimension),u_zoom:new c.bq(x,t.u_zoom),u_unpack:new c.c1(x,t.u_unpack)}),colorRelief:(x,t)=>({u_image:new c.b_(x,t.u_image),u_unpack:new c.c1(x,t.u_unpack),u_dimension:new c.c3(x,t.u_dimension),u_elevation_stops:new c.b_(x,t.u_elevation_stops),u_color_stops:new c.b_(x,t.u_color_stops),u_color_ramp_size:new c.b_(x,t.u_color_ramp_size),u_opacity:new c.bq(x,t.u_opacity)}),line:(x,t)=>({u_translation:new c.c3(x,t.u_translation),u_ratio:new c.bq(x,t.u_ratio),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(x,t.u_units_to_pixels)}),lineGradient:(x,t)=>({u_translation:new c.c3(x,t.u_translation),u_ratio:new c.bq(x,t.u_ratio),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(x,t.u_units_to_pixels),u_image:new c.b_(x,t.u_image),u_image_height:new c.bq(x,t.u_image_height)}),linePattern:(x,t)=>({u_translation:new c.c3(x,t.u_translation),u_texsize:new c.c3(x,t.u_texsize),u_ratio:new c.bq(x,t.u_ratio),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_image:new c.b_(x,t.u_image),u_units_to_pixels:new c.c3(x,t.u_units_to_pixels),u_scale:new c.c2(x,t.u_scale),u_fade:new c.bq(x,t.u_fade)}),lineSDF:(x,t)=>({u_translation:new c.c3(x,t.u_translation),u_ratio:new c.bq(x,t.u_ratio),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(x,t.u_units_to_pixels),u_image:new c.b_(x,t.u_image),u_mix:new c.bq(x,t.u_mix),u_tileratio:new c.bq(x,t.u_tileratio),u_crossfade_from:new c.bq(x,t.u_crossfade_from),u_crossfade_to:new c.bq(x,t.u_crossfade_to),u_lineatlas_width:new c.bq(x,t.u_lineatlas_width),u_lineatlas_height:new c.bq(x,t.u_lineatlas_height)}),lineGradientSDF:(x,t)=>({u_translation:new c.c3(x,t.u_translation),u_ratio:new c.bq(x,t.u_ratio),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(x,t.u_units_to_pixels),u_image:new c.b_(x,t.u_image),u_image_height:new c.bq(x,t.u_image_height),u_tileratio:new c.bq(x,t.u_tileratio),u_crossfade_from:new c.bq(x,t.u_crossfade_from),u_crossfade_to:new c.bq(x,t.u_crossfade_to),u_image_dash:new c.b_(x,t.u_image_dash),u_mix:new c.bq(x,t.u_mix),u_lineatlas_width:new c.bq(x,t.u_lineatlas_width),u_lineatlas_height:new c.bq(x,t.u_lineatlas_height)}),raster:(x,t)=>({u_tl_parent:new c.c3(x,t.u_tl_parent),u_scale_parent:new c.bq(x,t.u_scale_parent),u_buffer_scale:new c.bq(x,t.u_buffer_scale),u_fade_t:new c.bq(x,t.u_fade_t),u_opacity:new c.bq(x,t.u_opacity),u_image0:new c.b_(x,t.u_image0),u_image1:new c.b_(x,t.u_image1),u_brightness_low:new c.bq(x,t.u_brightness_low),u_brightness_high:new c.bq(x,t.u_brightness_high),u_saturation_factor:new c.bq(x,t.u_saturation_factor),u_contrast_factor:new c.bq(x,t.u_contrast_factor),u_spin_weights:new c.c2(x,t.u_spin_weights),u_coords_top:new c.c1(x,t.u_coords_top),u_coords_bottom:new c.c1(x,t.u_coords_bottom)}),symbolIcon:(x,t)=>({u_is_size_zoom_constant:new c.b_(x,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(x,t.u_is_size_feature_constant),u_size_t:new c.bq(x,t.u_size_t),u_size:new c.bq(x,t.u_size),u_camera_to_center_distance:new c.bq(x,t.u_camera_to_center_distance),u_pitch:new c.bq(x,t.u_pitch),u_rotate_symbol:new c.b_(x,t.u_rotate_symbol),u_aspect_ratio:new c.bq(x,t.u_aspect_ratio),u_fade_change:new c.bq(x,t.u_fade_change),u_label_plane_matrix:new c.c0(x,t.u_label_plane_matrix),u_coord_matrix:new c.c0(x,t.u_coord_matrix),u_is_text:new c.b_(x,t.u_is_text),u_pitch_with_map:new c.b_(x,t.u_pitch_with_map),u_is_along_line:new c.b_(x,t.u_is_along_line),u_is_variable_anchor:new c.b_(x,t.u_is_variable_anchor),u_texsize:new c.c3(x,t.u_texsize),u_texture:new c.b_(x,t.u_texture),u_translation:new c.c3(x,t.u_translation),u_pitched_scale:new c.bq(x,t.u_pitched_scale)}),symbolSDF:(x,t)=>({u_is_size_zoom_constant:new c.b_(x,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(x,t.u_is_size_feature_constant),u_size_t:new c.bq(x,t.u_size_t),u_size:new c.bq(x,t.u_size),u_camera_to_center_distance:new c.bq(x,t.u_camera_to_center_distance),u_pitch:new c.bq(x,t.u_pitch),u_rotate_symbol:new c.b_(x,t.u_rotate_symbol),u_aspect_ratio:new c.bq(x,t.u_aspect_ratio),u_fade_change:new c.bq(x,t.u_fade_change),u_label_plane_matrix:new c.c0(x,t.u_label_plane_matrix),u_coord_matrix:new c.c0(x,t.u_coord_matrix),u_is_text:new c.b_(x,t.u_is_text),u_pitch_with_map:new c.b_(x,t.u_pitch_with_map),u_is_along_line:new c.b_(x,t.u_is_along_line),u_is_variable_anchor:new c.b_(x,t.u_is_variable_anchor),u_texsize:new c.c3(x,t.u_texsize),u_texture:new c.b_(x,t.u_texture),u_gamma_scale:new c.bq(x,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_is_halo:new c.b_(x,t.u_is_halo),u_translation:new c.c3(x,t.u_translation),u_pitched_scale:new c.bq(x,t.u_pitched_scale)}),symbolTextAndIcon:(x,t)=>({u_is_size_zoom_constant:new c.b_(x,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(x,t.u_is_size_feature_constant),u_size_t:new c.bq(x,t.u_size_t),u_size:new c.bq(x,t.u_size),u_camera_to_center_distance:new c.bq(x,t.u_camera_to_center_distance),u_pitch:new c.bq(x,t.u_pitch),u_rotate_symbol:new c.b_(x,t.u_rotate_symbol),u_aspect_ratio:new c.bq(x,t.u_aspect_ratio),u_fade_change:new c.bq(x,t.u_fade_change),u_label_plane_matrix:new c.c0(x,t.u_label_plane_matrix),u_coord_matrix:new c.c0(x,t.u_coord_matrix),u_is_text:new c.b_(x,t.u_is_text),u_pitch_with_map:new c.b_(x,t.u_pitch_with_map),u_is_along_line:new c.b_(x,t.u_is_along_line),u_is_variable_anchor:new c.b_(x,t.u_is_variable_anchor),u_texsize:new c.c3(x,t.u_texsize),u_texsize_icon:new c.c3(x,t.u_texsize_icon),u_texture:new c.b_(x,t.u_texture),u_texture_icon:new c.b_(x,t.u_texture_icon),u_gamma_scale:new c.bq(x,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(x,t.u_device_pixel_ratio),u_is_halo:new c.b_(x,t.u_is_halo),u_translation:new c.c3(x,t.u_translation),u_pitched_scale:new c.bq(x,t.u_pitched_scale)}),background:(x,t)=>({u_opacity:new c.bq(x,t.u_opacity),u_color:new c.b$(x,t.u_color)}),backgroundPattern:(x,t)=>({u_opacity:new c.bq(x,t.u_opacity),u_image:new c.b_(x,t.u_image),u_pattern_tl_a:new c.c3(x,t.u_pattern_tl_a),u_pattern_br_a:new c.c3(x,t.u_pattern_br_a),u_pattern_tl_b:new c.c3(x,t.u_pattern_tl_b),u_pattern_br_b:new c.c3(x,t.u_pattern_br_b),u_texsize:new c.c3(x,t.u_texsize),u_mix:new c.bq(x,t.u_mix),u_pattern_size_a:new c.c3(x,t.u_pattern_size_a),u_pattern_size_b:new c.c3(x,t.u_pattern_size_b),u_scale_a:new c.bq(x,t.u_scale_a),u_scale_b:new c.bq(x,t.u_scale_b),u_pixel_coord_upper:new c.c3(x,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(x,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(x,t.u_tile_units_to_pixels)}),terrain:(x,t)=>({u_texture:new c.b_(x,t.u_texture),u_ele_delta:new c.bq(x,t.u_ele_delta),u_fog_matrix:new c.c0(x,t.u_fog_matrix),u_fog_color:new c.b$(x,t.u_fog_color),u_fog_ground_blend:new c.bq(x,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(x,t.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(x,t.u_horizon_color),u_horizon_fog_blend:new c.bq(x,t.u_horizon_fog_blend),u_is_globe_mode:new c.bq(x,t.u_is_globe_mode)}),terrainDepth:(x,t)=>({u_ele_delta:new c.bq(x,t.u_ele_delta)}),terrainCoords:(x,t)=>({u_texture:new c.b_(x,t.u_texture),u_terrain_coords_id:new c.bq(x,t.u_terrain_coords_id),u_ele_delta:new c.bq(x,t.u_ele_delta)}),projectionErrorMeasurement:(x,t)=>({u_input:new c.bq(x,t.u_input),u_output_expected:new c.bq(x,t.u_output_expected)}),atmosphere:(x,t)=>({u_sun_pos:new c.c2(x,t.u_sun_pos),u_atmosphere_blend:new c.bq(x,t.u_atmosphere_blend),u_globe_position:new c.c2(x,t.u_globe_position),u_globe_radius:new c.bq(x,t.u_globe_radius),u_inv_proj_matrix:new c.c0(x,t.u_inv_proj_matrix)}),sky:(x,t)=>({u_sky_color:new c.b$(x,t.u_sky_color),u_horizon_color:new c.b$(x,t.u_horizon_color),u_horizon:new c.c3(x,t.u_horizon),u_horizon_normal:new c.c3(x,t.u_horizon_normal),u_sky_horizon_blend:new c.bq(x,t.u_sky_horizon_blend),u_sky_blend:new c.bq(x,t.u_sky_blend)})};class xl{constructor(t,a,u){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _l={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class nh{constructor(t,a,u,p){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let u=0;u<this.attributes.length;u++){const p=a.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,a,u){for(let p=0;p<this.attributes.length;p++){const b=this.attributes[p],j=a.attributes[b.name];j!==void 0&&t.vertexAttribPointer(j,b.components,t[_l[b.type]],!1,this.itemSize,b.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ws{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class On extends Ws{getDefault(){return c.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class uu extends Ws{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class du extends Ws{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class od extends Ws{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class vl extends Ws{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hu extends Ws{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class pc extends Ws{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ja extends Ws{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class oh extends Ws{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class ld extends Ws{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ta extends Ws{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ln extends Ws{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ki extends Ws{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class lo extends Ws{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class bl extends Ws{getDefault(){return c.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class wl extends Ws{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class fu extends Ws{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Uo extends Ws{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Qa extends Ws{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class lh extends Ws{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class mc extends Ws{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class gs extends Ws{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cd extends Ws{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Na extends Ws{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ud extends Ws{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ea extends Ws{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rf extends Ws{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class dd extends Ws{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const u=this.gl;Xa(u)?u.bindVertexArray(t):(a=u.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class $o extends Ws{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ch extends Ws{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class hd extends Ws{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Vo extends Ws{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class gc extends Vo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ji extends Vo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qo extends Vo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Go="Framebuffer is not complete";class Sl{constructor(t,a,u,p,b){this.context=t,this.width=a,this.height=u;const j=t.gl,E=this.framebuffer=j.createFramebuffer();if(this.colorAttachment=new gc(t,E),p)this.depthAttachment=b?new qo(t,E):new Ji(t,E);else if(b)throw new Error("Stencil cannot be set without depth");if(j.checkFramebufferStatus(j.FRAMEBUFFER)!==j.FRAMEBUFFER_COMPLETE)throw new Error(Go)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class Ho{constructor(t){var a,u;if(this.gl=t,this.clearColor=new On(this),this.clearDepth=new uu(this),this.clearStencil=new du(this),this.colorMask=new od(this),this.depthMask=new vl(this),this.stencilMask=new hu(this),this.stencilFunc=new pc(this),this.stencilOp=new ja(this),this.stencilTest=new oh(this),this.depthRange=new ld(this),this.depthTest=new Ta(this),this.depthFunc=new Ln(this),this.blend=new Ki(this),this.blendFunc=new lo(this),this.blendColor=new bl(this),this.blendEquation=new wl(this),this.cullFace=new fu(this),this.cullFaceSide=new Uo(this),this.frontFace=new Qa(this),this.program=new lh(this),this.activeTexture=new mc(this),this.viewport=new gs(this),this.bindFramebuffer=new cd(this),this.bindRenderbuffer=new Na(this),this.bindTexture=new ud(this),this.bindVertexBuffer=new Ea(this),this.bindElementBuffer=new Rf(this),this.bindVertexArray=new dd(this),this.pixelStoreUnpack=new $o(this),this.pixelStoreUnpackPremultiplyAlpha=new ch(this),this.pixelStoreUnpackFlipY=new hd(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Xa(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:p?.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:p?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new xl(this,t,a)}createVertexBuffer(t,a,u){return new nh(this,t,a,u)}createRenderbuffer(t,a,u){const p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,t,a,u),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,u,p){return new Sl(this,t,a,u,p)}clear({color:t,depth:a,stencil:u}){const p=this.gl;let b=0;t&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(b|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.bR(t.blendFunction,nr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Xa(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Xa(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let gi;function bi(x,t,a,u,p){const b=x.context,j=x.transform,E=b.gl,M=x.useProgram("collisionBox"),z=[];let L=0,q=0;for(let ge=0;ge<u.length;ge++){const Se=u[ge],Me=t.getTile(Se).getBucket(a);if(!Me)continue;const we=p?Me.textCollisionBox:Me.iconCollisionBox,ke=Me.collisionCircleArray;ke.length>0&&(z.push({circleArray:ke,circleOffset:q,coord:Se}),L+=ke.length/4,q=L),we&&M.draw(b,E.LINES,ms.disabled,Bs.disabled,x.colorModeForRenderPass(),As.disabled,Lo(x.transform),x.style.map.terrain&&x.style.map.terrain.getTerrainData(Se),j.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,x.transform.zoom,null,null,we.collisionVertexBuffer)}if(!p||!z.length)return;const V=x.useProgram("collisionCircle"),J=new c.ca;J.resize(4*L),J._trim();let ie=0;for(const ge of z)for(let Se=0;Se<ge.circleArray.length/4;Se++){const Me=4*Se,we=ge.circleArray[Me+0],ke=ge.circleArray[Me+1],De=ge.circleArray[Me+2],je=ge.circleArray[Me+3];J.emplace(ie++,we,ke,De,je,0),J.emplace(ie++,we,ke,De,je,1),J.emplace(ie++,we,ke,De,je,2),J.emplace(ie++,we,ke,De,je,3)}(!gi||gi.length<2*L)&&(gi=(function(ge){const Se=2*ge,Me=new c.cc;Me.resize(Se),Me._trim();for(let we=0;we<Se;we++){const ke=6*we;Me.uint16[ke+0]=4*we+0,Me.uint16[ke+1]=4*we+1,Me.uint16[ke+2]=4*we+2,Me.uint16[ke+3]=4*we+2,Me.uint16[ke+4]=4*we+3,Me.uint16[ke+5]=4*we+0}return Me})(L));const fe=b.createIndexBuffer(gi,!0),ye=b.createVertexBuffer(J,c.cb.members,!0);for(const ge of z){const Se=rh(x.transform);V.draw(b,E.TRIANGLES,ms.disabled,Bs.disabled,x.colorModeForRenderPass(),As.disabled,Se,x.style.map.terrain&&x.style.map.terrain.getTerrainData(ge.coord),null,a.id,ye,fe,c.aX.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,x.transform.zoom,null,null,null)}ye.destroy(),fe.destroy()}const Bn=c.ar(new Float32Array(16));function Fn(x,t,a,u,p,b){const{horizontalAlign:j,verticalAlign:E}=c.aS(x);return new c.P((-(j-.5)*t/p+u[0])*b,(-(E-.5)*a/p+u[1])*b)}function na(x,t,a,u,p,b){const j=t.tileAnchorPoint.add(new c.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let E=u.mult(b);a||(E=E.rotate(-p));const M=j.add(E);return ds(M.x,M.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const E=Ht(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(x),M=Math.atan(E.y/E.x)+(E.x<0?Math.PI:0);return x.add(u.rotate(M))}return x.add(u)}function co(x,t,a,u,p,b,j,E,M,z,L,q){const V=x.text.placedSymbolArray,J=x.text.dynamicLayoutVertexArray,ie=x.icon.dynamicLayoutVertexArray,fe={};J.clear();for(let ye=0;ye<V.length;ye++){const ge=V.get(ye),Se=ge.hidden||!ge.crossTileID||x.allowVerticalPlacement&&!ge.placedOrientation?null:u[ge.crossTileID];if(Se){const Me=new c.P(ge.anchorX,ge.anchorY),we={getElevation:q,width:p.width,height:p.height,pitchedLabelPlaneMatrix:b,pitchWithMap:a,transform:p,tileAnchorPoint:Me,translation:z,unwrappedTileID:L},ke=a?fi(Me.x,Me.y,we):Ht(Me.x,Me.y,we),De=no(p.cameraToCenterDistance,ke.signedDistanceFromCamera);let je=c.aA(x.textSizeData,E,ge)*De/c.aM;a&&(je*=x.tilePixelRatio/j);const{width:qe,height:st,anchor:Ke,textOffset:et,textBoxScale:tt}=Se,Rt=Fn(Ke,qe,st,et,tt,je),It=p.getPitchedTextCorrection(Me.x+z[0],Me.y+z[1],L),St=na(ke.point,we,t,Rt,-p.bearingInRadians,It),Bt=x.allowVerticalPlacement&&ge.placedOrientation===c.az.vertical?Math.PI/2:0;for(let fs=0;fs<ge.numGlyphs;fs++)c.aG(J,St,Bt);M&&ge.associatedIconIndex>=0&&(fe[ge.associatedIconIndex]={shiftedAnchor:St,angle:Bt})}else Rn(ge.numGlyphs,J)}if(M){ie.clear();const ye=x.icon.placedSymbolArray;for(let ge=0;ge<ye.length;ge++){const Se=ye.get(ge);if(Se.hidden)Rn(Se.numGlyphs,ie);else{const Me=fe[ge];if(Me)for(let we=0;we<Se.numGlyphs;we++)c.aG(ie,Me.shiftedAnchor,Me.angle);else Rn(Se.numGlyphs,ie)}}x.icon.dynamicLayoutVertexBuffer.updateData(ie)}x.text.dynamicLayoutVertexBuffer.updateData(J)}function uh(x,t,a){return a.iconsInText&&t?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function jl(x,t,a,u,p,b,j,E,M,z,L,q,V){const J=x.context,ie=J.gl,fe=x.transform,ye=E==="map",ge=M==="map",Se=E!=="viewport"&&a.layout.get("symbol-placement")!=="point",Me=ye&&!ge&&!Se,we=!a.layout.get("symbol-sort-key").isConstant();let ke=!1;const De=x.getDepthModeForSublayer(0,ms.ReadOnly),je=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),qe=[],st=fe.getCircleRadiusCorrection();for(const Ke of u){const et=t.getTile(Ke),tt=et.getBucket(a);if(!tt)continue;const Rt=p?tt.text:tt.icon;if(!Rt||!Rt.segments.get().length||!Rt.hasVisibleVertices)continue;const It=Rt.programConfigurations.get(a.id),St=p||tt.sdfIcons,Bt=p?tt.textSizeData:tt.iconSizeData,fs=ge||fe.pitch!==0,er=x.useProgram(uh(St,p,tt),It),_r=c.ay(Bt,fe.zoom),hr=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ke);let Tr,or,Or,Nr,Si=[0,0],qr=null;if(p)or=et.glyphAtlasTexture,Or=ie.LINEAR,Tr=et.glyphAtlasTexture.size,tt.iconsInText&&(Si=et.imageAtlasTexture.size,qr=et.imageAtlasTexture,Nr=fs||x.options.rotating||x.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?ie.LINEAR:ie.NEAREST);else{const rr=a.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;or=et.imageAtlasTexture,Or=St||x.options.rotating||x.options.zooming||rr||fs?ie.LINEAR:ie.NEAREST,Tr=et.imageAtlasTexture.size}const Gr=c.aN(et,1,x.transform.zoom),ji=ra(ye,x.transform,Gr),Qn=c.N();c.aB(Qn,ji);const eo=rc(ge,ye,x.transform,Gr),jn=c.aO(fe,et,b,j),ua=fe.getProjectionData({overscaledTileID:Ke,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),Dl=je&&tt.hasTextData(),Nc=a.layout.get("icon-text-fit")!=="none"&&Dl&&tt.hasIconData();if(Se){const rr=x.style.map.terrain?(ri,ui)=>x.style.map.terrain.getElevation(Ke,ri,ui):null,fr=a.layout.get("text-rotation-alignment")==="map";Za(tt,x,p,ji,Qn,ge,z,fr,Ke.toUnwrapped(),fe.width,fe.height,jn,rr)}const Tn=p&&je||Nc,da=Se||Tn?Bn:ge?ji:x.transform.clipSpaceToPixelsMatrix,Pa=St&&a.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let nn;nn=St?tt.iconsInText?Ja(Bt.kind,_r,Me,ge,Se,Tn,x,da,eo,jn,Tr,Si,st):ad(Bt.kind,_r,Me,ge,Se,Tn,x,da,eo,jn,p,Tr,0,st):ou(Bt.kind,_r,Me,ge,Se,Tn,x,da,eo,jn,p,Tr,st);const on={program:er,buffers:Rt,uniformValues:nn,projectionData:ua,atlasTexture:or,atlasTextureIcon:qr,atlasInterpolation:Or,atlasInterpolationIcon:Nr,isSDF:St,hasHalo:Pa};if(we&&tt.canOverlap){ke=!0;const rr=Rt.segments.get();for(const fr of rr)qe.push({segments:new c.aX([fr]),sortKey:fr.sortKey,state:on,terrainData:hr})}else qe.push({segments:Rt.segments,sortKey:0,state:on,terrainData:hr})}ke&&qe.sort(((Ke,et)=>Ke.sortKey-et.sortKey));for(const Ke of qe){const et=Ke.state;if(J.activeTexture.set(ie.TEXTURE0),et.atlasTexture.bind(et.atlasInterpolation,ie.CLAMP_TO_EDGE),et.atlasTextureIcon&&(J.activeTexture.set(ie.TEXTURE1),et.atlasTextureIcon&&et.atlasTextureIcon.bind(et.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),et.isSDF){const tt=et.uniformValues;et.hasHalo&&(tt.u_is_halo=1,yc(et.buffers,Ke.segments,a,x,et.program,De,L,q,tt,et.projectionData,Ke.terrainData)),tt.u_is_halo=0}yc(et.buffers,Ke.segments,a,x,et.program,De,L,q,et.uniformValues,et.projectionData,Ke.terrainData)}}function yc(x,t,a,u,p,b,j,E,M,z,L){const q=u.context;p.draw(q,q.gl.TRIANGLES,b,j,E,As.backCCW,M,L,z,a.id,x.layoutVertexBuffer,x.indexBuffer,t,a.paint,u.transform.zoom,x.programConfigurations.get(a.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function dh(x,t,a,u,p){const b=x.context,j=b.gl,E=Bs.disabled,M=new nr([j.ONE,j.ONE],c.bp.transparent,[!0,!0,!0,!0]),z=t.getBucket(a);if(!z)return;const L=u.key;let q=a.heatmapFbos.get(L);q||(q=dr(b,t.tileSize,t.tileSize),a.heatmapFbos.set(L,q)),b.bindFramebuffer.set(q.framebuffer),b.viewport.set([0,0,t.tileSize,t.tileSize]),b.clear({color:c.bp.transparent});const V=z.programConfigurations.get(a.id),J=x.useProgram("heatmap",V,!p),ie=x.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),fe=x.style.map.terrain.getTerrainData(u);J.draw(b,j.TRIANGLES,ms.disabled,E,M,As.disabled,Bo(t,x.transform.zoom,a.paint.get("heatmap-intensity"),1),fe,ie,a.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,a.paint,x.transform.zoom,V)}function wi(x,t,a,u,p){const b=x.context,j=b.gl,E=x.transform;b.setColorMode(x.colorModeForRenderPass());const M=zs(b,t),z=a.key,L=t.heatmapFbos.get(z);if(!L)return;b.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,L.colorAttachment.get()),b.activeTexture.set(j.TEXTURE1),M.bind(j.LINEAR,j.CLAMP_TO_EDGE);const q=E.getProjectionData({overscaledTileID:a,applyTerrainMatrix:p,applyGlobeMatrix:!u});x.useProgram("heatmapTexture").draw(b,j.TRIANGLES,ms.disabled,Bs.disabled,x.colorModeForRenderPass(),As.disabled,ih(x,t,0,1),null,q,t.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,t.paint,E.zoom),L.destroy(),t.heatmapFbos.delete(z)}function dr(x,t,a){var u,p;const b=x.gl,j=b.createTexture();b.bindTexture(b.TEXTURE_2D,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const E=(u=x.HALF_FLOAT)!==null&&u!==void 0?u:b.UNSIGNED_BYTE,M=(p=x.RGBA16F)!==null&&p!==void 0?p:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,M,t,a,0,b.RGBA,E,null);const z=x.createFramebuffer(t,a,!1,!1);return z.colorAttachment.set(j),z}function zs(x,t){return t.colorRampTexture||(t.colorRampTexture=new c.T(x,t.colorRamp,x.gl.RGBA)),t.colorRampTexture}function uo(x,t,a,u,p,b,j,E){let M=256;if(p.stepInterpolant){const z=t.getSource().maxzoom,L=j.canonical.z===z?Math.ceil(1<<x.transform.maxZoom-j.canonical.z):1;M=c.an(c.ce(b.maxLineLength/c.a5*1024*L),256,a.maxTextureSize)}return E.gradient=c.cf({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:M,image:E.gradient||void 0,clips:b.lineClipsArray}),E.texture?E.texture.update(E.gradient):E.texture=new c.T(a,E.gradient,u.RGBA),E.version=p.gradientVersion,E.texture}function Ca(x,t,a,u,p){x.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),u.updatePaintBuffers(p)}function Ir(x,t,a,u,p,b){(p||x.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),x.lineAtlas.bind(t)),u.updatePaintBuffers(b)}function oa(x,t,a,u,p,b,j){const E=b.gradients[p.id];let M=E.texture;p.gradientVersion!==E.version&&(M=uo(x,t,a,u,p,b,j,E)),a.activeTexture.set(u.TEXTURE0),M.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}function la(x,t,a,u,p,b,j,E,M){const z=b.gradients[p.id];let L=z.texture;p.gradientVersion!==z.version&&(L=uo(x,t,a,u,p,b,j,z)),a.activeTexture.set(u.TEXTURE0),L.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE),a.activeTexture.set(u.TEXTURE1),x.lineAtlas.bind(a),E.updatePaintBuffers(M)}function pu(x,t,a,u,p){if(!a||!u||!u.imageAtlas)return;const b=u.imageAtlas.patternPositions;let j=b[a.to.toString()],E=b[a.from.toString()];if(!j&&E&&(j=E),!E&&j&&(E=j),!j||!E){const M=p.getPaintProperty(t);j=b[M],E=b[M]}j&&E&&x.setConstantPatternPositions(j,E)}function Un(x,t,a,u,p,b,j,E){const M=x.context.gl,z="fill-pattern",L=a.paint.get(z),q=L&&L.constantOr(1),V=a.getCrossfadeParameters();let J,ie,fe,ye,ge;const Se=x.transform,Me=a.paint.get("fill-translate"),we=a.paint.get("fill-translate-anchor");j?(ie=q&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=M.LINES):(ie=q?"fillPattern":"fill",J=M.TRIANGLES);const ke=L.constantOr(null);for(const De of u){const je=t.getTile(De);if(q&&!je.patternsLoaded())continue;const qe=je.getBucket(a);if(!qe)continue;const st=qe.programConfigurations.get(a.id),Ke=x.useProgram(ie,st),et=x.style.map.terrain&&x.style.map.terrain.getTerrainData(De);q&&(x.context.activeTexture.set(M.TEXTURE0),je.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),st.updatePaintBuffers(V)),pu(st,z,ke,je,a);const tt=Se.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),Rt=c.aO(Se,je,Me,we);if(j){ye=qe.indexBuffer2,ge=qe.segments2;const St=[M.drawingBufferWidth,M.drawingBufferHeight];fe=ie==="fillOutlinePattern"&&q?Af(x,V,je,St,Rt):fc(St,Rt)}else ye=qe.indexBuffer,ge=qe.segments,fe=q?yl(x,V,je,Rt):{u_fill_translate:Rt};const It=x.stencilModeForClipping(De);Ke.draw(x.context,J,p,It,b,As.backCCW,fe,et,tt,a.id,qe.layoutVertexBuffer,ye,ge,a.paint,x.transform.zoom,st)}}function $n(x,t,a,u,p,b,j,E){const M=x.context,z=M.gl,L="fill-extrusion-pattern",q=a.paint.get(L),V=q.constantOr(1),J=a.getCrossfadeParameters(),ie=a.paint.get("fill-extrusion-opacity"),fe=q.constantOr(null),ye=x.transform;for(const ge of u){const Se=t.getTile(ge),Me=Se.getBucket(a);if(!Me)continue;const we=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ge),ke=Me.programConfigurations.get(a.id),De=x.useProgram(V?"fillExtrusionPattern":"fillExtrusion",ke);V&&(x.context.activeTexture.set(z.TEXTURE0),Se.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ke.updatePaintBuffers(J));const je=ye.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!E,applyTerrainMatrix:!0});pu(ke,L,fe,Se,a);const qe=c.aO(ye,Se,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),st=a.paint.get("fill-extrusion-vertical-gradient"),Ke=V?sd(x,st,ie,qe,ge,J,Se):td(x,st,ie,qe);De.draw(M,M.gl.TRIANGLES,p,b,j,As.backCCW,Ke,we,je,a.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,a.paint,x.transform.zoom,ke,x.style.map.terrain&&Me.centroidVertexBuffer)}}function Vn(x,t,a,u,p,b,j,E,M){var z;const L=x.style.projection,q=x.context,V=x.transform,J=q.gl,ie=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],fe=x.useProgram("hillshade",null,!1,ie),ye=!x.options.moving;for(const ge of u){const Se=t.getTile(ge),Me=Se.fbo;if(!Me)continue;const we=L.getMeshFromTileID(q,ge.canonical,E,!0,"raster"),ke=(z=x.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(ge);q.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,Me.colorAttachment.get());const De=V.getProjectionData({overscaledTileID:ge,aligned:ye,applyGlobeMatrix:!M,applyTerrainMatrix:!0});fe.draw(q,J.TRIANGLES,b,p[ge.overscaledZ],j,As.backCCW,iu(x,Se,a),ke,De,a.id,we.vertexBuffer,we.indexBuffer,we.segments)}}function ho(x,t,a,u,p,b,j,E,M){var z;const L=x.style.projection,q=x.context,V=x.transform,J=q.gl,ie=x.useProgram("colorRelief"),fe=!x.options.moving;let ye=!0,ge=0;for(const Se of u){const Me=t.getTile(Se),we=Me.dem;if(ye){const Ke=J.getParameter(J.MAX_TEXTURE_SIZE),{elevationTexture:et,colorTexture:tt}=a.getColorRampTextures(q,Ke,we.getUnpackVector());q.activeTexture.set(J.TEXTURE1),et.bind(J.NEAREST,J.CLAMP_TO_EDGE),q.activeTexture.set(J.TEXTURE4),tt.bind(J.LINEAR,J.CLAMP_TO_EDGE),ye=!1,ge=et.size[0]}if(!we||!we.data)continue;const ke=we.stride,De=we.getPixels();if(q.activeTexture.set(J.TEXTURE0),q.pixelStoreUnpackPremultiplyAlpha.set(!1),Me.demTexture=Me.demTexture||x.getTileTexture(ke),Me.demTexture){const Ke=Me.demTexture;Ke.update(De,{premultiply:!1}),Ke.bind(J.LINEAR,J.CLAMP_TO_EDGE)}else Me.demTexture=new c.T(q,De,J.RGBA,{premultiply:!1}),Me.demTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const je=L.getMeshFromTileID(q,Se.canonical,E,!0,"raster"),qe=(z=x.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(Se),st=V.getProjectionData({overscaledTileID:Se,aligned:fe,applyGlobeMatrix:!M,applyTerrainMatrix:!0});ie.draw(q,J.TRIANGLES,b,p[Se.overscaledZ],j,As.backCCW,Mf(a,Me.dem,ge),qe,st,a.id,je.vertexBuffer,je.indexBuffer,je.segments)}}const fo=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function en(x,t,a,u,p,b,j,E,M=!1,z=!1){const L=u[u.length-1].overscaledZ,q=x.context,V=q.gl,J=x.useProgram("raster"),ie=x.transform,fe=x.style.projection,ye=x.colorModeForRenderPass(),ge=!x.options.moving,Se=a.paint.get("raster-opacity"),Me=a.paint.get("raster-resampling"),we=a.paint.get("raster-fade-duration"),ke=!!x.style.map.terrain;for(const De of u){const je=x.getDepthModeForSublayer(De.overscaledZ-L,Se===1?ms.ReadWrite:ms.ReadOnly,V.LESS),qe=t.getTile(De),st=Me==="nearest"?V.NEAREST:V.LINEAR;q.activeTexture.set(V.TEXTURE0),qe.texture.bind(st,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(V.TEXTURE1);const{parentTile:Ke,parentScaleBy:et,parentTopLeft:tt,fadeValues:Rt}=qn(qe,t,we,ke);qe.fadeOpacity=Rt.tileOpacity,Ke?(Ke.fadeOpacity=Rt.parentTileOpacity,Ke.texture.bind(st,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST)):qe.texture.bind(st,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),qe.texture.useMipmap&&q.extTextureFilterAnisotropic&&x.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const It=x.style.map.terrain&&x.style.map.terrain.getTerrainData(De),St=ie.getProjectionData({overscaledTileID:De,aligned:ge,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Bt=rd(tt,et,Rt.fadeMix,a,E),fs=fe.getMeshFromTileID(q,De.canonical,b,j,"raster");J.draw(q,V.TRIANGLES,je,p?p[De.overscaledZ]:Bs.disabled,ye,M?As.frontCCW:As.backCCW,Bt,It,St,a.id,fs.vertexBuffer,fs.indexBuffer,fs.segments)}}function qn(x,t,a,u){const p={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||u)return p;if(x.fadingParentID){const b=t.getLoadedTile(x.fadingParentID);if(!b)return p;const j=Math.pow(2,b.tileID.overscaledZ-x.tileID.overscaledZ),E=[x.tileID.canonical.x*j%1,x.tileID.canonical.y*j%1],M=(function(z,L,q){const V=Y(),J=(V-L.timeAdded)/q,ie=z.fadingDirection===he.Incoming,fe=c.an((V-z.timeAdded)/q,0,1),ye=c.an(1-J,0,1),ge=ie?fe:ye;return{tileOpacity:ge,parentTileOpacity:ie?ye:fe,fadeMix:{opacity:1,mix:1-ge}}})(x,b,a);return{parentTile:b,parentScaleBy:j,parentTopLeft:E,fadeValues:M}}if(x.selfFading){const b=(function(j,E){const M=(Y()-j.timeAdded)/E,z=c.an(M,0,1);return{tileOpacity:z,fadeMix:{opacity:z,mix:0}}})(x,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:b}}return p}const po=new c.bp(1,0,0,1),Gn=new c.bp(0,1,0,1),fd=new c.bp(0,0,1,1),pd=new c.bp(1,0,1,1),Aa=new c.bp(0,1,1,1);function xc(x,t,a,u){si(x,0,t+a/2,x.transform.width,a,u)}function mo(x,t,a,u){si(x,t-a/2,0,a,x.transform.height,u)}function si(x,t,a,u,p,b){const j=x.context,E=j.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*x.pixelRatio,a*x.pixelRatio,u*x.pixelRatio,p*x.pixelRatio),j.clear({color:b}),E.disable(E.SCISSOR_TEST)}function mu(x,t,a){const u=x.context,p=u.gl,b=x.useProgram("debug"),j=ms.disabled,E=Bs.disabled,M=x.colorModeForRenderPass(),z="$debug",L=x.style.map.terrain&&x.style.map.terrain.getTerrainData(a);u.activeTexture.set(p.TEXTURE0);const q=t.getTileByID(a.key).latestRawTileData,V=Math.floor((q&&q.byteLength||0)/1024),J=t.getTile(a).tileSize,ie=512/Math.min(J,512)*(a.overscaledZ/x.transform.zoom)*.5;let fe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(fe+=` => ${a.overscaledZ}`),(function(ge,Se){ge.initDebugOverlayCanvas();const Me=ge.debugOverlayCanvas,we=ge.context.gl,ke=ge.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,Me.width,Me.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(Se,5,5),ke.strokeText(Se,5,5),ge.debugOverlayTexture.update(Me),ge.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)})(x,`${fe} ${V}kB`);const ye=x.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(u,p.TRIANGLES,j,E,nr.alphaBlended,As.disabled,ru(c.bp.transparent,ie),null,ye,z,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),b.draw(u,p.LINE_STRIP,j,E,M,As.disabled,ru(c.bp.red),L,ye,z,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function md(x,t,a,u){const{isRenderingGlobe:p}=u,b=x.context,j=b.gl,E=x.transform,M=x.colorModeForRenderPass(),z=x.getDepthModeFor3D(),L=x.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,x.width,x.height]);for(const q of a){const V=t.getTerrainMesh(q.tileID),J=x.renderToTexture.getTexture(q),ie=t.getTerrainData(q.tileID);b.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,J.texture);const fe=t.getMeshFrameDelta(E.zoom),ye=E.calculateFogMatrix(q.tileID.toUnwrapped()),ge=Nf(fe,ye,x.style.sky,E.pitch,p),Se=E.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});L.draw(b,j.TRIANGLES,z,Bs.disabled,M,As.backCCW,ge,ie,Se,"terrain",V.vertexBuffer,V.indexBuffer,V.segments)}}function hh(x,t){if(!t.mesh){const a=new c.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const u=new c.aY;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),t.mesh=new ur(x.createVertexBuffer(a,Ya.members),x.createIndexBuffer(u),c.aX.simpleSegment(0,0,a.length,u.length))}return t.mesh}class If{constructor(t,a){this.context=new Ho(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Hs.maxOverzooming+Hs.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new pi}resize(t,a,u){if(this.width=Math.floor(t*u),this.height=Math.floor(a*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,a=new c.aW;a.emplaceBack(0,0),a.emplaceBack(c.a5,0),a.emplaceBack(0,c.a5),a.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=t.createVertexBuffer(a,Ya.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const u=new c.aW;u.emplaceBack(0,0),u.emplaceBack(c.a5,0),u.emplaceBack(0,c.a5),u.emplaceBack(c.a5,c.a5),this.debugBuffer=t.createVertexBuffer(u,Ya.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const p=new c.ch;p.emplaceBack(0,0,0,0),p.emplaceBack(c.a5,0,c.a5,0),p.emplaceBack(0,c.a5,0,c.a5),p.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=t.createVertexBuffer(p,Tf.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const b=new c.aW;b.emplaceBack(0,0),b.emplaceBack(c.a5,0),b.emplaceBack(0,c.a5),b.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(b,Ya.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const j=new c.aW;j.emplaceBack(0,0),j.emplaceBack(1,0),j.emplaceBack(0,1),j.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(j,Ya.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const E=new c.ci;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(E);const M=new c.aY;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(M);const z=this.context.gl;this.stencilClearMode=new Bs({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new ur(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=c.N();c.c7(u,0,this.width,this.height,0,0,1),c.Q(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const p={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,ms.disabled,this.stencilClearMode,nr.disabled,As.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,u){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const p=this.context;p.setColorMode(nr.disabled),p.setDepthMode(ms.disabled);const b={};for(const j of a)b[j.key]=this.nextStencilID++;this._renderTileMasks(b,a,u,!0),this._renderTileMasks(b,a,u,!1),this._tileClippingMaskIDs=b}_renderTileMasks(t,a,u,p){const b=this.context,j=b.gl,E=this.style.projection,M=this.transform,z=this.useProgram("clippingMask");for(const L of a){const q=t[L.key],V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(L),J=E.getMeshFromTileID(this.context,L.canonical,p,!0,"stencil"),ie=M.getProjectionData({overscaledTileID:L,applyGlobeMatrix:!u,applyTerrainMatrix:!0});z.draw(b,j.TRIANGLES,ms.disabled,new Bs({func:j.ALWAYS,mask:0},q,255,j.KEEP,j.KEEP,j.REPLACE),nr.disabled,u?As.disabled:As.backCCW,null,V,ie,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,u=this.style.projection,p=this.transform,b=this.useProgram("depth"),j=this.getDepthModeFor3D(),E=xr(p,{tileSize:p.tileSize});for(const M of E){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),L=u.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),q=p.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(t,a.TRIANGLES,j,Bs.disabled,nr.disabled,As.backCCW,null,z,q,"$clipping",L.vertexBuffer,L.indexBuffer,L.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Bs({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Bs({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,u=t.sort(((j,E)=>E.overscaledZ-j.overscaledZ)),p=u[u.length-1].overscaledZ,b=u[0].overscaledZ-p+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const j={};for(let E=0;E<b;E++)j[E+p]=new Bs({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[j,u]}return[{[p]:Bs.disabled},u]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,u=t.sort(((j,E)=>E.overscaledZ-j.overscaledZ)),p=u[u.length-1].overscaledZ,b=u[0].overscaledZ-p+1;if(this.clearStencil(),b>1){const j={},E={};for(let M=0;M<b;M++)j[M+p]=new Bs({func:a.GREATER,mask:255},b+1+M,255,a.KEEP,a.KEEP,a.REPLACE),E[M+p]=new Bs({func:a.GREATER,mask:255},1+M,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*b+1,[j,E,u]}return this.nextStencilID=3,[{[p]:new Bs({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[p]:new Bs({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new nr([t.CONSTANT_COLOR,t.ONE],new c.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?nr.unblended:nr.alphaBlended}getDepthModeForSublayer(t,a,u){if(!this.opaquePassEnabledForLayer())return ms.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ms(u||this.context.gl.LEQUAL,a,[p,p])}getDepthModeFor3D(){return new ms(this.context.gl.LEQUAL,ms.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var u,p;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Y()),this.imageManager.beginFrame();const b=this.style._order,j=this.style.tileManagers,E={},M={},z={},L={isRenderingToTexture:!1,isRenderingGlobe:((u=t.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const V in j){const J=j[V];J.used&&J.prepare(this.context),E[V]=J.getVisibleCoordinates(!1),M[V]=E[V].slice().reverse(),z[V]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<b.length;V++)if(this.style._layers[b[V]].is3D()){this.opaquePassCutoff=V;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const V of b){const J=this.style._layers[V];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const ie=M[J.source];(J.type==="custom"||ie.length)&&this.renderLayer(this,j[J.source],J,ie,L)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:V=>this.useProgram(V)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(V,J){const ie=V.context,fe=ie.gl,ye=((De,je,qe)=>{const st=Math.cos(je.rollInRadians),Ke=Math.sin(je.rollInRadians),et=ot(je),tt=je.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:De.properties.get("sky-color"),u_horizon_color:De.properties.get("horizon-color"),u_horizon:[(je.width/2-et*Ke)*qe,(je.height/2+et*st)*qe],u_horizon_normal:[-Ke,st],u_sky_horizon_blend:De.properties.get("sky-horizon-blend")*je.height/2*qe,u_sky_blend:tt}})(J,V.style.map.transform,V.pixelRatio),ge=new ms(fe.LEQUAL,ms.ReadWrite,[0,1]),Se=Bs.disabled,Me=V.colorModeForRenderPass(),we=V.useProgram("sky"),ke=hh(ie,J);we.draw(ie,fe.TRIANGLES,ge,Se,Me,As.disabled,ye,null,void 0,"sky",ke.vertexBuffer,ke.indexBuffer,ke.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[b[this.currentLayer]],J=j[V.source],ie=E[V.source];this._renderTileClippingMasks(V,ie,!1),this.renderLayer(this,J,V,ie,L)}this.renderPass="translucent";let q=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const V=this.style._layers[b[this.currentLayer]],J=j[V.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(V,L))continue;this.opaquePassEnabledForLayer()||q||(q=!0,L.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ie=(V.type==="symbol"?z:M)[V.source];this._renderTileClippingMasks(V,E[V.source],!!this.renderToTexture),this.renderLayer(this,J,V,ie,L)}if(L.isRenderingGlobe&&(function(V,J,ie){const fe=V.context,ye=fe.gl,ge=V.useProgram("atmosphere"),Se=new ms(ye.LEQUAL,ms.ReadOnly,[0,1]),Me=V.transform,we=(function(tt,Rt){const It=tt.properties.get("position"),St=[-It.x,-It.y,-It.z],Bt=c.ar(new Float64Array(16));return tt.properties.get("anchor")==="map"&&(c.bg(Bt,Bt,Rt.rollInRadians),c.bh(Bt,Bt,-Rt.pitchInRadians),c.bg(Bt,Bt,Rt.bearingInRadians),c.bh(Bt,Bt,Rt.center.lat*Math.PI/180),c.bJ(Bt,Bt,-Rt.center.lng*Math.PI/180)),c.cg(St,St,Bt),St})(ie,V.transform),ke=Me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),De=J.properties.get("atmosphere-blend")*ke.projectionTransition;if(De===0)return;const je=gl(Me.worldSize,Me.center.lat),qe=Me.inverseProjectionMatrix,st=new Float64Array(4);st[3]=1,c.aH(st,st,Me.modelViewProjectionMatrix),st[0]/=st[3],st[1]/=st[3],st[2]/=st[3],st[3]=1,c.aH(st,st,qe),st[0]/=st[3],st[1]/=st[3],st[2]/=st[3],st[3]=1;const Ke=((tt,Rt,It,St,Bt)=>({u_sun_pos:tt,u_atmosphere_blend:Rt,u_globe_position:It,u_globe_radius:St,u_inv_proj_matrix:Bt}))(we,De,[st[0],st[1],st[2]],je,qe),et=hh(fe,J);ge.draw(fe,ye.TRIANGLES,Se,Bs.disabled,nr.alphaBlended,As.disabled,Ke,null,null,"atmosphere",et.vertexBuffer,et.indexBuffer,et.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const V=(function(J,ie){let fe=null;const ye=Object.values(J._layers).flatMap((we=>we.source&&!we.isHidden(ie)?[J.tileManagers[we.source]]:[])),ge=ye.filter((we=>we.getSource().type==="vector")),Se=ye.filter((we=>we.getSource().type!=="vector")),Me=we=>{(!fe||fe.getSource().maxzoom<we.getSource().maxzoom)&&(fe=we)};return ge.forEach((we=>Me(we))),fe||Se.forEach((we=>Me(we))),fe})(this.style,this.transform.zoom);V&&(function(J,ie,fe){for(let ye=0;ye<fe.length;ye++)mu(J,ie,fe[ye])})(this,V,V.getVisibleCoordinates())}this.options.showPadding&&(function(V){const J=V.transform.padding;xc(V,V.transform.height-(J.top||0),3,po),xc(V,J.bottom||0,3,Gn),mo(V,J.left||0,3,fd),mo(V,V.transform.width-(J.right||0),3,pd);const ie=V.transform.centerPoint;(function(fe,ye,ge,Se){si(fe,ye-1,ge-10,2,20,Se),si(fe,ye-10,ge-1,20,2,Se)})(V,ie.x,V.transform.height-ie.y,Aa)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=t?!c.cj(a,u):!c.ck(a,u)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(c.cl(a,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(b,j){const E=b.context,M=E.gl,z=b.transform,L=nr.unblended,q=new ms(M.LEQUAL,ms.ReadWrite,[0,1]),V=j.tileManager.getRenderableTiles(),J=b.useProgram("terrainDepth");E.bindFramebuffer.set(j.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),E.clear({color:c.bp.transparent,depth:1});for(const ie of V){const fe=j.getTerrainMesh(ie.tileID),ye=j.getTerrainData(ie.tileID),ge=z.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Se={u_ele_delta:j.getMeshFrameDelta(z.zoom)};J.draw(E,M.TRIANGLES,q,Bs.disabled,L,As.backCCW,Se,ye,ge,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain),(function(b,j){const E=b.context,M=E.gl,z=b.transform,L=nr.unblended,q=new ms(M.LEQUAL,ms.ReadWrite,[0,1]),V=j.getCoordsTexture(),J=j.tileManager.getRenderableTiles(),ie=b.useProgram("terrainCoords");E.bindFramebuffer.set(j.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),E.clear({color:c.bp.transparent,depth:1}),j.coordsIndex=[];for(const fe of J){const ye=j.getTerrainMesh(fe.tileID),ge=j.getTerrainData(fe.tileID);E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,V.texture);const Se={u_terrain_coords_id:(255-j.coordsIndex.length)/255,u_texture:0,u_ele_delta:j.getMeshFrameDelta(z.zoom)},Me=z.getProjectionData({overscaledTileID:fe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ie.draw(E,M.TRIANGLES,q,Bs.disabled,L,As.backCCW,Se,ge,Me,"terrain",ye.vertexBuffer,ye.indexBuffer,ye.segments),j.coordsIndex.push(fe.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain))}renderLayer(t,a,u,p,b){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(p||[]).length)&&(this.id=u.id,c.cm(u)?(function(j,E,M,z,L,q){if(j.renderPass!=="translucent")return;const{isRenderingToTexture:V}=q,J=Bs.disabled,ie=j.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(fe,ye,ge,Se,Me,we,ke,De,je){const qe=ye.transform,st=ye.style.map.terrain,Ke=Me==="map",et=we==="map";for(const tt of fe){const Rt=Se.getTile(tt),It=Rt.getBucket(ge);if(!It||!It.text||!It.text.segments.get().length)continue;const St=c.ay(It.textSizeData,qe.zoom),Bt=c.aN(Rt,1,ye.transform.zoom),fs=ra(Ke,ye.transform,Bt),er=ge.layout.get("icon-text-fit")!=="none"&&It.hasIconData();if(St){const _r=Math.pow(2,qe.zoom-Rt.tileID.overscaledZ),hr=st?(Tr,or)=>st.getElevation(tt,Tr,or):null;co(It,Ke,et,je,qe,fs,_r,St,er,c.aO(qe,Rt,ke,De),tt.toUnwrapped(),hr)}}})(z,j,M,E,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),L),M.paint.get("icon-opacity").constantOr(1)!==0&&jl(j,E,M,z,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),J,ie,V),M.paint.get("text-opacity").constantOr(1)!==0&&jl(j,E,M,z,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),J,ie,V),E.map.showCollisionBoxes&&(bi(j,E,M,z,!0),bi(j,E,M,z,!1))})(t,a,u,p,this.style.placement.variableOffsets,b):c.cn(u)?(function(j,E,M,z,L){if(j.renderPass!=="translucent")return;const{isRenderingToTexture:q}=L,V=M.paint.get("circle-opacity"),J=M.paint.get("circle-stroke-width"),ie=M.paint.get("circle-stroke-opacity"),fe=!M.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&(J.constantOr(1)===0||ie.constantOr(1)===0))return;const ye=j.context,ge=ye.gl,Se=j.transform,Me=j.getDepthModeForSublayer(0,ms.ReadOnly),we=Bs.disabled,ke=j.colorModeForRenderPass(),De=[],je=Se.getCircleRadiusCorrection();for(let qe=0;qe<z.length;qe++){const st=z[qe],Ke=E.getTile(st),et=Ke.getBucket(M);if(!et)continue;const tt=M.paint.get("circle-translate"),Rt=M.paint.get("circle-translate-anchor"),It=c.aO(Se,Ke,tt,Rt),St=et.programConfigurations.get(M.id),Bt=j.useProgram("circle",St),fs=et.layoutVertexBuffer,er=et.indexBuffer,_r=j.style.map.terrain&&j.style.map.terrain.getTerrainData(st),hr={programConfiguration:St,program:Bt,layoutVertexBuffer:fs,indexBuffer:er,uniformValues:su(j,Ke,M,It,je),terrainData:_r,projectionData:Se.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!q,applyTerrainMatrix:!0})};if(fe){const Tr=et.segments.get();for(const or of Tr)De.push({segments:new c.aX([or]),sortKey:or.sortKey,state:hr})}else De.push({segments:et.segments,sortKey:0,state:hr})}fe&&De.sort(((qe,st)=>qe.sortKey-st.sortKey));for(const qe of De){const{programConfiguration:st,program:Ke,layoutVertexBuffer:et,indexBuffer:tt,uniformValues:Rt,terrainData:It,projectionData:St}=qe.state;Ke.draw(ye,ge.TRIANGLES,Me,we,ke,As.backCCW,Rt,It,St,M.id,et,tt,qe.segments,M.paint,j.transform.zoom,st)}})(t,a,u,p,b):c.co(u)?(function(j,E,M,z,L){if(M.paint.get("heatmap-opacity")===0)return;const q=j.context,{isRenderingToTexture:V,isRenderingGlobe:J}=L;if(j.style.map.terrain){for(const ie of z){const fe=E.getTile(ie);E.hasRenderableParent(ie)||(j.renderPass==="offscreen"?dh(j,fe,M,ie,J):j.renderPass==="translucent"&&wi(j,M,ie,V,J))}q.viewport.set([0,0,j.width,j.height])}else j.renderPass==="offscreen"?(function(ie,fe,ye,ge){const Se=ie.context,Me=Se.gl,we=ie.transform,ke=Bs.disabled,De=new nr([Me.ONE,Me.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(je,qe,st){const Ke=je.gl;je.activeTexture.set(Ke.TEXTURE1),je.viewport.set([0,0,qe.width/4,qe.height/4]);let et=st.heatmapFbos.get(c.cd);et?(Ke.bindTexture(Ke.TEXTURE_2D,et.colorAttachment.get()),je.bindFramebuffer.set(et.framebuffer)):(et=dr(je,qe.width/4,qe.height/4),st.heatmapFbos.set(c.cd,et))})(Se,ie,ye),Se.clear({color:c.bp.transparent});for(let je=0;je<ge.length;je++){const qe=ge[je];if(fe.hasRenderableParent(qe))continue;const st=fe.getTile(qe),Ke=st.getBucket(ye);if(!Ke)continue;const et=Ke.programConfigurations.get(ye.id),tt=ie.useProgram("heatmap",et),Rt=we.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),It=we.getCircleRadiusCorrection();tt.draw(Se,Me.TRIANGLES,ms.disabled,ke,De,As.backCCW,Bo(st,we.zoom,ye.paint.get("heatmap-intensity"),It),null,Rt,ye.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,ye.paint,we.zoom,et)}Se.viewport.set([0,0,ie.width,ie.height])})(j,E,M,z):j.renderPass==="translucent"&&(function(ie,fe){const ye=ie.context,ge=ye.gl;ye.setColorMode(ie.colorModeForRenderPass());const Se=fe.heatmapFbos.get(c.cd);Se&&(ye.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Se.colorAttachment.get()),ye.activeTexture.set(ge.TEXTURE1),zs(ye,fe).bind(ge.LINEAR,ge.CLAMP_TO_EDGE),ie.useProgram("heatmapTexture").draw(ye,ge.TRIANGLES,ms.disabled,Bs.disabled,ie.colorModeForRenderPass(),As.disabled,ih(ie,fe,0,1),null,null,fe.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments,fe.paint,ie.transform.zoom))})(j,M)})(t,a,u,p,b):c.cp(u)?(function(j,E,M,z,L){if(j.renderPass!=="translucent")return;const{isRenderingToTexture:q}=L,V=M.paint.get("line-opacity"),J=M.paint.get("line-width");if(V.constantOr(1)===0||J.constantOr(1)===0)return;const ie=j.getDepthModeForSublayer(0,ms.ReadOnly),fe=j.colorModeForRenderPass(),ye=M.paint.get("line-dasharray"),ge=ye.constantOr(1),Se=M.paint.get("line-pattern"),Me=Se.constantOr(1),we=M.paint.get("line-gradient"),ke=M.getCrossfadeParameters();let De;De=Me?"linePattern":ge&&we?"lineGradientSDF":ge?"lineSDF":we?"lineGradient":"line";const je=j.context,qe=je.gl,st=j.transform;let Ke=!0;for(const et of z){const tt=E.getTile(et);if(Me&&!tt.patternsLoaded())continue;const Rt=tt.getBucket(M);if(!Rt)continue;const It=Rt.programConfigurations.get(M.id),St=j.context.program.get(),Bt=j.useProgram(De,It),fs=Ke||Bt.program!==St,er=j.style.map.terrain&&j.style.map.terrain.getTerrainData(et),_r=Se.constantOr(null),hr=ye&&ye.constantOr(null);if(_r&&tt.imageAtlas){const Si=tt.imageAtlas,qr=Si.patternPositions[_r.to.toString()],Gr=Si.patternPositions[_r.from.toString()];qr&&Gr&&It.setConstantPatternPositions(qr,Gr)}else if(hr){const Si=M.layout.get("line-cap")==="round",qr=j.lineAtlas.getDash(hr.to,Si),Gr=j.lineAtlas.getDash(hr.from,Si);It.setConstantDashPositions(qr,Gr)}const Tr=st.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),or=st.getPixelScale();let Or;Me?(Or=ah(j,tt,M,or,ke),Ca(je,qe,tt,It,ke)):ge&&we?(Or=Fo(j,tt,M,or,ke,Rt.lineClipsArray.length),la(j,E,je,qe,M,Rt,et,It,ke)):ge?(Or=aa(j,tt,M,or,ke),Ir(j,je,qe,It,fs,ke)):we?(Or=Pf(j,tt,M,or,Rt.lineClipsArray.length),oa(j,E,je,qe,M,Rt,et)):Or=au(j,tt,M,or);const Nr=j.stencilModeForClipping(et);Bt.draw(je,qe.TRIANGLES,ie,Nr,fe,As.disabled,Or,er,Tr,M.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,M.paint,j.transform.zoom,It,Rt.layoutVertexBuffer2),Ke=!1}})(t,a,u,p,b):c.cq(u)?(function(j,E,M,z,L){const q=M.paint.get("fill-color"),V=M.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const{isRenderingToTexture:J}=L,ie=j.colorModeForRenderPass(),fe=M.paint.get("fill-pattern"),ye=j.opaquePassEnabledForLayer()&&!fe.constantOr(1)&&q.constantOr(c.bp.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(j.renderPass===ye){const ge=j.getDepthModeForSublayer(1,j.renderPass==="opaque"?ms.ReadWrite:ms.ReadOnly);Un(j,E,M,z,ge,ie,!1,J)}if(j.renderPass==="translucent"&&M.paint.get("fill-antialias")){const ge=j.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,ms.ReadOnly);Un(j,E,M,z,ge,ie,!0,J)}})(t,a,u,p,b):c.cr(u)?(function(j,E,M,z,L){const q=M.paint.get("fill-extrusion-opacity");if(q===0)return;const{isRenderingToTexture:V}=L;if(j.renderPass==="translucent"){const J=new ms(j.context.gl.LEQUAL,ms.ReadWrite,j.depthRangeFor3D);if(q!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))$n(j,E,M,z,J,Bs.disabled,nr.disabled,V),$n(j,E,M,z,J,j.stencilModeFor3D(),j.colorModeForRenderPass(),V);else{const ie=j.colorModeForRenderPass();$n(j,E,M,z,J,Bs.disabled,ie,V)}}})(t,a,u,p,b):c.cs(u)?(function(j,E,M,z,L){if(j.renderPass!=="offscreen"&&j.renderPass!=="translucent")return;const{isRenderingToTexture:q}=L,V=j.context,J=j.style.projection.useSubdivision,ie=j.getDepthModeForSublayer(0,ms.ReadOnly),fe=j.colorModeForRenderPass();if(j.renderPass==="offscreen")(function(ye,ge,Se,Me,we,ke,De){const je=ye.context,qe=je.gl;for(const st of Se){const Ke=ge.getTile(st),et=Ke.dem;if(!et||!et.data||!Ke.needsHillshadePrepare)continue;const tt=et.dim,Rt=et.stride,It=et.getPixels();if(je.activeTexture.set(qe.TEXTURE1),je.pixelStoreUnpackPremultiplyAlpha.set(!1),Ke.demTexture=Ke.demTexture||ye.getTileTexture(Rt),Ke.demTexture){const Bt=Ke.demTexture;Bt.update(It,{premultiply:!1}),Bt.bind(qe.NEAREST,qe.CLAMP_TO_EDGE)}else Ke.demTexture=new c.T(je,It,qe.RGBA,{premultiply:!1}),Ke.demTexture.bind(qe.NEAREST,qe.CLAMP_TO_EDGE);je.activeTexture.set(qe.TEXTURE0);let St=Ke.fbo;if(!St){const Bt=new c.T(je,{width:tt,height:tt,data:null},qe.RGBA);Bt.bind(qe.LINEAR,qe.CLAMP_TO_EDGE),St=Ke.fbo=je.createFramebuffer(tt,tt,!0,!1),St.colorAttachment.set(Bt.texture)}je.bindFramebuffer.set(St.framebuffer),je.viewport.set([0,0,tt,tt]),ye.useProgram("hillshadePrepare").draw(je,qe.TRIANGLES,we,ke,De,As.disabled,kf(Ke.tileID,et),null,null,Me.id,ye.rasterBoundsBuffer,ye.quadTriangleIndexBuffer,ye.rasterBoundsSegments),Ke.needsHillshadePrepare=!1}})(j,E,z,M,ie,Bs.disabled,fe),V.viewport.set([0,0,j.width,j.height]);else if(j.renderPass==="translucent")if(J){const[ye,ge,Se]=j.stencilConfigForOverlapTwoPass(z);Vn(j,E,M,Se,ye,ie,fe,!1,q),Vn(j,E,M,Se,ge,ie,fe,!0,q)}else{const[ye,ge]=j.getStencilConfigForOverlapAndUpdateStencilID(z);Vn(j,E,M,ge,ye,ie,fe,!1,q)}})(t,a,u,p,b):c.ct(u)?(function(j,E,M,z,L){if(j.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:q}=L,V=j.style.projection.useSubdivision,J=j.getDepthModeForSublayer(0,ms.ReadOnly),ie=j.colorModeForRenderPass();if(V){const[fe,ye,ge]=j.stencilConfigForOverlapTwoPass(z);ho(j,E,M,ge,fe,J,ie,!1,q),ho(j,E,M,ge,ye,J,ie,!0,q)}else{const[fe,ye]=j.getStencilConfigForOverlapAndUpdateStencilID(z);ho(j,E,M,ye,fe,J,ie,!1,q)}})(t,a,u,p,b):c.bU(u)?(function(j,E,M,z,L){if(j.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:q}=L,V=E.getSource(),J=j.style.projection.useSubdivision;if(V instanceof oi)en(j,E,M,z,null,!1,!1,V.tileCoords,V.flippedWindingOrder,q);else if(J){const[ie,fe,ye]=j.stencilConfigForOverlapTwoPass(z);en(j,E,M,ye,ie,!1,!0,fo,!1,q),en(j,E,M,ye,fe,!0,!0,fo,!1,q)}else{const[ie,fe]=j.getStencilConfigForOverlapAndUpdateStencilID(z);en(j,E,M,fe,ie,!1,!0,fo,!1,q)}})(t,a,u,p,b):c.cu(u)?(function(j,E,M,z,L){const q=M.paint.get("background-color"),V=M.paint.get("background-opacity");if(V===0)return;const{isRenderingToTexture:J}=L,ie=j.context,fe=ie.gl,ye=j.style.projection,ge=j.transform,Se=ge.tileSize,Me=M.paint.get("background-pattern");if(j.isPatternMissing(Me))return;const we=!Me&&q.a===1&&V===1&&j.opaquePassEnabledForLayer()?"opaque":"translucent";if(j.renderPass!==we)return;const ke=Bs.disabled,De=j.getDepthModeForSublayer(0,we==="opaque"?ms.ReadWrite:ms.ReadOnly),je=j.colorModeForRenderPass(),qe=j.useProgram(Me?"backgroundPattern":"background"),st=z||xr(ge,{tileSize:Se,terrain:j.style.map.terrain});Me&&(ie.activeTexture.set(fe.TEXTURE0),j.imageManager.bind(j.context));const Ke=M.getCrossfadeParameters();for(const et of st){const tt=ge.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),Rt=Me?cu(V,j,Me,{tileID:et,tileSize:Se},Ke):lu(V,q),It=j.style.map.terrain&&j.style.map.terrain.getTerrainData(et),St=ye.getMeshFromTileID(ie,et.canonical,!1,!0,"raster");qe.draw(ie,fe.TRIANGLES,De,ke,je,As.backCCW,Rt,It,tt,M.id,St.vertexBuffer,St.indexBuffer,St.segments)}})(t,0,u,p,b):c.cv(u)&&(function(j,E,M,z){const{isRenderingGlobe:L}=z,q=j.context,V=M.implementation,J=j.style.projection,ie=j.transform,fe=ie.getProjectionDataForCustomLayer(L),ye={farZ:ie.farZ,nearZ:ie.nearZ,fov:ie.fov*Math.PI/180,modelViewProjectionMatrix:ie.modelViewProjectionMatrix,projectionMatrix:ie.projectionMatrix,shaderData:{variantName:J.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${J.shaderPreludeCode.vertexSource}`,define:J.shaderDefine},defaultProjectionData:fe},ge=V.renderingMode?V.renderingMode:"2d";if(j.renderPass==="offscreen"){const Se=V.prerender;Se&&(j.setCustomLayerDefaults(),q.setColorMode(j.colorModeForRenderPass()),Se.call(V,q.gl,ye),q.setDirty(),j.setBaseState())}else if(j.renderPass==="translucent"){j.setCustomLayerDefaults(),q.setColorMode(j.colorModeForRenderPass()),q.setStencilMode(Bs.disabled);const Se=ge==="3d"?j.getDepthModeFor3D():j.getDepthModeForSublayer(0,ms.ReadOnly);q.setDepthMode(Se),V.render(q.gl,ye),q.setDirty(),j.setBaseState(),q.bindFramebuffer.set(null)}})(t,0,u,b))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!a||!u}useProgram(t,a,u=!1,p=[]){this.cache=this.cache||{};const b=!!this.style.map.terrain,j=this.style.projection,E=u?Cr.projectionMercator:j.shaderPreludeCode,M=u?Ur:j.shaderDefine,z=t+(a?a.cacheKey:"")+`/${u?Zi:j.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[z]||(this.cache[z]=new Ef(this.context,Cr[t],a,Df[t],this._showOverdrawInspector,b,E,M,p)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const u in this._tileTextures){const p=this._tileTextures[u];if(p)for(const b of p)b.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const u in this.cache){const p=this.cache[u];p&&p.program&&this.context.gl.deleteProgram(p.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function fh(x,t){let a,u=!1,p=null,b=null;const j=()=>{p=null,u&&(x.apply(b,a),p=setTimeout(j,t),u=!1)};return(...E)=>(u=!0,b=this,a=E,p||j(),p)}class Yr{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(u=p)})),(u&&u[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const u=a.join("/");let p=u;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${u}`);let b=window.location.hash.replace(p,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let j=window.location.href.replace(/(#.+)?$/,b);j=j.replace("&&","&"),window.history.replaceState(window.history.state,null,j)},this._updateHash=fh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),j=Math.round(a.lng*b)/b,E=Math.round(a.lat*b)/b,M=this._map.getBearing(),z=this._map.getPitch();let L="";if(L+=t?`/${j}/${E}/${u}`:`${u}/${E}/${j}`,(M||z)&&(L+="/"+Math.round(10*M)/10),z&&(L+=`/${Math.round(z)}`),this._hashName){const q=this._hashName;let V=!1;const J=window.location.hash.slice(1).split("&").map((ie=>{const fe=ie.split("=")[0];return fe===q?(V=!0,`${fe}=${L}`):ie})).filter((ie=>ie));return V||J.push(`${q}=${L}`),`#${J.join("&")}`}return`#${L}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new c.V(+t[2],+t[1])}catch{return!1}const a=+t[0],u=+(t[3]||0),p=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&u>=-180&&u<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Hn={linearity:.3,easing:c.cw(0,0,.3,1)},_c=c.e({deceleration:2500,maxSpeed:1400},Hn),Li=c.e({deceleration:20,maxSpeed:1400},Hn),ka=c.e({deceleration:1e3,maxSpeed:360},Hn),Tl=c.e({deceleration:1e3,maxSpeed:90},Hn),Bi=c.e({deceleration:1e3,maxSpeed:360},Hn);class om{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Y(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=Y();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,a.roll+=b.rollDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){const b=gu(a.pan.mag(),u,c.e({},_c,t||{})),j=a.pan.mult(b.amount/a.pan.mag()),E=this._map.cameraHelper.handlePanInertia(j,this._map.transform);p.center=E.easingCenter,p.offset=E.easingOffset,vc(p,b)}if(a.zoom){const b=gu(a.zoom,u,Li),j=c.cx(this._map.transform.zoom+b.amount,this._map.getZoomSnap(),b.amount);p.zoom=j,vc(p,b)}if(a.bearing){const b=gu(a.bearing,u,ka);p.bearing=this._map.transform.bearing+c.an(b.amount,-179,179),vc(p,b)}if(a.pitch){const b=gu(a.pitch,u,Tl);p.pitch=this._map.transform.pitch+b.amount,vc(p,b)}if(a.roll){const b=gu(a.roll,u,Bi);p.roll=this._map.transform.roll+c.an(b.amount,-179,179),vc(p,b)}if(p.zoom||p.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;p.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),c.e(p,{noMoveStart:!0})}}function vc(x,t){(!x.duration||x.duration<t.duration)&&(x.duration=t.duration,x.easing=t.easing)}function gu(x,t,a){const{maxSpeed:u,linearity:p,deceleration:b}=a,j=c.an(x*p/(t/1e3),-u,u),E=Math.abs(j)/(b*p);return{easing:a.easing,duration:1e3*E,amount:j*(E/2)}}class yi extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u,p={}){u=u instanceof MouseEvent?u:new MouseEvent(t,u);const b=G.mousePos(a.getCanvas(),u),j=a.unproject(b);super(t,c.e({point:b,lngLat:j,originalEvent:u},p)),this._defaultPrevented=!1,this.target=a}}class xn extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){const p=t==="touchend"?u.changedTouches:u.touches,b=G.touchPos(a.getCanvasContainer(),p),j=b.map((M=>a.unproject(M))),E=b.reduce(((M,z,L,q)=>M.add(z.div(q.length))),new c.P(0,0));super(t,{points:b,point:E,lngLats:j,lngLat:a.unproject(E),originalEvent:u}),this._defaultPrevented=!1}}class gd extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class yd{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new gd(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new yi(t.type,this._map,t))}mouseup(t){this._map.fire(new yi(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new yi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new yi(t.type,this._map,t))}mouseover(t){this._map.fire(new yi(t.type,this._map,t))}mouseout(t){this._map.fire(new yi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new xn(t.type,this._map,t))}touchmove(t){this._map.fire(new xn(t.type,this._map,t))}touchend(t){this._map.fire(new xn(t.type,this._map,t))}touchcancel(t){this._map.fire(new xn(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new yi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new yi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _n{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(c.P.convert(t),this._map.terrain)}}class Zo{constructor(t,a){this._map=t,this._tr=new _n(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(G.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=G.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(p.x,u.x),j=Math.max(p.x,u.x),E=Math.min(p.y,u.y),M=Math.max(p.y,u.y);G.setTransform(this._box,`translate(${b}px,${E}px)`),this._box.style.width=j-b+"px",this._box.style.height=M-E+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const u=this._startPos,p=a;if(this.reset(),G.suppressClick(),u.x!==p.x||u.y!==p.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(u,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new c.l(t,{originalEvent:a}))}}function ca(x,t){if(x.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${t.length}`);const a={};for(let u=0;u<x.length;u++)a[x[u].identifier]=t[u];return a}class Ut{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=(function(p){const b=new c.P(0,0);for(const j of p)b._add(j);return b.div(p.length)})(a),this.touches=ca(u,a)))}touchmove(t,a,u){if(this.aborted||!this.centroid)return;const p=ca(u,a);for(const b in this.touches){const j=p[b];(!j||j.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class yu{constructor(t){this.singleTap=new Ut(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,u){this.singleTap.touchstart(t,a,u)}touchmove(t,a,u){this.singleTap.touchmove(t,a,u)}touchend(t,a,u){const p=this.singleTap.touchend(t,a,u);if(p){const b=t.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(p)<30;if(b&&j||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class xd{constructor(t){this._tr=new _n(t),this._zoomIn=new yu({numTouches:1,numTaps:2}),this._zoomOut=new yu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,u){this._zoomIn.touchstart(t,a,u),this._zoomOut.touchstart(t,a,u)}touchmove(t,a,u){this._zoomIn.touchmove(t,a,u),this._zoomOut.touchmove(t,a,u)}touchend(t,a,u){const p=this._zoomIn.touchend(t,a,u),b=this._zoomOut.touchend(t,a,u),j=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:c.cx(j.zoom+1,E.getZoomSnap()),around:j.unproject(p)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:c.cx(j.zoom-1,E.getZoomSnap()),around:j.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=Array.isArray(a)?a[0]:a;return!this._moved&&p.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(u,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&G.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vn=0,bc=2,_d={[vn]:1,[bc]:2};class Zn{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=G.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,u){const p=_d[u];return a.buttons===void 0||(a.buttons&p)!==p})(t,this._eventButton)}isValidEndEvent(t){return G.mouseButton(t)===this._eventButton}}class Nl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class xu{constructor(t=new Zn({checkCorrectEvent:()=>!0}),a=new Nl){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,u){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?u(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Wn=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=t=>{t.preventDefault()}};class vd{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,u){return this._calculateTransform(t,a,u)}touchmove(t,a,u){if(this._active){if(!this._shouldBePrevented(u.length))return t.preventDefault(),this._calculateTransform(t,a,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,u){this._calculateTransform(t,a,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,u){u.length>0&&(this._active=!0);const p=ca(u,a),b=new c.P(0,0),j=new c.P(0,0);let E=0;for(const z in p){const L=p[z],q=this._touches[z];q&&(b._add(L),j._add(L.sub(q)),E++,p[z]=L)}if(this._touches=p,this._shouldBePrevented(E)||!j.mag())return;const M=j.div(E);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(E),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _u{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,u){if(!this._firstTwoTouches)return;t.preventDefault();const[p,b]=this._firstTwoTouches,j=Yn(u,a,p),E=Yn(u,a,b);if(!j||!E)return;const M=this._aroundCenter?null:j.add(E).div(2);return this._move([j,E],M,t)}touchend(t,a,u){if(!this._firstTwoTouches)return;const[p,b]=this._firstTwoTouches,j=Yn(u,a,p),E=Yn(u,a,b);j&&E||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Yn(x,t,a){for(let u=0;u<x.length;u++)if(x[u].identifier===a)return t[u]}function ph(x,t){return Math.log(x/t)/Math.LN2}class Xn extends _u{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ph(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ph(this._distance,u),pinchAround:a}}}function bd(x,t){return 180*x.angleWith(t)/Math.PI}class vu extends _u{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,u){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bd(this._vector,p),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,u=bd(t,this._startVector);return Math.abs(u)<a}}function Kn(x){return Math.abs(x.y)>Math.abs(x.x)}class go extends _u{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,u){super.touchstart(t,a,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,Kn(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,b,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,b=a.mag()>=2;if(!p&&!b)return;if(!p||!b)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const j=t.y>0==a.y>0;return Kn(t)&&Kn(a)&&j}}const sn={panStep:100,bearingStep:15,pitchStep:10};class sr{constructor(t){this._tr=new _n(t);const a=sn;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,u=0,p=0,b=0,j=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),j=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:E=>{const M=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:mh,zoom:a?c.cx(M.zoom+a*(t.shiftKey?2:1),E.getZoomSnap()):M.zoom,bearing:M.bearing+u*this._bearingStep,pitch:M.pitch+p*this._pitchStep,offset:[-b*this._panStep,-j*this._panStep],center:M.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mh(x){return x*(2-x)}const yo=4.000244140625,Wo=1/450;class bu{constructor(t,a){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new _n(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Wo}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=Y(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%yo==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=G.mousePos(this._map.getCanvas(),t),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(c.V.convert(u.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const E=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=E),typeof this._targetZoom=="number"&&(this._targetZoom+=E)}if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>yo?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&M!==0&&(M=1/M);const z=typeof this._targetZoom!="number"?t.scale:c.aq(this._targetZoom),L=t.applyConstrain(t.getCameraLngLat(),c.at(z*M)).zoom,q=this._map.getZoomSnap();if(this._type==="wheel"&&q>0){const V=c.cx(t.zoom,q);this._targetZoom=c.cx(L,q,L-V)}else this._targetZoom=L;this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,u=this._startZoom,p=this._easing;let b,j=!1;if(this._type==="wheel"&&u&&p){const E=Y()-this._lastWheelEventTime,M=Math.min((E+5)/200,1),z=p(M);b=c.G.number(u,a,z),M<1?this._frameId||(this._frameId=!0):j=!0}else b=a,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!j,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=c.cz;if(this._prevEase){const u=this._prevEase,p=(Y()-u.start)/u.duration,b=u.easing(p+.01)-u.easing(p),j=.27/Math.sqrt(b*b+1e-4)*.01,E=Math.sqrt(.0729-j*j);a=c.cw(j,E,.25,1)}return this._prevEase={start:Y(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class wd{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class El{constructor(t){this._tr=new _n(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:c.cx(this._tr.zoom+(t.shiftKey?-1:1),u.getZoomSnap()),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wu{constructor(){this._tap=new yu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,u){if(!this._swipePoint)if(this._tapTime){const p=a[0],b=t.timeStamp-this._tapTime<500,j=this._tapPoint.dist(p)<30;b&&j?u.length>0&&(this._swipePoint=p,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,a,u)}touchmove(t,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=a[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,u)}touchend(t,a,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const p=this._tap.touchend(t,a,u);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gh{constructor(t,a,u){this._el=t,this._mousePan=a,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ma{constructor(t,a,u,p){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=u,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Cl{constructor(t,a,u,p){this._el=t,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $t{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=G.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=a,this._container.appendChild(p);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=u,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(G.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Wt=x=>x.zoom||x.drag||x.roll||x.pitch||x.rotate;class rn extends c.l{}function wc(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta||x.rollDelta}class Su{get _ownerDocument(){var t;return((t=this._el)===null||t===void 0?void 0:t.ownerDocument)||document}get _ownerWindow(){var t,a;return((a=(t=this._el)===null||t===void 0?void 0:t.ownerDocument)===null||a===void 0?void 0:a.defaultView)||window}constructor(t,a){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,b)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const j=p.type==="renderFrame"?void 0:p,E={needsRenderFrame:!1},M={},z={};for(const{handlerName:V,handler:J,allowed:ie}of this._handlers){if(!J.isEnabled())continue;let fe;if(this._blockedByActive(z,ie,V))J.reset();else if(J[b||p.type]){if(c.cA(p,b||p.type)){const ye=G.mousePos(this._map.getCanvas(),p);fe=J[b||p.type](p,ye)}else if(c.cB(p,b||p.type)){const ye=this._getMapTouches(p.touches),ge=G.touchPos(this._map.getCanvas(),ye);fe=J[b||p.type](p,ge,ye)}else c.cC(b||p.type)||(fe=J[b||p.type](p));this.mergeHandlerResult(E,M,fe,V,j),fe&&fe.needsRenderFrame&&this._triggerRenderFrame()}(fe||J.isActive())&&(z[V]=J)}const L={};for(const V in this._previousActiveHandlers)z[V]||(L[V]=j);this._previousActiveHandlers=z,(Object.keys(L).length||wc(E))&&(this._changes.push([E,M,L]),this._triggerRenderFrame()),(Object.keys(z).length||wc(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=E;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new om(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[p,b,j]of this._listeners)G.addEventListener(p,b,p===this._ownerDocument?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[t,a,u]of this._listeners)G.removeEventListener(t,a,t===this._ownerDocument?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new yd(a,t));const p=a.boxZoom=new Zo(a,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const b=a.cooperativeGestures=new $t(a,t.cooperativeGestures);this._add("cooperativeGestures",b),t.cooperativeGestures&&b.enable();const j=new xd(a),E=new El(a);a.doubleClickZoom=new wd(E,j),this._add("tapZoom",j),this._add("clickZoom",E),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const M=new wu;this._add("tapDragZoom",M);const z=a.touchPitch=new go(a);this._add("touchPitch",z),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const L=()=>a.project(a.getCenter()),q=(function({enable:we,clickTolerance:ke,aroundCenter:De=!0,minPixelCenterThreshold:je=100,rotateDegreesPerPixelMoved:qe=.8},st){const Ke=new Zn({checkCorrectEvent:et=>G.mouseButton(et)===0&&et.ctrlKey||G.mouseButton(et)===2&&!et.ctrlKey});return new tn({clickTolerance:ke,move:(et,tt)=>{const Rt=st();if(De&&Math.abs(Rt.y-et.y)>je)return{bearingDelta:c.cy(new c.P(et.x,tt.y),tt,Rt)};let It=(tt.x-et.x)*qe;return De&&tt.y<Rt.y&&(It=-It),{bearingDelta:It}},moveStateManager:Ke,enable:we,assignEvents:Wn})})(t,L),V=(function({enable:we,clickTolerance:ke,pitchDegreesPerPixelMoved:De=-.5}){const je=new Zn({checkCorrectEvent:qe=>G.mouseButton(qe)===0&&qe.ctrlKey||G.mouseButton(qe)===2});return new tn({clickTolerance:ke,move:(qe,st)=>({pitchDelta:(st.y-qe.y)*De}),moveStateManager:je,enable:we,assignEvents:Wn})})(t),J=(function({enable:we,clickTolerance:ke,rollDegreesPerPixelMoved:De=.3},je){const qe=new Zn({checkCorrectEvent:st=>G.mouseButton(st)===2&&st.ctrlKey});return new tn({clickTolerance:ke,move:(st,Ke)=>{const et=je();let tt=(Ke.x-st.x)*De;return Ke.y<et.y&&(tt=-tt),{rollDelta:tt}},moveStateManager:qe,enable:we,assignEvents:Wn})})(t,L);a.dragRotate=new Ma(t,q,V,J),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",V,["mouseRotate","mouseRoll"]),this._add("mouseRoll",J,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const ie=(function({enable:we,clickTolerance:ke}){const De=new Zn({checkCorrectEvent:je=>G.mouseButton(je)===0&&!je.ctrlKey});return new tn({clickTolerance:ke,move:(je,qe)=>({around:qe,panDelta:qe.sub(je)}),activateOnStart:!0,moveStateManager:De,enable:we,assignEvents:Wn})})(t),fe=new vd(t,a);a.dragPan=new gh(u,ie,fe),this._add("mousePan",ie),this._add("touchPan",fe,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const ye=new vu,ge=new Xn;a.touchZoomRotate=new Cl(u,ge,ye,M),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",ge,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new zf(a));const Se=a.scrollZoom=new bu(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Se,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const Me=a.keyboard=new sr(a);this._add("keyboard",Me),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,u){this._handlers.push({handlerName:t,handler:a,allowed:u}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,u){for(const p in t)if(p!==u&&(!a||a.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const u of t)this._el.contains(u.target)&&a.push(u);return a}mergeHandlerResult(t,a,u,p,b){if(!u)return;c.e(t,u);const j={handlerName:p,originalEvent:u.originalEvent||b};u.zoomDelta!==void 0&&(a.zoom=j),u.panDelta!==void 0&&(a.drag=j),u.rollDelta!==void 0&&(a.roll=j),u.pitchDelta!==void 0&&(a.pitch=j),u.bearingDelta!==void 0&&(a.rotate=j)}_applyChanges(){const t={},a={},u={};for(const[p,b,j]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(t.rollDelta=(t.rollDelta||0)+p.rollDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),c.e(a,b),c.e(u,j);this._updateMapTransform(t,a,u),this._changes=[]}_updateMapTransform(t,a,u){const p=this._map,b=p._getTransformForUpdate(),j=p.terrain;if(!(wc(t)||j&&this._terrainMovement))return this._fireEvents(a,u,!0);p._stop(!0);let{panDelta:E,zoomDelta:M,bearingDelta:z,pitchDelta:L,rollDelta:q,around:V,pinchAround:J}=t;J!==void 0&&(V=J),V=V||p.transform.centerPoint,j&&!b.isPointOnMapSurface(V)&&(V=b.centerPoint);const ie={panDelta:E,zoomDelta:M,rollDelta:q,pitchDelta:L,bearingDelta:z,around:V};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(V)&&(V=b.centerPoint);const fe=V.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(E?V.sub(E):V);this._handleMapControls({terrain:j,tr:b,deltasForHelper:ie,preZoomAroundLoc:fe,combinedEventsInProgress:a,panDelta:E}),p._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,u,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:u,preZoomAroundLoc:p,combinedEventsInProgress:b,panDelta:j}){const E=this._map.cameraHelper;if(E.handleMapControlsRollPitchBearingZoom(u,a),t)return E.useGlobeControls?(this._terrainMovement||!b.drag&&!b.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void E.handleMapControlsPan(u,a,p)):this._terrainMovement||!b.drag&&!b.zoom?void(b.drag&&this._terrainMovement&&j?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(j))):E.handleMapControlsPan(u,a,p)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void E.handleMapControlsPan(u,a,p));E.handleMapControlsPan(u,a,p)}_fireEvents(t,a,u){const p=Wt(this._eventsInProgress),b=Wt(t),j={};for(const q in t){const{originalEvent:V}=t[q];this._eventsInProgress[q]||(j[`${q}start`]=V),this._eventsInProgress[q]=t[q]}!p&&b&&this._fireEvent("movestart",b.originalEvent);for(const q in j)this._fireEvent(q,j[q]);b&&this._fireEvent("move",b.originalEvent);for(const q in t){const{originalEvent:V}=t[q];this._fireEvent(q,V)}const E={};let M;for(const q in this._eventsInProgress){const{handlerName:V,originalEvent:J}=this._eventsInProgress[q];this._handlersById[V].isActive()||(delete this._eventsInProgress[q],M=a[V]||J,E[`${q}end`]=M)}for(const q in E)this._fireEvent(q,E[q]);const z=Wt(this._eventsInProgress),L=(p||b)&&!z;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const q=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&q.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(q)}if(u&&L){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!q||!q.essential&&ae.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:M})),V(this._map.getBearing())&&this._map.resetNorth()):(V(q.bearing||this._map.getBearing())&&(q.bearing=0),q.freezeElevation=!0,this._map.easeTo(q,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new c.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new rn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Xr extends c.E{constructor(t,a,u){super(),this._renderFrameCallback=()=>{const p=Math.min((Y()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=u.bearingSnap,this._zoomSnap=u.zoomSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform,!0),this.transform=t,this.cameraHelper=a}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,u){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},a),u)}panTo(t,a,u){return this.easeTo(c.e({center:t},a),u)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,u){return this.easeTo(c.e({zoom:t},a),u)}zoomIn(t,a){return this.zoomTo(c.cx(this.getZoom()+1,this._zoomSnap),t,a),this}zoomOut(t,a){return this.zoomTo(c.cx(this.getZoom()-1,this._zoomSnap),t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new c.l("movestart",a)).fire(new c.l("move",a)).fire(new c.l("moveend",a))),this}getBearing(){return this.transform.bearing}setZoomSnap(t){return this._zoomSnap=t,this}getZoomSnap(){return this._zoomSnap}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,u){return this.easeTo(c.e({bearing:t},a),u)}resetNorth(t,a){return this.rotateTo(0,c.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=Os.convert(t).adjustAntiMeridian();const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,a)}_cameraForBoxAndBearing(t,a,u,p){const b={top:0,bottom:0,right:0,left:0};if(typeof(p=c.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const z=p.padding;p.padding={top:z,bottom:z,right:z,left:z}}const j=c.e(b,p.padding);p.padding=j;const E=this.transform,M=new Os(t,a);return this.cameraHelper.cameraForBoxAndBearing(p,j,M,u,E)}fitBounds(t,a,u){return this._fitInternal(this.cameraForBounds(t,a),a,u)}fitScreenCoordinates(t,a,u,p,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(t)),this.transform.screenPointToLocation(c.P.convert(a)),u,p),p,b)}_fitInternal(t,a,u){return t?(delete(a=c.e(t,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(t,a){this.stop();const u=this._getTransformForUpdate();let p=!1,b=!1,j=!1;const E=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,t);const M=u.zoom!==E;return"elevation"in t&&u.elevation!==+t.elevation&&u.setElevation(+t.elevation),"bearing"in t&&u.bearing!==+t.bearing&&(p=!0,u.setBearing(+t.bearing)),"pitch"in t&&u.pitch!==+t.pitch&&(b=!0,u.setPitch(+t.pitch)),"roll"in t&&u.roll!==+t.roll&&(j=!0,u.setRoll(+t.roll)),t.padding==null||u.isPaddingEqual(t.padding)||u.setPadding(t.padding),this._applyUpdatedTransform(u),this.fire(new c.l("movestart",a)).fire(new c.l("move",a)),M&&this.fire(new c.l("zoomstart",a)).fire(new c.l("zoom",a)).fire(new c.l("zoomend",a)),p&&this.fire(new c.l("rotatestart",a)).fire(new c.l("rotate",a)).fire(new c.l("rotateend",a)),b&&this.fire(new c.l("pitchstart",a)).fire(new c.l("pitch",a)).fire(new c.l("pitchend",a)),j&&this.fire(new c.l("rollstart",a)).fire(new c.l("roll",a)).fire(new c.l("rollend",a)),this.fire(new c.l("moveend",a))}calculateCameraOptionsFromTo(t,a,u,p=0){const b=c.a9.fromLngLat(t,a),j=c.a9.fromLngLat(u,p),E=j.x-b.x,M=j.y-b.y,z=j.z-b.z,L=Math.hypot(E,M,z);if(L===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(E,M),V=c.at(this.transform.cameraToCenterDistance/L/this.transform.tileSize),J=180*Math.atan2(E,-M)/Math.PI;let ie=180*Math.acos(q/L)/Math.PI;return ie=z<0?90-ie:90+ie,{center:j.toLngLat(),elevation:p,zoom:V,pitch:ie,bearing:J}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,u,p,b){const j=this.transform.calculateCenterFromCameraLngLatAlt(t,a,u,p);return{center:j.center,elevation:j.elevation,zoom:j.zoom,bearing:u,pitch:p,roll:b}}easeTo(t,a){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.cz},t)).animate===!1||!t.essential&&ae.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),p=this.getBearing(),b=u.pitch,j=u.roll,E="bearing"in t?this._normalizeBearing(t.bearing,p):p,M="pitch"in t?+t.pitch:b,z="roll"in t?this._normalizeBearing(t.roll,j):j,L="padding"in t?t.padding:u.padding,q=c.P.convert(t.offset);let V,J;t.around&&(V=c.V.convert(t.around),J=u.locationToScreenPoint(V));const ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},fe=this.cameraHelper.handleEaseTo(u,{bearing:E,pitch:M,roll:z,padding:L,around:V,aroundPoint:J,offsetAsPoint:q,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||p!==E,this._pitching=this._pitching||M!==b,this._rolling=this._rolling||z!==j,this._padding=!u.isPaddingEqual(L),this._zooming=this._zooming||fe.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ie),this.terrain&&this._prepareElevation(fe.elevationCenter),this._ease((ye=>{fe.easeFunc(ye),this.terrain&&!t.freezeElevation&&this._updateElevation(ye),this._applyUpdatedTransform(u),this._fireMoveEvents(a)}),(ye=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,ye)}),t),this}_prepareEase(t,a,u={}){this._moving=!0,a||u.moving||this.fire(new c.l("movestart",t)),this._zooming&&!u.zooming&&this.fire(new c.l("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new c.l("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new c.l("pitchstart",t)),this._rolling&&!u.rolling&&this.fire(new c.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(a-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),u=t.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(u<p){const b=this.calculateCameraOptionsFromTo(a,p,t.center,t.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&a.push((p=>this.transformCameraUpdate(p))),!a.length)return;const u=t.clone();for(const p of a){const b=u.clone(),{center:j,zoom:E,roll:M,pitch:z,bearing:L,elevation:q}=p(b);j&&b.setCenter(j),q!==void 0&&b.setElevation(q),E!==void 0&&b.setZoom(E),M!==void 0&&b.setRoll(M),z!==void 0&&b.setPitch(z),L!==void 0&&b.setBearing(L),u.apply(b,!1)}this.transform.apply(u,!1)}_fireMoveEvents(t){this.fire(new c.l("move",t)),this._zooming&&this.fire(new c.l("zoom",t)),this._rotating&&this.fire(new c.l("rotate",t)),this._pitching&&this.fire(new c.l("pitch",t)),this._rolling&&this.fire(new c.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const u=this._zooming,p=this._rotating,b=this._pitching,j=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new c.l("zoomend",t)),p&&this.fire(new c.l("rotateend",t)),b&&this.fire(new c.l("pitchend",t)),j&&this.fire(new c.l("rollend",t)),this.fire(new c.l("moveend",t))}flyTo(t,a){if(!t.essential&&ae.prefersReducedMotion){const tt=c.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(tt,a)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cz},t);const u=this._getTransformForUpdate(),p=u.bearing,b=u.pitch,j=u.roll,E=u.padding,M="bearing"in t?this._normalizeBearing(t.bearing,p):p,z="pitch"in t?+t.pitch:b,L="roll"in t?this._normalizeBearing(t.roll,j):j,q="padding"in t?t.padding:u.padding,V=c.P.convert(t.offset);let J=u.centerPoint.add(V);const ie=u.screenPointToLocation(J),fe=this.cameraHelper.handleFlyTo(u,{bearing:M,pitch:z,roll:L,padding:q,locationAtOffset:ie,offsetAsPoint:V,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ye=t.curve;const ge=Math.max(u.width,u.height),Se=ge/fe.scaleOfZoom,Me=fe.pixelPathLength;typeof fe.scaleOfMinZoom=="number"&&(ye=Math.sqrt(ge/fe.scaleOfMinZoom/Me*2));const we=ye*ye;function ke(tt){const Rt=(Se*Se-ge*ge+(tt?-1:1)*we*we*Me*Me)/(2*(tt?Se:ge)*we*Me);return Math.log(Math.sqrt(Rt*Rt+1)-Rt)}function De(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function je(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const qe=ke(!1);let st=function(tt){return je(qe)/je(qe+ye*tt)},Ke=function(tt){return ge*((je(qe)*(De(Rt=qe+ye*tt)/je(Rt))-De(qe))/we)/Me;var Rt},et=(ke(!0)-qe)/ye;if(Math.abs(Me)<2e-6||!isFinite(et)){if(Math.abs(ge-Se)<1e-6)return this.easeTo(t,a);const tt=Se<ge?-1:1;et=Math.abs(Math.log(Se/ge))/ye,Ke=()=>0,st=Rt=>Math.exp(tt*ye*Rt)}return t.duration="duration"in t?+t.duration:1e3*et/("screenSpeed"in t?+t.screenSpeed/ye:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==M,this._pitching=z!==b,this._rolling=L!==j,this._padding=!u.isPaddingEqual(q),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(fe.targetCenter),this._ease((tt=>{const Rt=tt*et,It=1/st(Rt),St=Ke(Rt);this._rotating&&u.setBearing(c.G.number(p,M,tt)),this._pitching&&u.setPitch(c.G.number(b,z,tt)),this._rolling&&u.setRoll(c.G.number(j,L,tt)),this._padding&&(u.interpolatePadding(E,q,tt),J=u.centerPoint.add(V)),fe.easeFunc(tt,It,St,J),this.terrain&&!t.freezeElevation&&this._updateElevation(tt),this._applyUpdatedTransform(u),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,a)}return t||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(t,a,u){u.animate===!1||u.duration===0?(t(1),a()):(this._easeStart=Y(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=c.W(t,-180,180);const u=Math.abs(t-a);return Math.abs(t-360-a)<u&&(t-=360),Math.abs(t+360-a)<u&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(t),this.transform):null}}const zr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Vr{constructor(t=zr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=G.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=G.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const u=this._map._getUIString(`AttributionControl.${a}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const a=this._map.style.tileManagers;for(const p in a){const b=a[p];if(b.used||b.usedForTerrain){const j=b.getSource();j.attribution&&t.indexOf(j.attribution)<0&&t.push(j.attribution)}}t=t.filter((p=>String(p).trim())),t.sort(((p,b)=>p.length-b.length)),t=t.filter(((p,b)=>{for(let j=b+1;j<t.length;j++)if(t[j].indexOf(p)>=0)return!1;return!0}));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=G.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ju{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=G.create("div","maplibregl-ctrl");const a=G.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){G.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class xo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Cs=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Qs extends c.E{constructor(t){super(),this._lastTilesetChange=Y(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const u={};for(const p of xr(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))u[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),c.c7(p.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[p.key]=new ve(p,this.tileSize),this._lastTilesetChange=Y());for(const p in this._tiles)u[p]||delete this._tiles[p]}freeRtt(t){for(const a in this._tiles){const u=this._tiles[a];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const u of this._renderableTilesKeys){const p=this._tiles[u].tileID,b=t.clone(),j=c.bk();if(p.canonical.equals(t.canonical))c.c7(j,0,c.a5,c.a5,0,0,1);else if(p.canonical.isChildOf(t.canonical)){const E=p.canonical.z-t.canonical.z,M=p.canonical.x-(p.canonical.x>>E<<E),z=p.canonical.y-(p.canonical.y>>E<<E),L=c.a5>>E;c.c7(j,0,L,L,0,0,1),c.O(j,j,[-M*L,-z*L,0])}else{if(!t.canonical.isChildOf(p.canonical))continue;{const E=t.canonical.z-p.canonical.z,M=t.canonical.x-(t.canonical.x>>E<<E),z=t.canonical.y-(t.canonical.y>>E<<E),L=c.a5>>E;c.c7(j,0,c.a5,c.a5,0,0,1),c.O(j,j,[M*L,z*L,0]),c.Q(j,j,[1/2**E,1/2**E,0])}}b.terrainRttPosMatrix32f=new Float32Array(j),a[u]=b}return a}_getTerrainCoordsForTileRanges(t,a){const u={};for(const p of this._renderableTilesKeys){const b=this._tiles[p].tileID;if(!this._isWithinTileRanges(b,a))continue;const j=t.clone(),E=c.bk();if(b.canonical.z===t.canonical.z){const M=t.canonical.x-b.canonical.x+t.wrap*(1<<t.canonical.z),z=t.canonical.y-b.canonical.y;c.c7(E,0,c.a5,c.a5,0,0,1),c.O(E,E,[M*c.a5,z*c.a5,0])}else if(b.canonical.z>t.canonical.z){const M=b.canonical.z-t.canonical.z,z=b.canonical.x-(b.canonical.x>>M<<M)+t.wrap*(1<<b.canonical.z),L=b.canonical.y-(b.canonical.y>>M<<M),q=t.canonical.x-(b.canonical.x>>M),V=t.canonical.y-(b.canonical.y>>M),J=c.a5>>M;c.c7(E,0,J,J,0,0,1),c.O(E,E,[-z*J+q*c.a5,-L*J+V*c.a5,0])}else{const M=t.canonical.z-b.canonical.z,z=t.canonical.x-(t.canonical.x>>M<<M)+t.wrap*(1<<t.canonical.z),L=t.canonical.y-(t.canonical.y>>M<<M),q=(t.canonical.x>>M)-b.canonical.x,V=(t.canonical.y>>M)-b.canonical.y,J=c.a5<<M;c.c7(E,0,J,J,0,0,1),c.O(E,E,[z*c.a5+q*J,L*c.a5+V*J,0])}j.terrainRttPosMatrix32f=new Float32Array(E),u[p]=j}return u}getSourceTile(t,a){const u=this.tileManager._source;let p=t.overscaledZ-this.deltaZoom;if(p>u.maxzoom&&(p=u.maxzoom),p<u.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let b=this.findTileInCaches(this._sourceTileCache[t.key]);if(!b?.dem&&a)for(;p>=u.minzoom&&!b?.dem;)b=this.findTileInCaches(t.scaledTo(p--).key);return b}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){const u=a[t.canonical.z];return!!u&&(t.wrap>u.minWrap||t.wrap<u.maxWrap||t.canonical.x>=u.minTileXWrapped&&t.canonical.x<=u.maxTileXWrapped&&t.canonical.y>=u.minTileY&&t.canonical.y<=u.maxTileY)}}class Ts{constructor(t,a,u){this._meshCache={},this.painter=t,this.tileManager=new Qs(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,u,p=c.a5){var b;const j=t.normalizeCoordinates(a,u,p);if(!j)return 0;const E=this.getTerrainData(j.tileID),M=(b=E.tile)===null||b===void 0?void 0:b.dem;if(!M)return 0;const z=c.cD([],[j.x/p*c.a5,j.y/p*c.a5],E.u_terrain_matrix),L=[z[0]*M.dim,z[1]*M.dim],q=Math.floor(L[0]),V=Math.floor(L[1]),J=L[0]-q,ie=L[1]-V;return M.get(q,V)*(1-J)*(1-ie)+M.get(q+1,V)*J*(1-ie)+M.get(q,V+1)*(1-J)*ie+M.get(q+1,V+1)*J*ie}getElevationForLngLatZoom(t,a){if(!c.cE(a,t.wrap()))return 0;const{tileID:u,mercatorX:p,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(u,p%c.a5,b%c.a5,c.a5)}getElevationForLngLat(t,a){const u=xr(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let p=0;for(const b of u)b.canonical.z>p&&(p=Math.min(b.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,p)}getElevation(t,a,u,p=c.a5){return this.getDEMElevation(t,a,u,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,b=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(p,b,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(p,new c.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const p=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new c.T(p,a.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),a.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a.toString()+a.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const p=this.tileManager.getSource().maxzoom;let b=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?b=t.canonical.z-p:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const j=t.canonical.x-(t.canonical.x>>b<<b),E=t.canonical.y-(t.canonical.y>>b<<b),M=c.cF(new Float64Array(16),[1/(c.a5<<b),1/(c.a5<<b),0]);c.O(M,M,[j*c.a5,E*c.a5,0]),this._demMatrixCache[t.key]={matrix:M,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,u=a.width/devicePixelRatio,p=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(a.context,{width:u,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(a.context,{width:u,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,p,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,j=0;b<this._coordsTextureSize;b++)for(let E=0;E<this._coordsTextureSize;E++,j+=4)a[j+0]=255&E,a[j+1]=255&b,a[j+2]=E>>8<<4|b>>8,a[j+3]=0;const u=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),p=new c.T(t,u,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),u=this.painter.context,p=u.gl,b=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),j=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(b,E-j-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null);const M=a[0]+(a[2]>>4<<8),z=a[1]+((15&a[2])<<8),L=this.coordsIndex[255-a[3]],q=L&&this.tileManager.getTileByID(L);if(!q)return null;const V=this._coordsTextureSize,J=(1<<q.tileID.canonical.z)*V;return new c.a9((q.tileID.canonical.x*V+M)/J+q.tileID.wrap,(q.tileID.canonical.y*V+z)/J,this.getElevation(q.tileID,M,z,V))}depthAtPoint(t){const a=new Uint8Array(4),u=this.painter.context,p=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const u=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,p=u&&t.canonical.y===0,b=u&&t.canonical.y===(1<<t.canonical.z)-1,j=`m_${p?"n":""}_${b?"s":""}`;if(this._meshCache[j])return this._meshCache[j];const E=this.painter.context,M=new c.cG,z=new c.aY,L=this.meshSize,q=c.a5/L,V=L*L;for(let je=0;je<=L;je++)for(let qe=0;qe<=L;qe++)M.emplaceBack(qe*q,je*q,0);for(let je=0;je<V;je+=L+1)for(let qe=0;qe<L;qe++)z.emplaceBack(qe+je,L+qe+je+1,L+qe+je+2),z.emplaceBack(qe+je,L+qe+je+2,qe+je+1);const J=M.length,ie=J+(L+1),fe=(L+1)*L,ye=p?c.br:0,ge=p?0:1,Se=b?c.bs:c.a5,Me=b?0:1;for(let je=0;je<=L;je++)M.emplaceBack(je*q,ye,ge);for(let je=0;je<=L;je++)M.emplaceBack(je*q,Se,Me);for(let je=0;je<L;je++)z.emplaceBack(fe+je,ie+je,ie+je+1),z.emplaceBack(fe+je,ie+je+1,fe+je+1),z.emplaceBack(0+je,J+je+1,J+je),z.emplaceBack(0+je,0+je+1,J+je+1);const we=M.length,ke=we+2*(L+1);for(const je of[0,1])for(let qe=0;qe<=L;qe++)for(const st of[0,1])M.emplaceBack(je*c.a5,qe*q,st);for(let je=0;je<2*L;je+=2)z.emplaceBack(we+je,we+je+1,we+je+3),z.emplaceBack(we+je,we+je+3,we+je+2),z.emplaceBack(ke+je,ke+je+3,ke+je+1),z.emplaceBack(ke+je,ke+je+2,ke+je+3);const De=new ur(E.createVertexBuffer(M,Cs.members),E.createIndexBuffer(z),c.aX.simpleSegment(0,0,M.length,z.length));return this._meshCache[j]=De,De}getMeshFrameDelta(t){return 2*Math.PI*c.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var u;if(!c.cE(a,t.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(u=this.getMinMaxElevation(p).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=a.dem.min*this.exaggeration,u.maxElevation=a.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,a){const u=c.a9.fromLngLat(t.wrap()),p=(1<<a)*c.a5,b=u.x*p,j=u.y*p,E=Math.floor(b/c.a5),M=Math.floor(j/c.a5);return{tileID:new c.a2(a,0,a,E,M),mercatorX:b,mercatorY:j}}}class Mr{constructor(t,a,u){this._context=t,this._size=a,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(u.texture),{id:t,fbo:a,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const an={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class bn{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Mr(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){var u,p;this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((b=>!t._layers[b].isHidden(a))),this._coordsAscending={};for(const b in t.tileManagers){this._coordsAscending[b]={};const j=t.tileManagers[b].getVisibleCoordinates(),E=t.tileManagers[b].getSource(),M=E instanceof oi?E.terrainTileRanges:null;for(const z of j){const L=this.terrain.tileManager.getTerrainCoords(z,M);for(const q in L)this._coordsAscending[b][q]||(this._coordsAscending[b][q]=[]),this._coordsAscending[b][q].push(L[q])}}this._rttFingerprints={};for(const b of t._order){const j=t._layers[b],E=j.source;if(an[j.type]&&!this._rttFingerprints[E]){this._rttFingerprints[E]={};const M=(p=(u=t.tileManagers[E])===null||u===void 0?void 0:u.getState().revision)!==null&&p!==void 0?p:0;for(const z in this._coordsAscending[E])this._rttFingerprints[E][z]=`${this._coordsAscending[E][z].map((L=>L.key)).sort().join()}#${M}`}}for(const b of this._renderableTiles)for(const j in this._rttFingerprints){const E=this._rttFingerprints[j][b.tileID.key];E&&E!==b.rttFingerprint[j]&&(b.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),p=t.type,b=this.painter,j=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(an[p]&&(this._prevType&&an[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(t.id),!j))return!0;if(an[this._prevType]||an[p]&&j){this._prevType=p;const E=this._stacks.length-1,M=this._stacks[E]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(md(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[E]){const q=this.pool.getObjectForId(z.rtt[E].id);if(q.stamp===z.rtt[E].stamp){this.pool.useObject(q);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),z.rtt[E]={id:L.id,stamp:L.stamp},b.context.bindFramebuffer.set(L.fbo.framebuffer),b.context.clear({color:c.bp.transparent,stencil:0}),b.currentStencilSource=void 0;for(let q=0;q<M.length;q++){const V=b.style._layers[M[q]],J=V.source?this._coordsAscending[V.source][z.tileID.key]:[z.tileID];b.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),b._renderTileClippingMasks(V,J,!0),b.renderLayer(b,b.style.tileManagers[V.source],V,J,u),V.source&&(z.rttFingerprint[V.source]=this._rttFingerprints[V.source][z.tileID.key])}}return md(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),an[p]}return!1}}const Al={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Drag to rotate map, click to reset north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},kl=O,_o={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:zr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},yh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class jr{constructor(t,a,u=!1){this.mousedown=b=>{this.startMove(b,G.mousePos(this.element,b)),G.addEventListener(window,"mousemove",this.mousemove),G.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,G.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHandler.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),G.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const p=new xu;this._rotatePitchHandler=new tn({clickTolerance:3,move:(b,j)=>{const E=a.getBoundingClientRect(),M=new c.P((E.bottom-E.top)/2,(E.right-E.left)/2);return{bearingDelta:c.cy(new c.P(b.x,j.y),j,M),pitchDelta:u?-.5*(j.y-b.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=t,G.addEventListener(a,"mousedown",this.mousedown),G.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),G.disableDrag()}move(t,a){const u=this.map,{bearingDelta:p,pitchDelta:b}=this._rotatePitchHandler.dragMove(t,a)||{};p&&u.setBearing(u.getBearing()+p),b&&u.setPitch(u.getPitch()+b)}off(){const t=this.element;G.removeEventListener(t,"mousedown",this.mousedown),G.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend),G.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),G.removeEventListener(window,"mousemove",this.mousemove),G.removeEventListener(window,"mouseup",this.mouseup),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend)}}let wn;function Sc(x,t,a,u=!1){if(u||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return x?.wrap();const p=new c.V(x.lng,x.lat);if(x=new c.V(x.lng,x.lat),t){const b=new c.V(x.lng-360,x.lat),j=new c.V(x.lng+360,x.lat),E=a.locationToScreenPoint(x).distSqr(t);a.locationToScreenPoint(b).distSqr(t)<E?x=b:a.locationToScreenPoint(j).distSqr(t)<E&&(x=j)}for(;Math.abs(x.lng-a.center.lng)>180;){const b=a.locationToScreenPoint(x);if(b.x>=0&&b.y>=0&&b.x<=a.width&&b.y<=a.height)break;x.lng>a.center.lng?x.lng-=360:x.lng+=360}return x.lng!==p.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(x))?x:p}const jc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tu(x,t,a){const u=x.classList;for(const p in jc)u.remove(`maplibregl-${a}-anchor-${p}`);u.add(`maplibregl-${a}-anchor-${t}`)}class Nu extends c.E{constructor(t){if(super(),this._onClick=a=>{this.fire(new c.l("click",{originalEvent:a}))},this._onKeyPress=a=>{const u=a.code,p=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=a=>{const u=a.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Sc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,`${jc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${p}`),ae.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div");const a=G.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${p}px`),a.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const b=G.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const j=G.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill-rule","nonzero");const E=G.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of M){const Se=G.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",ge.rx),Se.setAttributeNS(null,"ry",ge.ry),E.appendChild(Se)}const z=G.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const L=G.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(L);const q=G.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const V=G.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(V);const J=G.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const ie=G.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(8.0, 8.0)");const fe=G.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#000000"),fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962");const ye=G.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#FFFFFF"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962"),ie.appendChild(fe),ie.appendChild(ye),j.appendChild(E),j.appendChild(z),j.appendChild(q),j.appendChild(J),j.appendChild(ie),a.appendChild(j),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(a),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Tu(this._element,this._anchor,"marker"),this._element.addEventListener("click",this._onClick),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,u;const p=(a=this._map)===null||a===void 0?void 0:a.terrain,b=this._map.transform.isLocationOccluded(this._lngLat);if(!p||b){const J=b?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==J&&(this._element.style.opacity=J))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const j=this._map,E=j.terrain.depthAtPoint(this._pos),M=j.terrain.getElevationForLngLat(this._lngLat,j.transform);if(j.transform.lngLatToCameraDepth(this._lngLat,M)-E<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/j.transform.pixelsPerMeter,L=Math.sin(j.getPitch()*Math.PI/180)*z,q=j.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),V=j.transform.lngLatToCameraDepth(this._lngLat,M+L)-q>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Eu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Yo=0,vo=!1;const Di={maxWidth:100,unit:"metric"};function Pr(x,t,a){const u=a&&a.maxWidth||100,p=x._container.clientHeight/2,b=x._container.clientWidth/2,j=x.unproject([b-u/2,p]),E=x.unproject([b+u/2,p]),M=Math.round(x.project(E).x-x.project(j).x),z=Math.min(u,M,x._container.clientWidth),L=j.distanceTo(E);if(a&&a.unit==="imperial"){const q=3.2808*L;q>5280?Jn(t,z,q/5280,x._getUIString("ScaleControl.Miles")):Jn(t,z,q,x._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Jn(t,z,L/1852,x._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Jn(t,z,L/1e3,x._getUIString("ScaleControl.Kilometers")):Jn(t,z,L,x._getUIString("ScaleControl.Meters"))}function Jn(x,t,a,u){const p=(function(b){const j=Math.pow(10,`${Math.floor(b)}`.length-1);let E=b/j;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z})(E),j*E})(a);x.style.width=t*(p/a)+"px",x.innerHTML=`${p}&nbsp;${u}`}const Ml={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Pl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Tc(x){if(x){if(typeof x=="number"){const t=Math.round(Math.abs(x)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,x),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-x),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(x,0),right:new c.P(-x,0)}}if(x instanceof c.P||Array.isArray(x)){const t=c.P.convert(x);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(x.center||[0,0]),top:c.P.convert(x.top||[0,0]),"top-left":c.P.convert(x["top-left"]||[0,0]),"top-right":c.P.convert(x["top-right"]||[0,0]),bottom:c.P.convert(x.bottom||[0,0]),"bottom-left":c.P.convert(x["bottom-left"]||[0,0]),"bottom-right":c.P.convert(x["bottom-right"]||[0,0]),left:c.P.convert(x.left||[0,0]),right:c.P.convert(x.right||[0,0])}}return Tc(new c.P(0,0))}const Sn=O;T.AJAXError=c.cJ,T.EXTENT=c.a5,T.Event=c.l,T.Evented=c.E,T.LngLat=c.V,T.MercatorCoordinate=c.a9,T.Point=c.P,T.addProtocol=c.cK,T.config=c.c,T.removeProtocol=c.cL,T.AttributionControl=Vr,T.BoxZoomHandler=Zo,T.CanvasSource=Oi,T.CooperativeGesturesHandler=$t,T.DoubleClickZoomHandler=wd,T.DragPanHandler=gh,T.DragRotateHandler=Ma,T.EdgeInsets=wa,T.FullscreenControl=class extends c.E{constructor(x={}){var t;super(),this._onFullscreenChange=()=>{var a;let u=window.document.fullscreenElement||window.document.webkitFullscreenElement;for(;!((a=u?.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,this._pseudo=(t=x.pseudo)!==null&&t!==void 0&&t,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){G.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=G.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);G.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){this._pseudo?this._togglePseudoFullScreen():window.document.exitFullscreen?window.document.exitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._pseudo?this._togglePseudoFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=Ms,T.GeolocateControl=class extends c.E{constructor(x){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new c.V(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,p=this._map.getBearing(),b=c.e({bearing:p},this.options.fitBoundsOptions),j=Os.fromLngLat(a,u);this._map.fitBounds(j,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new c.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&vo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=G.create("button","maplibregl-ctrl-geolocate",this._container),G.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Nu({element:this._dotElement}),this._circleElement=G.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const u=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},Eu,x)}onAdd(x){return this._map=x,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(t=!1){if(wn!==void 0&&!t)return wn;if(window.navigator.permissions===void 0)return wn=!!window.navigator.geolocation,wn;try{wn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{wn=!!window.navigator.geolocation}return wn}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Yo=0,vo=!1}_isOutOfMapMaxBounds(x){const t=this._map.getMaxBounds(),a=x.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const x=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&x))return;const t=this._map.project(x),a=this._map.unproject([t.x+100,t.y]),u=x.distanceTo(a)/100,p=2*this._accuracy/u;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yo--,vo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Yo++,Yo>1?(x={maximumAge:6e5,timeout:0},vo=!0):(x=this.options.positionOptions,vo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.GlobeControl=class{constructor(){this._toggleProjection=()=>{var x;const t=(x=this._map.getProjection())===null||x===void 0?void 0:x.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var x;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((x=this._map.getProjection())===null||x===void 0?void 0:x.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(x){return this._map=x,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=G.create("button","maplibregl-ctrl-globe",this._container),G.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._map.on("projectiontransition",this._updateGlobeIcon),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._map.off("projectiontransition",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},T.Hash=Yr,T.ImageSource=oi,T.KeyboardHandler=sr,T.LngLatBounds=Os,T.LogoControl=ju,T.Map=class extends Xr{get _ownerWindow(){var x,t;return((t=(x=this._container)===null||x===void 0?void 0:x.ownerDocument)===null||t===void 0?void 0:t.defaultView)||window}constructor(x){var t,a;c.cH.mark(c.cI.create);const u=Object.assign(Object.assign(Object.assign({},_o),x),{canvasContextAttributes:Object.assign(Object.assign({},_o.canvasContextAttributes),x.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new ci,b=new pl;u.minZoom!==void 0&&p.setMinZoom(u.minZoom),u.maxZoom!==void 0&&p.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&p.setMinPitch(u.minPitch),u.maxPitch!==void 0&&p.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&p.setRenderWorldCopies(u.renderWorldCopies),u.transformConstrain!==null&&p.setConstrainOverride(u.transformConstrain),super(p,b,{bearingSnap:u.bearingSnap,zoomSnap:u.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new xo,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=E=>{if(E.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy(),this._lostContextStyle=this._getStyleAndImages(),this.style){for(const M of Object.values(this.style._layers))if(M.type==="custom"&&console.warn(`Custom layer with id '${M.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),M._listeners)for(const[z]of Object.entries(M._listeners))console.warn(`Custom layer with id '${M.id}' had event listeners for event '${z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:E}))}else this.fire(new c.l("webglcontextlost",{originalEvent:E}))},this._contextRestored=E=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new c.l("webglcontextrestored",{originalEvent:E}))},this._onMapScroll=E=>{if(E.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._zoomSnap=u.zoomSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Al),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this._zoomLevelsToOverscale=u.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=u.transformCameraUpdate,this.transformConstrain=u.transformConstrain,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,u.reduceMotion!==void 0&&(ae.prefersReducedMotion=u.reduceMotion),this._imageQueueHandle=$e.addThrottleControl((()=>this.isMoving())),this._requestManager=new de(u.transformRequest),this._container=this._resolveContainer(u.container),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Su(this,u),this._hash=u.hash&&new Yr(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,c.e({},u.fitBoundsOptions,{duration:0}))));const j=typeof u.style=="string"||((a=(t=u.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,j),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Vr(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new ju,u.logoPosition),this.on("style.load",(()=>{if(j||this._resizeTransform(),this.transform.unmodified){const E=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(E)}})),this.on("data",(E=>{this._update(E.dataType==="style"),this.fire(new c.l(`${E.dataType}data`,E))})),this.on("dataloading",(E=>{this.fire(new c.l(`${E.dataType}dataloading`,E))})),this.on("dataabort",(E=>{this.fire(new c.l("sourcedataabort",E))}))}_getMapId(){return this._mapId}setGlobalStateProperty(x,t){return this.style.setGlobalStateProperty(x,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(x,t){if(t===void 0&&(t=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=x.onAdd(this);this._controls.push(x);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(x);return t>-1&&this._controls.splice(t,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}coveringTiles(x){return xr(this.transform,x)}calculateCameraOptionsFromTo(x,t,a,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(x,t,a,u)}resize(x,t=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(t);const a=!this._moving;return a&&(this.stop(),this.fire(new c.l("movestart",x)).fire(new c.l("move",x))),this.fire(new c.l("resize",x)),a&&this.fire(new c.l("moveend",x)),this}_resizeInternal(x=!0){const[t,a]=this._containerDimensions(),u=this._getClampedPixelRatio(t,a);if(this._resizeCanvas(t,a,u),this.painter.resize(t,a,u),this.painter.overLimit()){const p=this.painter.context.gl;this._maxCanvasSize=[p.drawingBufferWidth,p.drawingBufferHeight];const b=this._getClampedPixelRatio(t,a);this._resizeCanvas(t,a,b),this.painter.resize(t,a,b)}this._resizeTransform(x)}_resizeTransform(x=!0){var t;const[a,u]=this._containerDimensions();this.transform.resize(a,u,x),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,u,x)}_getClampedPixelRatio(x,t){const{0:a,1:u}=this._maxCanvasSize,p=this.getPixelRatio(),b=x*p,j=t*p;return Math.min(b>a?a/b:1,j>u?u/j:1)*p}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Os.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom){const t=this.transform.zoom,a=this._getTransformForUpdate();return a.setMinZoom(x),this._applyUpdatedTransform(a),this._update(),t!==this.transform.zoom&&this.fire(new c.l("zoomstart")).fire(new c.l("zoom")).fire(new c.l("zoomend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom){const t=this.transform.zoom,a=this._getTransformForUpdate();return a.setMaxZoom(x),this._applyUpdatedTransform(a),this._update(),t!==this.transform.zoom&&this.fire(new c.l("zoomstart")).fire(new c.l("zoom")).fire(new c.l("zoomend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch){const t=this.transform.pitch,a=this._getTransformForUpdate();return a.setMinPitch(x),this._applyUpdatedTransform(a),this._update(),t!==this.transform.pitch&&this.fire(new c.l("pitchstart")).fire(new c.l("pitch")).fire(new c.l("pitchend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(x>=this.transform.minPitch){const t=this.transform.pitch,a=this._getTransformForUpdate();return a.setMaxPitch(x),this._applyUpdatedTransform(a),this._update(),t!==this.transform.pitch&&this.fire(new c.l("pitchstart")).fire(new c.l("pitch")).fire(new c.l("pitchend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.setRenderWorldCopies(x),this._update()}setTransformConstrain(x){return this.transform.setConstrainOverride(x),this._update()}project(x){return this.transform.locationToScreenPoint(c.V.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.screenPointToLocation(c.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,t,a){if(x==="mouseenter"||x==="mouseover"){let u=!1;return{layers:t,listener:a,delegates:{mousemove:b=>{const j=t.filter((M=>this.getLayer(M))),E=j.length!==0?this.queryRenderedFeatures(b.point,{layers:j}):[];E.length?u||(u=!0,a.call(this,new yi(x,this,b.originalEvent,{features:E}))):u=!1},mouseout:()=>{u=!1}}}}if(x==="mouseleave"||x==="mouseout"){let u=!1;return{layers:t,listener:a,delegates:{mousemove:j=>{const E=t.filter((M=>this.getLayer(M)));(E.length!==0?this.queryRenderedFeatures(j.point,{layers:E}):[]).length?u=!0:u&&(u=!1,a.call(this,new yi(x,this,j.originalEvent)))},mouseout:j=>{u&&(u=!1,a.call(this,new yi(x,this,j.originalEvent)))}}}}{const u=p=>{const b=t.filter((E=>this.getLayer(E))),j=b.length!==0?this.queryRenderedFeatures(p.point,{layers:b}):[];j.length&&(p.features=j,a.call(this,p),delete p.features)};return{layers:t,listener:a,delegates:{[x]:u}}}}_saveDelegatedListener(x,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(t)}_removeDelegatedListener(x,t,a){if(!this._delegatedListeners||!this._delegatedListeners[x])return;const u=this._delegatedListeners[x];for(let p=0;p<u.length;p++){const b=u[p];if(b.listener===a&&b.layers.length===t.length&&b.layers.every((j=>t.includes(j)))){for(const j in b.delegates)this.off(j,b.delegates[j]);return void u.splice(p,1)}}}on(x,t,a){if(a===void 0)return super.on(x,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(x,u,a);this._saveDelegatedListener(x,p);for(const b in p.delegates)this.on(b,p.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(x,u,a)}}}once(x,t,a){if(a===void 0)return super.once(x,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(x,u,a);for(const b in p.delegates){const j=p.delegates[b];p.delegates[b]=(...E)=>{this._removeDelegatedListener(x,u,a),j(...E)}}this._saveDelegatedListener(x,p);for(const b in p.delegates)this.once(b,p.delegates[b]);return this}off(x,t,a){return a===void 0?super.off(x,t):(this._removeDelegatedListener(x,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(x,t){if(!this.style)return[];let a;const u=x instanceof c.P||Array.isArray(x),p=u?x:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:x)||{},p instanceof c.P||typeof p[0]=="number")a=[c.P.convert(p)];else{const b=c.P.convert(p[0]),j=c.P.convert(p[1]);a=[b,new c.P(j.x,b.y),j,new c.P(b.x,j.y),b]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(x,t){return this.style.querySourceFeatures(x,t)}setStyle(x,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(x,t))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const t=this._locale[x];if(t==null)throw new Error(`Missing UI string '${x}'`);return t}_updateStyle(x,t){var a,u;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(x,t)));const p=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Oo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,t,p):this.style.loadJSON(x,t,p),this):((u=(a=this.style)===null||a===void 0?void 0:a.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,t){if(typeof x=="string"){const a=this._requestManager.transformRequest(x,"Style");c.j(a,new AbortController).then((u=>{this._updateDiff(u.data,t)})).catch((u=>{u&&this.fire(new c.k(u))}))}else typeof x=="object"&&this._updateDiff(x,t)}_updateDiff(x,t){try{this.style.setState(x,t)&&this._update(!0)}catch(a){c.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(x,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(x,t){return this._lazyInitEmptyStyle(),this.style.addSource(x,t),this._update(!0)}isSourceLoaded(x){const t=this.style&&this.style.tileManagers[x];if(t!==void 0)return t.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const t=this.style.tileManagers[x.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const u=this.style._layers[a];u.type==="hillshade"&&u.source===x.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===x.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ts(this.painter,t,x),this.painter.renderToTexture=new bn(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var u;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==x.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=a.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:x})),this}getTerrain(){var x,t;return(t=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const x=this.style&&this.style.tileManagers;for(const t of Object.values(x))if(!t.areTilesLoaded())return!1;return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}setSourceTileLodParams(x,t,a){if(a){const u=this.getSource(a);if(!u)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);u.calculateTileZoom=ss(Math.max(1,x),Math.max(1,t))}else for(const u in this.style.tileManagers)this.style.tileManagers[u].getSource().calculateTileZoom=ss(Math.max(1,x),Math.max(1,t));return this._update(!0),this}refreshTiles(x,t){const a=this.style.tileManagers[x];if(!a)throw new Error(`There is no tile manager with ID "${x}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((u=>new c.ac(u.z,u.x,u.y))))}addImage(x,t,a={}){const{pixelRatio:u=1,sdf:p=!1,stretchX:b,stretchY:j,content:E,textFitWidth:M,textFitHeight:z}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:q,data:V}=t,J=t;return this.style.addImage(x,{data:new c.R({width:L,height:q},new Uint8Array(V)),pixelRatio:u,stretchX:b,stretchY:j,content:E,textFitWidth:M,textFitHeight:z,sdf:p,version:0,userImage:J}),J.onAdd&&J.onAdd(this,x),this}}{const{width:L,height:q,data:V}=ae.getImageData(t);this.style.addImage(x,{data:new c.R({width:L,height:q},V),pixelRatio:u,stretchX:b,stretchY:j,content:E,textFitWidth:M,textFitHeight:z,sdf:p,version:0})}}updateImage(x,t){const a=this.style.getImage(x);if(!a)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||c.b(t)?ae.getImageData(t):t,{width:p,height:b,data:j}=u;if(p===void 0||b===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==a.data.width||b!==a.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||c.b(t));return a.data.replace(j,E),this.style.updateImage(x,a),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return $e.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,t){return this._lazyInitEmptyStyle(),this.style.addLayer(x,t),this._update(!0)}moveLayer(x,t){return this.style.moveLayer(x,t),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,t,a){return this.style.setLayerZoomRange(x,t,a),this._update(!0)}setFilter(x,t,a={}){return this.style.setFilter(x,t,a),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,t,a,u={}){return this.style.setPaintProperty(x,t,a,u),this._update(!0)}getPaintProperty(x,t){return this.style.getPaintProperty(x,t)}setLayoutProperty(x,t,a,u={}){return this.style.setLayoutProperty(x,t,a,u),this._update(!0)}getLayoutProperty(x,t){return this.style.getLayoutProperty(x,t)}setGlyphs(x,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,t,a,(u=>{u||this._update(!0)})),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,t,(a=>{a||this._update(!0)})),this}setLight(x,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(x,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(x,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,t){return this.style.setFeatureState(x,t),this._update()}removeFeatureState(x,t){return this.style.removeFeatureState(x,t),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,t=0;return this._container&&(x=this._container.clientWidth||400,t=this._container.clientHeight||300),[x,t]}_setupResizeObserver(){var x;let t=!1;const a=fh((p=>{this._trackResize&&!this._removed&&(this.resize(p),this.redraw())}),50),u=(x=this._ownerWindow.ResizeObserver)!==null&&x!==void 0?x:ResizeObserver;this._resizeObserver=new u((p=>{t?a(p):t=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(x){if(typeof x=="string"){const t=document.getElementById(x);if(!t)throw new Error(`Container '${x}' not found.`);return t}if(x instanceof HTMLElement||x&&typeof x=="object"&&x.nodeType===1)return x;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const t=this._canvasContainer=G.create("div","maplibregl-canvas-container",x);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=G.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),u=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],u);const p=this._controlContainer=G.create("div","maplibregl-control-container",x),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((j=>{b[j]=G.create("div",`maplibregl-ctrl-${j} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,t,a){this._canvas.width=Math.floor(a*x),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const x=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{t={requestedAttributes:x},u&&(t.statusMessage=u.statusMessage,t.type=u.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,x):this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x),!a){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new If(a,this.transform),pe.testSupport(a)}migrateProjection(x,t){super.migrateProjection(x,t),this.painter.transform=x,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){var t,a,u,p,b;const j=this._idleTriggered?this._fadeDuration:0,E=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const q=this.transform.zoom,V=Y();this.style.zoomHistory.update(q,V);const J=new c.H(q,{now:V,fadeDuration:j,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ie=J.crossFadingFactor();ie===1&&ie===this._crossFadingFactor||(M=!0,this._crossFadingFactor=ie),this.style.update(J)}const z=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==E;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,j,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:j,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cH.mark(c.cI.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,c.cH.mark(c.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),$e.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),G.remove(this._canvasContainer),G.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cH.remove(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ae.frame(this._frameRequest,(x=>{c.cH.recordStartOfFrameAt(x),this._frameRequest=null;try{this._render(x)}catch(t){if(!c.Z(t)&&!(function(a){return a.message===Go})(t))throw t}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return kl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(x){return this._lazyInitEmptyStyle(),this.style.setProjection(x),this._update(!0)}},T.MapMouseEvent=yi,T.MapTouchEvent=xn,T.MapWheelEvent=gd,T.Marker=Nu,T.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const u=this._map._getUIString(`NavigationControl.${a}`);t.title=u,t.setAttribute("aria-label",u)},this.options=c.e({},yh,x),this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),G.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),G.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=G.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,t){const a=G.create("button",x,this._container);return a.type="button",a.addEventListener("click",t),a}},T.Popup=class extends c.E{constructor(x){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=G.create("div","maplibregl-popup",this._map.getContainer()),this._tip=G.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const j of this.options.className.split(" "))this._container.classList.add(j);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Sc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const p=Tc(this.options.offset);if(!u){const j=this._container.offsetWidth,E=this._container.offsetHeight,M=(function(L){var q,V,J,ie;return L?{top:(q=L.top)!==null&&q!==void 0?q:0,right:(V=L.right)!==null&&V!==void 0?V:0,bottom:(J=L.bottom)!==null&&J!==void 0?J:0,left:(ie=L.left)!==null&&ie!==void 0?ie:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let z;z=a.y+p.bottom.y<E+M.top?["top"]:a.y>this._map.transform.height-E-M.bottom?["bottom"]:[],a.x<j/2+M.left?z.push("left"):a.x>this._map.transform.width-j/2-M.right&&z.push("right"),u=z.length===0?"bottom":z.join("-")}let b=a.add(p[u]);this.options.subpixelPositioning||(b=b.round()),G.setTransform(this._container,`${jc[u]} translate(${b.x}px,${b.y}px)`),Tu(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ml),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=c.V.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const t=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=x;u=a.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}setPadding(x){this.options.padding=x,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(Pl);x&&x.focus()}},T.RasterDEMTileSource=qs,T.RasterTileSource=wt,T.ScaleControl=class{constructor(x){this._onMove=()=>{Pr(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Pr(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Di),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=bu,T.Style=Oo,T.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=G.create("button","maplibregl-ctrl-terrain",this._container),G.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){G.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=go,T.TwoFingersTouchRotateHandler=vu,T.TwoFingersTouchZoomHandler=Xn,T.TwoFingersTouchZoomRotateHandler=Cl,T.VectorTileSource=vi,T.VideoSource=Fr,T.addSourceType=(x,t)=>c._(void 0,void 0,void 0,(function*(){if(Fs(x))throw new Error(`A source type called "${x}" already exists.`);((a,u)=>{Gi[a]=u})(x,t)})),T.clearPrewarmedResources=function(){const x=mt;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(lt),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.createTileMesh=wf,T.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return K().getRTLTextPluginStatus()},T.getVersion=function(){return Sn},T.getWorkerCount=function(){return Ot.workerCount},T.getWorkerUrl=function(){return c.c.WORKER_URL},T.importScriptInWorkers=function(x){return ks().broadcast("IS",x)},T.isTimeFrozen=function(){return Q.isFrozen()},T.now=Y,T.prewarm=function(){ys().acquire(lt)},T.restoreNow=function(){Q.restoreNow()},T.setMaxParallelImageRequests=function(x){c.c.MAX_PARALLEL_IMAGE_REQUESTS=x},T.setNow=function(x){Q.setNow(x)},T.setRTLTextPlugin=function(x,t){return K().setRTLTextPlugin(x,t)},T.setWorkerCount=function(x){Ot.workerCount=x},T.setWorkerUrl=function(x){c.c.WORKER_URL=x}}));var P=_;return P}))})(Gy)),Gy.exports}var TT=jT();const lg=Ov(TT),NT="https://demotiles.maplibre.org/style.json";function ET({markers:m}){const h=ee.useRef(null),_=ee.useRef(null),S=ee.useRef([]);return ee.useEffect(()=>{_.current||!h.current||(_.current=new lg.Map({container:h.current,style:NT,center:[0,0],zoom:2,attributionControl:!0}),_.current.addControl(new lg.NavigationControl,"top-right"))},[]),ee.useEffect(()=>{const k=_.current;if(!k)return;if(S.current.forEach(T=>T.remove()),S.current=[],m.length===0){k.setCenter([0,0]),k.setZoom(2);return}const P=new lg.LngLatBounds;m.forEach(T=>{const c=new lg.Marker({color:"#e14171"}).setLngLat([T.lng,T.lat]).setPopup(new lg.Popup({offset:12}).setHTML(`
            <div style="font-family: Inter, sans-serif; min-width: 180px">
              <div style="font-weight:600; color:#111;">${T.customerName||"Customer"}</div>
              ${T.orderNumber?`<div style="color:#555; font-size:12px;">Order ${T.orderNumber}</div>`:""}
              ${T.serviceType?`<div style="color:#555; font-size:12px; text-transform:capitalize;">${T.serviceType}</div>`:""}
              ${T.status?`<div style="margin-top:4px; color:#e14171; font-size:12px; font-weight:600;">${T.status}</div>`:""}
            </div>
          `)).addTo(k);S.current.push(c),P.extend([T.lng,T.lat])}),P.isEmpty()||k.fitBounds(P,{padding:40,maxZoom:16,duration:400})},[m]),n.jsxs("div",{className:"relative w-full h-[420px] rounded-2xl overflow-hidden border border-gray-200 shadow-sm",children:[n.jsx("div",{ref:h,className:"absolute inset-0"}),m.length===0&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-sm text-gray-500 bg-white/70 backdrop-blur-sm",children:"No locations with coordinates yet."})]})}const Uy=({label:m,value:h})=>n.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 text-center border border-gray-100",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500 mb-1",children:m}),n.jsx("p",{className:"text-xl font-semibold text-gray-900",children:h})]});function CT(){const{orderPins:m,hotZones:h,fetchOrderPins:_,loading:S}=rm(),k=m.map(c=>{const O=se=>se==null||se===""?null:Number(se),F=O(c.pickup_latitude)??O(c.latitude)??O(c.lat)??null,re=O(c.pickup_longitude)??O(c.longitude)??O(c.lng)??null;return F===null||re===null||Number.isNaN(F)||Number.isNaN(re)?null:{id:c.id,orderNumber:c.order_number,customerName:c.customer_name,status:c.status,serviceType:c.service_type,lat:F,lng:re}}).filter(Boolean),P=c=>{switch(c){case"pending":case"confirmed":case"scheduled":return"bg-[#e14171]";case"picked_up":case"cleaning":case"ready":return"bg-yellow-500";case"out_for_delivery":return"bg-blue-500";case"delivered":return"bg-green-500";default:return"bg-gray-500"}},T=c=>{switch(c){case"pending":return"Pending";case"confirmed":return"Confirmed";case"scheduled":return"Scheduled";case"picked_up":return"Picked Up";case"cleaning":return"Cleaning";case"ready":return"Ready";case"out_for_delivery":return"Out for Delivery";case"delivered":return"Delivered";default:return c}};return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Live Map View"}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("button",{onClick:()=>_(),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg",children:[n.jsx(io,{className:"h-4 w-4"}),"Refresh"]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-3 h-3 bg-[#e14171] rounded-full"}),"Awaiting Pickup"]}),n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),"In Progress"]}),n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),"Out for Delivery"]})]})]})]}),n.jsx(ET,{markers:k}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 mb-4",children:["Active Orders (",m.length,")"]}),S?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):m.length===0?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(_a,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"No active orders at the moment"})]}):n.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:m.map(c=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white ${P(c.status)}`,children:n.jsx(_a,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:c.customer_name}),n.jsxs("p",{className:"text-sm text-gray-500",children:[c.order_number,"  ",c.service_type]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${c.status==="pending"||c.status==="confirmed"?"bg-pink-100 text-[#e14171]":c.status==="out_for_delivery"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:T(c.status)}),n.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[c.landmark?.slice(0,30),"..."]})]})]},c.id))})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Hot Zones (Last 30 Days)"}),h.length===0?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(qa,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"No data available yet"})]}):n.jsx("div",{className:"space-y-4",children:h.map((c,O)=>n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[n.jsx("span",{className:"font-medium text-gray-900",children:c.name}),n.jsxs("span",{className:"text-gray-500",children:[c.orders," orders (",c.percentage,"%)"]})]}),n.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-[#e14171] to-pink-400 rounded-full",style:{width:`${c.percentage}%`}})})]},O))})]})]})}function AT(){const{dailyStats:m,serviceBreakdown:h,recentTransactions:_,revenueOrders:S,fetchRevenueStats:k,loading:P}=rm(),[T,c]=ee.useState("today"),[O,F]=ee.useState({start:"",end:""}),[re,se]=ee.useState(null),[ue,ae]=ee.useState("none"),[Q,Y]=ee.useState(!1),G=[{id:"order_number",label:"Order #",getter:de=>de.order_number||de.id||""},{id:"service_type",label:"Service",getter:de=>de.service_type||""},{id:"status",label:"Status",getter:de=>de.status||""},{id:"amount",label:"Amount",getter:de=>Number(de.total??de.total_amount??0).toFixed(2)},{id:"subtotal",label:"Subtotal",getter:de=>Number(de.subtotal??0).toFixed(2)},{id:"delivery_fee",label:"Delivery Fee",getter:de=>Number(de.delivery_fee??0).toFixed(2)},{id:"discount",label:"Discount",getter:de=>Number(de.discount??0).toFixed(2)},{id:"created_at",label:"Created At",getter:de=>de.created_at?new Date(de.created_at).toISOString():""},{id:"delivery_date",label:"Delivery Date",getter:de=>de.delivery_date||""},{id:"user_id",label:"User ID",getter:de=>de.user_id||""}],[pe,_e]=ee.useState(["order_number","service_type","status","amount","created_at"]);ee.useEffect(()=>{T!=="custom"&&k(T)},[T,k]),ee.useEffect(()=>{se(null)},[T]);const Ne=de=>{_e(Ae=>Ae.includes(de)?Ae.filter(Ye=>Ye!==de):[...Ae,de])},Oe=()=>_e(G.map(de=>de.id)),Be=()=>_e([]),xt=()=>{if(!O.start||!O.end){se("Select a start and end date");return}se(null),k("custom",O)},$e=()=>{if(!pe.length){se("Choose at least one column to export"),Y(!0);return}if(!S||S.length===0){se("No revenue data to export for this period");return}const de=pe.map(Qe=>G.find(Ce=>Ce.id===Qe)?.label||Qe),Ae=S.map(Qe=>pe.map(Ce=>{const We=G.find(dt=>dt.id===Ce);return We?We.getter(Qe):""})),Ye=Qe=>`"${String(Qe).replace(/"/g,'""')}"`,_t=[de.map(Ye).join(","),...Ae.map(Qe=>Qe.map(Ye).join(","))].join(`
`),Et=new Blob([_t],{type:"text/csv;charset=utf-8;"}),zt=URL.createObjectURL(Et),ht=document.createElement("a");ht.href=zt,ht.download=`revenue-${T}${T==="custom"?"":`-${new Date().toISOString().slice(0,10)}`}.csv`,ht.click(),URL.revokeObjectURL(zt)};return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Revenue Tracking"}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("select",{className:"px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",value:T,onChange:de=>c(de.target.value),children:[n.jsx("option",{value:"today",children:"Today"}),n.jsx("option",{value:"week",children:"This Week"}),n.jsx("option",{value:"month",children:"This Month"}),n.jsx("option",{value:"year",children:"This Year"}),n.jsx("option",{value:"custom",children:"Custom Range"})]}),n.jsxs("div",{className:"relative",children:[n.jsx("button",{onClick:()=>Y(de=>!de),className:"px-4 py-2 border border-gray-200 rounded-xl font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:"Export CSV"}),Q&&n.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white border border-gray-200 rounded-2xl shadow-lg p-4 z-10",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Choose columns"}),n.jsx("button",{onClick:()=>Y(!1),className:"text-gray-400 hover:text-gray-600 text-sm",children:""})]}),n.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:G.map(de=>n.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[n.jsx("input",{type:"checkbox",checked:pe.includes(de.id),onChange:()=>Ne(de.id),className:"rounded border-gray-300 text-[#e14171] focus:ring-[#e14171]"}),de.label]},de.id))}),n.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs text-gray-600",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:Oe,className:"underline hover:text-gray-900",children:"Select all"}),n.jsx("button",{onClick:Be,className:"underline hover:text-gray-900",children:"Clear"})]}),n.jsx("button",{onClick:()=>{Y(!1),$e()},className:"px-3 py-1.5 bg-[#e14171] text-white rounded-lg text-xs font-semibold hover:bg-[#c73562]",children:"Download"})]})]})]})]})]}),T==="custom"&&n.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 flex flex-col gap-3 sm:flex-row sm:items-end sm:gap-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start date"}),n.jsx("input",{type:"date",value:O.start,onChange:de=>F({...O,start:de.target.value}),className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End date"}),n.jsx("input",{type:"date",value:O.end,onChange:de=>F({...O,end:de.target.value}),className:"w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsx("button",{onClick:xt,className:"h-11 px-6 bg-[#e14171] text-white rounded-xl font-semibold hover:bg-[#c73562] transition-colors",children:"Apply"})]}),re&&n.jsx("div",{className:"rounded-xl border border-yellow-200 bg-yellow-50 px-4 py-3 text-sm text-yellow-800",children:re}),P?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("div",{className:"bg-green-100 p-3 rounded-xl",children:n.jsx(Wd,{className:"h-6 w-6 text-green-600"})}),m.growth!==0&&n.jsxs("span",{className:`flex items-center gap-1 text-sm font-medium ${m.growth>0?"text-green-600":"text-red-600"}`,children:[m.growth>0?n.jsx(S0,{className:"h-4 w-4"}):n.jsx(Uj,{className:"h-4 w-4"}),m.growth>0?"+":"",m.growth,"%"]})]}),n.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",m.total.toFixed(2)]}),n.jsxs("p",{className:"text-sm text-gray-500",children:[T==="today"?"Today's":T==="week"?"This Week's":T==="month"?"This Month's":"This Year's"," Revenue"]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("div",{className:"bg-pink-100 p-3 rounded-xl w-fit mb-4",children:n.jsx(_a,{className:"h-6 w-6 text-[#e14171]"})}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.orders}),n.jsx("p",{className:"text-sm text-gray-500",children:"Total Orders"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("div",{className:"bg-gray-100 p-3 rounded-xl w-fit mb-4",children:n.jsx(S0,{className:"h-6 w-6 text-gray-600"})}),n.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",m.avgOrder.toFixed(2)]}),n.jsx("p",{className:"text-sm text-gray-500",children:"Avg. Order Value"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("div",{className:"bg-orange-100 p-3 rounded-xl w-fit mb-4",children:n.jsx(nx,{className:"h-6 w-6 text-orange-600"})}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.newCustomers}),n.jsx("p",{className:"text-sm text-gray-500",children:"New Customers"})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Revenue by Service"}),h.every(de=>de.orders===0)?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(Wd,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"No revenue data for this period"})]}):n.jsx("div",{className:"space-y-4",children:h.map((de,Ae)=>n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`w-4 h-4 rounded ${de.color}`}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex justify-between mb-1",children:[n.jsx("span",{className:"font-medium text-gray-900",children:de.service}),n.jsxs("span",{className:"text-gray-700",children:["$",de.amount.toFixed(2)]})]}),n.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:n.jsx("div",{className:`h-full ${de.color} rounded-full`,style:{width:`${m.total>0?de.amount/m.total*100:0}%`}})}),n.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[de.orders," orders"]})]})]},Ae))})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:"Recent Transactions"}),n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx("span",{className:"text-gray-500",children:"Group by"}),n.jsxs("select",{className:"px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#e14171]",value:ue,onChange:de=>ae(de.target.value),children:[n.jsx("option",{value:"none",children:"None"}),n.jsx("option",{value:"customer",children:"Customer"})]})]})]}),_.length===0?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(_a,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"No transactions yet"})]}):n.jsx("div",{className:"overflow-x-auto",children:ue==="customer"?n.jsx("div",{className:"space-y-4",children:Object.entries(_.reduce((de,Ae)=>{const Ye=Ae.customer_name||"Unknown";return de[Ye]||(de[Ye]=[]),de[Ye].push(Ae),de},{})).map(([de,Ae])=>{const Ye=Ae.reduce((_t,Et)=>_t+(Et.amount||0),0);return n.jsxs("div",{className:"border border-gray-100 rounded-xl overflow-hidden",children:[n.jsxs("div",{className:"bg-gray-50 px-4 py-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-gray-900",children:de}),n.jsxs("p",{className:"text-xs text-gray-500",children:[Ae.length," orders"]})]}),n.jsxs("p",{className:"font-semibold text-gray-900",children:["$",Ye.toFixed(2)]})]}),n.jsx("table",{className:"w-full",children:n.jsx("tbody",{children:Ae.map(_t=>n.jsxs("tr",{className:"border-t last:border-0",children:[n.jsx("td",{className:"py-3 px-4 font-medium text-gray-900 whitespace-nowrap",children:_t.order_number}),n.jsx("td",{className:"py-3 px-4 text-gray-600 capitalize",children:_t.service_type}),n.jsxs("td",{className:"py-3 px-4 font-medium text-gray-900",children:["$",_t.amount.toFixed(2)]}),n.jsx("td",{className:"py-3 px-4 text-gray-500 whitespace-nowrap",children:_t.time}),n.jsx("td",{className:"py-3 px-4",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${_t.status==="delivered"?"bg-green-100 text-green-700":_t.status==="cancelled"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:_t.status})})]},_t.id))})})]},de)})}):n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"text-left text-sm text-gray-500 border-b",children:[n.jsx("th",{className:"pb-3 font-medium",children:"Order ID"}),n.jsx("th",{className:"pb-3 font-medium",children:"Customer"}),n.jsx("th",{className:"pb-3 font-medium",children:"Service"}),n.jsx("th",{className:"pb-3 font-medium",children:"Amount"}),n.jsx("th",{className:"pb-3 font-medium",children:"Time"}),n.jsx("th",{className:"pb-3 font-medium",children:"Status"})]})}),n.jsx("tbody",{children:_.map(de=>n.jsxs("tr",{className:"border-b last:border-0",children:[n.jsx("td",{className:"py-3 font-medium text-gray-900",children:de.order_number}),n.jsx("td",{className:"py-3 text-gray-700",children:de.customer_name}),n.jsx("td",{className:"py-3 text-gray-600 capitalize",children:de.service_type}),n.jsxs("td",{className:"py-3 font-medium text-gray-900",children:["$",de.amount.toFixed(2)]}),n.jsx("td",{className:"py-3 text-gray-500",children:de.time}),n.jsx("td",{className:"py-3",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${de.status==="delivered"?"bg-green-100 text-green-700":de.status==="cancelled"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:de.status})})]},de.id))})]})})]})]})]})}function kT(){const{customers:m,fetchCustomers:h,updateCustomerNote:_,loading:S}=rm(),[k,P]=ee.useState(""),[T,c]=ee.useState(null),[O,F]=ee.useState(""),[re,se]=ee.useState(!1),[ue,ae]=ee.useState([]),[Q,Y]=ee.useState({}),[G,pe]=ee.useState({}),[_e,Ne]=ee.useState({pinned:!1,highValue:!1,repeat:!1,notes:!1});ee.useEffect(()=>{const Be=setTimeout(()=>{h(k||void 0)},300);return()=>clearTimeout(Be)},[k,h]),ee.useEffect(()=>{const Be=localStorage.getItem("blackbookPins"),xt=localStorage.getItem("blackbookTags");Be&&ae(JSON.parse(Be)),xt&&Y(JSON.parse(xt))},[]),ee.useEffect(()=>{localStorage.setItem("blackbookPins",JSON.stringify(ue))},[ue]),ee.useEffect(()=>{localStorage.setItem("blackbookTags",JSON.stringify(Q))},[Q]);const Oe=async Be=>{se(!0);const xt=await _(Be,O);se(!1),xt.success&&(c(null),F(""))};return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Blackbook"}),n.jsxs("button",{onClick:()=>h(),className:"px-4 py-2 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] flex items-center gap-2",children:[n.jsx(io,{className:"h-4 w-4"}),"Refresh"]})]}),n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[n.jsxs("div",{className:"flex-1 relative",children:[n.jsx(x_,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Search customers by name or email...",value:k,onChange:Be=>P(Be.target.value),className:"w-full pl-12 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>Ne(Be=>({...Be,pinned:!Be.pinned})),className:`px-3 py-2 rounded-xl border text-sm flex items-center gap-1 ${_e.pinned?"bg-[#e14171] text-white border-[#e14171]":"border-gray-200 text-gray-700"}`,children:[n.jsx(qS,{className:"h-4 w-4"})," Pinned"]}),n.jsx("button",{onClick:()=>Ne(Be=>({...Be,highValue:!Be.highValue})),className:`px-3 py-2 rounded-xl border text-sm ${_e.highValue?"bg-[#e14171] text-white border-[#e14171]":"border-gray-200 text-gray-700"}`,children:"High value"}),n.jsx("button",{onClick:()=>Ne(Be=>({...Be,repeat:!Be.repeat})),className:`px-3 py-2 rounded-xl border text-sm ${_e.repeat?"bg-[#e14171] text-white border-[#e14171]":"border-gray-200 text-gray-700"}`,children:"Repeat"}),n.jsx("button",{onClick:()=>Ne(Be=>({...Be,notes:!Be.notes})),className:`px-3 py-2 rounded-xl border text-sm ${_e.notes?"bg-[#e14171] text-white border-[#e14171]":"border-gray-200 text-gray-700"}`,children:"Has notes"})]})]}),S?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):m.length===0?n.jsxs("div",{className:"text-center py-16 text-gray-500",children:[n.jsx(nx,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("p",{className:"text-lg font-medium",children:"No customers found"}),n.jsx("p",{className:"text-sm",children:"Customers will appear here after they place orders"})]}):n.jsx("div",{className:"space-y-4",children:m.filter(Be=>!(_e.pinned&&!ue.includes(Be.id)||_e.highValue&&Be.total_spent<=150||_e.repeat&&Be.orders_count<3||_e.notes&&!Be.notes)).sort((Be,xt)=>{const $e=ue.includes(Be.id)?1:0,de=ue.includes(xt.id)?1:0;return $e!==de?de-$e:xt.total_spent-Be.total_spent}).map(Be=>{const xt=Q[Be.id]||[],$e=Be.orders_count>0?Be.total_spent/Be.orders_count:0;return n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-[#e14171] to-pink-600 rounded-full flex items-center justify-center text-white text-xl font-bold",children:Be.name.charAt(0).toUpperCase()}),n.jsxs("div",{children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("h3",{className:"font-semibold text-gray-900",children:Be.name})}),n.jsx("p",{className:"text-sm text-gray-500",children:Be.email}),Be.phone&&n.jsx("p",{className:"text-sm text-gray-500",children:Be.phone}),Be.average_rating>0&&n.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[[...Array(5)].map((de,Ae)=>n.jsx(ro,{className:`h-4 w-4 ${Ae<Math.round(Be.average_rating)?"fill-[#e14171] text-[#e14171]":"text-gray-200"}`},Ae)),n.jsxs("span",{className:"text-sm text-gray-500 ml-1",children:["(",Be.average_rating,")"]})]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-gray-900",children:["$",Be.total_spent.toFixed(2)]}),n.jsxs("p",{className:"text-sm text-gray-500",children:[Be.orders_count," orders"]}),n.jsxs("p",{className:"text-xs text-gray-400",children:["AOV $",$e.toFixed(2)]}),n.jsx("button",{onClick:()=>ae(de=>de.includes(Be.id)?de.filter(Ae=>Ae!==Be.id):[...de,Be.id]),className:`mt-2 inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${ue.includes(Be.id)?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-600"}`,children:ue.includes(Be.id)?"Pinned":"Pin"})]})]}),T===Be.id?n.jsxs("div",{className:"mb-4",children:[n.jsx("textarea",{value:O,onChange:de=>F(de.target.value),placeholder:"Add notes about this customer (preferences, special requests, etc.)",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] resize-none",rows:3}),n.jsxs("div",{className:"flex gap-2 mt-2",children:[n.jsxs("button",{onClick:()=>Oe(Be.id),disabled:re,className:"px-4 py-2 bg-[#e14171] text-white rounded-lg font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center gap-2",children:[re&&n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),"Save Note"]}),n.jsx("button",{onClick:()=>{c(null),F("")},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"})]})]}):Be.notes?n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx($c,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-yellow-800",children:Be.notes})]}),n.jsx("button",{onClick:()=>{c(Be.id),F(Be.notes)},className:"text-yellow-600 hover:text-yellow-800",children:n.jsx(sm,{className:"h-4 w-4"})})]})}):n.jsxs("button",{onClick:()=>{c(Be.id),F("")},className:"mb-4 text-sm text-[#e14171] hover:underline flex items-center gap-1",children:[n.jsx(Vc,{className:"h-4 w-4"}),"Add customer note"]}),(Be.preferences.length>0||xt.length>0)&&n.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[Be.preferences.map((de,Ae)=>n.jsx("span",{className:"px-3 py-1 bg-pink-50 text-[#e14171] rounded-full text-sm capitalize",children:de},`pref-${Ae}`)),xt.map((de,Ae)=>n.jsxs("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm flex items-center gap-2",children:[de,n.jsx("button",{onClick:()=>Y(Ye=>({...Ye,[Be.id]:(Ye[Be.id]||[]).filter(_t=>_t!==de)})),className:"text-gray-400 hover:text-gray-600",children:""})]},`tag-${Ae}`))]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[n.jsx("input",{type:"text",value:G[Be.id]||"",onChange:de=>pe(Ae=>({...Ae,[Be.id]:de.target.value})),placeholder:"Add private tag (e.g. VIP, Allergies)",className:"px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#e14171]"}),n.jsx("button",{onClick:()=>{const de=(G[Be.id]||"").trim();de&&(Y(Ae=>({...Ae,[Be.id]:[...Ae[Be.id]||[],de]})),pe(Ae=>({...Ae,[Be.id]:""})))},className:"px-3 py-2 bg-gray-900 text-white rounded-xl text-sm hover:bg-gray-800",children:"Add tag"}),n.jsx("div",{className:"flex gap-2 text-xs text-gray-600",children:["VIP","Allergies","Fragile items"].map(de=>n.jsx("button",{onClick:()=>Y(Ae=>({...Ae,[Be.id]:Ae[Be.id]?.includes(de)?Ae[Be.id]:[...Ae[Be.id]||[],de]})),className:"px-2 py-1 border border-gray-200 rounded-lg hover:border-gray-400",children:de},de))})]}),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[n.jsxs("div",{className:"text-sm text-gray-500 space-x-2",children:[n.jsxs("span",{children:["Last order: ",Be.last_order]}),n.jsx("span",{className:"text-gray-300",children:"|"}),n.jsxs("span",{children:["Value tier: ",Be.total_spent>300?"Top":Be.total_spent>150?"Rising":"Standard"]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{className:"p-2 text-gray-400 hover:text-[#e14171] hover:bg-pink-50 rounded-lg",children:n.jsx(gf,{className:"h-5 w-5"})}),n.jsx("button",{className:"p-2 text-gray-400 hover:text-[#e14171] hover:bg-pink-50 rounded-lg",children:n.jsx(Ky,{className:"h-5 w-5"})})]})]})]},Be.id)})})]})}function MT(){const{drivers:m,driverStats:h,addDriver:_,updateDriverStatus:S,loading:k,fetchDriverTrips:P}=rm(),[T,c]=ee.useState(!1),[O,F]=ee.useState({name:"",phone:""}),[re,se]=ee.useState(!1),[ue,ae]=ee.useState(null),[Q,Y]=ee.useState([]),[G,pe]=ee.useState(!1),[_e,Ne]=ee.useState(["trip_type","order_number","customer_name","started_at","completed_at","duration_minutes"]),Oe=ee.useRef(null),Be=async()=>{if(!O.name.trim())return;se(!0);const Qe=await _(O);se(!1),Qe.success&&(c(!1),F({name:"",phone:""}))},xt=async(Qe,Ce)=>{await S(Qe,Ce)},$e=async Qe=>{ae(Qe),pe(!0);const Ce=await P(Qe.id);Y(Ce),pe(!1)},de=()=>{ae(null),Y([]),pe(!1)},Ae=Qe=>{Ne(Ce=>Ce.includes(Qe)?Ce.filter(We=>We!==Qe):[...Ce,Qe])},Ye=async(Qe=!1)=>{let Ce=[];if(Qe){const{data:Le,error:nt}=await vt.from("driver_trips").select(`
          *,
          drivers(name, phone),
          orders(order_number, users(full_name))
        `).order("started_at",{ascending:!1}).limit(5e3);if(nt)return;Ce=(Le||[]).map(lt=>({driver:lt.drivers?.name||"",driver_phone:lt.drivers?.phone||"",trip_type:lt.trip_type,order_number:lt.orders?.order_number||lt.order_id,customer_name:lt.orders?.users?.full_name||"",started_at:lt.started_at,completed_at:lt.completed_at,duration_minutes:lt.started_at&&lt.completed_at?Math.round((new Date(lt.completed_at).getTime()-new Date(lt.started_at).getTime())/6e4*10)/10:""}))}else Ce=Q.map(Le=>({driver:ue?.name||"",driver_phone:ue?.phone||"",trip_type:Le.trip_type,order_number:Le.order_number||Le.order_id,customer_name:Le.customer_name||"",started_at:Le.started_at,completed_at:Le.completed_at,duration_minutes:Le.duration_minutes??""}));const dt=[_e.map(Le=>Le).join(","),...Ce.map(Le=>_e.map(nt=>{const lt=Le[nt]??"",Ot=String(lt);return Ot.includes(",")||Ot.includes('"')?`"${Ot.replace(/"/g,'""')}"`:Ot}).join(","))].join(`
`),Ze=new Blob([dt],{type:"text/csv"}),Pe=URL.createObjectURL(Ze),le=document.createElement("a");le.href=Pe,le.download=Qe?"driver-trips-all.csv":`driver-trips-${ue?.name||"driver"}.csv`,le.click(),URL.revokeObjectURL(Pe)},_t=()=>{window.print()},Et=Q.filter(Qe=>Qe.trip_type==="pickup").length,zt=Q.filter(Qe=>Qe.trip_type==="delivery").length,ht=Math.round(Q.filter(Qe=>Qe.duration_minutes!==null).reduce((Qe,Ce)=>Qe+(Ce.duration_minutes||0),0)/(Q.filter(Qe=>Qe.duration_minutes!==null).length||1));return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Driver Performance"}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Active"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Break"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Offline"]})]}),n.jsxs("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] flex items-center gap-2",children:[n.jsx(Vc,{className:"h-4 w-4"}),"Add Driver"]})]})]}),n.jsxs("div",{className:"grid sm:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-gray-900",children:h.total}),n.jsx("p",{className:"text-sm text-gray-500",children:"Total Drivers"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.active}),n.jsx("p",{className:"text-sm text-gray-500",children:"Active Now"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-gray-900",children:h.todayPickups}),n.jsx("p",{className:"text-sm text-gray-500",children:"Today's Pickups"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-gray-900",children:h.todayDeliveries}),n.jsx("p",{className:"text-sm text-gray-500",children:"Today's Deliveries"})]})]}),k?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):m.length===0?n.jsxs("div",{className:"text-center py-16 text-gray-500",children:[n.jsx(Yd,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("p",{className:"text-lg font-medium",children:"No drivers added yet"}),n.jsx("p",{className:"text-sm",children:'Click "Add Driver" to add your first driver'})]}):n.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:m.map(Qe=>n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-[#e14171] to-pink-600 rounded-full flex items-center justify-center text-white text-xl font-bold",children:Qe.name.charAt(0).toUpperCase()}),n.jsx("span",{className:`absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-white ${Qe.status==="active"?"bg-green-500":Qe.status==="break"?"bg-yellow-500":"bg-gray-400"}`})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:Qe.name}),Qe.phone&&n.jsx("p",{className:"text-sm text-gray-500",children:Qe.phone}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(ro,{className:"h-4 w-4 fill-[#e14171] text-[#e14171]"}),n.jsx("span",{className:"text-sm text-gray-600",children:Qe.rating})]})]})]}),n.jsxs("select",{value:Qe.status,onChange:Ce=>xt(Qe.id,Ce.target.value),className:`px-3 py-1 rounded-full text-xs font-medium capitalize border-0 cursor-pointer ${Qe.status==="active"?"bg-green-100 text-green-700":Qe.status==="break"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:[n.jsx("option",{value:"active",children:"Active"}),n.jsx("option",{value:"break",children:"Break"}),n.jsx("option",{value:"offline",children:"Offline"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[n.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center",children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Qe.today_pickups}),n.jsx("p",{className:"text-xs text-gray-500",children:"Pickups Today"})]}),n.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center",children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Qe.today_deliveries}),n.jsx("p",{className:"text-xs text-gray-500",children:"Deliveries Today"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[n.jsx("span",{className:"text-gray-600",children:"Avg. Pickup  Facility"}),n.jsxs("span",{className:"font-medium",children:[Qe.avg_pickup_time," min"]})]}),n.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:n.jsx("div",{className:`h-full rounded-full ${Qe.avg_pickup_time<=15?"bg-green-500":Qe.avg_pickup_time<=20?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(100,(30-Qe.avg_pickup_time)/30*100+50)}%`}})})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[n.jsx("span",{className:"text-gray-600",children:"On-Time Rate"}),n.jsxs("span",{className:"font-medium",children:[Qe.on_time_rate,"%"]})]}),n.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:n.jsx("div",{className:`h-full rounded-full ${Qe.on_time_rate>=95?"bg-green-500":Qe.on_time_rate>=90?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Qe.on_time_rate}%`}})})]})]}),n.jsx("button",{onClick:()=>$e(Qe),className:"mt-4 w-full py-2 border border-gray-200 rounded-xl text-gray-700 font-medium hover:bg-gray-50",children:"View Full Report"})]},Qe.id))}),ue&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 no-print",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Driver Report"}),n.jsxs("p",{className:"text-sm text-gray-500",children:[ue.name,"  ",ue.phone||"No phone"]})]}),n.jsx("button",{onClick:de,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:n.jsx(Ga,{className:"h-5 w-5 text-gray-500"})})]}),n.jsx("style",{children:`
                @media screen {
                  .print-only { display: none; }
                }
                @media print {
                  .no-print { display: none !important; }
                  .print-only { display: block !important; }
                  #driver-print { display: block !important; }
                  #driver-print .print-table { width: 100%; border-collapse: collapse; }
                  #driver-print .print-table th, #driver-print .print-table td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
                  @page { margin: 12mm; }
                }
                .print-table { width: 100%; border-collapse: collapse; }
                .print-table th, .print-table td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
              `}),n.jsx("div",{className:"p-6 space-y-4",ref:Oe,children:G?n.jsx("div",{className:"flex items-center justify-center py-10",children:n.jsx(Ss,{className:"h-6 w-6 animate-spin text-[#e14171]"})}):Q.length===0?n.jsx("p",{className:"text-center text-gray-500 py-8",children:"No trips found for this driver."}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid sm:grid-cols-4 gap-4",children:[n.jsx(Uy,{label:"Trips",value:Q.length}),n.jsx(Uy,{label:"Pickups",value:Et}),n.jsx(Uy,{label:"Deliveries",value:zt}),n.jsx(Uy,{label:"Avg Duration",value:`${ht} min`})]}),n.jsx("div",{className:"border rounded-xl overflow-hidden",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50 text-gray-600",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-left px-4 py-2",children:"Trip Type"}),n.jsx("th",{className:"text-left px-4 py-2",children:"Order"}),n.jsx("th",{className:"text-left px-4 py-2",children:"Started"}),n.jsx("th",{className:"text-left px-4 py-2",children:"Completed"}),n.jsx("th",{className:"text-left px-4 py-2",children:"Duration"})]})}),n.jsx("tbody",{children:Q.map(Qe=>n.jsxs("tr",{className:"border-t last:border-0",children:[n.jsx("td",{className:"px-4 py-2 capitalize",children:Qe.trip_type}),n.jsxs("td",{className:"px-4 py-2",children:[n.jsx("div",{className:"text-sm font-semibold text-gray-900",children:Qe.order_number||Qe.order_id}),n.jsx("div",{className:"text-xs text-gray-500",children:Qe.customer_name||""})]}),n.jsx("td",{className:"px-4 py-2",children:Qe.started_at?new Date(Qe.started_at).toLocaleString():""}),n.jsx("td",{className:"px-4 py-2",children:Qe.completed_at?new Date(Qe.completed_at).toLocaleString():""}),n.jsx("td",{className:"px-4 py-2",children:Qe.duration_minutes!==null?`${Qe.duration_minutes} min`:""})]},Qe.id))})]})})]})}),n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 px-6 py-4 border-t bg-gray-50",children:[n.jsx("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[{id:"trip_type",label:"Trip Type"},{id:"order_number",label:"Order #"},{id:"customer_name",label:"Customer"},{id:"started_at",label:"Started"},{id:"completed_at",label:"Completed"},{id:"duration_minutes",label:"Duration (min)"},{id:"driver",label:"Driver (all export)"},{id:"driver_phone",label:"Driver Phone"}].map(Qe=>n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#e14171] focus:ring-[#e14171]",checked:_e.includes(Qe.id),onChange:()=>Ae(Qe.id)}),n.jsx("span",{className:"text-gray-700",children:Qe.label})]},Qe.id))}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:_t,className:"px-3 py-2 border rounded-lg text-sm hover:bg-gray-100",children:"Print"}),n.jsx("button",{onClick:()=>Ye(!1),className:"px-3 py-2 bg-[#e14171] text-white rounded-lg text-sm hover:bg-[#c73562]",children:"Export CSV (Driver)"}),n.jsx("button",{onClick:()=>Ye(!0),className:"px-3 py-2 border rounded-lg text-sm hover:bg-gray-100",children:"Export CSV (All Drivers)"})]})]})]})}),n.jsxs("div",{id:"driver-print",className:"printable-driver-report print-only",style:{maxWidth:"1000px",margin:"0 auto",padding:"12mm 0",fontFamily:"Inter, system-ui, -apple-system, sans-serif",color:"#0f172a"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[n.jsx("img",{src:"https://af6815798a.imgdist.com/pub/bfra/knkjywkm/2no/pvb/dgk/logocroped-removebg-preview.png",alt:"Bubble Box",style:{height:"52px",width:"52px",borderRadius:"50%"}}),n.jsxs("div",{children:[n.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:700},children:"Driver Report"}),n.jsxs("p",{style:{margin:"4px 0 0",color:"#475569",fontSize:"13px"},children:[ue.name," ",ue.phone?` ${ue.phone}`:""]})]})]}),Q.length===0?n.jsx("p",{style:{marginTop:"12px",color:"#475569"},children:"No trips found for this driver."}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gap:"12px",marginBottom:"14px"},children:[{label:"Trips",value:Q.length},{label:"Pickups",value:Et},{label:"Deliveries",value:zt},{label:"Avg Duration",value:`${ht} min`}].map(Qe=>n.jsxs("div",{style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"12px",textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"12px",color:"#64748b",textTransform:"uppercase"},children:Qe.label}),n.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a",marginTop:"6px"},children:Qe.value})]},Qe.label))}),n.jsxs("table",{className:"print-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[n.jsx("thead",{style:{background:"#f8fafc"},children:n.jsxs("tr",{children:[n.jsx("th",{children:"Trip Type"}),n.jsx("th",{children:"Order"}),n.jsx("th",{children:"Started"}),n.jsx("th",{children:"Completed"}),n.jsx("th",{children:"Duration"})]})}),n.jsx("tbody",{children:Q.map(Qe=>n.jsxs("tr",{children:[n.jsx("td",{style:{textTransform:"capitalize"},children:Qe.trip_type}),n.jsxs("td",{children:[n.jsx("div",{style:{fontWeight:600},children:Qe.order_number||Qe.order_id}),n.jsx("div",{style:{color:"#64748b",fontSize:"11px"},children:Qe.customer_name||""})]}),n.jsx("td",{children:Qe.started_at?new Date(Qe.started_at).toLocaleString():""}),n.jsx("td",{children:Qe.completed_at?new Date(Qe.completed_at).toLocaleString():""}),n.jsx("td",{children:Qe.duration_minutes!==null?`${Qe.duration_minutes} min`:""})]},Qe.id))})]})]})]})]}),T&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Add New Driver"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Driver Name"}),n.jsx("input",{type:"text",value:O.name,onChange:Qe=>F({...O,name:Qe.target.value}),placeholder:"Enter driver name",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),n.jsx("input",{type:"tel",value:O.phone,onChange:Qe=>F({...O,phone:Qe.target.value}),placeholder:"Enter phone number",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{onClick:Be,disabled:re||!O.name.trim(),className:"flex-1 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center justify-center gap-2",children:[re&&n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),"Add Driver"]}),n.jsx("button",{onClick:()=>c(!1),className:"flex-1 py-3 border rounded-xl font-medium hover:bg-gray-50",children:"Cancel"})]})]})})]})}function PT(){const{products:m,loading:h,fetchProducts:_,getAllProductsByCategory:S,addProduct:k,updateProduct:P,deleteProduct:T,toggleProductActive:c}=__(),[O,F]=ee.useState("laundry"),[re,se]=ee.useState(!1),[ue,ae]=ee.useState(!1),[Q,Y]=ee.useState(null),[G,pe]=ee.useState(!1),[_e,Ne]=ee.useState(null),[Oe,Be]=ee.useState({name:"",description:"",price:"",unit:"per_item"}),xt=[{id:"laundry",label:"Laundry",icon:""},{id:"suit",label:"Suit Cleaning",icon:""},{id:"shoe",label:"Shoe Cleaning",icon:""},{id:"dry-clean",label:"Dry Cleaning",icon:""},{id:"addon",label:"Add-ons",icon:""}],$e={per_item:"Per Item",per_kg:"Per Kg",per_bag:"Per Bag",per_pair:"Per Pair"},de=(ht,Qe)=>{Ne({type:ht,message:Qe}),setTimeout(()=>Ne(null),3e3)},Ae=async()=>{if(!Oe.name.trim()||!Oe.price){de("error","Please fill in all required fields");return}pe(!0);const ht=await k({category:O,name:Oe.name,description:Oe.description||void 0,price:parseFloat(Oe.price),unit:Oe.unit});pe(!1),ht.success?(de("success","Product added successfully"),se(!1),Be({name:"",description:"",price:"",unit:"per_item"})):de("error",ht.message)},Ye=async()=>{if(!Q)return;pe(!0);const ht=await P(Q.id,{name:Q.name,description:Q.description||void 0,price:Q.price,unit:Q.unit});pe(!1),ht.success?(de("success","Product updated successfully"),ae(!1),Y(null)):de("error",ht.message)},_t=async ht=>{if(!confirm(`Are you sure you want to delete "${ht.name}"?`))return;const Qe=await T(ht.id);Qe.success?de("success","Product deleted"):de("error",Qe.message)},Et=async ht=>{const Qe=await c(ht.id,!ht.is_active);Qe.success||de("error",Qe.message)},zt=S(O);return n.jsxs("div",{className:"space-y-6",children:[_e&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg flex items-center gap-2 ${_e.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[_e.type==="success"?n.jsx(ni,{className:"h-5 w-5"}):n.jsx($c,{className:"h-5 w-5"}),_e.message]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Products & Pricing"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("button",{onClick:()=>_(),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg",children:[n.jsx(io,{className:"h-4 w-4"}),"Refresh"]}),n.jsxs("button",{onClick:()=>se(!0),className:"px-4 py-2 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] flex items-center gap-2",children:[n.jsx(Vc,{className:"h-4 w-4"}),"Add Product"]})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:xt.map(ht=>n.jsxs("button",{onClick:()=>F(ht.id),className:`px-4 py-2 rounded-xl font-medium transition-colors flex items-center gap-2 ${O===ht.id?"bg-[#e14171] text-white":"bg-white text-gray-600 hover:bg-gray-50 border"}`,children:[n.jsx("span",{children:ht.icon}),ht.label]},ht.id))}),n.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:h?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):zt.length===0?n.jsxs("div",{className:"text-center py-16 text-gray-500",children:[n.jsx(pf,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("p",{className:"text-lg font-medium",children:"No products in this category"}),n.jsx("p",{className:"text-sm",children:'Click "Add Product" to create one'})]}):n.jsxs("div",{className:"divide-y",children:[n.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-3 bg-gray-50 text-sm font-medium text-gray-500",children:[n.jsx("div",{className:"col-span-5",children:"Product"}),n.jsx("div",{className:"col-span-2",children:"Price"}),n.jsx("div",{className:"col-span-2",children:"Unit"}),n.jsx("div",{className:"col-span-1 text-center",children:"Active"}),n.jsx("div",{className:"col-span-2 text-right",children:"Actions"})]}),zt.map(ht=>n.jsxs("div",{className:`grid grid-cols-12 gap-4 px-6 py-4 items-center hover:bg-gray-50 ${ht.is_active?"":"opacity-50"}`,children:[n.jsxs("div",{className:"col-span-5",children:[n.jsx("p",{className:"font-medium text-gray-900",children:ht.name}),ht.description&&n.jsx("p",{className:"text-sm text-gray-500 truncate",children:ht.description})]}),n.jsx("div",{className:"col-span-2",children:n.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:["$",ht.price.toFixed(2)]})}),n.jsx("div",{className:"col-span-2",children:n.jsx("span",{className:"text-sm text-gray-600",children:$e[ht.unit]||ht.unit})}),n.jsx("div",{className:"col-span-1 text-center",children:n.jsx("button",{onClick:()=>Et(ht),className:"focus:outline-none",children:ht.is_active?n.jsx(Lj,{className:"h-6 w-6 text-green-500"}):n.jsx(zj,{className:"h-6 w-6 text-gray-400"})})}),n.jsxs("div",{className:"col-span-2 flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{Y({...ht}),ae(!0)},className:"p-2 text-gray-400 hover:text-[#e14171] hover:bg-pink-50 rounded-lg",children:n.jsx(sm,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>_t(ht),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg",children:n.jsx(Eg,{className:"h-4 w-4"})})]})]},ht.id))]})}),n.jsxs("div",{className:"grid sm:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m.length}),n.jsx("p",{className:"text-sm text-gray-500",children:"Total Products"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-green-600",children:m.filter(ht=>ht.is_active).length}),n.jsx("p",{className:"text-sm text-gray-500",children:"Active"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-gray-400",children:m.filter(ht=>!ht.is_active).length}),n.jsx("p",{className:"text-sm text-gray-500",children:"Inactive"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-[#e14171]",children:xt.length}),n.jsx("p",{className:"text-sm text-gray-500",children:"Categories"})]})]}),re&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add New Product"}),n.jsx("button",{onClick:()=>se(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Ga,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),n.jsxs("div",{className:"px-4 py-3 bg-gray-100 rounded-xl text-gray-700 font-medium",children:[xt.find(ht=>ht.id===O)?.icon," ",xt.find(ht=>ht.id===O)?.label]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Name *"}),n.jsx("input",{type:"text",value:Oe.name,onChange:ht=>Be({...Oe,name:ht.target.value}),placeholder:"e.g., Regular Bag, 2-Piece Suit",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:Oe.description,onChange:ht=>Be({...Oe,description:ht.target.value}),placeholder:"Optional description",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price *"}),n.jsxs("div",{className:"relative",children:[n.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),n.jsx("input",{type:"number",step:"0.01",min:"0",value:Oe.price,onChange:ht=>Be({...Oe,price:ht.target.value}),placeholder:"0.00",className:"w-full pl-8 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),n.jsxs("select",{value:Oe.unit,onChange:ht=>Be({...Oe,unit:ht.target.value}),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"per_item",children:"Per Item"}),n.jsx("option",{value:"per_kg",children:"Per Kg"}),n.jsx("option",{value:"per_bag",children:"Per Bag"}),n.jsx("option",{value:"per_pair",children:"Per Pair"})]})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{onClick:Ae,disabled:G||!Oe.name.trim()||!Oe.price,className:"flex-1 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center justify-center gap-2",children:[G&&n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),"Add Product"]}),n.jsx("button",{onClick:()=>se(!1),className:"flex-1 py-3 border rounded-xl font-medium hover:bg-gray-50",children:"Cancel"})]})]})}),ue&&Q&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Edit Product"}),n.jsx("button",{onClick:()=>{ae(!1),Y(null)},className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Ga,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Name *"}),n.jsx("input",{type:"text",value:Q.name,onChange:ht=>Y({...Q,name:ht.target.value}),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:Q.description||"",onChange:ht=>Y({...Q,description:ht.target.value}),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price *"}),n.jsxs("div",{className:"relative",children:[n.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),n.jsx("input",{type:"number",step:"0.01",min:"0",value:Q.price,onChange:ht=>Y({...Q,price:parseFloat(ht.target.value)||0}),className:"w-full pl-8 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),n.jsxs("select",{value:Q.unit,onChange:ht=>Y({...Q,unit:ht.target.value}),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"per_item",children:"Per Item"}),n.jsx("option",{value:"per_kg",children:"Per Kg"}),n.jsx("option",{value:"per_bag",children:"Per Bag"}),n.jsx("option",{value:"per_pair",children:"Per Pair"})]})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{onClick:Ye,disabled:G||!Q.name.trim(),className:"flex-1 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center justify-center gap-2",children:[G&&n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),"Save Changes"]}),n.jsx("button",{onClick:()=>{ae(!1),Y(null)},className:"flex-1 py-3 border rounded-xl font-medium hover:bg-gray-50",children:"Cancel"})]})]})})]})}function DT(){const{plans:m,loading:h,fetchPlans:_,updatePlan:S,addFeature:k,removeFeature:P,setPopularPlan:T}=cx(),[c,O]=ee.useState(null),[F,re]=ee.useState(!1),[se,ue]=ee.useState(!1),[ae,Q]=ee.useState(""),[Y,G]=ee.useState(!1),[pe,_e]=ee.useState(null),[Ne,Oe]=ee.useState(null),[Be,xt]=ee.useState(""),[$e,de]=ee.useState(""),[Ae,Ye]=ee.useState(""),[_t,Et]=ee.useState(""),zt=(Ze,Pe)=>{_e({type:Ze,message:Pe}),setTimeout(()=>_e(null),3e3)},ht=Ze=>{O(Ze),xt(Ze.name),de(Ze.description),Ye(Ze.monthly_price.toString()),Et(Ze.yearly_price.toString()),Oe(null),re(!0)},Qe=async()=>{if(!c)return;const Ze={name:Be,description:$e,monthly_price:parseFloat(Ae)||0,yearly_price:parseFloat(_t)||0};console.log("Saving plan with data:",{id:c.id,...Ze}),G(!0);try{Oe(null);const Pe=await S(c.id,Ze);console.log("Update result:",Pe),Pe.success?(zt("success","Plan updated successfully"),re(!1),O(null),Oe(null),await _()):(Oe(Pe.message),zt("error",`Failed: ${Pe.message}`))}catch(Pe){console.error("Error in handleUpdatePlan:",Pe);const le=Pe instanceof Error?Pe.message:"Unknown error";Oe(le),zt("error",`Error: ${le}`)}finally{G(!1)}},Ce=async()=>{if(!c||!ae.trim())return;G(!0);const Ze=await k(c.id,ae.trim());G(!1),Ze.success?(Q(""),await _()):zt("error",Ze.message)},We=async Ze=>{if(!c)return;const Pe=await P(c.id,Ze);Pe.success?await _():zt("error",Pe.message)},dt=async Ze=>{const Pe=await T(Ze);Pe.success?zt("success","Popular plan updated"):zt("error",Pe.message)};return ee.useEffect(()=>{if(c&&se){const Ze=m.find(Pe=>Pe.id===c.id);Ze&&O(Ze)}},[m,c,se]),n.jsxs("div",{className:"space-y-6",children:[pe&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg flex items-center gap-2 ${pe.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[pe.type==="success"?n.jsx(ni,{className:"h-5 w-5"}):n.jsx($c,{className:"h-5 w-5"}),pe.message]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Subscription Plans"}),n.jsx("p",{className:"text-gray-500",children:"Manage Bubble Pass pricing and features"})]}),n.jsxs("button",{onClick:()=>_(),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg",children:[n.jsx(io,{className:"h-4 w-4"}),"Refresh"]})]}),h?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):m.length===0?n.jsxs("div",{className:"text-center py-16 text-gray-500",children:[n.jsx(Zu,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("p",{className:"text-lg font-medium",children:"No subscription plans found"}),n.jsx("p",{className:"text-sm",children:"Run the SQL setup to create default plans"})]}):n.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:m.map(Ze=>n.jsxs("div",{className:`bg-white rounded-2xl shadow-sm overflow-hidden flex flex-col h-full ${Ze.is_popular?"ring-2 ring-[#e14171]":""}`,children:[n.jsxs("div",{className:`p-6 ${Ze.is_popular?"bg-gradient-to-r from-[#e14171] to-pink-500 text-white":"bg-gray-50"}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[Ze.slug==="basic"&&n.jsx(_a,{className:"h-6 w-6"}),Ze.slug==="bubble-pass"&&n.jsx(Zu,{className:"h-6 w-6"}),Ze.slug==="family-pass"&&n.jsx(Pn,{className:"h-6 w-6"}),n.jsx("h3",{className:"text-xl font-bold",children:Ze.name})]}),Ze.is_popular&&n.jsx("span",{className:"px-2 py-1 bg-white/20 text-white text-xs font-medium rounded-full",children:"Popular"})]}),n.jsx("p",{className:`text-sm ${Ze.is_popular?"text-white/80":"text-gray-500"}`,children:Ze.description})]}),n.jsx("div",{className:"p-6 border-b",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Monthly"}),n.jsx("span",{className:"text-2xl font-bold text-gray-900",children:Ze.monthly_price===0?"Free":`$${Ze.monthly_price.toFixed(2)}`})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Yearly"}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:"text-2xl font-bold text-gray-900",children:Ze.yearly_price===0?"Free":`$${Ze.yearly_price.toFixed(2)}`}),Ze.yearly_price>0&&Ze.monthly_price>0&&n.jsxs("p",{className:"text-xs text-green-600",children:["Save $",(Ze.monthly_price*12-Ze.yearly_price).toFixed(2),"/year"]})]})]})]})}),n.jsxs("div",{className:"p-6 border-b flex-1",children:[n.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Features (",Ze.features.length,")"]}),n.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto",children:Ze.features.map((Pe,le)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx(ni,{className:"h-4 w-4 text-green-500 flex-shrink-0 mt-0.5"}),n.jsx("span",{className:"text-gray-600",children:Pe})]},le))})]}),n.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-100 flex gap-3 items-center justify-between mt-auto",children:[n.jsxs("button",{onClick:()=>ht(Ze),className:"flex-1 h-12 px-4 bg-[#e14171] text-white rounded-full font-semibold hover:bg-[#c73562] shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2",children:[n.jsx(sm,{className:"h-4 w-4"}),"Edit Pricing"]}),n.jsxs("button",{onClick:()=>{O({...Ze}),ue(!0)},className:"flex-1 h-12 px-4 border border-gray-300 rounded-full font-semibold bg-white text-gray-700 hover:border-gray-400 hover:shadow-sm transition-all flex items-center justify-center gap-2",children:[n.jsx(Vc,{className:"h-4 w-4"}),"Features"]})]}),!Ze.is_popular&&Ze.slug!=="basic"&&n.jsx("div",{className:"px-4 pb-4",children:n.jsx("button",{onClick:()=>dt(Ze.id),className:"w-full h-11 text-sm font-semibold text-[#e14171] hover:bg-pink-50 border border-pink-100 rounded-full transition-colors",children:"Set as Popular"})})]},Ze.id))}),n.jsx("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-2xl p-6",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"bg-[#e14171] p-3 rounded-xl",children:n.jsx(Zu,{className:"h-6 w-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Subscription Management"}),n.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Changes to pricing and features will immediately reflect on the Bubble Pass page. Basic plan pricing is always $0 and cannot be changed."}),n.jsx("p",{className:"text-xs text-gray-500",children:"Note: Existing subscribers will keep their current pricing until their subscription renews."})]})]})}),F&&c&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Edit ",c.name]}),n.jsx("button",{onClick:()=>{re(!1),O(null),Oe(null)},className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Ga,{className:"h-5 w-5"})})]}),Ne&&n.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-xl",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx($c,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-red-800",children:"Error"}),n.jsx("p",{className:"text-sm text-red-600",children:Ne})]})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Name"}),n.jsx("input",{type:"text",value:Be,onChange:Ze=>xt(Ze.target.value),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:$e,onChange:Ze=>de(Ze.target.value),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),c.slug!=="basic"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Price"}),n.jsxs("div",{className:"relative",children:[n.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),n.jsx("input",{type:"number",step:"0.01",min:"0",value:Ae,onChange:Ze=>Ye(Ze.target.value),className:"w-full pl-8 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Yearly Price"}),n.jsxs("div",{className:"relative",children:[n.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),n.jsx("input",{type:"number",step:"0.01",min:"0",value:_t,onChange:Ze=>Et(Ze.target.value),className:"w-full pl-8 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),parseFloat(Ae)>0&&n.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Suggested yearly price: $",(parseFloat(Ae)*10).toFixed(2)," (save 2 months)"]})]})]}),c.slug==="basic"&&n.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:n.jsx("p",{className:"text-sm text-gray-600",children:"The Basic plan is always free. You can only edit the name and description."})})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{onClick:Qe,disabled:Y,className:"flex-1 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center justify-center gap-2",children:[Y&&n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),"Save Changes"]}),n.jsx("button",{onClick:()=>{re(!1),O(null)},className:"flex-1 py-3 border rounded-xl font-medium hover:bg-gray-50",children:"Cancel"})]})]})}),se&&c&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[c.name," Features"]}),n.jsx("button",{onClick:()=>{ue(!1),O(null),Q("")},className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Ga,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"flex gap-2 mb-6",children:[n.jsx("input",{type:"text",value:ae,onChange:Ze=>Q(Ze.target.value),placeholder:"Add a new feature...",className:"flex-1 px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",onKeyPress:Ze=>Ze.key==="Enter"&&Ce()}),n.jsxs("button",{onClick:Ce,disabled:Y||!ae.trim(),className:"px-4 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center gap-2",children:[Y?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(Vc,{className:"h-4 w-4"}),"Add"]})]}),n.jsx("div",{className:"space-y-2",children:c.features.length===0?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(Pn,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"No features added yet"})]}):c.features.map((Ze,Pe)=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl group",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ni,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-gray-700",children:Ze})]}),n.jsx("button",{onClick:()=>We(Pe),className:"p-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Eg,{className:"h-4 w-4"})})]},Pe))}),n.jsx("div",{className:"mt-6 pt-4 border-t",children:n.jsx("button",{onClick:()=>{ue(!1),O(null),Q("")},className:"w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200",children:"Done"})})]})})]})}function RT(){const{categories:m,loading:h,fetchCategories:_,updateCategory:S,addFeature:k,removeFeature:P}=vv(),[T,c]=ee.useState(null),[O,F]=ee.useState(!1),[re,se]=ee.useState(!1),[ue,ae]=ee.useState(""),[Q,Y]=ee.useState(!1),[G,pe]=ee.useState(null),[_e,Ne]=ee.useState(null),[Oe,Be]=ee.useState(""),[xt,$e]=ee.useState(""),[de,Ae]=ee.useState(""),[Ye,_t]=ee.useState(""),[Et,zt]=ee.useState(""),ht=(Pe,le)=>{pe({type:Pe,message:le}),setTimeout(()=>pe(null),3e3)},Qe=Pe=>{switch(Pe){case"laundry":return"";case"suit":return"";case"shoe":return"";case"dry-clean":return"";default:return""}},Ce=Pe=>{c(Pe),Be(Pe.name),$e(Pe.tagline||""),Ae(Pe.description||""),_t(Pe.price_range),zt(Pe.price_note||""),Ne(null),F(!0)},We=async()=>{if(!T)return;const Pe={name:Oe,tagline:xt,description:de,price_range:Ye,price_note:Et};console.log("Saving category with data:",{id:T.id,...Pe}),Y(!0);try{Ne(null);const le=await S(T.id,Pe);console.log("Update result:",le),le.success?(ht("success","Service category updated successfully"),F(!1),c(null),Ne(null),await _()):(Ne(le.message),ht("error",`Failed: ${le.message}`))}catch(le){console.error("Error in handleUpdateCategory:",le);const Le=le instanceof Error?le.message:"Unknown error";Ne(Le),ht("error",`Error: ${Le}`)}finally{Y(!1)}},dt=async()=>{if(!T||!ue.trim())return;Y(!0);const Pe=await k(T.id,ue.trim());if(Y(!1),Pe.success){ae(""),await _();const le=m.find(Le=>Le.id===T.id);le&&c(le)}else ht("error",Pe.message)},Ze=async Pe=>{if(!T)return;const le=await P(T.id,Pe);le.success?await _():ht("error",le.message)};return ee.useEffect(()=>{if(T&&re){const Pe=m.find(le=>le.id===T.id);Pe&&c(Pe)}},[m,T,re]),n.jsxs("div",{className:"space-y-6",children:[G&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg flex items-center gap-2 ${G.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[G.type==="success"?n.jsx(ni,{className:"h-5 w-5"}):n.jsx($c,{className:"h-5 w-5"}),G.message]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Service Categories"}),n.jsx("p",{className:"text-gray-500",children:"Manage price ranges displayed on the Services page"})]}),n.jsxs("button",{onClick:()=>_(),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg",children:[n.jsx(io,{className:"h-4 w-4"}),"Refresh"]})]}),h?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):m.length===0?n.jsxs("div",{className:"text-center py-16 text-gray-500",children:[n.jsx(pf,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("p",{className:"text-lg font-medium",children:"No service categories found"}),n.jsx("p",{className:"text-sm",children:"Run the SQL setup to create default categories"})]}):n.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:m.map(Pe=>n.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[n.jsx("div",{className:"p-6 bg-gradient-to-r from-gray-50 to-gray-100 border-b",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("span",{className:"text-3xl",children:Qe(Pe.slug)}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:Pe.name}),Pe.tagline&&n.jsx("p",{className:"text-sm text-gray-500",children:Pe.tagline})]})]})}),n.jsxs("div",{className:"p-6 border-b",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-gray-600 font-medium",children:"Price Range"}),n.jsx("span",{className:"text-2xl font-bold text-[#e14171]",children:Pe.price_range})]}),Pe.price_note&&n.jsx("p",{className:"text-sm text-gray-500 text-right",children:Pe.price_note})]}),Pe.description&&n.jsx("div",{className:"px-6 py-4 border-b",children:n.jsx("p",{className:"text-sm text-gray-600",children:Pe.description})}),n.jsxs("div",{className:"p-6 border-b bg-gray-50",children:[n.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Features (",Pe.features.length,")"]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[Pe.features.slice(0,4).map((le,Le)=>n.jsx("span",{className:"px-3 py-1 bg-white text-gray-600 text-sm rounded-full border",children:le},Le)),Pe.features.length>4&&n.jsxs("span",{className:"px-3 py-1 bg-[#e14171] text-white text-sm rounded-full",children:["+",Pe.features.length-4," more"]})]})]}),n.jsxs("div",{className:"p-4 flex gap-2",children:[n.jsxs("button",{onClick:()=>Ce(Pe),className:"flex-1 py-2 px-4 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] flex items-center justify-center gap-2",children:[n.jsx(sm,{className:"h-4 w-4"}),"Edit Details"]}),n.jsxs("button",{onClick:()=>{c({...Pe}),se(!0)},className:"flex-1 py-2 px-4 border border-gray-300 rounded-xl font-medium hover:bg-gray-50 flex items-center justify-center gap-2",children:[n.jsx(Vc,{className:"h-4 w-4"}),"Features"]})]})]},Pe.id))}),n.jsx("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-2xl p-6",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"bg-[#e14171] p-3 rounded-xl",children:n.jsx(pf,{className:"h-6 w-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Service Categories Management"}),n.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"These price ranges are displayed on the Services page. Edit the price range text to update what customers see when browsing your services."}),n.jsx("p",{className:"text-xs text-gray-500",children:'Example: "$2.50/kg or $12/bag" or "$18-$30 per suit"'})]})]})}),O&&T&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-2xl",children:Qe(T.slug)}),n.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Edit ",T.name]})]}),n.jsx("button",{onClick:()=>{F(!1),c(null),Ne(null)},className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Ga,{className:"h-5 w-5"})})]}),_e&&n.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-xl",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx($c,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-red-800",children:"Error"}),n.jsx("p",{className:"text-sm text-red-600",children:_e})]})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Service Name"}),n.jsx("input",{type:"text",value:Oe,onChange:Pe=>Be(Pe.target.value),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tagline"}),n.jsx("input",{type:"text",value:xt,onChange:Pe=>$e(Pe.target.value),placeholder:"e.g., Fresh, Clean, Perfectly Folded",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),n.jsx("textarea",{value:de,onChange:Pe=>Ae(Pe.target.value),rows:3,className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] resize-none"})]}),n.jsxs("div",{className:"bg-pink-50 rounded-xl p-4 space-y-4",children:[n.jsxs("h4",{className:"font-medium text-gray-900 flex items-center gap-2",children:[n.jsx(Wd,{className:"h-5 w-5 text-[#e14171]"}),"Pricing Display"]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price Range *"}),n.jsx("input",{type:"text",value:Ye,onChange:Pe=>_t(Pe.target.value),placeholder:"e.g., $2.50/kg or $12/bag",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] bg-white"}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This is what customers see on the Services page"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price Note"}),n.jsx("input",{type:"text",value:Et,onChange:Pe=>zt(Pe.target.value),placeholder:"e.g., Priced by weight or bag",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] bg-white"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{onClick:We,disabled:Q||!Ye.trim(),className:"flex-1 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center justify-center gap-2",children:[Q&&n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),"Save Changes"]}),n.jsx("button",{onClick:()=>{F(!1),c(null)},className:"flex-1 py-3 border rounded-xl font-medium hover:bg-gray-50",children:"Cancel"})]})]})}),re&&T&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-2xl",children:Qe(T.slug)}),n.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[T.name," Features"]})]}),n.jsx("button",{onClick:()=>{se(!1),c(null),ae("")},className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Ga,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"flex gap-2 mb-6",children:[n.jsx("input",{type:"text",value:ue,onChange:Pe=>ae(Pe.target.value),placeholder:"Add a new feature...",className:"flex-1 px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",onKeyPress:Pe=>Pe.key==="Enter"&&dt()}),n.jsxs("button",{onClick:dt,disabled:Q||!ue.trim(),className:"px-4 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center gap-2",children:[Q?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(Vc,{className:"h-4 w-4"}),"Add"]})]}),n.jsx("div",{className:"space-y-2",children:T.features.length===0?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(Pn,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"No features added yet"})]}):T.features.map((Pe,le)=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl group",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ni,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-gray-700",children:Pe})]}),n.jsx("button",{onClick:()=>Ze(le),className:"p-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Eg,{className:"h-4 w-4"})})]},le))}),n.jsx("div",{className:"mt-6 pt-4 border-t",children:n.jsx("button",{onClick:()=>{se(!1),c(null),ae("")},className:"w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200",children:"Done"})})]})})]})}function IT(){const{reviews:m,loading:h,stats:_,fetchReviews:S,addReview:k,updateReview:P,deleteReview:T,toggleFeatured:c,toggleApproved:O}=xv(),[F,re]=ee.useState(!1),[se,ue]=ee.useState(!1),[ae,Q]=ee.useState(null),[Y,G]=ee.useState(!1),[pe,_e]=ee.useState(null),[Ne,Oe]=ee.useState(""),[Be,xt]=ee.useState(""),[$e,de]=ee.useState(5),[Ae,Ye]=ee.useState(""),[_t,Et]=ee.useState("laundry"),[zt,ht]=ee.useState(!0),[Qe,Ce]=ee.useState(!0),We=(mt,Dt)=>{_e({type:mt,message:Dt}),setTimeout(()=>_e(null),3e3)},dt=()=>{Oe(""),xt(""),de(5),Ye(""),Et("laundry"),ht(!0),Ce(!0)},Ze=()=>{dt(),re(!0)},Pe=mt=>{Q(mt),Oe(mt.customer_name),xt(mt.customer_location||""),de(mt.rating),Ye(mt.comment),Et(mt.service_type),ht(mt.is_featured),Ce(mt.is_approved),ue(!0)},le=async()=>{if(!Ne.trim()||!Ae.trim()){We("error","Please fill in customer name and comment");return}G(!0);const mt=await k({customer_name:Ne,customer_location:Be||void 0,rating:$e,comment:Ae,service_type:_t,is_featured:zt,is_approved:Qe});G(!1),mt.success?(We("success","Review added successfully"),re(!1),dt()):We("error",mt.message)},Le=async()=>{if(!ae)return;G(!0);const mt=await P(ae.id,{customer_name:Ne,customer_location:Be||void 0,rating:$e,comment:Ae,service_type:_t,is_featured:zt,is_approved:Qe});G(!1),mt.success?(We("success","Review updated successfully"),ue(!1),Q(null)):We("error",mt.message)},nt=async mt=>{if(!confirm(`Are you sure you want to delete the review from "${mt.customer_name}"?`))return;const Dt=await T(mt.id);Dt.success?We("success","Review deleted"):We("error",Dt.message)},lt=async mt=>{const Dt=await c(mt.id,!mt.is_featured);Dt.success||We("error",Dt.message)},Ot=async mt=>{const Dt=await O(mt.id,!mt.is_approved);Dt.success||We("error",Dt.message)},Mt={laundry:"Laundry",suit:"Suit Cleaning",shoe:"Shoe Cleaning","dry-clean":"Dry Cleaning"};return n.jsxs("div",{className:"space-y-6",children:[pe&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg flex items-center gap-2 ${pe.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[pe.type==="success"?n.jsx(ni,{className:"h-5 w-5"}):n.jsx($c,{className:"h-5 w-5"}),pe.message]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Reviews"}),n.jsx("p",{className:"text-gray-500",children:"Manage testimonials displayed on the homepage"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("button",{onClick:()=>S(),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg",children:[n.jsx(io,{className:"h-4 w-4"}),"Refresh"]}),n.jsxs("button",{onClick:Ze,className:"px-4 py-2 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] flex items-center gap-2",children:[n.jsx(Vc,{className:"h-4 w-4"}),"Add Review"]})]})]}),n.jsxs("div",{className:"grid sm:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-gray-900",children:_.total}),n.jsx("p",{className:"text-sm text-gray-500",children:"Total Reviews"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-[#e14171]",children:_.featured}),n.jsx("p",{className:"text-sm text-gray-500",children:"Featured"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsx("p",{className:"text-3xl font-bold text-green-600",children:_.approved}),n.jsx("p",{className:"text-sm text-gray-500",children:"Approved"})]}),n.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1",children:[n.jsx(ro,{className:"h-6 w-6 fill-yellow-400 text-yellow-400"}),n.jsx("p",{className:"text-3xl font-bold text-gray-900",children:_.averageRating.toFixed(1)})]}),n.jsx("p",{className:"text-sm text-gray-500",children:"Avg Rating"})]})]}),h?n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsx(Ss,{className:"h-8 w-8 animate-spin text-[#e14171]"})}):m.length===0?n.jsxs("div",{className:"text-center py-16 text-gray-500",children:[n.jsx(gf,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),n.jsx("p",{className:"text-lg font-medium",children:"No reviews yet"}),n.jsx("p",{className:"text-sm",children:'Click "Add Review" to create your first testimonial'})]}):n.jsx("div",{className:"space-y-4",children:m.map(mt=>n.jsxs("div",{className:`bg-white rounded-2xl p-6 shadow-sm ${mt.is_approved?"":"opacity-60"}`,children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-[#e14171] to-pink-600 rounded-full flex items-center justify-center text-white text-xl font-bold",children:mt.customer_name.charAt(0).toUpperCase()}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:mt.customer_name}),mt.is_featured&&n.jsxs("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full flex items-center gap-1",children:[n.jsx(ro,{className:"h-3 w-3 fill-yellow-500"}),"Featured"]}),!mt.is_approved&&n.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:"Hidden"})]}),mt.customer_location&&n.jsx("p",{className:"text-sm text-gray-500",children:mt.customer_location}),n.jsx("div",{className:"flex items-center gap-1 mt-1",children:[...Array(5)].map((Dt,ys)=>n.jsx(ro,{className:`h-4 w-4 ${ys<mt.rating?"fill-yellow-400 text-yellow-400":"text-gray-200"}`},ys))})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>lt(mt),className:`p-2 rounded-lg transition-colors ${mt.is_featured?"bg-yellow-100 text-yellow-600 hover:bg-yellow-200":"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,title:mt.is_featured?"Remove from featured":"Add to featured",children:n.jsx(ro,{className:`h-4 w-4 ${mt.is_featured?"fill-yellow-500":""}`})}),n.jsx("button",{onClick:()=>Ot(mt),className:`p-2 rounded-lg transition-colors ${mt.is_approved?"bg-green-100 text-green-600 hover:bg-green-200":"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,title:mt.is_approved?"Hide review":"Approve review",children:n.jsx(ni,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>Pe(mt),className:"p-2 text-gray-400 hover:text-[#e14171] hover:bg-pink-50 rounded-lg",title:"Edit review",children:n.jsx(sm,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>nt(mt),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg",title:"Delete review",children:n.jsx(Eg,{className:"h-4 w-4"})})]})]}),n.jsx("p",{className:"text-gray-700 mb-4",children:mt.comment}),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[n.jsx("span",{className:"px-3 py-1 bg-pink-50 text-[#e14171] rounded-full text-sm capitalize",children:Mt[mt.service_type]||mt.service_type}),n.jsx("span",{className:"text-sm text-gray-500",children:new Date(mt.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]})]},mt.id))}),n.jsx("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-2xl p-6",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"bg-[#e14171] p-3 rounded-xl",children:n.jsx(gf,{className:"h-6 w-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Reviews Management"}),n.jsxs("p",{className:"text-gray-600 text-sm mb-3",children:["Only reviews that are both ",n.jsx("strong",{children:"Featured"})," and ",n.jsx("strong",{children:"Approved"}),' will appear on the homepage in the "What Our Customers Say" section.']}),n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(ro,{className:"h-4 w-4 fill-yellow-500 text-yellow-500"}),n.jsx("span",{className:"text-gray-600",children:"= Featured"})]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(ni,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-gray-600",children:"= Approved (visible)"})]})]})]})]})}),(F||se)&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:F?"Add New Review":"Edit Review"}),n.jsx("button",{onClick:()=>{re(!1),ue(!1),Q(null)},className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Ga,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Name *"}),n.jsx("input",{type:"text",value:Ne,onChange:mt=>Oe(mt.target.value),placeholder:"e.g., Sarah Johnson",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),n.jsx("input",{type:"text",value:Be,onChange:mt=>xt(mt.target.value),placeholder:"e.g., Downtown, Westside",className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rating *"}),n.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(mt=>n.jsx("button",{type:"button",onClick:()=>de(mt),className:"p-1 focus:outline-none",children:n.jsx(ro,{className:`h-8 w-8 transition-colors ${mt<=$e?"fill-yellow-400 text-yellow-400":"text-gray-200 hover:text-yellow-300"}`})},mt)),n.jsxs("span",{className:"ml-2 text-gray-600 font-medium",children:[$e,"/5"]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Review Comment *"}),n.jsx("textarea",{value:Ae,onChange:mt=>Ye(mt.target.value),placeholder:"Write the customer's review here...",rows:4,className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171] resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Service Type"}),n.jsxs("select",{value:_t,onChange:mt=>Et(mt.target.value),className:"w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#e14171]",children:[n.jsx("option",{value:"laundry",children:"Laundry Services"}),n.jsx("option",{value:"suit",children:"Suit Cleaning"}),n.jsx("option",{value:"shoe",children:"Shoe Cleaning"}),n.jsx("option",{value:"dry-clean",children:"Dry Cleaning"})]})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:zt,onChange:mt=>ht(mt.target.checked),className:"w-5 h-5 text-[#e14171] rounded focus:ring-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Featured on Homepage"})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:Qe,onChange:mt=>Ce(mt.target.checked),className:"w-5 h-5 text-[#e14171] rounded focus:ring-[#e14171]"}),n.jsx("span",{className:"text-gray-700",children:"Approved"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{onClick:F?le:Le,disabled:Y||!Ne.trim()||!Ae.trim(),className:"flex-1 py-3 bg-[#e14171] text-white rounded-xl font-medium hover:bg-[#c73562] disabled:opacity-50 flex items-center justify-center gap-2",children:[Y&&n.jsx(Ss,{className:"h-4 w-4 animate-spin"}),F?"Add Review":"Save Changes"]}),n.jsx("button",{onClick:()=>{re(!1),ue(!1),Q(null)},className:"flex-1 py-3 border rounded-xl font-medium hover:bg-gray-50",children:"Cancel"})]})]})})]})}function zT(){const{getNumberSetting:m}=Cg(),[h,_]=ee.useState([]),[S,k]=ee.useState(!0),[P,T]=ee.useState(""),[c,O]=ee.useState(""),F=async()=>{k(!0);try{const[se,ue]=await Promise.all([vt.from("users").select("id, full_name, email"),vt.from("user_credits").select("user_id, amount, source_type, type, created_at")]);if(se.error)throw se.error;if(ue.error)throw ue.error;const ae=m("award_min_lifetime_earnings",1e3),Q=se.data||[],Y=ue.data||[],G=P?new Date(P).getTime():null,pe=c?new Date(c).getTime():null,_e=Q.map(Ne=>{const Oe=Y.filter(Ae=>Ae.user_id===Ne.id),Be=Oe.filter(Ae=>Number(Ae.amount)>0).reduce((Ae,Ye)=>Ae+Number(Ye.amount),0),xt=Oe.filter(Ae=>Number(Ae.amount)>0&&Ae.source_type==="referral").reduce((Ae,Ye)=>Ae+Number(Ye.amount),0),$e=Oe.reduce((Ae,Ye)=>Ae+Number(Ye.amount),0),de=Oe.reduce((Ae,Ye)=>{const _t=new Date(Ye.created_at||0).getTime();return _t>Ae?_t:Ae},0);return G&&(!de||de<G)||pe&&(!de||de>pe)?null:{id:Ne.id,name:Ne.full_name||"",email:Ne.email||"",lifetimeEarned:Be,referralEarned:xt,balance:$e,lastCreditAt:de?new Date(de).toLocaleString():"",qualifies:Be>=ae}}).filter(Boolean).sort((Ne,Oe)=>Oe.lifetimeEarned-Ne.lifetimeEarned);_(_e)}catch(se){console.error("Error loading referral earnings",se)}finally{k(!1)}};ee.useEffect(()=>{F()},[P,c]);const re=()=>{const se=["User","Email","Lifetime Earned","Referral Earned","Balance","Last Credit","Qualifies"],ue=h.map(pe=>[`"${(pe.name||"").replace(/"/g,'""')}"`,`"${(pe.email||"").replace(/"/g,'""')}"`,pe.lifetimeEarned.toFixed(2),pe.referralEarned.toFixed(2),pe.balance.toFixed(2),`"${pe.lastCreditAt}"`,pe.qualifies?"Yes":"No"].join(",")),ae=[se.join(","),...ue].join(`
`),Q=new Blob([ae],{type:"text/csv;charset=utf-8;"}),Y=URL.createObjectURL(Q),G=document.createElement("a");G.href=Y,G.download="referral_earnings.csv",G.click(),URL.revokeObjectURL(Y)};return n.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Referral Earnings"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Lifetime earnings, balances, and award eligibility"})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsx("input",{type:"date",value:P,onChange:se=>T(se.target.value),className:"px-3 py-2 border rounded-lg text-sm","aria-label":"From date"}),n.jsx("span",{className:"text-sm text-gray-500",children:"to"}),n.jsx("input",{type:"date",value:c,onChange:se=>O(se.target.value),className:"px-3 py-2 border rounded-lg text-sm","aria-label":"To date"}),n.jsx("button",{onClick:F,disabled:S,className:"px-3 py-2 border rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50",children:S?"Refreshing":"Refresh"}),n.jsx("button",{onClick:re,disabled:S||h.length===0,className:"px-3 py-2 bg-[#e14171] text-white rounded-lg text-sm hover:bg-[#c73562] disabled:opacity-50",children:"Export CSV"})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"text-left text-xs uppercase text-gray-500",children:[n.jsx("th",{className:"py-2 pr-4",children:"User"}),n.jsx("th",{className:"py-2 pr-4",children:"Email"}),n.jsx("th",{className:"py-2 pr-4",children:"Lifetime Earned"}),n.jsx("th",{className:"py-2 pr-4",children:"Referral Earned"}),n.jsx("th",{className:"py-2 pr-4",children:"Balance"}),n.jsx("th",{className:"py-2 pr-4",children:"Last Credit"}),n.jsx("th",{className:"py-2 pr-4",children:"Qualifies"})]})}),n.jsx("tbody",{children:S?n.jsx("tr",{children:n.jsxs("td",{colSpan:7,className:"py-6 text-center text-gray-500",children:[n.jsx(Ss,{className:"h-5 w-5 inline animate-spin text-[#e14171] mr-2"}),"Loading"]})}):h.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"py-6 text-center text-gray-500",children:"No data yet"})}):h.map(se=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"py-2 pr-4 font-medium text-gray-900",children:se.name}),n.jsx("td",{className:"py-2 pr-4 text-gray-600",children:se.email}),n.jsxs("td",{className:"py-2 pr-4",children:["$",se.lifetimeEarned.toFixed(2)]}),n.jsxs("td",{className:"py-2 pr-4",children:["$",se.referralEarned.toFixed(2)]}),n.jsxs("td",{className:"py-2 pr-4",children:["$",se.balance.toFixed(2)]}),n.jsx("td",{className:"py-2 pr-4 text-gray-500",children:se.lastCreditAt}),n.jsx("td",{className:"py-2 pr-4",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${se.qualifies?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:se.qualifies?"Yes":"No"})})]},se.id))})]})})]})}function OT(){const m=sc(),h=yf(),{dailyStats:_,orderPins:S,driverStats:k}=rm(),{user:P,signOut:T}=ao(),{canAccessAdmin:c,loading:O}=yv(),[F,re]=ee.useState(!1);ee.useEffect(()=>{!O&&!c()&&h("/")},[O,c,h]);const se=async()=>{re(!0),await T(),re(!1),h("/")},ue=[{path:"/admin",label:"Map View",icon:qa},{path:"/admin/orders",label:"All Orders",icon:kS},{path:"/admin/revenue",label:"Revenue",icon:Wd},{path:"/admin/customers",label:"Customer Notes",icon:nx},{path:"/admin/referrals",label:"Referral Earnings",icon:mf},{path:"/admin/drivers",label:"Driver Performance",icon:Yd},{path:"/admin/products",label:"Products & Pricing",icon:pf},{path:"/admin/subscriptions",label:"Subscription Plans",icon:Zu},{path:"/admin/services",label:"Service Categories",icon:Pn},{path:"/admin/reviews",label:"Reviews",icon:gf},{path:"/admin/users",label:"User Management",icon:Jy},{path:"/admin/settings",label:"Settings",icon:gv}],ae=Y=>m.pathname===Y,Q=[{label:"Active Orders",value:S.length,icon:_a,color:"text-[#e14171]"},{label:"Today's Revenue",value:`$${_.total.toFixed(0)}`,icon:Wd,color:"text-green-500"},{label:"Total Orders",value:_.orders,icon:hg,color:"text-orange-500"},{label:"Drivers Active",value:k.active,icon:Yd,color:"text-blue-500"}];return O?n.jsx("div",{className:"min-h-screen flex items-center justify-center text-gray-600",children:"Loading"}):c()?n.jsxs("div",{className:"min-h-screen bg-gray-50",children:[n.jsx("div",{className:"bg-black text-white py-4",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>h("/"),className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",title:"Back to Home",children:n.jsx(hv,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-bold",children:"Admin Dashboard"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"The Bubble Box Control Center"})]})]}),n.jsxs("div",{className:"flex items-center gap-6",children:[Q.map((Y,G)=>n.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[n.jsx(Y.icon,{className:`h-5 w-5 ${Y.color}`}),n.jsxs("div",{children:[n.jsx("p",{className:"text-lg font-bold",children:Y.value}),n.jsx("p",{className:"text-xs text-gray-400",children:Y.label})]})]},G)),n.jsxs("div",{className:"flex items-center gap-3 ml-4 pl-4 border-l border-gray-700",children:[P&&n.jsxs("div",{className:"hidden sm:block text-right",children:[n.jsx("p",{className:"text-sm font-medium",children:P.user_metadata?.full_name||P.email?.split("@")[0]||"Admin"}),n.jsx("p",{className:"text-xs text-gray-400",children:P.email})]}),n.jsxs("button",{onClick:se,disabled:F,className:"flex items-center gap-2 px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",title:"Logout",children:[F?n.jsx(Ss,{className:"h-4 w-4 animate-spin"}):n.jsx(o_,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline text-sm",children:"Logout"})]})]})]})]})})}),n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:n.jsxs("div",{className:"grid lg:grid-cols-5 gap-8",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm sticky top-24",children:[n.jsx("nav",{className:"space-y-2",children:ue.map(Y=>n.jsxs("button",{onClick:()=>h(Y.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-colors ${ae(Y.path)?"bg-[#e14171] text-white":"text-gray-600 hover:bg-gray-50"}`,children:[n.jsx(Y.icon,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium",children:Y.label}),n.jsx(Dn,{className:"h-4 w-4 ml-auto"})]},Y.path))}),n.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(ni,{className:"h-5 w-5 text-green-600"}),n.jsx("span",{className:"font-medium text-gray-900",children:"System Status"})]}),n.jsx("p",{className:"text-sm text-gray-600",children:"All services operational"})]})]})}),n.jsx("div",{className:"lg:col-span-4",children:n.jsxs(h_,{children:[n.jsx(Br,{path:"/",element:n.jsx(CT,{})}),n.jsx(Br,{path:"/orders",element:n.jsx(wT,{})}),n.jsx(Br,{path:"/revenue",element:n.jsx(AT,{})}),n.jsx(Br,{path:"/customers",element:n.jsx(kT,{})}),n.jsx(Br,{path:"/drivers",element:n.jsx(MT,{})}),n.jsx(Br,{path:"/products",element:n.jsx(PT,{})}),n.jsx(Br,{path:"/subscriptions",element:n.jsx(DT,{})}),n.jsx(Br,{path:"/services",element:n.jsx(RT,{})}),n.jsx(Br,{path:"/reviews",element:n.jsx(IT,{})}),n.jsx(Br,{path:"/referrals",element:n.jsx(zT,{})}),n.jsx(Br,{path:"/users",element:n.jsx(vT,{})}),n.jsx(Br,{path:"/settings",element:n.jsx(bT,{})})]})})]})})]}):null}function LT(){const{user:m}=ao(),{loading:h,unsubscribe:_,message:S,error:k}=_v(),[P,T]=ee.useState(""),[c,O]=ee.useState(!1);ee.useEffect(()=>{m?.email&&T(m.email)},[m?.email]);const F=async se=>{if(se.preventDefault(),!P)return;(await _(P)).success},re=!m;return n.jsxs("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:[n.jsxs("div",{className:"bg-white max-w-lg w-full rounded-2xl shadow-sm p-8 space-y-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Unsubscribe"}),n.jsx("p",{className:"text-gray-600",children:"Well stop marketing emails to this address. Transactional emails (order updates, receipts) will still arrive."})]}),re?n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Please sign in so we can identify your email automatically."}),n.jsx("button",{onClick:()=>O(!0),className:"w-full py-3 bg-[#e14171] text-white rounded-xl font-semibold hover:bg-[#c73562]",children:"Sign in to continue"})]}):S?n.jsxs("div",{className:"text-center space-y-4",children:[n.jsx("div",{className:"text-5xl",children:""}),n.jsx("h2",{className:"text-2xl font-semibold text-[#e14171]",children:"Sad to see you go"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Youve been unsubscribed from marketing emails. Transactional emails will still be sent."})]}):n.jsxs("form",{onSubmit:F,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),n.jsx("input",{type:"email",required:!0,value:P,readOnly:!0,className:"w-full px-4 py-3 border rounded-xl bg-gray-100 text-gray-700"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Were using your signed-in email."})]}),n.jsx("button",{type:"submit",disabled:h,className:"w-full py-3 bg-[#e14171] text-white rounded-xl font-semibold hover:bg-[#c73562] disabled:opacity-50",children:h?"Updating":"Unsubscribe from marketing emails"})]}),k&&n.jsx("div",{className:"p-3 rounded-xl text-sm bg-red-50 text-red-700",children:k}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Need help? Email ",n.jsx("span",{className:"font-medium text-gray-700",children:"support@bubblebox.com"}),"."]})]}),n.jsx(lx,{isOpen:c,onClose:()=>O(!1),initialMode:"signin"})]})}function BT(){return n.jsx(sS,{children:n.jsx(p1,{children:n.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[n.jsx(Qj,{}),n.jsxs(h_,{children:[n.jsx(Br,{path:"/",element:n.jsx(tT,{})}),n.jsx(Br,{path:"/pricing",element:n.jsx(sT,{})}),n.jsx(Br,{path:"/services",element:n.jsx(N0,{})}),n.jsx(Br,{path:"/services/:serviceId",element:n.jsx(N0,{})}),n.jsx(Br,{path:"/subscription",element:n.jsx(aT,{})}),n.jsx(Br,{path:"/booking",element:n.jsx(lT,{})}),n.jsx(Br,{path:"/portal/*",element:n.jsx(xT,{})}),n.jsx(Br,{path:"/admin/*",element:n.jsx(OT,{})}),n.jsx(Br,{path:"/unsubscribe",element:n.jsx(LT,{})})]}),n.jsx(eT,{})]})})})}Zv.createRoot(document.getElementById("root")).render(n.jsx(ee.StrictMode,{children:n.jsx(BT,{})}));</script>
    <style rel="stylesheet" crossorigin>@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0;--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-space-y-reverse:0;--tw-space-x-reverse:0;--tw-divide-y-reverse:0;--tw-border-style:solid;--tw-gradient-position:initial;--tw-gradient-from:#0000;--tw-gradient-via:#0000;--tw-gradient-to:#0000;--tw-gradient-stops:initial;--tw-gradient-via-stops:initial;--tw-gradient-from-position:0%;--tw-gradient-via-position:50%;--tw-gradient-to-position:100%;--tw-leading:initial;--tw-font-weight:initial;--tw-tracking:initial;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-backdrop-blur:initial;--tw-backdrop-brightness:initial;--tw-backdrop-contrast:initial;--tw-backdrop-grayscale:initial;--tw-backdrop-hue-rotate:initial;--tw-backdrop-invert:initial;--tw-backdrop-opacity:initial;--tw-backdrop-saturate:initial;--tw-backdrop-sepia:initial;--tw-duration:initial;--tw-ease:initial;--tw-scale-x:1;--tw-scale-y:1;--tw-scale-z:1}}}@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-50:oklch(97.1% .013 17.38);--color-red-100:oklch(93.6% .032 17.717);--color-red-200:oklch(88.5% .062 18.334);--color-red-300:oklch(80.8% .114 19.571);--color-red-400:oklch(70.4% .191 22.216);--color-red-500:oklch(63.7% .237 25.331);--color-red-600:oklch(57.7% .245 27.325);--color-red-700:oklch(50.5% .213 27.518);--color-red-800:oklch(44.4% .177 26.899);--color-orange-50:oklch(98% .016 73.684);--color-orange-100:oklch(95.4% .038 75.164);--color-orange-200:oklch(90.1% .076 70.697);--color-orange-500:oklch(70.5% .213 47.604);--color-orange-600:oklch(64.6% .222 41.116);--color-orange-700:oklch(55.3% .195 38.402);--color-orange-800:oklch(47% .157 37.304);--color-yellow-50:oklch(98.7% .026 102.212);--color-yellow-100:oklch(97.3% .071 103.193);--color-yellow-200:oklch(94.5% .129 101.54);--color-yellow-300:oklch(90.5% .182 98.111);--color-yellow-400:oklch(85.2% .199 91.936);--color-yellow-500:oklch(79.5% .184 86.047);--color-yellow-600:oklch(68.1% .162 75.834);--color-yellow-700:oklch(55.4% .135 66.442);--color-yellow-800:oklch(47.6% .114 61.907);--color-yellow-900:oklch(42.1% .095 57.708);--color-green-50:oklch(98.2% .018 155.826);--color-green-100:oklch(96.2% .044 156.743);--color-green-200:oklch(92.5% .084 155.995);--color-green-300:oklch(87.1% .15 154.449);--color-green-500:oklch(72.3% .219 149.579);--color-green-600:oklch(62.7% .194 149.214);--color-green-700:oklch(52.7% .154 150.069);--color-green-800:oklch(44.8% .119 151.328);--color-teal-100:oklch(95.3% .051 180.801);--color-teal-800:oklch(43.7% .078 188.216);--color-cyan-100:oklch(95.6% .045 203.388);--color-cyan-800:oklch(45% .085 224.283);--color-blue-50:oklch(97% .014 254.604);--color-blue-100:oklch(93.2% .032 255.585);--color-blue-200:oklch(88.2% .059 254.128);--color-blue-300:oklch(80.9% .105 251.813);--color-blue-500:oklch(62.3% .214 259.815);--color-blue-600:oklch(54.6% .245 262.881);--color-blue-700:oklch(48.8% .243 264.376);--color-blue-800:oklch(42.4% .199 265.638);--color-blue-900:oklch(37.9% .146 265.522);--color-indigo-100:oklch(93% .034 272.788);--color-indigo-600:oklch(51.1% .262 276.966);--color-indigo-800:oklch(39.8% .195 277.366);--color-purple-50:oklch(97.7% .014 308.299);--color-purple-100:oklch(94.6% .033 307.174);--color-purple-200:oklch(90.2% .063 306.703);--color-purple-300:oklch(82.7% .119 306.383);--color-purple-400:oklch(71.4% .203 305.504);--color-purple-500:oklch(62.7% .265 303.9);--color-purple-600:oklch(55.8% .288 302.321);--color-purple-700:oklch(49.6% .265 301.924);--color-purple-800:oklch(43.8% .218 303.724);--color-purple-900:oklch(38.1% .176 304.987);--color-pink-50:oklch(97.1% .014 343.198);--color-pink-100:oklch(94.8% .028 342.258);--color-pink-200:oklch(89.9% .061 343.231);--color-pink-400:oklch(71.8% .202 349.761);--color-pink-500:oklch(65.6% .241 354.308);--color-pink-600:oklch(59.2% .249 .584);--color-pink-800:oklch(45.9% .187 3.815);--color-rose-50:oklch(96.9% .015 12.422);--color-rose-100:oklch(94.1% .03 12.58);--color-rose-600:oklch(58.6% .253 17.585);--color-gray-50:oklch(98.5% .002 247.839);--color-gray-100:oklch(96.7% .003 264.542);--color-gray-200:oklch(92.8% .006 264.531);--color-gray-300:oklch(87.2% .01 258.338);--color-gray-400:oklch(70.7% .022 261.325);--color-gray-500:oklch(55.1% .027 264.364);--color-gray-600:oklch(44.6% .03 256.802);--color-gray-700:oklch(37.3% .034 259.733);--color-gray-800:oklch(27.8% .033 256.848);--color-gray-900:oklch(21% .034 264.665);--color-black:#000;--color-white:#fff;--spacing:.25rem;--container-xs:20rem;--container-md:28rem;--container-lg:32rem;--container-xl:36rem;--container-2xl:42rem;--container-3xl:48rem;--container-4xl:56rem;--container-5xl:64rem;--container-7xl:80rem;--text-xs:.75rem;--text-xs--line-height:calc(1/.75);--text-sm:.875rem;--text-sm--line-height:calc(1.25/.875);--text-base:1rem;--text-base--line-height: 1.5 ;--text-lg:1.125rem;--text-lg--line-height:calc(1.75/1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75/1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2/1.5);--text-3xl:1.875rem;--text-3xl--line-height: 1.2 ;--text-4xl:2.25rem;--text-4xl--line-height:calc(2.5/2.25);--text-5xl:3rem;--text-5xl--line-height:1;--text-6xl:3.75rem;--text-6xl--line-height:1;--font-weight-normal:400;--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--tracking-wide:.025em;--leading-tight:1.25;--radius-lg:.5rem;--radius-xl:.75rem;--radius-2xl:1rem;--radius-3xl:1.5rem;--ease-in-out:cubic-bezier(.4,0,.2,1);--animate-spin:spin 1s linear infinite;--animate-pulse:pulse 2s cubic-bezier(.4,0,.6,1)infinite;--blur-sm:8px;--blur-3xl:64px;--default-transition-duration:.15s;--default-transition-timing-function:cubic-bezier(.4,0,.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono)}}@layer base{*,:after,:before,::backdrop{box-sizing:border-box;border:0 solid;margin:0;padding:0}::file-selector-button{box-sizing:border-box;border:0 solid;margin:0;padding:0}html,:host{-webkit-text-size-adjust:100%;tab-size:4;line-height:1.5;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{vertical-align:middle;display:block}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not ((-webkit-appearance:-apple-pay-button))) or (contain-intrinsic-size:1px){::placeholder{color:currentColor}@supports (color:color-mix(in lab,red,red)){::placeholder{color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit{padding-block:0}::-webkit-datetime-edit-year-field{padding-block:0}::-webkit-datetime-edit-month-field{padding-block:0}::-webkit-datetime-edit-day-field{padding-block:0}::-webkit-datetime-edit-hour-field{padding-block:0}::-webkit-datetime-edit-minute-field{padding-block:0}::-webkit-datetime-edit-second-field{padding-block:0}::-webkit-datetime-edit-millisecond-field{padding-block:0}::-webkit-datetime-edit-meridiem-field{padding-block:0}::-webkit-calendar-picker-indicator{line-height:1}:-moz-ui-invalid{box-shadow:none}button,input:where([type=button],[type=reset],[type=submit]){appearance:button}::file-selector-button{appearance:button}::-webkit-inner-spin-button{height:auto}::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden=until-found])){display:none!important}}@layer components;@layer utilities{.collapse{visibility:collapse}.visible{visibility:visible}.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.static{position:static}.sticky{position:sticky}.inset-0{inset:calc(var(--spacing)*0)}.-top-4{top:calc(var(--spacing)*-4)}.top-0{top:calc(var(--spacing)*0)}.top-1{top:calc(var(--spacing)*1)}.top-1\/2{top:50%}.top-4{top:calc(var(--spacing)*4)}.top-16{top:calc(var(--spacing)*16)}.top-24{top:calc(var(--spacing)*24)}.-right-4{right:calc(var(--spacing)*-4)}.-right-6{right:calc(var(--spacing)*-6)}.right-0{right:calc(var(--spacing)*0)}.right-3{right:calc(var(--spacing)*3)}.right-4{right:calc(var(--spacing)*4)}.-bottom-4{bottom:calc(var(--spacing)*-4)}.-bottom-6{bottom:calc(var(--spacing)*-6)}.bottom-0{bottom:calc(var(--spacing)*0)}.-left-4{left:calc(var(--spacing)*-4)}.left-0{left:calc(var(--spacing)*0)}.left-3{left:calc(var(--spacing)*3)}.left-4{left:calc(var(--spacing)*4)}.z-10{z-index:10}.z-20{z-index:20}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.z-\[100\]{z-index:100}.col-span-1{grid-column:span 1/span 1}.col-span-2{grid-column:span 2/span 2}.col-span-5{grid-column:span 5/span 5}.container{width:100%}@media(min-width:40rem){.container{max-width:40rem}}@media(min-width:48rem){.container{max-width:48rem}}@media(min-width:64rem){.container{max-width:64rem}}@media(min-width:80rem){.container{max-width:80rem}}@media(min-width:96rem){.container{max-width:96rem}}.mx-2{margin-inline:calc(var(--spacing)*2)}.mx-4{margin-inline:calc(var(--spacing)*4)}.mx-auto{margin-inline:auto}.my-4{margin-block:calc(var(--spacing)*4)}.mt-0{margin-top:calc(var(--spacing)*0)}.mt-0\.5{margin-top:calc(var(--spacing)*.5)}.mt-1{margin-top:calc(var(--spacing)*1)}.mt-2{margin-top:calc(var(--spacing)*2)}.mt-3{margin-top:calc(var(--spacing)*3)}.mt-4{margin-top:calc(var(--spacing)*4)}.mt-6{margin-top:calc(var(--spacing)*6)}.mt-8{margin-top:calc(var(--spacing)*8)}.mt-12{margin-top:calc(var(--spacing)*12)}.mt-auto{margin-top:auto}.mr-1{margin-right:calc(var(--spacing)*1)}.mr-2{margin-right:calc(var(--spacing)*2)}.mb-1{margin-bottom:calc(var(--spacing)*1)}.mb-2{margin-bottom:calc(var(--spacing)*2)}.mb-3{margin-bottom:calc(var(--spacing)*3)}.mb-4{margin-bottom:calc(var(--spacing)*4)}.mb-6{margin-bottom:calc(var(--spacing)*6)}.mb-8{margin-bottom:calc(var(--spacing)*8)}.mb-12{margin-bottom:calc(var(--spacing)*12)}.ml-1{margin-left:calc(var(--spacing)*1)}.ml-2{margin-left:calc(var(--spacing)*2)}.ml-3{margin-left:calc(var(--spacing)*3)}.ml-4{margin-left:calc(var(--spacing)*4)}.ml-6{margin-left:calc(var(--spacing)*6)}.ml-8{margin-left:calc(var(--spacing)*8)}.ml-auto{margin-left:auto}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.inline{display:inline}.inline-block{display:inline-block}.inline-flex{display:inline-flex}.table{display:table}.h-1{height:calc(var(--spacing)*1)}.h-2{height:calc(var(--spacing)*2)}.h-3{height:calc(var(--spacing)*3)}.h-4{height:calc(var(--spacing)*4)}.h-5{height:calc(var(--spacing)*5)}.h-6{height:calc(var(--spacing)*6)}.h-7{height:calc(var(--spacing)*7)}.h-8{height:calc(var(--spacing)*8)}.h-10{height:calc(var(--spacing)*10)}.h-11{height:calc(var(--spacing)*11)}.h-12{height:calc(var(--spacing)*12)}.h-14{height:calc(var(--spacing)*14)}.h-16{height:calc(var(--spacing)*16)}.h-20{height:calc(var(--spacing)*20)}.h-24{height:calc(var(--spacing)*24)}.h-32{height:calc(var(--spacing)*32)}.h-48{height:calc(var(--spacing)*48)}.h-64{height:calc(var(--spacing)*64)}.h-72{height:calc(var(--spacing)*72)}.h-80{height:calc(var(--spacing)*80)}.h-96{height:calc(var(--spacing)*96)}.h-\[420px\]{height:420px}.h-full{height:100%}.max-h-40{max-height:calc(var(--spacing)*40)}.max-h-48{max-height:calc(var(--spacing)*48)}.max-h-96{max-height:calc(var(--spacing)*96)}.max-h-\[60vh\]{max-height:60vh}.max-h-\[90vh\]{max-height:90vh}.min-h-screen{min-height:100vh}.w-0{width:calc(var(--spacing)*0)}.w-0\.5{width:calc(var(--spacing)*.5)}.w-2{width:calc(var(--spacing)*2)}.w-3{width:calc(var(--spacing)*3)}.w-4{width:calc(var(--spacing)*4)}.w-5{width:calc(var(--spacing)*5)}.w-6{width:calc(var(--spacing)*6)}.w-7{width:calc(var(--spacing)*7)}.w-8{width:calc(var(--spacing)*8)}.w-10{width:calc(var(--spacing)*10)}.w-12{width:calc(var(--spacing)*12)}.w-14{width:calc(var(--spacing)*14)}.w-16{width:calc(var(--spacing)*16)}.w-20{width:calc(var(--spacing)*20)}.w-24{width:calc(var(--spacing)*24)}.w-32{width:calc(var(--spacing)*32)}.w-48{width:calc(var(--spacing)*48)}.w-64{width:calc(var(--spacing)*64)}.w-72{width:calc(var(--spacing)*72)}.w-fit{width:fit-content}.w-full{width:100%}.max-w-2xl{max-width:var(--container-2xl)}.max-w-3xl{max-width:var(--container-3xl)}.max-w-4xl{max-width:var(--container-4xl)}.max-w-5xl{max-width:var(--container-5xl)}.max-w-7xl{max-width:var(--container-7xl)}.max-w-lg{max-width:var(--container-lg)}.max-w-md{max-width:var(--container-md)}.max-w-xl{max-width:var(--container-xl)}.max-w-xs{max-width:var(--container-xs)}.min-w-0{min-width:calc(var(--spacing)*0)}.min-w-\[140px\]{min-width:140px}.min-w-\[240px\]{min-width:240px}.min-w-full{min-width:100%}.flex-1{flex:1}.flex-shrink-0{flex-shrink:0}.border-collapse{border-collapse:collapse}.-translate-x-1{--tw-translate-x:calc(var(--spacing)*-1);translate:var(--tw-translate-x)var(--tw-translate-y)}.-translate-x-1\/2{--tw-translate-x: -50% ;translate:var(--tw-translate-x)var(--tw-translate-y)}.translate-x-1{--tw-translate-x:calc(var(--spacing)*1);translate:var(--tw-translate-x)var(--tw-translate-y)}.translate-x-1\/2{--tw-translate-x: 50% ;translate:var(--tw-translate-x)var(--tw-translate-y)}.-translate-y-1{--tw-translate-y:calc(var(--spacing)*-1);translate:var(--tw-translate-x)var(--tw-translate-y)}.-translate-y-1\/2{--tw-translate-y: -50% ;translate:var(--tw-translate-x)var(--tw-translate-y)}.translate-y-1{--tw-translate-y:calc(var(--spacing)*1);translate:var(--tw-translate-x)var(--tw-translate-y)}.translate-y-1\/2{--tw-translate-y: 50% ;translate:var(--tw-translate-x)var(--tw-translate-y)}.scale-\[1\.02\]{scale:1.02}.rotate-3{rotate:3deg}.rotate-90{rotate:90deg}.transform{transform:var(--tw-rotate-x,)var(--tw-rotate-y,)var(--tw-rotate-z,)var(--tw-skew-x,)var(--tw-skew-y,)}.animate-\[float_6s_ease-in-out_infinite\]{animation:6s ease-in-out infinite float}.animate-pulse{animation:var(--animate-pulse)}.animate-spin{animation:var(--animate-spin)}.cursor-default{cursor:default}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.resize{resize:both}.resize-none{resize:none}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.items-start{align-items:flex-start}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.gap-1{gap:calc(var(--spacing)*1)}.gap-2{gap:calc(var(--spacing)*2)}.gap-3{gap:calc(var(--spacing)*3)}.gap-4{gap:calc(var(--spacing)*4)}.gap-6{gap:calc(var(--spacing)*6)}.gap-8{gap:calc(var(--spacing)*8)}.gap-12{gap:calc(var(--spacing)*12)}:where(.space-y-1>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*1)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*1)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-2>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*2)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*2)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-3>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*3)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*3)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-4>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*4)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*4)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-6>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*6)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*6)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-8>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*8)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*8)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-x-2>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing)*2)*var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing)*2)*calc(1 - var(--tw-space-x-reverse)))}:where(.divide-y>:not(:last-child)){--tw-divide-y-reverse:0;border-bottom-style:var(--tw-border-style);border-top-style:var(--tw-border-style);border-top-width:calc(1px*var(--tw-divide-y-reverse));border-bottom-width:calc(1px*calc(1 - var(--tw-divide-y-reverse)))}:where(.divide-gray-100>:not(:last-child)){border-color:var(--color-gray-100)}.truncate{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:var(--radius-2xl)}.rounded-3xl{border-radius:var(--radius-3xl)}.rounded-full{border-radius:3.40282e38px}.rounded-lg{border-radius:var(--radius-lg)}.rounded-xl{border-radius:var(--radius-xl)}.rounded-t-2xl{border-top-left-radius:var(--radius-2xl);border-top-right-radius:var(--radius-2xl)}.rounded-b-2xl{border-bottom-right-radius:var(--radius-2xl);border-bottom-left-radius:var(--radius-2xl)}.border{border-style:var(--tw-border-style);border-width:1px}.border-0{border-style:var(--tw-border-style);border-width:0}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-t{border-top-style:var(--tw-border-style);border-top-width:1px}.border-t-2{border-top-style:var(--tw-border-style);border-top-width:2px}.border-b{border-bottom-style:var(--tw-border-style);border-bottom-width:1px}.border-b-2{border-bottom-style:var(--tw-border-style);border-bottom-width:2px}.border-l{border-left-style:var(--tw-border-style);border-left-width:1px}.border-dashed{--tw-border-style:dashed;border-style:dashed}.border-\[\#e14171\]{border-color:#e14171}.border-blue-200{border-color:var(--color-blue-200)}.border-blue-300{border-color:var(--color-blue-300)}.border-gray-100{border-color:var(--color-gray-100)}.border-gray-200{border-color:var(--color-gray-200)}.border-gray-300{border-color:var(--color-gray-300)}.border-gray-400{border-color:var(--color-gray-400)}.border-gray-700{border-color:var(--color-gray-700)}.border-gray-800{border-color:var(--color-gray-800)}.border-green-200{border-color:var(--color-green-200)}.border-green-300{border-color:var(--color-green-300)}.border-green-500{border-color:var(--color-green-500)}.border-orange-200{border-color:var(--color-orange-200)}.border-pink-100{border-color:var(--color-pink-100)}.border-pink-200{border-color:var(--color-pink-200)}.border-purple-300{border-color:var(--color-purple-300)}.border-red-200{border-color:var(--color-red-200)}.border-red-300{border-color:var(--color-red-300)}.border-red-500{border-color:var(--color-red-500)}.border-transparent{border-color:#0000}.border-white{border-color:var(--color-white)}.border-white\/20{border-color:#fff3}@supports (color:color-mix(in lab,red,red)){.border-white\/20{border-color:color-mix(in oklab,var(--color-white)20%,transparent)}}.border-yellow-200{border-color:var(--color-yellow-200)}.border-yellow-300{border-color:var(--color-yellow-300)}.border-t-transparent{border-top-color:#0000}.bg-\[\#F8F9FA\]{background-color:#f8f9fa}.bg-\[\#e14171\]{background-color:#e14171}.bg-\[\#e14171\]\/10{background-color:#e141711a}.bg-\[\#e14171\]\/20{background-color:#e1417133}.bg-black{background-color:var(--color-black)}.bg-black\/50{background-color:#00000080}@supports (color:color-mix(in lab,red,red)){.bg-black\/50{background-color:color-mix(in oklab,var(--color-black)50%,transparent)}}.bg-black\/60{background-color:#0009}@supports (color:color-mix(in lab,red,red)){.bg-black\/60{background-color:color-mix(in oklab,var(--color-black)60%,transparent)}}.bg-blue-50{background-color:var(--color-blue-50)}.bg-blue-100{background-color:var(--color-blue-100)}.bg-blue-500{background-color:var(--color-blue-500)}.bg-cyan-100{background-color:var(--color-cyan-100)}.bg-gray-50{background-color:var(--color-gray-50)}.bg-gray-100{background-color:var(--color-gray-100)}.bg-gray-200{background-color:var(--color-gray-200)}.bg-gray-300{background-color:var(--color-gray-300)}.bg-gray-400{background-color:var(--color-gray-400)}.bg-gray-500{background-color:var(--color-gray-500)}.bg-gray-600{background-color:var(--color-gray-600)}.bg-gray-700{background-color:var(--color-gray-700)}.bg-gray-800{background-color:var(--color-gray-800)}.bg-gray-900{background-color:var(--color-gray-900)}.bg-green-50{background-color:var(--color-green-50)}.bg-green-100{background-color:var(--color-green-100)}.bg-green-500{background-color:var(--color-green-500)}.bg-indigo-100{background-color:var(--color-indigo-100)}.bg-orange-50{background-color:var(--color-orange-50)}.bg-orange-100{background-color:var(--color-orange-100)}.bg-pink-50{background-color:var(--color-pink-50)}.bg-pink-100{background-color:var(--color-pink-100)}.bg-pink-400{background-color:var(--color-pink-400)}.bg-pink-500{background-color:var(--color-pink-500)}.bg-purple-50{background-color:var(--color-purple-50)}.bg-purple-100{background-color:var(--color-purple-100)}.bg-purple-200{background-color:var(--color-purple-200)}.bg-purple-300{background-color:var(--color-purple-300)}.bg-purple-500{background-color:var(--color-purple-500)}.bg-red-50{background-color:var(--color-red-50)}.bg-red-100{background-color:var(--color-red-100)}.bg-red-500{background-color:var(--color-red-500)}.bg-red-600{background-color:var(--color-red-600)}.bg-rose-100{background-color:var(--color-rose-100)}.bg-teal-100{background-color:var(--color-teal-100)}.bg-white{background-color:var(--color-white)}.bg-white\/10{background-color:#ffffff1a}@supports (color:color-mix(in lab,red,red)){.bg-white\/10{background-color:color-mix(in oklab,var(--color-white)10%,transparent)}}.bg-white\/20{background-color:#fff3}@supports (color:color-mix(in lab,red,red)){.bg-white\/20{background-color:color-mix(in oklab,var(--color-white)20%,transparent)}}.bg-white\/70{background-color:#ffffffb3}@supports (color:color-mix(in lab,red,red)){.bg-white\/70{background-color:color-mix(in oklab,var(--color-white)70%,transparent)}}.bg-yellow-50{background-color:var(--color-yellow-50)}.bg-yellow-100{background-color:var(--color-yellow-100)}.bg-yellow-500{background-color:var(--color-yellow-500)}.bg-gradient-to-br{--tw-gradient-position:to bottom right in oklab;background-image:linear-gradient(var(--tw-gradient-stops))}.bg-gradient-to-r{--tw-gradient-position:to right in oklab;background-image:linear-gradient(var(--tw-gradient-stops))}.from-\[\#e14171\]{--tw-gradient-from:#e14171;--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.from-black{--tw-gradient-from:var(--color-black);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.from-gray-50{--tw-gradient-from:var(--color-gray-50);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.from-pink-50{--tw-gradient-from:var(--color-pink-50);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.from-pink-100{--tw-gradient-from:var(--color-pink-100);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.via-gray-900{--tw-gradient-via:var(--color-gray-900);--tw-gradient-via-stops:var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-via)var(--tw-gradient-via-position),var(--tw-gradient-to)var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-via-stops)}.to-black{--tw-gradient-to:var(--color-black);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.to-gray-100{--tw-gradient-to:var(--color-gray-100);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.to-gray-900{--tw-gradient-to:var(--color-gray-900);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.to-pink-400{--tw-gradient-to:var(--color-pink-400);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.to-pink-500{--tw-gradient-to:var(--color-pink-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.to-pink-600{--tw-gradient-to:var(--color-pink-600);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.to-rose-50{--tw-gradient-to:var(--color-rose-50);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.to-white{--tw-gradient-to:var(--color-white);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-position))}.fill-\[\#e14171\]{fill:#e14171}.fill-current{fill:currentColor}.fill-red-500{fill:var(--color-red-500)}.fill-yellow-400{fill:var(--color-yellow-400)}.fill-yellow-500{fill:var(--color-yellow-500)}.object-cover{object-fit:cover}.p-1{padding:calc(var(--spacing)*1)}.p-2{padding:calc(var(--spacing)*2)}.p-3{padding:calc(var(--spacing)*3)}.p-4{padding:calc(var(--spacing)*4)}.p-6{padding:calc(var(--spacing)*6)}.p-8{padding:calc(var(--spacing)*8)}.px-1{padding-inline:calc(var(--spacing)*1)}.px-2{padding-inline:calc(var(--spacing)*2)}.px-3{padding-inline:calc(var(--spacing)*3)}.px-4{padding-inline:calc(var(--spacing)*4)}.px-5{padding-inline:calc(var(--spacing)*5)}.px-6{padding-inline:calc(var(--spacing)*6)}.px-8{padding-inline:calc(var(--spacing)*8)}.py-0{padding-block:calc(var(--spacing)*0)}.py-0\.5{padding-block:calc(var(--spacing)*.5)}.py-1{padding-block:calc(var(--spacing)*1)}.py-1\.5{padding-block:calc(var(--spacing)*1.5)}.py-2{padding-block:calc(var(--spacing)*2)}.py-3{padding-block:calc(var(--spacing)*3)}.py-4{padding-block:calc(var(--spacing)*4)}.py-6{padding-block:calc(var(--spacing)*6)}.py-8{padding-block:calc(var(--spacing)*8)}.py-10{padding-block:calc(var(--spacing)*10)}.py-12{padding-block:calc(var(--spacing)*12)}.py-14{padding-block:calc(var(--spacing)*14)}.py-16{padding-block:calc(var(--spacing)*16)}.pt-2{padding-top:calc(var(--spacing)*2)}.pt-3{padding-top:calc(var(--spacing)*3)}.pt-4{padding-top:calc(var(--spacing)*4)}.pt-8{padding-top:calc(var(--spacing)*8)}.pt-12{padding-top:calc(var(--spacing)*12)}.pr-4{padding-right:calc(var(--spacing)*4)}.pr-10{padding-right:calc(var(--spacing)*10)}.pr-12{padding-right:calc(var(--spacing)*12)}.pb-2{padding-bottom:calc(var(--spacing)*2)}.pb-3{padding-bottom:calc(var(--spacing)*3)}.pb-4{padding-bottom:calc(var(--spacing)*4)}.pb-6{padding-bottom:calc(var(--spacing)*6)}.pb-12{padding-bottom:calc(var(--spacing)*12)}.pb-20{padding-bottom:calc(var(--spacing)*20)}.pl-4{padding-left:calc(var(--spacing)*4)}.pl-8{padding-left:calc(var(--spacing)*8)}.pl-10{padding-left:calc(var(--spacing)*10)}.pl-12{padding-left:calc(var(--spacing)*12)}.text-center{text-align:center}.text-justify{text-align:justify}.text-left{text-align:left}.text-right{text-align:right}.font-mono{font-family:var(--font-mono)}.text-2xl{font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}.text-3xl{font-size:var(--text-3xl);line-height:var(--tw-leading,var(--text-3xl--line-height))}.text-4xl{font-size:var(--text-4xl);line-height:var(--tw-leading,var(--text-4xl--line-height))}.text-5xl{font-size:var(--text-5xl);line-height:var(--tw-leading,var(--text-5xl--line-height))}.text-6xl{font-size:var(--text-6xl);line-height:var(--tw-leading,var(--text-6xl--line-height))}.text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.text-lg{font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}.text-xs{font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}.leading-tight{--tw-leading:var(--leading-tight);line-height:var(--leading-tight)}.font-bold{--tw-font-weight:var(--font-weight-bold);font-weight:var(--font-weight-bold)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.font-normal{--tw-font-weight:var(--font-weight-normal);font-weight:var(--font-weight-normal)}.font-semibold{--tw-font-weight:var(--font-weight-semibold);font-weight:var(--font-weight-semibold)}.tracking-wide{--tw-tracking:var(--tracking-wide);letter-spacing:var(--tracking-wide)}.whitespace-nowrap{white-space:nowrap}.text-\[\#e14171\]{color:#e14171}.text-blue-500{color:var(--color-blue-500)}.text-blue-600{color:var(--color-blue-600)}.text-blue-700{color:var(--color-blue-700)}.text-blue-800{color:var(--color-blue-800)}.text-blue-900{color:var(--color-blue-900)}.text-cyan-800{color:var(--color-cyan-800)}.text-gray-200{color:var(--color-gray-200)}.text-gray-300{color:var(--color-gray-300)}.text-gray-400{color:var(--color-gray-400)}.text-gray-500{color:var(--color-gray-500)}.text-gray-600{color:var(--color-gray-600)}.text-gray-700{color:var(--color-gray-700)}.text-gray-800{color:var(--color-gray-800)}.text-gray-900{color:var(--color-gray-900)}.text-green-300{color:var(--color-green-300)}.text-green-500{color:var(--color-green-500)}.text-green-600{color:var(--color-green-600)}.text-green-700{color:var(--color-green-700)}.text-green-800{color:var(--color-green-800)}.text-indigo-600{color:var(--color-indigo-600)}.text-indigo-800{color:var(--color-indigo-800)}.text-orange-500{color:var(--color-orange-500)}.text-orange-600{color:var(--color-orange-600)}.text-orange-700{color:var(--color-orange-700)}.text-orange-800{color:var(--color-orange-800)}.text-pink-100{color:var(--color-pink-100)}.text-pink-200{color:var(--color-pink-200)}.text-pink-800{color:var(--color-pink-800)}.text-purple-400{color:var(--color-purple-400)}.text-purple-600{color:var(--color-purple-600)}.text-purple-700{color:var(--color-purple-700)}.text-purple-800{color:var(--color-purple-800)}.text-purple-900{color:var(--color-purple-900)}.text-red-500{color:var(--color-red-500)}.text-red-600{color:var(--color-red-600)}.text-red-700{color:var(--color-red-700)}.text-red-800{color:var(--color-red-800)}.text-rose-600{color:var(--color-rose-600)}.text-teal-800{color:var(--color-teal-800)}.text-white{color:var(--color-white)}.text-white\/80{color:#fffc}@supports (color:color-mix(in lab,red,red)){.text-white\/80{color:color-mix(in oklab,var(--color-white)80%,transparent)}}.text-white\/90{color:#ffffffe6}@supports (color:color-mix(in lab,red,red)){.text-white\/90{color:color-mix(in oklab,var(--color-white)90%,transparent)}}.text-yellow-400{color:var(--color-yellow-400)}.text-yellow-500{color:var(--color-yellow-500)}.text-yellow-600{color:var(--color-yellow-600)}.text-yellow-700{color:var(--color-yellow-700)}.text-yellow-800{color:var(--color-yellow-800)}.text-yellow-900{color:var(--color-yellow-900)}.capitalize{text-transform:capitalize}.lowercase{text-transform:lowercase}.uppercase{text-transform:uppercase}.italic{font-style:italic}.underline{text-decoration-line:underline}.opacity-0{opacity:0}.opacity-10{opacity:.1}.opacity-20{opacity:.2}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.opacity-75{opacity:.75}.opacity-90{opacity:.9}.shadow-2xl{--tw-shadow:0 25px 50px -12px var(--tw-shadow-color,#00000040);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px var(--tw-shadow-color,#0000001a),0 4px 6px -4px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px var(--tw-shadow-color,#0000001a),0 2px 4px -2px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,#0000001a),0 1px 2px -1px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px var(--tw-shadow-color,#0000001a),0 8px 10px -6px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring{--tw-ring-shadow:var(--tw-ring-inset,)0 0 0 calc(1px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-2{--tw-ring-shadow:var(--tw-ring-inset,)0 0 0 calc(2px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-\[\#e14171\]{--tw-ring-color:#e14171}.ring-blue-300{--tw-ring-color:var(--color-blue-300)}.ring-red-400{--tw-ring-color:var(--color-red-400)}.blur{--tw-blur:blur(8px);filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.blur-3xl{--tw-blur:blur(var(--blur-3xl));filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.invert{--tw-invert:invert(100%);filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.backdrop-blur-sm{--tw-backdrop-blur:blur(var(--blur-sm));-webkit-backdrop-filter:var(--tw-backdrop-blur,)var(--tw-backdrop-brightness,)var(--tw-backdrop-contrast,)var(--tw-backdrop-grayscale,)var(--tw-backdrop-hue-rotate,)var(--tw-backdrop-invert,)var(--tw-backdrop-opacity,)var(--tw-backdrop-saturate,)var(--tw-backdrop-sepia,);backdrop-filter:var(--tw-backdrop-blur,)var(--tw-backdrop-brightness,)var(--tw-backdrop-contrast,)var(--tw-backdrop-grayscale,)var(--tw-backdrop-hue-rotate,)var(--tw-backdrop-invert,)var(--tw-backdrop-opacity,)var(--tw-backdrop-saturate,)var(--tw-backdrop-sepia,)}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,-webkit-backdrop-filter,backdrop-filter,display,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-colors{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-shadow{transition-property:box-shadow;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-transform{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.duration-200{--tw-duration:.2s;transition-duration:.2s}.duration-300{--tw-duration:.3s;transition-duration:.3s}.ease-in-out{--tw-ease:var(--ease-in-out);transition-timing-function:var(--ease-in-out)}@media(hover:hover){.group-hover\:scale-105:is(:where(.group):hover *){--tw-scale-x:105%;--tw-scale-y:105%;--tw-scale-z:105%;scale:var(--tw-scale-x)var(--tw-scale-y)}.group-hover\:opacity-100:is(:where(.group):hover *){opacity:1}}.last\:border-0:last-child{border-style:var(--tw-border-style);border-width:0}@media(hover:hover){.hover\:-translate-y-1:hover{--tw-translate-y:calc(var(--spacing)*-1);translate:var(--tw-translate-x)var(--tw-translate-y)}.hover\:border-\[\#e14171\]:hover{border-color:#e14171}.hover\:border-gray-300:hover{border-color:var(--color-gray-300)}.hover\:border-gray-400:hover{border-color:var(--color-gray-400)}.hover\:bg-\[\#c73562\]:hover{background-color:#c73562}.hover\:bg-blue-50:hover{background-color:var(--color-blue-50)}.hover\:bg-blue-100:hover{background-color:var(--color-blue-100)}.hover\:bg-blue-200:hover{background-color:var(--color-blue-200)}.hover\:bg-gray-50:hover{background-color:var(--color-gray-50)}.hover\:bg-gray-100:hover{background-color:var(--color-gray-100)}.hover\:bg-gray-200:hover{background-color:var(--color-gray-200)}.hover\:bg-gray-300:hover{background-color:var(--color-gray-300)}.hover\:bg-gray-600:hover{background-color:var(--color-gray-600)}.hover\:bg-gray-700:hover{background-color:var(--color-gray-700)}.hover\:bg-gray-800:hover{background-color:var(--color-gray-800)}.hover\:bg-green-50:hover{background-color:var(--color-green-50)}.hover\:bg-green-200:hover{background-color:var(--color-green-200)}.hover\:bg-green-600:hover{background-color:var(--color-green-600)}.hover\:bg-pink-50:hover{background-color:var(--color-pink-50)}.hover\:bg-purple-200:hover{background-color:var(--color-purple-200)}.hover\:bg-red-50:hover{background-color:var(--color-red-50)}.hover\:bg-red-100:hover{background-color:var(--color-red-100)}.hover\:bg-red-200:hover{background-color:var(--color-red-200)}.hover\:bg-red-700:hover{background-color:var(--color-red-700)}.hover\:bg-white\/10:hover{background-color:#ffffff1a}@supports (color:color-mix(in lab,red,red)){.hover\:bg-white\/10:hover{background-color:color-mix(in oklab,var(--color-white)10%,transparent)}}.hover\:bg-white\/20:hover{background-color:#fff3}@supports (color:color-mix(in lab,red,red)){.hover\:bg-white\/20:hover{background-color:color-mix(in oklab,var(--color-white)20%,transparent)}}.hover\:bg-white\/30:hover{background-color:#ffffff4d}@supports (color:color-mix(in lab,red,red)){.hover\:bg-white\/30:hover{background-color:color-mix(in oklab,var(--color-white)30%,transparent)}}.hover\:bg-yellow-200:hover{background-color:var(--color-yellow-200)}.hover\:bg-yellow-600:hover{background-color:var(--color-yellow-600)}.hover\:text-\[\#e14171\]:hover{color:#e14171}.hover\:text-blue-600:hover{color:var(--color-blue-600)}.hover\:text-gray-200:hover{color:var(--color-gray-200)}.hover\:text-gray-600:hover{color:var(--color-gray-600)}.hover\:text-gray-700:hover{color:var(--color-gray-700)}.hover\:text-gray-800:hover{color:var(--color-gray-800)}.hover\:text-gray-900:hover{color:var(--color-gray-900)}.hover\:text-red-500:hover{color:var(--color-red-500)}.hover\:text-red-600:hover{color:var(--color-red-600)}.hover\:text-white:hover{color:var(--color-white)}.hover\:text-yellow-300:hover{color:var(--color-yellow-300)}.hover\:text-yellow-800:hover{color:var(--color-yellow-800)}.hover\:underline:hover{text-decoration-line:underline}.hover\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px var(--tw-shadow-color,#0000001a),0 4px 6px -4px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px var(--tw-shadow-color,#0000001a),0 2px 4px -2px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.hover\:shadow-sm:hover{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,#0000001a),0 1px 2px -1px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.hover\:shadow-xl:hover{--tw-shadow:0 20px 25px -5px var(--tw-shadow-color,#0000001a),0 8px 10px -6px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:border-\[\#e14171\]:focus{border-color:#e14171}.focus\:border-transparent:focus{border-color:#0000}.focus\:ring-2:focus{--tw-ring-shadow:var(--tw-ring-inset,)0 0 0 calc(2px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.focus\:ring-\[\#e14171\]:focus{--tw-ring-color:#e14171}.focus\:outline-none:focus{--tw-outline-style:none;outline-style:none}.active\:scale-95:active{--tw-scale-x:95%;--tw-scale-y:95%;--tw-scale-z:95%;scale:var(--tw-scale-x)var(--tw-scale-y)}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:text-gray-400:disabled{color:var(--color-gray-400)}.disabled\:opacity-50:disabled{opacity:.5}@media(min-width:40rem){.sm\:mb-6{margin-bottom:calc(var(--spacing)*6)}.sm\:mb-8{margin-bottom:calc(var(--spacing)*8)}.sm\:block{display:block}.sm\:flex{display:flex}.sm\:inline{display:inline}.sm\:h-14{height:calc(var(--spacing)*14)}.sm\:w-24{width:calc(var(--spacing)*24)}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.sm\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.sm\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.sm\:flex-row{flex-direction:row}.sm\:items-center{align-items:center}.sm\:items-end{align-items:flex-end}.sm\:justify-between{justify-content:space-between}.sm\:gap-3{gap:calc(var(--spacing)*3)}.sm\:gap-4{gap:calc(var(--spacing)*4)}:where(.sm\:space-y-3>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*3)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*3)*calc(1 - var(--tw-space-y-reverse)))}.sm\:p-8{padding:calc(var(--spacing)*8)}.sm\:px-6{padding-inline:calc(var(--spacing)*6)}.sm\:px-8{padding-inline:calc(var(--spacing)*8)}.sm\:py-4{padding-block:calc(var(--spacing)*4)}.sm\:py-16{padding-block:calc(var(--spacing)*16)}.sm\:pt-14{padding-top:calc(var(--spacing)*14)}.sm\:text-2xl{font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}.sm\:text-3xl{font-size:var(--text-3xl);line-height:var(--tw-leading,var(--text-3xl--line-height))}.sm\:text-4xl{font-size:var(--text-4xl);line-height:var(--tw-leading,var(--text-4xl--line-height))}.sm\:text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.sm\:text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}}@media(min-width:48rem){.md\:flex{display:flex}.md\:hidden{display:none}.md\:w-auto{width:auto}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.md\:flex-row{flex-direction:row}.md\:items-center{align-items:center}.md\:justify-between{justify-content:space-between}.md\:justify-end{justify-content:flex-end}.md\:gap-4{gap:calc(var(--spacing)*4)}.md\:p-8{padding:calc(var(--spacing)*8)}.md\:p-12{padding:calc(var(--spacing)*12)}.md\:pb-0{padding-bottom:calc(var(--spacing)*0)}.md\:text-4xl{font-size:var(--text-4xl);line-height:var(--tw-leading,var(--text-4xl--line-height))}}@media(min-width:64rem){.lg\:col-span-1{grid-column:span 1/span 1}.lg\:col-span-3{grid-column:span 3/span 3}.lg\:col-span-4{grid-column:span 4/span 4}.lg\:block{display:block}.lg\:flex{display:flex}.lg\:h-96{height:calc(var(--spacing)*96)}.lg\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.lg\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.lg\:flex-row{flex-direction:row}.lg\:items-center{align-items:center}.lg\:px-8{padding-inline:calc(var(--spacing)*8)}.lg\:py-24{padding-block:calc(var(--spacing)*24)}.lg\:text-5xl{font-size:var(--text-5xl);line-height:var(--tw-leading,var(--text-5xl--line-height))}}}.maplibregl-map{-webkit-tap-highlight-color:#0000;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;position:relative;overflow:hidden}.maplibregl-canvas{position:absolute;top:0;left:0}.maplibregl-map:fullscreen{width:100%;height:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;z-index:2;position:absolute}.maplibregl-ctrl-top-left{top:0;left:0}.maplibregl-ctrl-top-right{top:0;right:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media(forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px buttontext}}.maplibregl-ctrl-group button{box-sizing:border-box;cursor:pointer;background-color:#0000;border:0;outline:none;width:29px;height:29px;padding:0;display:block}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;width:100%;height:100%;display:block}@media(forced-colors:active){.maplibregl-ctrl-icon{background-color:#0000}.maplibregl-ctrl-group button+button{border-top:1px solid buttontext}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}@media(hover:hover){.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}}.maplibregl-ctrl button:not(:disabled):active{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media(forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media(forced-colors:active)and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media(forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media(forced-colors:active)and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media(forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media(forced-colors:active)and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%23333' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%2333b5e5' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:2s linear infinite maplibregl-spin}@media(forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media(forced-colors:active)and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{cursor:pointer;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;width:88px;height:23px;margin:0 0 -4px -4px;display:block;overflow:hidden}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media(forced-colors:active){a.maplibregl-ctrl-logo{background-color:#0000;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media(forced-colors:active)and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{box-sizing:content-box;color:#000;background-color:#fff;border-radius:12px;min-height:20px;margin:10px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{visibility:visible;padding:2px 28px 2px 8px}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{box-sizing:border-box;cursor:pointer;background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;outline:none;width:24px;height:24px;display:none;position:absolute;top:0;right:0}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{top:0;right:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{top:0;left:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active)and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{box-sizing:border-box;color:#333;white-space:nowrap;background-color:#ffffffbf;border:2px solid #333;border-top:#333;padding:0 5px;font-size:10px}.maplibregl-popup{pointer-events:none;will-change:transform;display:flex;position:absolute;top:0;left:0}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{z-index:1;border:10px solid #0000;width:0;height:0}.maplibregl-popup-anchor-top .maplibregl-popup-tip{border-top:none;border-bottom-color:#fff;align-self:center}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{border-top:none;border-bottom-color:#fff;border-left:none;align-self:flex-start}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{border-top:none;border-bottom-color:#fff;border-right:none;align-self:flex-end}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{border-top-color:#fff;border-bottom:none;align-self:center}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{border-top-color:#fff;border-bottom:none;border-left:none;align-self:flex-start}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{border-top-color:#fff;border-bottom:none;border-right:none;align-self:flex-end}.maplibregl-popup-anchor-left .maplibregl-popup-tip{border-left:none;border-right-color:#fff;align-self:center}.maplibregl-popup-anchor-right .maplibregl-popup-tip{border-left-color:#fff;border-right:none;align-self:center}.maplibregl-popup-close-button{cursor:pointer;background-color:#0000;border:0;border-radius:0 3px 0 0;position:absolute;top:0;right:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{pointer-events:auto;background:#fff;border-radius:3px;padding:15px 10px;position:relative;box-shadow:0 1px 2px #0000001a}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{will-change:transform;transition:opacity .2s;position:absolute;top:0;left:0}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;width:15px;height:15px}.maplibregl-user-location-dot:before{content:"";animation:2s infinite maplibregl-user-location-dot-pulse;position:absolute}.maplibregl-user-location-dot:after{box-sizing:border-box;content:"";border:2px solid #fff;border-radius:50%;width:19px;height:19px;position:absolute;top:-2px;left:-2px;box-shadow:0 0 3px #00000059}@media(prefers-reduced-motion:reduce){.maplibregl-user-location-dot:before{animation:none}}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;width:1px;height:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{opacity:.5;background:#fff;border:2px dotted #202020;width:0;height:0;position:absolute;top:0;left:0}.maplibregl-cooperative-gesture-screen{color:#fff;opacity:0;pointer-events:none;z-index:99999;background:#0006;justify-content:center;align-items:center;padding:1rem;font-size:1.4em;line-height:1.2;transition:opacity 1s 1s;display:flex;position:absolute;inset:0}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity 50ms}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media(hover:none),(pointer:coarse){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{z-index:99999;width:100%!important;height:100%!important;position:fixed!important;top:0!important;left:0!important}@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-6px)}to{transform:translateY(0)}}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-space-x-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-divide-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-gradient-position{syntax:"*";inherits:false}@property --tw-gradient-from{syntax:"<color>";inherits:false;initial-value:#0000}@property --tw-gradient-via{syntax:"<color>";inherits:false;initial-value:#0000}@property --tw-gradient-to{syntax:"<color>";inherits:false;initial-value:#0000}@property --tw-gradient-stops{syntax:"*";inherits:false}@property --tw-gradient-via-stops{syntax:"*";inherits:false}@property --tw-gradient-from-position{syntax:"<length-percentage>";inherits:false;initial-value:0%}@property --tw-gradient-via-position{syntax:"<length-percentage>";inherits:false;initial-value:50%}@property --tw-gradient-to-position{syntax:"<length-percentage>";inherits:false;initial-value:100%}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-tracking{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-backdrop-blur{syntax:"*";inherits:false}@property --tw-backdrop-brightness{syntax:"*";inherits:false}@property --tw-backdrop-contrast{syntax:"*";inherits:false}@property --tw-backdrop-grayscale{syntax:"*";inherits:false}@property --tw-backdrop-hue-rotate{syntax:"*";inherits:false}@property --tw-backdrop-invert{syntax:"*";inherits:false}@property --tw-backdrop-opacity{syntax:"*";inherits:false}@property --tw-backdrop-saturate{syntax:"*";inherits:false}@property --tw-backdrop-sepia{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-ease{syntax:"*";inherits:false}@property --tw-scale-x{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-y{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-z{syntax:"*";inherits:false;initial-value:1}@keyframes spin{to{transform:rotate(360deg)}}@keyframes pulse{50%{opacity:.5}}</style>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
